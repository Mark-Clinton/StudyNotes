<center>
    <h1>
        Javaè¿›é˜¶
    </h1>
</center>

## 1. å¤ä¹ å›é¡¾

- å®šä¹‰ç±»ã€‚ä¸€ä¸ªJavaæ–‡ä»¶å¯ä»¥å®šä¹‰å¤šä¸ªç±»ã€‚ä½†æ˜¯åªæœ‰ä¸€ä¸ªç±»æ˜¯ç”¨publicä¿®é¥°ï¼Œpublicä¿®é¥°çš„ç±»åå¿…é¡»ç§°ä¸ºJavaæ–‡ä»¶åã€‚
- ç±»ä¸­æœ‰ä¸”ä»…æœ‰5å¤§æˆåˆ†(äº”å¤§é‡‘åˆš)
  - æˆå‘˜å˜é‡Fieldï¼šæè¿°ç±»æˆ–è€…å¯¹è±¡çš„å±æ€§ä¿¡æ¯çš„ã€‚
  - æˆå‘˜æ–¹æ³•Methodï¼šæè¿°ç±»æˆ–è€…å¯¹è±¡çš„è¡Œä¸ºçš„ã€‚
  - æ„é€ å™¨(æ„é€ æ–¹æ³•ï¼ŒConstructor)ï¼šåˆå§‹åŒ–ç±»çš„ä¸€ä¸ªå¯¹è±¡è¿”å›ã€‚
  - ä»£ç å—ï¼šè¿˜æ²¡æœ‰å­¦ã€‚
  - å†…éƒ¨ç±»ï¼šè¿˜æ²¡æœ‰å­¦ã€‚
  - æ³¨æ„ï¼šåªè¦ä¸æ˜¯è¿™5å¤§æˆåˆ†æ”¾åœ¨ç±»ä¸‹å°±ä¼šæŠ¥é”™ã€‚
- å°è£…
  - é¢å‘å¯¹è±¡çš„ä¸‰å¤§ç‰¹å¾ä¹‹ä¸€ï¼šå°è£…ï¼Œç»§æ‰¿ï¼Œå¤šæ€ã€‚
  - å½¢æˆäº†è§„èŒƒï¼Œå³ä½¿æ¯«æ— æ„ä¹‰è¿˜æ˜¯ä¼šè¿™æ ·å†™ä»£ç ï¼
  - åˆç†éšè—ï¼Œåˆç†æš´éœ²ã€‚
  - å°è£…çš„è§„èŒƒï¼šæˆå‘˜å˜é‡ç§æœ‰ï¼Œæ–¹æ³•ä¸€èˆ¬å…¬å¼€ï¼Œæä¾›æˆå¥—çš„getterå’Œsetteræ–¹æ³•æš´éœ²æˆå‘˜å˜é‡çš„å–å€¼å’Œèµ‹å€¼ã€‚
  - å°è£…çš„ä½œç”¨ï¼šæé«˜å®‰å…¨æ€§ï¼Œæé«˜ä»£ç çš„ç»„ä»¶åŒ–æ€æƒ³ã€‚
  - å°è£…å·²ç»æˆä¸ºJavaä»£ç çš„è§„èŒƒï¼Œå³ä½¿æ¯«æ— æ„ä¹‰ï¼Œæˆ‘ä»¬ä¹Ÿè¦è¿™æ ·å†™ä»£ç (æˆå‘˜å˜é‡ç§æœ‰ï¼Œæ–¹æ³•å…¬å¼€)
- thiså…³é”®å­—
  - thisä»£è¡¨äº†å½“å‰å¯¹è±¡çš„å¼•ç”¨ã€‚
  - thiså¯ä»¥å‡ºç°åœ¨æ„é€ å™¨å’Œæ–¹æ³•ä¸­ã€‚
  - thiså‡ºç°åœ¨æ„é€ å™¨ä¸­ä»£è¡¨æ„é€ å™¨æ­£åœ¨åˆå§‹åŒ–çš„å¯¹è±¡ã€‚
  - thiså‡ºç°åœ¨æ–¹æ³•ä¸­ï¼Œå“ªä¸ªå¯¹è±¡è°ƒç”¨æ–¹æ³•ï¼Œthiså°±ä»£è¡¨å“ªä¸ªå¯¹è±¡ã€‚
  - thiså¯ä»¥è®¿é—®å¯¹è±¡çš„æˆå‘˜å˜é‡ï¼ŒåŒºåˆ†æˆå‘˜å˜é‡æ˜¯å±€éƒ¨çš„è¿˜æ˜¯å¯¹è±¡ä¸­çš„æˆå‘˜å˜é‡ã€‚
- staticå…³é”®å­—
  - é™æ€ã€‚
  - ä¿®é¥°æ–¹æ³•å’Œå˜é‡éƒ½æ˜¯å±äºç±»çš„ã€‚æ²¡æœ‰staticä¿®é¥°çš„æ–¹æ³•å’Œå˜é‡æ˜¯å±äºæ¯ä¸ªå¯¹è±¡çš„ã€‚
- ç»§æ‰¿
  - æ˜¯é¢å‘å¯¹è±¡çš„ä¸‰å¤§ç‰¹å¾ä¹‹ä¸€ï¼šå°è£…ï¼Œç»§æ‰¿ï¼Œå¤šæ€ã€‚
  - ç»§æ‰¿æ˜¯Javaä¸­ä¸€èˆ¬åˆ°ç‰¹æ®Šçš„å…³ç³»ï¼Œæ˜¯ä¸€ç§å­ç±»åˆ°çˆ¶ç±»çš„å…³ç³»ã€‚ä¾‹å¦‚ï¼šå­¦ç”Ÿç±»ç»§æ‰¿äº†äººç±»ã€‚çŒ«ç±»ç»§æ‰¿äº†åŠ¨ç‰©ç±»ã€‚
  - è¢«ç»§æ‰¿çš„ç±»ç§°ä¸ºï¼šçˆ¶ç±»/è¶…ç±»ã€‚
  - ç»§æ‰¿çˆ¶ç±»çš„ç±»ç§°ä¸ºï¼šå­ç±»ã€‚
  - å¯æé«˜ä»£ç çš„å¤ç”¨ã€‚
  - å­ç±»æ›´å¼ºå¤§ï¼Œå­ç±»ä¸ä»…å¾—åˆ°äº†çˆ¶ç±»çš„åŠŸèƒ½ï¼Œå®ƒè¿˜æœ‰è‡ªå·±çš„åŠŸèƒ½ã€‚
  - ç»§æ‰¿çš„ç‰¹ç‚¹ï¼šå­ç±»ç»§æ‰¿äº†ä¸€ä¸ªçˆ¶ç±»ï¼Œå­ç±»å°±å¯ä»¥ç›´æ¥å¾—åˆ°çˆ¶ç±»çš„å±æ€§(æˆå‘˜å˜é‡)å’Œè¡Œä¸º(æ–¹æ³•)äº†ã€‚å•ç»§æ‰¿ï¼Œå¤šå±‚ç»§æ‰¿ã€‚è‹¥æ”¯æŒå¤šç»§æ‰¿ä¼šå‡ºç°ç±»çš„äºŒä¹‰æ€§ï¼Œæ•…ä¸æ”¯æŒå¤šç»§æ‰¿ã€‚
  - å­ç±»ä¸èƒ½ç»§æ‰¿çˆ¶ç±»çš„æ„é€ å™¨ï¼šå­ç±»æœ‰è‡ªå·±çš„æ„é€ å™¨ã€‚
  - æœ‰äº‰è®®çš„è§‚ç‚¹(æ‹“å±•)
    - è®¤ä¸ºå­ç±»æ˜¯å¯ä»¥ç»§æ‰¿çˆ¶ç±»çš„ç§æœ‰æˆå‘˜çš„ï¼Œåªæ˜¯ä¸èƒ½ç›´æ¥è®¿é—®è€Œå·²ã€‚ä»¥åå¯ä»¥åˆ©ç”¨åå°„æš´åŠ›å»è®¿é—®ç»§æ‰¿è‡ªçˆ¶ç±»çš„ç§æœ‰æˆå‘˜ã€‚
    - è®¤ä¸ºå­ç±»æ˜¯ä¸èƒ½ç»§æ‰¿çˆ¶ç±»çš„é™æ€æˆå‘˜çš„ï¼Œå­ç±»åªæ˜¯å¯ä»¥è®¿é—®çˆ¶ç±»çš„é™æ€æˆå‘˜ï¼Œçˆ¶ç±»çš„é™æ€æˆå‘˜åªæœ‰ä¸€ä»½å¯ä»¥è¢«å­ç±»å…±äº«è®¿é—®ã€‚å…±äº«å¹¶éç»§æ‰¿ã€‚
  - thisä»£è¡¨äº†å½“å‰å¯¹è±¡çš„å¼•ç”¨ï¼Œå¯ä»¥ç”¨äºè®¿é—®å½“å‰å­ç±»å¯¹è±¡çš„æˆå‘˜å˜é‡ã€‚
  - superä»£è¡¨äº†çˆ¶ç±»å¯¹è±¡çš„å¼•ç”¨ï¼Œå¯ä»¥ç”¨äºè®¿é—®çˆ¶ç±»ä¸­çš„æˆå‘˜å˜é‡ã€‚
  - å­ç±»çš„æ„é€ å™¨çš„ç¬¬ä¸€è¡Œé»˜è®¤æœ‰ä¸€ä¸ªsuper()è°ƒç”¨çˆ¶ç±»çš„æ— å‚æ•°æ„é€ å™¨ï¼Œå†™ä¸å†™éƒ½å­˜åœ¨ã€‚
  - å­ç±»ç»§æ‰¿çˆ¶ç±»ï¼Œå­ç±»å°±å¾—åˆ°äº†çˆ¶ç±»çš„å±æ€§å’Œè¡Œä¸ºã€‚å½“æˆ‘ä»¬è°ƒç”¨å­ç±»æ„é€ å™¨åˆå§‹åŒ–å­ç±»å¯¹è±¡æ•°æ®çš„æ—¶å€™ï¼Œå¿…é¡»å…ˆè°ƒç”¨çˆ¶ç±»æ„é€ å™¨åˆå§‹åŒ–ç»§æ‰¿è‡ªçˆ¶ç±»çš„å±æ€§å’Œè¡Œä¸ºã€‚
  - å¯ä»¥åœ¨å­ç±»æ„é€ å™¨ä¸­é€šè¿‡super(...)æ ¹æ®å‚æ•°é€‰æ‹©è°ƒç”¨åˆ†ç±»çš„æ„é€ å™¨ï¼Œä»¥ä¾¿è°ƒç”¨çˆ¶ç±»æ„é€ å™¨åˆå§‹åŒ–ç»§æ‰¿è‡ªçˆ¶ç±»çš„æ•°æ®ã€‚
  - this(...)å’Œsuper(...)å¿…é¡»æ”¾åœ¨æ„é€ å™¨çš„ç¬¬ä¸€è¡Œï¼Œå¦åˆ™æŠ¥é”™ã€‚æ‰€ä»¥this(...)å’Œsuper(...)ä¸èƒ½åŒæ—¶å‡ºç°åœ¨æ„é€ å™¨ä¸­ã€‚
- æ–¹æ³•é‡å†™
  - æ–¹æ³•é‡å†™æ˜¯å­ç±»é‡å†™ä¸€ä¸ªä¸çˆ¶ç±»ç”³æ˜ä¸€æ ·çš„æ–¹æ³•è¦†ç›–çˆ¶ç±»çš„æ–¹æ³•ã€‚
  - æ–¹æ³•é‡å†™å»ºè®®åŠ ä¸Š@Overrideæ³¨è§£ã€‚
  - æ–¹æ³•é‡å†™çš„æ ¸å¿ƒè¦æ±‚ï¼šæ–¹æ³•åç§°å½¢å‚åˆ—è¡¨å¿…é¡»ä¸è¢«é‡å†™çš„æ–¹æ³•ä¸€è‡´ã€‚
  - å»ºè®®â€œç”³æ˜ä¸å˜ï¼Œé‡æ–°å®ç°â€ã€‚
  - é™æ€æ–¹æ³•å’Œç§æœ‰æ–¹æ³•éƒ½ä¸å¯ä»¥è¢«é‡å†™ï¼ŒåŠ ä¸Š@Overrideéƒ½æŠ¥é”™ã€‚
- å¼•ç”¨ç±»å‹
  - é™¤äº†åŸºæœ¬æ•°æ®ç±»å‹éƒ½æ˜¯å¼•ç”¨æ•°æ®ç±»å‹ï¼Œå¼•ç”¨ç±»å‹å­˜çš„éƒ½æ˜¯åœ°å€ã€‚
  - å¼•ç”¨ç±»å‹ä½œä¸ºæ•°æ®ç±»å‹å¯ä»¥åœ¨ä¸€åˆ‡å¯ä»¥ä½¿ç”¨ç±»å‹çš„åœ°æ–¹ä½¿ç”¨ã€‚
  - å¼•ç”¨ç±»å‹å¯ä»¥ä½œä¸ºæˆå‘˜å˜é‡çš„ç±»å‹(å¤åˆç±»å‹)ã€‚

## 2. æŠ½è±¡ç±»

### 2.1 æŠ½è±¡ç±»æ¦‚è¿°

çˆ¶ç±»çŸ¥é“å­ç±»ä¸€å®šè¦å®ŒæˆæŸä¸ªåŠŸèƒ½ï¼Œä½†æ˜¯æ¯ä¸ªå­ç±»å®Œæˆçš„æƒ…å†µæ˜¯ä¸ä¸€æ ·çš„ã€‚å­ç±»ä»¥åä¹Ÿåªä¼šç”¨è‡ªå·±é‡å†™çš„åŠŸèƒ½ï¼Œé‚£ä¹ˆçˆ¶ç±»çš„è¯¥åŠŸèƒ½å¯ä»¥å®šä¹‰æˆæŠ½è±¡æ–¹æ³•ï¼Œå­ç±»é‡å†™è°ƒç”¨å­ç±»è‡ªå·±çš„å°±å¯ä»¥äº†ã€‚

**æŠ½è±¡æ–¹æ³•**

æŠ½è±¡æ–¹æ³•ï¼šæ²¡æœ‰æ–¹æ³•ä½“ï¼Œåªæœ‰æ–¹æ³•ç­¾åï¼Œå¿…é¡»ç”¨abstractä¿®é¥°ã€‚

æ‹¥æœ‰æŠ½è±¡æ–¹æ³•çš„ç±»å¿…é¡»å®šä¹‰æˆæŠ½è±¡ç±»ã€‚

æŠ½è±¡ç±»ï¼šå¿…é¡»ç”¨abstractä¿®é¥°ã€‚

**å°ç»“**

æŠ½è±¡ç±»ï¼šæ‹¥æœ‰æŠ½è±¡æ–¹æ³•ç±»å¿…é¡»å®šä¹‰æˆæŠ½è±¡ç±»ï¼ŒæŠ½è±¡ç±»å¿…é¡»ç”¨abstractä¿®é¥°ã€‚

æŠ½è±¡æ–¹æ³•ï¼šæ²¡æœ‰æ–¹æ³•ä½“ï¼Œåªæœ‰æ–¹æ³•ç­¾åï¼Œå¿…é¡»ç”¨abstractä¿®é¥°ã€‚

æŠ½è±¡ç±»æ˜¯ä¸ºäº†è¢«å­ç±»ç»§æ‰¿ï¼Œå¿…é¡»é‡å†™å®ŒæŠ½è±¡ç±»çš„å…¨éƒ¨æŠ½è±¡æ–¹æ³•ï¼Œå¦åˆ™è¿™ä¸ªç±»ä¹Ÿå¿…é¡»å®šä¹‰æˆæŠ½è±¡ç±»ã€‚

### 2.2 æŠ½è±¡ç±»çš„ç‰¹å¾

æŠ½è±¡ç±»çš„ç‰¹å¾æ˜¯ï¼šæœ‰å¾—æœ‰å¤±ã€‚

- æœ‰å¾—ï¼šæŠ½è±¡ç±»å¾—åˆ°äº†æ‹¥æœ‰æŠ½è±¡æ–¹æ³•çš„èƒ½åŠ›ã€‚
- æœ‰å¤±ï¼šæŠ½è±¡ç±»å¤±å»äº†åˆ›å»ºå¯¹è±¡çš„èƒ½åŠ›ã€‚(æŠ½è±¡ç±»ä¸èƒ½åˆ›å»ºå¯¹è±¡)

æŠ½è±¡ç±»ä½œä¸ºç±»ä¸€å®šæœ‰æ„é€ å™¨ï¼Œè€Œä¸”æŠ½è±¡ç±»å¿…é¡»æœ‰æ„é€ å™¨ã€‚æä¾›ç»™å­ç±»åˆ›å»ºå¯¹è±¡è°ƒç”¨çˆ¶ç±»æ„é€ å™¨ä½¿ç”¨çš„ã€‚

æŠ½è±¡ç±»è™½ç„¶æœ‰æ„é€ å™¨ä½†æ˜¯æŠ½è±¡ç±»ä¸èƒ½åˆ›å»ºå¯¹è±¡ã€‚æŠ½è±¡ç±»ä¸­çš„æŠ½è±¡æ–¹æ³•ä¸èƒ½æ‰§è¡Œï¼Œå› ä¸ºå®ƒæ²¡æœ‰æ–¹æ³•ä½“ï¼Œæ‰€ä»¥æŠ½è±¡ç±»ä¸èƒ½åˆ›å»ºå¯¹è±¡ã€‚

æ³¨æ„ï¼šæŠ½è±¡ç±»é™¤äº†æœ‰å¾—æœ‰å¤±ï¼Œç±»çš„å…¶ä»–æˆåˆ†å®ƒéƒ½å…·å¤‡ã€‚

æŠ½è±¡ç±»å­˜åœ¨çš„æ„ä¹‰æœ‰2ç‚¹ï¼š

1. æŠ½è±¡ç±»å°±æ˜¯ä¸ºäº†è¢«å­ç±»ç»§æ‰¿(å°±æ˜¯ä¸ºäº†æ´¾ç”Ÿå­ç±»)ï¼Œå¦åˆ™æŠ½è±¡ç±»æ¯«æ— æ„ä¹‰ã€‚(åŸºæœ¬å‡†åˆ™)
2. æŠ½è±¡ç±»ä½“ç°çš„æ˜¯æ¨¡æ¿æ€æƒ³ï¼Œéƒ¨åˆ†å®ç°ï¼Œéƒ¨åˆ†æŠ½è±¡ã€‚

### 2.3 æŠ½è±¡ç±»è®¾è®¡æ¨¡æ¿æ¨¡å¼

è®¾è®¡æ¨¡å¼ï¼šè®¾è®¡æ¨¡å¼æ˜¯å‰äººæˆ–è€…æŠ€æœ¯å¤§ç‰›æˆ–è€…è½¯ä»¶è¡Œä¸šåœ¨ç”Ÿäº§å®è·µä¸­å‘ç°çš„ä¼˜ç§€è½¯ä»¶è®¾è®¡æ¶æ„å’Œæ€æƒ³ã€‚åæ¥è€…å¯ä»¥ç›´æ¥ç”¨è¿™äº›æ¶æ„æˆ–è€…æ€æƒ³å°±å¯ä»¥è®¾è®¡å‡ºä¼˜ç§€ï¼Œæé«˜æ•ˆç‡ï¼Œæé«˜è½¯ä»¶å¯æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§çš„è½¯ä»¶ã€‚

æ¨¡æ¿è®¾è®¡æ¨¡å¼å°±æ˜¯ä¸€ç§ç»å…¸çš„è®¾è®¡æ¨¡å¼æ€æƒ³ã€‚

æ¨¡æ¿è®¾è®¡æ¨¡å¼çš„ä½œç”¨ï¼šä¼˜åŒ–ä»£ç æ¶æ„ï¼Œæé«˜ä»£ç çš„å¤ç”¨æ€§ï¼Œç›¸åŒåŠŸèƒ½çš„é‡å¤ä»£ç æ— éœ€åå¤ä¹¦å†™ã€‚å¯ä»¥åšåˆ°éƒ¨åˆ†å®ç°ï¼Œéƒ¨åˆ†æŠ½è±¡ï¼ŒæŠ½è±¡çš„ä¸œè¥¿äº¤ç»™ä½¿ç”¨æ¨¡æ¿çš„äººé‡å†™å®ç°ã€‚

```Java
public class AbstractDemo {
    public static void main(String[] args) {
        Student ss = new Student();
        ss.write();
    }
}

class Student extends Template {
    @Override
    public String writeMain() {
        return "\t\tæˆ‘çš„å­¦æ ¡å¾ˆå¥½ï¼Œå¾ˆç‰›é€¼ã€‚";
    }
}

abstract class Template {
    private String title = "\t\t\t\t\t\tã€Šæˆ‘çš„å¤§å­¦ã€‹";
    private String one = "\t\tè¯·ä»‹ç»ä¸€ä¸‹ä½ çš„å¤§å­¦ï¼Œè¯´è¯´ä½ çš„å¤§å­¦æœ‰å¤šå¥½ï¼Œè¯´è¯´æœ‰å¤šç‰›é€¼ã€‚";
    private String last = "\t\tæˆ‘çš„å¤§å­¦çœŸæ£’ï¼Œèƒ½åœ¨è¿™æ ·çš„å¤§å­¦é‡Œè¯»ä¹¦çœŸæ˜¯å¤ªå¥½äº†ã€‚";

    public void write() {
        System.out.println(title);
        System.out.println(one);
        System.out.println(writeMain());
        System.out.println(last);
    }

    public abstract String writeMain();
}
```

## 3. æ¥å£

### 3.1 æ¥å£çš„æ¦‚è¿°

æ¥å£çš„æ¦‚å¿µ

- æ¥å£æ˜¯æ›´åŠ å½»åº•çš„æŠ½è±¡ï¼Œåœ¨JDK1.8ä¹‹å‰æ¥å£ä¸­åªèƒ½æ˜¯æŠ½è±¡æ–¹æ³•å’Œå¸¸é‡ã€‚
- æ¥å£ä½“ç°çš„æ˜¯è§„èŒƒæ€æƒ³ï¼Œå®ç°æ¥å£çš„å­ç±»å¿…é¡»é‡å†™å®Œæ¥å£çš„å…¨éƒ¨æŠ½è±¡æ–¹æ³•ã€‚

æ¥å£çš„å®šä¹‰æ ¼å¼ï¼šä¿®é¥°ç¬¦ interface æ¥å£åç§° {}

æ¥å£ä¸­æˆåˆ†çš„ç ”ç©¶ï¼šåœ¨JDK1.8ä¹‹å‰æ¥å£ä¸­åªèƒ½æ˜¯æŠ½è±¡æ–¹æ³•å’Œå¸¸é‡ã€‚

æ¥å£ä¸­å¸¸é‡

- å˜é‡å€¼åªæœ‰ä¸€ä¸ªï¼Œè€Œä¸”åœ¨ç¨‹åºè¿è¡Œçš„è¿‡ç¨‹ä¸­ä¸å¯æ›´æ”¹ã€‚
- å¸¸é‡ä¸€èˆ¬ä¿®é¥°ç¬¦æ˜¯ï¼špublic static finalã€‚
- å¸¸é‡çš„å˜é‡åç§°å»ºè®®å­—æ¯å…¨å¤§å†™ï¼Œå¤šä¸ªå•è¯ç”¨â€œ_â€è¿æ¥ã€‚
- æ¥å£ä¸­å¸¸é‡æ˜¯å¯ä»¥çœå»public stati finalçš„ã€‚

### 3.2 æ¥å£çš„åŸºæœ¬å®ç°

ç±»ä¸ç±»æ˜¯ç»§æ‰¿å…³ç³»ï¼Œç±»ä¸æ¥å£æ˜¯å®ç°å…³ç³»ã€‚æ¥å£æ˜¯è¢«ç±»å®ç°çš„ã€‚

å®ç°æ¥å£çš„ç±»ç§°ä¸ºï¼šå®ç°ç±»ã€‚

implementsï¼šç±»å®ç°æ¥å£çš„å…³é”®å­—ã€‚

æ¥å£å¯ä»¥å¤šå®ç°ã€‚

ä¸€ä¸ªç±»å®ç°æ¥å£å¿…é¡»é‡å†™å®Œæ¥å£ä¸­å…¨éƒ¨çš„æŠ½è±¡æ–¹æ³•ï¼Œå¦åˆ™è¿™ä¸ªç±»è¦å®šä¹‰æˆæŠ½è±¡ç±»ã€‚

æ¥å£ä¸æ¥å£çš„å¤šç»§æ‰¿ï¼šä¸€ä¸ªæ¥å£å¯ä»¥åŒæ—¶ç»§æ‰¿å¤šä¸ªæ¥å£ã€‚

JDK1.8å¼€å§‹ä¹‹åçš„æ¥å£

- JDK1.8ä¹‹å‰æ¥å£ä¸­åªèƒ½æ˜¯æŠ½è±¡æ–¹æ³•å’Œå¸¸é‡ï¼ŒJDK1.8ä¹‹åæ¥å£æ–°å¢äº†ä¸‰ä¸ªæ–¹æ³•ã€‚
  - é»˜è®¤æ–¹æ³•ï¼šå…¶å®å°±æ˜¯ä¹‹å‰çš„å®ä¾‹æ–¹æ³•ã€‚
    - å¿…é¡»ç”¨defaultä¿®é¥°
    - é»˜è®¤ä¼šåŠ publicä¿®é¥°
    - åªèƒ½ç”¨æ¥å£çš„å®ç°ç±»çš„å¯¹è±¡æ¥è°ƒç”¨
  - é™æ€æ–¹æ³•ï¼š
    - å¯ä»¥ç›´æ¥åŠ staticä¿®é¥°
    - é»˜è®¤ä¼šåŠ publicä¿®é¥°
    - æ¥å£çš„é™æ€æ–¹æ³•åªèƒ½ç”¨æ¥å£çš„ç±»åç§°è°ƒç”¨
  - ç§æœ‰æ–¹æ³•(å…¶å®æ˜¯ä»JDK1.9å¼€å§‹æ‰æ”¯æŒçš„)ï¼š
    - å…¶å®å°±æ˜¯ç§æœ‰çš„å®ä¾‹æ–¹æ³•ï¼Œå¿…é¡»åŠ privateä¿®é¥°
    - ç§æœ‰çš„å®ä¾‹æ–¹æ³•ï¼Œåªèƒ½åœ¨æœ¬æ¥å£ä¸­è¢«è®¿é—®
    - ç§æœ‰æ–¹æ³•é€šå¸¸æ˜¯ç»™å…¶ä»–ç§æœ‰æ–¹æ³•æˆ–è€…ç»™é»˜è®¤æ–¹æ³•è°ƒç”¨çš„

æ³¨æ„äº‹é¡¹

- å¦‚æœå®ç°äº†å¤šä¸ªæ¥å£ï¼Œå¤šä¸ªæ¥å£ä¸­å­˜åœ¨åŒåçš„é™æ€æ–¹æ³•å¹¶ä¸å†²çª
  - åŸå› æ˜¯åªèƒ½é€šè¿‡å„è‡ªæ¥å£åè®¿é—®å„è‡ªé™æ€æ–¹æ³•
- å½“ä¸€ä¸ªç±»ï¼Œæ—¢ç»§æ‰¿ä¸€ä¸ªçˆ¶ç±»ï¼Œåˆå®ç°è‹¥å¹²ä¸ªæ¥å£æ—¶
  - çˆ¶ç±»ä¸­çš„æˆå‘˜æ–¹æ³•ä¸æ¥å£ä¸­çš„é»˜è®¤æ–¹æ³•é‡åï¼Œå­ç±»å°±è¿‘é€‰æ‹©æ‰§è¡Œçˆ¶ç±»çš„æˆå‘˜æ–¹æ³•
- å½“ä¸€ä¸ªç±»å®ç°å¤šä¸ªæ¥å£æ—¶ï¼Œå¤šä¸ªæ¥å£ä¸­å­˜åœ¨åŒåçš„é»˜è®¤æ–¹æ³•
  - å®ç°ç±»å¿…é¡»é‡å†™è¿™ä¸ªæ–¹æ³•
- æ¥å£ä¸­ï¼Œæ²¡æœ‰æ„é€ å™¨ï¼Œä¸èƒ½åˆ›å»ºå¯¹è±¡
  - æ¥å£æ˜¯æ›´å½»åº•çš„æŠ½è±¡ï¼Œè¿æ„é€ å™¨éƒ½æ²¡æœ‰ï¼Œè‡ªç„¶ä¸èƒ½åˆ›å»ºå¯¹è±¡

## 4. ä»£ç å—

### 4.1 é™æ€ä»£ç å—

ç±»æœ‰5å¤§æˆåˆ†ï¼šæˆå‘˜å˜é‡ï¼Œæ–¹æ³•ï¼Œæ„é€ å™¨ï¼Œä»£ç å—ï¼Œå†…éƒ¨ç±»ã€‚

ä»£ç å—æŒ‰ç…§æœ‰æ— staticä¿®é¥°å¯åˆ†ä¸ºï¼šé™æ€ä»£ç å—ã€å®ä¾‹ä»£ç å—ã€‚

é™æ€ä»£ç å—

- æ ¼å¼ï¼šstatic {}
- å¿…é¡»ç”¨staticä¿®é¥°ã€‚å±äºç±»ï¼Œä¼šä¸ç±»ä¸€èµ·ä¼˜å…ˆåŠ è½½ï¼Œè€Œä¸”è‡ªåŠ¨è§¦å‘æ‰§è¡Œä¸€æ¬¡
- é™æ€ä»£ç å—å¯ä»¥ç”¨äºåœ¨æ‰§è¡Œç±»çš„æ–¹æ³•ä¹‹å‰è¿›è¡Œé™æ€èµ„æºçš„åˆå§‹åŒ–æ“ä½œ

### 4.2 å®ä¾‹ä»£ç å—

å®ä¾‹ä»£ç å—

- æ ¼å¼ï¼š{}
- å¿…é¡»æ— staticä¿®é¥°ã€‚å±äºç±»çš„æ¯ä¸ªå¯¹è±¡çš„ï¼Œä¼šä¸æ¯ä¸ªç±»çš„å¯¹è±¡ä¸€èµ·åŠ è½½ï¼Œæ¯æ¬¡åˆ›å»ºå¯¹è±¡çš„æ—¶å€™ï¼Œå®ä¾‹ä»£ç å—å°±ä¼šè§¦å‘æ‰§è¡Œä¸€æ¬¡
- å®ä¾‹ä»£ç å—å¯ä»¥ç”¨äºåˆå§‹åŒ–å®ä¾‹èµ„æº
- å®ä¾‹ä»£ç å—çš„ä»£ç å®é™…ä¸Šæ˜¯æå–åˆ°æ¯ä¸ªæ„é€ å™¨ä¸­å»æ‰§è¡Œçš„

### 4.3 å…¶ä»–çŸ¥è¯†ç‚¹

finalå…³é”®å­—

- finalå¯ä»¥ç”¨äºä¿®é¥°ç±»ï¼Œæ–¹æ³•ï¼Œå˜é‡ã€‚
- finalä¿®é¥°ç±»ï¼šç±»ä¸èƒ½è¢«ç»§æ‰¿äº†ã€‚
- finalä¿®é¥°æ–¹æ³•ï¼šæ–¹æ³•ä¸èƒ½è¢«é‡å†™ã€‚
- finalä¿®é¥°å˜é‡ï¼Œå˜é‡æœ‰ä¸”ä»…èƒ½è¢«èµ‹å€¼ä¸€æ¬¡ã€‚
- abstractå’Œfinalæ˜¯äº’æ–¥å…³ç³»ï¼Œä¸èƒ½åŒæ—¶å‡ºç°ä¿®é¥°æˆå‘˜ã€‚
- finalä¿®é¥°å±€éƒ¨å˜é‡ï¼Œè®©å€¼è¢«å›ºå®šæˆ–è€…è¯´ä¿æŠ¤èµ·æ¥ï¼Œæ‰§è¡Œçš„è¿‡ç¨‹ä¸­é˜²æ­¢è¢«ä¿®æ”¹ã€‚
- finalä¿®é¥°é™æ€æˆå‘˜å˜é‡ï¼Œå˜é‡å˜æˆäº†å¸¸é‡ã€‚
- finalä¿®é¥°é™æ€æˆå‘˜å˜é‡å¯ä»¥åœ¨å“ªäº›åœ°æ–¹èµ‹å€¼ä¸€æ¬¡ã€‚
  - å®šä¹‰çš„æ—¶å€™èµ‹å€¼ä¸€æ¬¡ã€‚
  - å¯ä»¥åœ¨é™æ€ä»£ç å—ä¸­èµ‹å€¼ä¸€æ¬¡ã€‚
- finalä¿®é¥°å˜é‡çš„æ€»è§„åˆ™ï¼šæœ‰ä¸”ä»…èƒ½è¢«èµ‹å€¼ä¸€æ¬¡ã€‚
- finalä¿®é¥°å®ä¾‹æˆå‘˜å˜é‡å¯ä»¥åœ¨å“ªäº›åœ°æ–¹èµ‹å€¼ä¸€æ¬¡ã€‚
  - å®šä¹‰çš„æ—¶å€™èµ‹å€¼ä¸€æ¬¡ã€‚
  - å¯ä»¥åœ¨å®ä¾‹ä»£ç å—ä¸­èµ‹å€¼ä¸€æ¬¡ã€‚
  - å¯ä»¥åœ¨æ¯ä¸ªæ„é€ å™¨ä¸­èµ‹å€¼ä¸€æ¬¡ã€‚

### 4.4 å•ä¾‹è®¾è®¡æ¨¡å¼

å•ä¾‹ï¼šå•ä¾‹çš„æ„æ€æ˜¯ä¸€ä¸ªç±»æ°¸è¿œåªå­˜åœ¨ä¸€ä¸ªå¯¹è±¡ï¼Œä¸èƒ½åˆ›å»ºå¤šä¸ªå¯¹è±¡ã€‚

ä¸ºä»€ä¹ˆè¦ç”¨å•ä¾‹ï¼šå¼€å‘ä¸­æœ‰å¾ˆå¤šç±»çš„å¯¹è±¡æˆ‘ä»¬åªéœ€è¦ä¸€ä¸ªï¼Œä¾‹å¦‚è™šæ‹Ÿæœºå¯¹è±¡ï¼Œä»»åŠ¡ç®¡ç†å™¨å¯¹è±¡ã€‚å¯¹è±¡è¶Šå¤šè¶Šå å†…å­˜ï¼Œæœ‰äº›æ—¶å€™åªéœ€è¦ä¸€ä¸ªå¯¹è±¡å°±å¯ä»¥å®ç°ä¸šåŠ¡ï¼Œå•ä¾‹å¯ä»¥èŠ‚çº¦å†…å­˜ï¼Œæé«˜æ€§èƒ½ã€‚

å•ä¾‹çš„å®ç°æ–¹å¼ç›®å‰å­¦ä¹ ä¸¤ç§æ–¹å¼

- é¥¿æ±‰å•ä¾‹è®¾è®¡æ¨¡å¼

  - é€šè¿‡ç±»è·å–å•ä¾‹å¯¹è±¡çš„æ—¶å€™ï¼Œå¯¹è±¡å·²ç»æå‰åšå¥½äº†ã€‚
  - å®ç°æ­¥éª¤
    - å®šä¹‰ä¸€ä¸ªå•ä¾‹ç±»
    - æŠŠç±»çš„æ„é€ å™¨ç§æœ‰
    - å®šä¹‰ä¸€ä¸ªé™æ€æˆå‘˜å˜é‡ç”¨äºå­˜å‚¨å¯¹è±¡ã€‚(é¥¿æ±‰å•ä¾‹åœ¨è¿”å›å¯¹è±¡çš„æ—¶å€™ï¼Œå¯¹è±¡å·²ç»åšå¥½ï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥åˆ›å»ºå‡ºæ¥)
    - å®šä¹‰ä¸€ä¸ªæ–¹æ³•è¿”å›å•ä¾‹å¯¹è±¡ã€‚

- æ‡’æ±‰å•ä¾‹è®¾è®¡æ¨¡å¼

  - é€šè¿‡ç±»è·å–å•ä¾‹å¯¹è±¡çš„æ—¶å€™å‘ç°æ²¡æœ‰å¯¹è±¡æ‰ä¼šå»åˆ›å»ºä¸€ä¸ªå¯¹è±¡ã€‚
  - å®ç°æ­¥éª¤
    - å®šä¹‰ä¸€ä¸ªå•ä¾‹ç±»
    - æŠŠç±»çš„æ„é€ å™¨ç§æœ‰
    - å®šä¹‰ä¸€ä¸ªé™æ€æˆå‘˜å˜é‡ç”¨äºå­˜å‚¨å¯¹è±¡ã€‚(æ‡’æ±‰å•ä¾‹ä¸èƒ½ç›´æ¥åˆ›å»ºå¯¹è±¡ï¼Œå¿…é¡»éœ€è¦çš„æ—¶å€™æ‰åˆ›å»º)
    - å®šä¹‰ä¸€ä¸ªæ–¹æ³•è¿”å›å•ä¾‹å¯¹è±¡ï¼Œåˆ¤æ–­å¯¹è±¡ä¸å­˜åœ¨æ‰åˆ›å»ºä¸€æ¬¡ï¼Œå­˜åœ¨ç›´æ¥è¿”å›ã€‚
  - æŸç§æ„ä¹‰ä¸Šæ¥è¯´ï¼Œæ‡’æ±‰å•ä¾‹æ¨¡å¼åœ¨éœ€è¦æ—¶æ‰åˆ›å»ºå¯¹è±¡ï¼Œèƒ½å¤ŸèŠ‚çº¦å†…å­˜ã€‚

  ### 4.5 æšä¸¾ç±»

  æšä¸¾ç±»çš„ä½œç”¨ï¼šæšä¸¾æ˜¯ç”¨äºåšä¿¡æ¯æ ‡å¿—å’Œä¿¡æ¯åˆ†ç±»ã€‚

  ```Java
  // æšä¸¾ç±»çš„æ ¼å¼
  ä¿®é¥°ç¬¦ enum æšä¸¾åç§° {
      å®ä¾‹1åç§°,å®ä¾‹2åç§°...;
  }
  ```

  æšä¸¾ç±»ç¬¬ä¸€è¡Œç½—åˆ—çš„å¿…é¡»æ˜¯æšä¸¾ç±»çš„å¯¹è±¡åç§°ã€‚

  æšä¸¾ç±»çš„ç‰¹ç‚¹

  - æšä¸¾ç±»æ˜¯finalä¿®é¥°çš„ï¼Œä¸èƒ½è¢«ç»§æ‰¿ã€‚
  - æšä¸¾ç±»é»˜è®¤ç»§æ‰¿äº†æšä¸¾ç±»å‹ï¼šjava.lang.Enumã€‚
  - æšä¸¾ç±»çš„ç¬¬ä¸€è¡Œç½—åˆ—çš„æ˜¯æšä¸¾ç±»çš„å¯¹è±¡ã€‚è€Œä¸”æ˜¯ç”¨å¸¸é‡å­˜å‚¨çš„ã€‚
  - æ‰€ä»¥æšä¸¾ç±»çš„ç¬¬ä¸€è¡Œå†™çš„éƒ½æ˜¯å¸¸é‡åç§°ï¼Œé»˜è®¤å­˜å‚¨äº†æšä¸¾å¯¹è±¡ã€‚
  - æšä¸¾ç±»çš„æ„é€ å™¨é»˜è®¤æ˜¯ç§æœ‰çš„ã€‚
  - æšä¸¾ç±»ç›¸å½“äºæ˜¯å¤šä¾‹è®¾è®¡æ¨¡å¼ã€‚

  å¸¸é‡åšä¿¡æ¯æ ‡å¿—å’Œåˆ†ç±»ï¼šè™½ç„¶ä¹ŸæŒºå¥½ï¼Œä½†æ˜¯å…¥å‚ä¸å—æ§åˆ¶ï¼Œå…¥å‚å¤ªéšæ€§æ— æ³•ä¸¥è°¨ã€‚

  æšä¸¾ç±»ç”¨äºåšä¿¡æ¯æ ‡å¿—å’Œåˆ†ç±»ï¼šä¼˜é›…ã€‚

  å»ºè®®åšä¿¡æ¯æ ‡å¿—å’Œä¿¡æ¯åˆ†ç±»é‡‡ç”¨æšä¸¾è¿›è¡Œã€‚

  ```Java
  enum Oritation {
      UP,DOWN,LEFT,RIGHT;
  }
  
  public class EnumDemo01 {
      public static void main(String[] args) {
          move(Oritation.LEFT);
      }
  
      public static void move(Oritation oritation) {
          switch (oritation) {
              case UP:
                  System.out.println("æ§åˆ¶ç›ä¸½å¾€ä¸Š");
                  break;
              case DOWN:
                  System.out.println("æ§åˆ¶ç›ä¸½å¾€ä¸‹");
                  break;
              case LEFT:
                  System.out.println("æ§åˆ¶ç›ä¸½å¾€å·¦");
                  break;
              case RIGHT:
                  System.out.println("æ§åˆ¶ç›ä¸½å¾€å³");
                  break;
          }
      }
  }
  ```

## 5. å¤šæ€

### 5.1 å¤šæ€çš„æ¦‚è¿°

å¤šæ€çš„å½¢å¼

- çˆ¶ç±»ç±»å‹ å¯¹è±¡åç§° = new å­ç±»æ„é€ å™¨;
- æ¥å£         å¯¹è±¡åç§° = new å®ç°ç±»æ„é€ å™¨;
- çˆ¶ç±»ç±»å‹çš„èŒƒå›´ > å­ç±»ç±»å‹çš„èŒƒå›´

å¤šæ€çš„æ¦‚å¿µï¼šåŒä¸€ä¸ªç±»å‹çš„å¯¹è±¡ï¼Œæ‰§è¡ŒåŒä¸€ä¸ªè¡Œä¸ºï¼Œåœ¨ä¸åŒçŠ¶æ€ä¸‹ä¼šè¡¨ç°å‡ºä¸åŒçš„è¡Œä¸ºç‰¹å¾ã€‚

å¤šæ€çš„è¯†åˆ«æŠ€å·§

- å¯¹äºæ–¹æ³•çš„è°ƒç”¨ï¼šç¼–è¯‘çœ‹å·¦è¾¹ï¼Œè¿è¡Œçœ‹å³è¾¹ã€‚
- å¯¹äºå˜é‡çš„è°ƒç”¨ï¼šç¼–è¯‘çœ‹å·¦è¾¹ï¼Œè¿è¡Œçœ‹å·¦è¾¹ã€‚

å¤šæ€çš„ä½¿ç”¨å‰æ

- å¿…é¡»å­˜åœ¨ç»§æ‰¿å’Œå®ç°å…³ç³»ã€‚

- å¿…é¡»å­˜åœ¨çˆ¶ç±»ç±»å‹çš„å˜é‡å¼•ç”¨å­ç±»ç±»å‹çš„å¯¹è±¡ã€‚
- éœ€è¦å­˜åœ¨æ–¹æ³•é‡å†™ã€‚

å¤šæ€çš„ä¼˜åŠ£åŠ¿

- ä¼˜åŠ¿
  - åœ¨å¤šæ€å½¢å¼ä¸‹ï¼Œå³è¾¹å¯¹è±¡å¯ä»¥å®ç°ç»„ä»¶åŒ–åˆ‡æ¢ï¼Œä¸šåŠ¡åŠŸèƒ½ä¹Ÿéšä¹‹æ”¹å˜ï¼Œä¾¿äºæ‹“å±•å’Œç»´æŠ¤ã€‚å¯ä»¥å®ç°ç±»ä¸ç±»ä¹‹é—´çš„è§£è€¦ã€‚
  - å®é™…å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œçˆ¶ç±»ç±»å‹ä½œä¸ºæ–¹æ³•å½¢å¼å‚æ•°ï¼Œä¼ é€’å­ç±»å¯¹è±¡ç»™æ–¹æ³•ï¼Œå¯ä»¥ä¼ å…¥ä¸€åˆ‡å­ç±»å¯¹è±¡è¿›è¡Œæ–¹æ³•çš„è°ƒç”¨ï¼Œæ›´èƒ½ä½“ç°å‡ºå¤šæ€çš„æ‰©å±•æ€§ä¸ä¾¿åˆ©ã€‚
- åŠ£åŠ¿
  - å¤šæ€å½¢å¼ä¸‹ï¼Œä¸èƒ½ç›´æ¥è°ƒç”¨å­ç±»ç‰¹æœ‰çš„åŠŸèƒ½ã€‚ç¼–è¯‘çœ‹å·¦è¾¹ï¼Œå·¦è¾¹çˆ¶ç±»ä¸­æ²¡æœ‰å­ç±»ç‹¬æœ‰çš„åŠŸèƒ½ï¼Œæ‰€ä»¥ä»£ç åœ¨ç¼–è¯‘é˜¶æ®µå°±ç›´æ¥æŠ¥é”™äº†ã€‚

### 5.2 å¤šæ€çš„ä¸‹çš„ç±»å‹è½¬æ¢

åŸºæœ¬æ•°æ®ç±»å‹çš„è½¬æ¢

- å°èŒƒå›´ç±»å‹çš„å˜é‡æˆ–è€…å€¼å¯ä»¥ç›´æ¥èµ‹å€¼ç»™å¤§èŒƒå›´ç±»å‹çš„å˜é‡ã€‚
- å¤§èŒƒå›´ç±»å‹çš„å˜é‡æˆ–è€…å€¼å¿…é¡»å¼ºåˆ¶ç±»å‹è½¬æ¢ç»™å°èŒƒå›´ç±»å‹çš„å˜é‡ã€‚

å¼•ç”¨æ•°æ®ç±»å‹è½¬æ¢çš„æ€æƒ³æ˜¯ä¸€æ ·çš„

- çˆ¶ç±»ç±»å‹çš„èŒƒå›´ > å­ç±»ç±»å‹çš„èŒƒå›´
- Animal                    Cat

å¼•ç”¨æ•°æ®ç±»å‹çš„è‡ªåŠ¨ç±»å‹è½¬æ¢è¯­æ³•

- å­ç±»ç±»å‹çš„å¯¹è±¡æˆ–è€…å˜é‡å¯ä»¥è‡ªåŠ¨ç±»å‹è½¬æ¢èµ‹å€¼ç»™çˆ¶ç±»ç±»å‹çš„å˜é‡ã€‚(ä¸èƒ½è§£å†³å¤šæ€çš„åŠ£åŠ¿)

å¼•ç”¨ç±»å‹å¼ºåˆ¶ç±»å‹è½¬æ¢çš„è¯­æ³•

- çˆ¶ç±»ç±»å‹çš„å˜é‡æˆ–è€…å¯¹è±¡å¿…é¡»å¼ºåˆ¶ç±»å‹è½¬æ¢æˆå­ç±»ç±»å‹çš„å˜é‡ï¼Œå¦åˆ™æŠ¥é”™ã€‚

å¼ºåˆ¶ç±»å‹è½¬æ¢çš„æ ¼å¼

- ç±»å‹ å˜é‡åç§° = (ç±»å‹) (å¯¹è±¡æˆ–è€…å˜é‡)

æ³¨æ„ï¼šæœ‰ç»§æ‰¿/å®ç°å…³ç³»çš„ä¸¤ä¸ªç±»å‹å°±å¯ä»¥è¿›è¡Œå¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œç¼–è¯‘é˜¶æ®µä¸€å®šä¸æŠ¥é”™ã€‚ä½†æ˜¯è¿è¡Œé˜¶æ®µå¯èƒ½å‡ºç°ï¼šç±»å‹è½¬æ¢å¼‚å¸¸ ClassCastException

Javaå»ºè®®åœ¨è¿›è¡Œå¼ºåˆ¶ç±»å‹è½¬æ¢ä¹‹å‰å…ˆåˆ¤æ–­å˜é‡çš„çœŸå®ç±»å‹ï¼Œå†å¼ºåˆ¶ç±»å‹è½¬æ¢ã€‚

- å˜é‡ instanceof ç±»å‹ï¼šåˆ¤æ–­å‰é¢çš„å˜é‡æ˜¯å¦æ˜¯åé¢çš„ç±»å‹æˆ–è€…å…¶å­ç±»ç±»å‹ã€‚

ç»ƒä¹ ï¼šé¢å‘å¯¹è±¡æ€æƒ³è®¾è®¡ä¸€ä¸ªç”µè„‘å¯¹è±¡ï¼Œå¯ä»¥æ¥å…¥2ä¸ªUSBè®¾å¤‡ã€‚

```Java
public class Demo {
    public static void main(String[] args) {
        Computer c = new Computer();
        USB xiaoMi = new Mouse("å°ç±³é¼ æ ‡");
        c.installUSB(xiaoMi);

        KeyBoard sfy = new KeyBoard("åŒé£ç‡•é”®ç›˜");
        c.installUSB(sfy);
    }
}

class Computer {
    public void installUSB(USB usb) {
        usb.connect();
        if (usb instanceof Mouse) {
            Mouse m = (Mouse) usb;
            m.dbclick();
        } else if (usb instanceof KeyBoard) {
            KeyBoard k = (KeyBoard) usb;
            k.keydown();
        }
        usb.unconnect();
    }
}

// å®šä¹‰2ä¸ªUSBè®¾å¤‡ï¼šé¼ æ ‡ï¼Œé”®ç›˜
class Mouse implements USB {
    private String name;

    public Mouse(String name) {
        this.name = name;
    }

    public void dbclick() {
        System.out.println(name + "åŒå‡»äº†Â·è€é“Â·666666~~~");
    }

    @Override
    public void connect() {
        System.out.println(name + "æˆåŠŸæ¥å…¥äº†è®¾å¤‡~~~~");
    }

    @Override
    public void unconnect() {
        System.out.println(name + "æˆåŠŸæ‹”å‡ºäº†è®¾å¤‡~~~~");
    }
}

class KeyBoard implements USB {
    private String name;

    public KeyBoard(String name) {
        this.name = name;
    }

    public void keydown() {
        System.out.println(name + "å†™ä¸‹äº†Â·æ¥äº†Â·è€å¼Ÿ~~è®°å¾—ç‚¹äº®å°â™¥â™¥â™¥");
    }

    @Override
    public void connect() {
        System.out.println(name + "æˆåŠŸæ¥å…¥äº†è®¾å¤‡~~~~");
    }

    @Override
    public void unconnect() {
        System.out.println(name + "æˆåŠŸæ‹”å‡ºäº†è®¾å¤‡~~~~");
    }
}

// å®šä¹‰USBçš„è§„èŒƒï¼Œå¿…é¡»è¦å®Œæˆæ¥å…¥å’Œæ‹”å‡ºçš„åŠŸèƒ½
interface USB {
    void connect();
    void unconnect();
}
```

## 6. å†…éƒ¨ç±»

å†…éƒ¨ç±»æ˜¯ç±»çš„äº”å¤§æˆåˆ†ä¹‹ä¸€ï¼šæˆå‘˜å˜é‡ï¼Œæ–¹æ³•ï¼Œæ„é€ å™¨ï¼Œä»£ç å—ï¼Œå†…éƒ¨ç±»ã€‚

å†…éƒ¨ç±»ï¼šå®šä¹‰åœ¨ä¸€ä¸ªç±»é‡Œé¢çš„ç±»å°±æ˜¯å†…éƒ¨ç±»ã€‚

å†…éƒ¨ç±»ä½œç”¨

- å¯ä»¥æä¾›æ›´å¥½çš„å°è£…æ€§ï¼Œå†…éƒ¨ç±»æœ‰æ›´å¤šæƒé™ä¿®é¥°ç¬¦ï¼Œå°è£…æ€§æœ‰æ›´å¤šçš„æ§åˆ¶ã€‚
- å¯ä»¥ä½“ç°å‡ºç»„ä»¶çš„æ€æƒ³ã€‚

å†…éƒ¨ç±»çš„åˆ†ç±»

- é™æ€å†…éƒ¨ç±»
- å®ä¾‹å†…éƒ¨ç±»(æˆå‘˜å†…éƒ¨ç±»)
- å±€éƒ¨å†…éƒ¨ç±»
- åŒ¿åå†…éƒ¨ç±»

**é™æ€å†…éƒ¨ç±»**

é™æ€å†…éƒ¨ç±»ï¼šæœ‰staticä¿®é¥°ï¼Œå±äºå¤–éƒ¨ç±»æœ¬èº«ï¼Œä¼šå’Œå¤–éƒ¨ç±»ä¸€èµ·åŠ è½½ä¸€æ¬¡ã€‚

é™æ€å†…éƒ¨ç±»ä¸­çš„æˆåˆ†ç ”ç©¶

- ç±»æœ‰çš„æˆåˆ†å®ƒéƒ½æœ‰ï¼Œé™æ€å†…éƒ¨ç±»å±äºå¤–éƒ¨ç±»æœ¬èº«ï¼Œåªä¼šåŠ è½½ä¸€æ¬¡ã€‚
- æ‰€ä»¥å®ƒçš„ç‰¹ç‚¹ä¸å¤–éƒ¨ç±»æ˜¯å®Œå…¨ä¸€æ ·çš„ï¼Œåªæ˜¯ä½ç½®åœ¨è¢«äººé‡Œé¢è€Œå·²ã€‚
- å¤–éƒ¨ç±» = å®¿ä¸»   å†…éƒ¨ç±» = å¯„ç”Ÿ

é™æ€å†…éƒ¨ç±»çš„è®¿é—®æ ¼å¼

- å¤–éƒ¨ç±»åç§°.å†…éƒ¨ç±»åç§°

é™æ€å†…éƒ¨ç±»åˆ›å»ºå¯¹è±¡çš„æ ¼å¼

- å¤–éƒ¨ç±»åç§°.å†…éƒ¨ç±»åç§° å¯¹è±¡åç§° = new å¤–éƒ¨ç±»åç§°.å†…éƒ¨ç±»æ„é€ å™¨;

é™æ€å†…éƒ¨ç±»çš„è®¿é—®æ‹“å±•

- é™æ€å†…éƒ¨ç±»ä¸­å¯ä»¥ç›´æ¥è®¿é—®å¤–éƒ¨ç±»çš„é™æ€æˆå‘˜ã€‚å¤–éƒ¨ç±»çš„é™æ€æˆå‘˜åªæœ‰ä¸€ä»½ï¼Œå¯ä»¥è¢«å…±äº«ã€‚
- é™æ€å†…éƒ¨ç±»ä¸­ä¸å¯ä»¥ç›´æ¥è®¿é—®å¤–éƒ¨ç±»çš„å®ä¾‹æˆå‘˜ã€‚å¤–éƒ¨ç±»çš„å®ä¾‹æˆå‘˜å¿…é¡»ç”¨å¤–éƒ¨ç±»å¯¹è±¡è®¿é—®ã€‚

**å®ä¾‹å†…éƒ¨ç±»**

å®ä¾‹å†…éƒ¨ç±»ï¼šæ— staticä¿®é¥°çš„å†…éƒ¨ç±»ï¼Œå±äºå¤–éƒ¨ç±»çš„æ¯ä¸ªå¯¹è±¡çš„ï¼Œè·Ÿç€å¯¹è±¡ä¸€èµ·åŠ è½½çš„ã€‚

å®ä¾‹å†…éƒ¨ç±»çš„æˆåˆ†ç‰¹ç‚¹

- å®ä¾‹å†…éƒ¨ç±»ä¸­ä¸èƒ½å®šä¹‰é™æ€æˆå‘˜ï¼Œå…¶ä»–éƒ½å¯ä»¥å®šä¹‰ã€‚
- å¯ä»¥å®šä¹‰å¸¸é‡ã€‚

å®ä¾‹å†…éƒ¨ç±»çš„è®¿é—®æ ¼å¼

- å¤–éƒ¨ç±»åç§°.å†…éƒ¨ç±»åç§°

åˆ›å»ºå¯¹è±¡çš„æ ¼å¼

- å¤–éƒ¨ç±»åç§°.å†…éƒ¨ç±»åç§° å¯¹è±¡åç§° = new å¤–éƒ¨ç±»æ„é€ å™¨.new å†…éƒ¨ç±»æ„é€ å™¨;

å®ä¾‹å†…éƒ¨ç±»çš„è®¿é—®æ‹“å±•

- å®ä¾‹å†…éƒ¨ç±»ä¸­å¯ä»¥ç›´æ¥è®¿é—®å¤–éƒ¨ç±»çš„é™æ€æˆå‘˜ã€‚å¤–éƒ¨ç±»çš„é™æ€æˆå‘˜å¯ä»¥è¢«å…±äº«è®¿é—®ã€‚
- å®ä¾‹å†…éƒ¨ç±»ä¸­å¯ä»¥ç›´æ¥è®¿é—®å¤–éƒ¨ç±»çš„å®ä¾‹æˆå‘˜ã€‚å®ä¾‹å†…éƒ¨ç±»å±äºå¤–éƒ¨ç±»å¯¹è±¡ï¼Œå¯ä»¥ç›´æ¥è®¿é—®å½“å‰å¤–éƒ¨ç±»å¯¹è±¡çš„å®ä¾‹æˆå‘˜ã€‚

**å±€éƒ¨å†…éƒ¨ç±»**

å±€éƒ¨å†…éƒ¨ç±»ï¼šå®šä¹‰åœ¨æ–¹æ³•ä¸­ï¼Œåœ¨æ„é€ å™¨ä¸­ï¼Œä»£ç å—ä¸­ï¼Œforå¾ªç¯ä¸­å®šä¹‰çš„å†…éƒ¨ç±»å°±æ˜¯å±€éƒ¨å†…éƒ¨ç±»

å±€éƒ¨å†…éƒ¨ç±»ä¸­çš„æˆåˆ†ç‰¹ç‚¹

- åªèƒ½å®šä¹‰å®ä¾‹æˆå‘˜ï¼Œä¸èƒ½å®šä¹‰é™æ€æˆå‘˜ã€‚
- å¯ä»¥å®šä¹‰å¸¸é‡ã€‚

**åŒ¿åå†…éƒ¨ç±»**

åŒ¿åå†…éƒ¨ç±»ï¼šå°±æ˜¯ä¸€ä¸ªæ²¡æœ‰åå­—çš„å±€éƒ¨å†…éƒ¨ç±»ã€‚åŒ¿åå†…éƒ¨ç±»å¯ä»¥ç®€åŒ–ä»£ç ï¼Œä¹Ÿæ˜¯å¼€å‘ä¸­å¸¸ç”¨çš„å½¢å¼ã€‚

åŒ¿åå†…éƒ¨ç±»çš„æ ¼å¼

```Java
new ç±»å|æŠ½è±¡ç±»|æ¥å£(å½¢å‚) {
    æ–¹æ³•é‡å†™ã€‚
}
```

åŒ¿åå†…éƒ¨ç±»çš„ç‰¹ç‚¹

- åŒ¿åå†…éƒ¨ç±»æ˜¯ä¸€ä¸ªæ²¡æœ‰åå­—çš„å†…éƒ¨ç±»ã€‚
- åŒ¿åå†…éƒ¨ç±»ä¸€æ—¦å†™å‡ºæ¥ï¼Œå°±ä¼šç«‹å³åˆ›å»ºä¸€ä¸ªåŒ¿åå†…éƒ¨ç±»çš„å¯¹è±¡è¿”å›ã€‚
- åŒ¿åå†…éƒ¨ç±»çš„å¯¹è±¡çš„ç±»å‹ç›¸å½“äºæ˜¯å½“å‰newçš„é‚£ä¸ªç±»å‹çš„å­ç±»ç±»å‹ã€‚

```Java
public class InnerClass {
    public static void main(String[] args) {
        Animal a = new Animal() {
            @Override
            public void run() {
                System.out.println("çŒ«è·‘å¾—è´¼æºœ~~~~");
            }
        };
        a.run();
        a.go();
    }
}

abstract class Animal {
    public abstract void run();

    public void go() {
        System.out.println("å¼€å§‹Go.....");
    }
}
```

ä½¿ç”¨å½¢å¼

```Java
public class Anonymity {
    public static void main(String[] args) {
        Swim bozai = new Swim() {
            @Override
            public void swimming() {
                System.out.println("è€å¸ˆæ¸¸æ³³è´¼æºœ~~~~~");
            }
        };
        go(bozai);

        Swim boniu = new Swim() {
            @Override
            public void swimming() {
                System.out.println("æ³¢å¦å­¦ç”Ÿå¿«ä¹çš„ç‹—çˆ¬å¼~~~~~");
            }
        };
        go(boniu);
        
        go(new Swim() {
            @Override
            public void swimming() {
                System.out.println("æ³¢å¦å­¦ç”Ÿå¿«ä¹çš„ç‹—çˆ¬å¼~~~~~");
            }
        });
    }

    public static void go(Swim s) {
        System.out.println("å¼€å§‹.....");
        s.swimming();
        System.out.println("ç»“æŸ.....");
    }
}

interface Swim {
    void swimming();
}
```

```Java
import javax.swing.*;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;

public class Anonymity01 {
    public static void main(String[] args) {
        // 1.åˆ›å»ºä¸€ä¸ªçª—å£
        JFrame win = new JFrame("ç™»å½•ç•Œé¢");

        // 2.è®¾ç½®çª—å£çš„å¤§å°
        win.setSize(400,300);

        // 3.å±…ä¸­
        win.setLocationRelativeTo(null);

        // 4.ä¸ºå½“å‰ç•Œé¢åŠ ä¸Šä¸€ä¸ªæŒ‰é’®å¯¹è±¡
        JButton btn = new JButton("å¼€å§‹ç™»é™†");
        JPanel panel = new JPanel();
        panel.add(btn);
        win.add(panel);

        // 5.ä¸ºå½“å‰æŒ‰é’®å¯¹è±¡ç»‘å®šä¸€ä¸ªç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨
        btn.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                System.out.println("ç”¨æˆ·ç‚¹å‡»äº†è§¦å‘ç™»é™†~~~");
            }
        });
        //btn.addActionListener(s -> System.out.println("ç”¨æˆ·ç‚¹å‡»äº†è§¦å‘ç™»é™†~~~"));

        // 6.æ˜¾ç¤ºçª—å£
        win.setDefaultCloseOperation(WindowConstants.EXIT_ON_CLOSE);
        win.setVisible(true);
    }
}
```

## 7. åŒ…ä¸æƒé™ä¿®é¥°ç¬¦

### 7.1 åŒ…

åŒ…

- åˆ†é—¨åˆ«ç±»çš„ç®¡ç†å„ç§ä¸åŒçš„æŠ€æœ¯ã€‚
- ä¼ä¸šçš„ä»£ç å¿…é¡»ç”¨åŒ…åˆ†åŒºã€‚ä¾¿äºç®¡ç†æŠ€æœ¯ï¼Œæ‰©å±•æŠ€æœ¯ï¼Œé˜…è¯»æŠ€æœ¯ã€‚

å®šä¹‰åŒ…çš„æ ¼å¼

- package åŒ…å;    å¿…é¡»æ”¾åœ¨ç±»åçš„æœ€ä¸Šé¢ã€‚
- ä¸€èˆ¬å·¥å…·å·²ç»å¸®æˆ‘ä»¬åšå¥½äº†ã€‚

åŒ…åçš„å‘½åè§„èŒƒ

- ä¸€èˆ¬æ˜¯å…¬å¸åŸŸåçš„å€’å†™+æŠ€æœ¯åç§°
- http://www.baidu.com => com.baidu.æŠ€æœ¯åç§°
- åŒ…åå»ºè®®å…¨éƒ¨ç”¨è‹±æ–‡ï¼Œå¤šä¸ªå•è¯ç”¨â€œ.â€è¿æ¥ï¼Œå¿…é¡»æ˜¯åˆæ³•æ ‡è¯†ç¬¦ï¼Œä¸èƒ½ç”¨å…³é”®å­—

æ³¨æ„

- ç›¸åŒåŒ…ä¸‹çš„ç±»å¯ä»¥ç›´æ¥è®¿é—®ã€‚
- ä¸åŒåŒ…ä¸‹çš„ç±»å¿…é¡»å¯¼åŒ…ï¼Œæ‰å¯ä»¥ä½¿ç”¨ã€‚
- å¯¼åŒ…æ ¼å¼ï¼šimport åŒ…å.ç±»å;

### 7.2 æƒé™ä¿®é¥°ç¬¦

æƒé™ä¿®é¥°ç¬¦

- æœ‰å››ç§(private -> ç¼ºçœ -> protected -> public)
- å¯ä»¥ä¿®é¥°æˆå‘˜å˜é‡ï¼Œä¿®é¥°æ–¹æ³•ï¼Œä¿®é¥°æ„é€ å™¨ï¼Œå†…éƒ¨ç±»ï¼Œä¸åŒä¿®é¥°ç¬¦ä¿®é¥°çš„æˆå‘˜èƒ½å¤Ÿè¢«è®¿é—®çš„æƒé™å°†å—åˆ°é™åˆ¶ã€‚

å››ç§ä¿®é¥°ç¬¦çš„è®¿é—®æƒé™èŒƒå›´

|                  | private | ç¼ºçœ | protected | public |
| ---------------- | :-----: | :--: | :-------: | :----: |
| æœ¬ç±»ä¸­           |    âˆš    |  âˆš   |     âˆš     |   âˆš    |
| æœ¬åŒ…ä¸‹å…¶ä»–ç±»ä¸­   |    Ã—    |  âˆš   |     âˆš     |   âˆš    |
| å…¶ä»–åŒ…ä¸‹çš„ç±»ä¸­   |    Ã—    |  Ã—   |     Ã—     |   âˆš    |
| å…¶ä»–åŒ…ä¸‹çš„å­ç±»ä¸­ |    Ã—    |  Ã—   |     âˆš     |   âˆš    |

## 8. å¸¸ç”¨API

### 8.1 Object

Objectç±»çš„å¸¸ç”¨æ–¹æ³•

- public String toString()
  - é»˜è®¤æ˜¯è¿”å›å½“å‰å¯¹è±¡åœ¨å †å†…å­˜ä¸­çš„åœ°å€ä¿¡æ¯ã€‚
  - é»˜è®¤çš„åœ°å€ä¿¡æ¯æ ¼å¼ï¼šç±»çš„å…¨é™å@å†…å­˜åœ°å€ã€‚
  - ç›´æ¥è¾“å‡ºå¯¹è±¡åç§°ï¼Œé»˜è®¤ä¼šè‡ªåŠ¨è°ƒç”¨toString()æ–¹æ³•ï¼Œæ‰€ä»¥è¾“å‡ºå¯¹è±¡toString()è°ƒç”¨å¯ä»¥çœç•¥ä¸å†™ã€‚
  - å¼€å‘ä¸­ç›´æ¥è¾“å‡ºå¯¹è±¡ï¼Œé»˜è®¤è¾“å‡ºå¯¹è±¡çš„åœ°å€å…¶å®æ˜¯æ¯«æ— æ„ä¹‰çš„ã€‚
  - å¼€å‘ä¸­è¾“å‡ºå¯¹è±¡å˜é‡ï¼Œæ›´å¤šçš„æ—¶å€™æ˜¯å¸Œæœ›çœ‹åˆ°å¯¹è±¡çš„å†…å®¹æ•°æ®è€Œä¸æ˜¯å¯¹è±¡çš„åœ°å€ä¿¡æ¯ã€‚æ‰€ä»¥çˆ¶ç±»toString()æ–¹æ³•å­˜åœ¨çš„æ„ä¹‰å°±æ˜¯ä¸ºäº†è¢«å­ç±»é‡å†™ï¼Œä»¥ä¾¿è¿”å›å¯¹è±¡çš„å†…å®¹ä¿¡æ¯ã€‚
- public boolean equals(Object o)
  - é»˜è®¤æ˜¯æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡çš„åœ°å€æ˜¯å¦ç›¸åŒã€‚ç›¸åŒåˆ™è¿”å›trueï¼Œåä¹‹falseã€‚
  - ç›´æ¥æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡çš„åœ°å€æ˜¯å¦ç›¸åŒå®Œå…¨å¯ä»¥ç”¨â€œ==â€ä»£æ›¿equalsã€‚
  - æ‰€ä»¥equalså­˜åœ¨çš„æ„ä¹‰æ˜¯ä¸ºäº†è¢«å­ç±»é‡å†™ï¼Œä»¥ä¾¿ç¨‹åºå‘˜å¯ä»¥è‡ªå·±æ¥å®šåˆ¶æ¯”è¾ƒè§„åˆ™ã€‚
  - æ³¨æ„ï¼šå­—ç¬¦ä¸²çš„æ¯”è¾ƒå»ºè®®ä½¿ç”¨equalsæ¯”è¾ƒï¼Œåªè¦å†…å®¹ä¸€æ ·ç»“æœå°±æ˜¯trueã€‚åŸºæœ¬æ•°æ®ç±»å‹ç”¨â€œ==â€æ¯”è¾ƒã€‚

### 8.2 Objects

Objectsç±»ä¸Objectè¿˜æ˜¯ç»§æ‰¿å…³ç³»ã€‚Objectsç±»æ˜¯ä»JDK1.7å¼€å§‹ä¹‹åæ‰æœ‰çš„ã€‚

Objectsçš„æ–¹æ³•

- public static boolean equals(Object a, Object b)
  - æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡
  - åº•å±‚è¿›è¡Œéç©ºåˆ¤æ–­ï¼Œä»è€Œå¯ä»¥é¿å…ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚æ›´å®‰å…¨
- public static boolean isNull(Object obj)
  - åˆ¤æ–­å˜é‡æ˜¯å¦ä¸ºnullï¼Œä¸ºnullè¿”å›trueï¼Œåä¹‹

### 8.3 Dateæ—¥æœŸç±»

Dateç±»åœ¨Javaä¸­ä»£è¡¨çš„æ˜¯ç³»ç»Ÿå½“å‰æ­¤åˆ»æ—¥æœŸæ—¶é—´å¯¹è±¡ã€‚

Dateç±»

- åŒ…ï¼šjava.util.Date
- æ„é€ å™¨
  - public Date()ï¼šåˆ›å»ºå½“å‰ç³»ç»Ÿçš„æ­¤åˆ»æ—¥æœŸæ—¶é—´å¯¹è±¡
  - public Date(long time)ï¼šæŠŠæ—¶é—´æ¯«ç§’å€¼è½¬æ¢æˆæ—¥æœŸå¯¹è±¡
- æ–¹æ³•
  - public long getTime()ï¼šè¿”å›è‡ª1970å¹´1æœˆ1æ—¥00:00:00GMTä»¥æ¥èµ°è¿‡çš„æ€»çš„æ¯«ç§’æ•°
- æ—¶é—´è®°å½•çš„ä¸¤ç§æ–¹å¼
  - Dateæ—¥æœŸå¯¹è±¡
  - æ—¶é—´æ¯«ç§’å€¼ï¼šä»1970å¹´1æœˆ1æ—¥00:00:00GMTå¼€å§‹èµ°åˆ°æ­¤åˆ»çš„æ€»çš„æ¯«ç§’å€¼ã€‚1s = 1000ms
- æµç¨‹
  - Dateæ—¥æœŸå¯¹è±¡ -> getTime -> æ—¶é—´æ¯«ç§’å€¼
  - æ—¶é—´æ¯«ç§’å€¼ -> new Date(æ—¶é—´æ¯«ç§’å€¼) -> Dateæ—¥æœŸå¯¹è±¡

### 8.4 SimpleDateFormatç®€å•æ—¥æœŸæ ¼å¼åŒ–ç±»

DateFormatä½œç”¨

- å¯ä»¥æŠŠæ—¥æœŸå¯¹è±¡æˆ–è€…æ—¶é—´æ¯«ç§’å€¼æ ¼å¼åŒ–æˆæˆ‘ä»¬å–œæ¬¢çš„æ—¶é—´å½¢å¼ã€‚
- å¯ä»¥æŠŠå­—ç¬¦ä¸²çš„æ—¶é—´å½¢å¼è§£ææˆæ—¥æœŸå¯¹è±¡ã€‚

DateFormatæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œä¸èƒ½ç›´æ¥ä½¿ç”¨ï¼Œè¦æ‰¾å®ƒçš„å­ç±»ï¼šSimpleDateFormatã€‚æˆ‘ä»¬éœ€è¦ç”¨çš„æ˜¯ç®€å•æ—¥æœŸæ ¼å¼åŒ–ç±»ï¼šSimpleDateFormatã€‚

SimpleDateFormatç®€å•æ—¥æœŸæ ¼å¼åŒ–ç±»

- æ„é€ å™¨
  - public SimpleDateFormat(String pattern)ï¼šæŒ‡å®šæ—¶é—´çš„æ ¼å¼åˆ›å»ºç®€å•æ—¥æœŸæ ¼å¼åŒ–å¯¹è±¡ã€‚
- æ–¹æ³•
  - public String format(Date date)ï¼šå¯ä»¥æŠŠæ—¥æœŸå¯¹è±¡æ ¼å¼åŒ–æˆæˆ‘ä»¬å–œæ¬¢çš„æ—¶é—´å½¢å¼ï¼Œè¿”å›çš„æ˜¯å­—ç¬¦ä¸²ã€‚
  - public String format(Object time)ï¼šå¯ä»¥æŠŠæ—¶é—´æ¯«ç§’å€¼æ ¼å¼åŒ–æˆæˆ‘ä»¬å–œæ¬¢çš„æ—¶é—´å½¢å¼ï¼Œè¿”å›çš„æ˜¯å­—ç¬¦ä¸²ã€‚
  - public Date parse(String date) throws ParseExceptionï¼šæŠŠå­—ç¬¦ä¸²çš„æ—¶é—´è§£ææˆæ—¥æœŸå¯¹è±¡ã€‚

```Java
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.Date;

public class DateFormatDemo01 {
    public static void main(String[] args) throws ParseException {
        String date = "2019-11-04 09:30:30";
        SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
        Date d = sdf.parse(date);
        long time = d.getTime() + (24L * 60 * 60 + 15 * 60 * 60 + 30 * 60 + 29) * 1000;

        String rs = sdf.format(time);
        System.out.println(rs);
    }
}
```

### 8.5 æ—¥å†ç±»Calendar

Calendarä»£è¡¨äº†ç³»ç»Ÿæ­¤åˆ»æ—¥æœŸå¯¹åº”çš„æ—¥å†å¯¹è±¡

Calendaræ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œä¸èƒ½ç›´æ¥åˆ›å»ºå¯¹è±¡ã€‚

Calendaræ—¥å†ç±»åˆ›å»ºæ—¥å†å¯¹è±¡çš„è¯­æ³•

- Calendar rightNow = Calendar.getInstance();

Calendarçš„æ–¹æ³•

- public static Calendar getInstance()ï¼šè¿”å›ä¸€ä¸ªæ—¥å†ç±»çš„å¯¹è±¡ã€‚
- public int get(int field)ï¼šå–æ—¥æœŸä¸­çš„æŸä¸ªå­—æ®µä¿¡æ¯ã€‚
- public void set(int field, int value)ï¼šä¿®æ”¹æ—¥å†çš„æŸä¸ªå­—æ®µä¿¡æ¯ã€‚
- public void add(int field, int amount)ï¼šä¸ºæŸä¸ªå­—æ®µå¢åŠ /å‡å°‘æŒ‡å®šçš„å€¼ã€‚
- public final Date getTime()ï¼šæ‹¿åˆ°æ­¤åˆ»æ—¥æœŸå¯¹è±¡ã€‚
- public long getTimeInMillis()ï¼šæ‹¿åˆ°æ­¤åˆ»æ—¶é—´æ¯«ç§’å€¼ã€‚

### 8.6 Mathç±»

Mathç”¨äºåšæ•°å­¦è¿ç®—ã€‚

Mathç±»ä¸­çš„æ–¹æ³•å…¨éƒ¨æ˜¯é™æ€æ–¹æ³•ï¼Œç›´æ¥ç”¨ç±»åè°ƒç”¨å³å¯ã€‚

æ–¹æ³•

- public static int abs(int a)ï¼šè·å–å‚æ•°açš„ç»å¯¹å€¼ã€‚
- public static double ceil(double a)ï¼šå‘ä¸Šå–æ•´ã€‚
- public static double floor(double a)ï¼šå‘ä¸‹å–æ•´ã€‚
- public static double pow(double a, double b)ï¼šè·å–açš„bæ¬¡å¹‚ã€‚
- public static long round(double a)ï¼šå››èˆäº”å…¥å–æ•´ã€‚

### 8.7 Systemç³»ç»Ÿç±»

Systemä»£è¡¨å½“å‰ç³»ç»Ÿã€‚

é™æ€æ–¹æ³•

- public static void exit(int status)ï¼šç»ˆæ­¢JVMè™šæ‹Ÿæœºçœ‹ï¼Œé0æ˜¯å¼‚å¸¸ç»ˆæ­¢ã€‚
- public static longcurrentTimeMillis()ï¼šè·å–å½“å‰ç³»ç»Ÿæ­¤åˆ»æ—¶é—´æ¯«ç§’å€¼ã€‚
- å¯ä»¥åšæ•°ç»„çš„æ‹·è´ã€‚
  - arraycopy(Object var0, int var1, Object var2, int var3, int var4);
  - å‚æ•°ä¸€ï¼šåŸæ•°ç»„
  - å‚æ•°äºŒï¼šä»åŸæ•°ç»„çš„å“ªä¸ªä½ç½®å¼€å§‹èµ‹å€¼
  - å‚æ•°ä¸‰ï¼šç›®æ ‡æ•°ç»„
  - å‚æ•°å››ï¼šèµ‹å€¼åˆ°ç›®æ ‡æ•°ç»„çš„å“ªä¸ªä½ç½®
  - å‚æ•°äº”ï¼šèµ‹å€¼å‡ ä¸ª

### 8.8 BigDecimalç±»

æµ®ç‚¹å‹è¿ç®—çš„æ—¶å€™ç›´æ¥ + * / å¯èƒ½ä¼šå‡ºç°æ•°æ®å¤±çœŸ(ç²¾åº¦é—®é¢˜)ã€‚

BigDecimalå¯ä»¥è§£å†³æµ®ç‚¹å‹è¿ç®—æ•°æ®å¤±çœŸçš„é—®é¢˜ã€‚

åˆ›å»ºå¯¹è±¡æ–¹å¼

- public static BigDecimal valueOf(double val)ï¼šåŒ…è£…æµ®ç‚¹æ•°æˆä¸ºå¤§æ•°æ®å¯¹è±¡ã€‚

æ–¹æ³•

- public BigDecimal add(BigDecimal value)ï¼šåŠ æ³•è¿ç®—
- public BigDecimal subtract(BigDecimal value)ï¼šå‡æ³•è¿ç®—
- public BigDecimal multiply(BigDecimal value)ï¼šä¹˜æ³•è¿ç®—
- public BigDecimal divide(BigDecimal value)ï¼šé™¤æ³•è¿ç®—
- public double doubleValue()ï¼šæŠŠBigDecimalè½¬æ¢æˆdoubleç±»å‹

### 8.9 åŒ…è£…ç±»

Javaè®¤ä¸ºä¸€åˆ‡çš†å¯¹è±¡ã€‚å¼•ç”¨æ•°æ®ç±»å‹å°±æ˜¯å¯¹è±¡äº†ã€‚ä½†æ˜¯åœ¨Javaä¸­8ç§åŸºæœ¬æ•°æ®ç±»å‹ä¸æ˜¯å¯¹è±¡ï¼Œåªæ˜¯è¡¨ç¤ºä¸€ç§æ•°æ®çš„ç±»å‹å½¢å¼ã€‚

Javaä¸ºäº†ä¸€åˆ‡çš†å¯¹è±¡çš„æ€æƒ³ç»Ÿä¸€ï¼ŒæŠŠ8ç§åŸºæœ¬æ•°æ®ç±»å‹è½¬æ¢æˆå¯¹åº”çš„ç±»ï¼Œè¿™ä¸ªç±»ç§°ä¸ºåŸºæœ¬æ•°æ®ç±»å‹çš„åŒ…è£…ç±»ã€‚

| åŸºæœ¬æ•°æ®ç±»å‹ | åŒ…è£…ç±»(å¼•ç”¨æ•°æ®ç±»å‹) |
| :----------: | :------------------: |
|     byte     |         Byte         |
|    short     |        Short         |
|     int      |       Integer        |
|     long     |         Long         |
|    float     |        Float         |
|    double    |        Double        |
|     char     |      Character       |
|   boolean    |       Boolean        |

è‡ªåŠ¨è£…ç®±ï¼šå¯ä»¥ç›´æ¥æŠŠåŸºæœ¬æ•°æ®ç±»å‹çš„å€¼æˆ–è€…å˜é‡èµ‹å€¼ç»™åŒ…è£…ç±»ã€‚

è‡ªåŠ¨æ‹†ç®±ï¼šå¯ä»¥æŠŠåŒ…è£…ç±»çš„å˜é‡ç›´æ¥èµ‹å€¼ç»™åŸºæœ¬æ•°æ®ç±»å‹ã€‚

Javaä¸ºåŒ…è£…ç±»åšäº†ä¸€äº›ç‰¹æ®ŠåŠŸèƒ½ï¼Œä»¥ä¾¿ç¨‹åºå‘˜ä½¿ç”¨ã€‚

åŒ…è£…ç±»ä½œä¸ºç±»é¦–å…ˆæ‹¥æœ‰äº†Objectç±»çš„æ–¹æ³•ã€‚

åŒ…è£…ç±»ä½œä¸ºå¼•ç”¨ç±»å‹çš„å˜é‡å¯ä»¥å­˜å‚¨nullå€¼ã€‚

ç‰¹æ®ŠåŠŸèƒ½ä¸»è¦æœ‰ï¼š

- å¯ä»¥æŠŠåŸºæœ¬æ•°æ®ç±»å‹çš„å€¼è½¬æ¢æˆå­—ç¬¦ä¸²ç±»å‹çš„å€¼ã€‚
  - è°ƒç”¨toString()æ–¹æ³•ã€‚
  - è°ƒç”¨Integer.toString(åŸºæœ¬æ•°æ®ç±»å‹çš„å€¼)å¾—åˆ°å­—ç¬¦ä¸²ã€‚
  - ç›´æ¥æŠŠåŸºæœ¬æ•°æ®ç±»å‹+ç©ºå­—ç¬¦ä¸²å°±å¾—åˆ°äº†å­—ç¬¦ä¸²ã€‚
- æŠŠå­—ç¬¦ä¸²ç±»å‹çš„æ•°å€¼è½¬æ¢æˆå¯¹åº”çš„åŸºæœ¬æ•°æ®ç±»å‹çš„å€¼ã€‚
  - Xxx.parseXxx("å­—ç¬¦ä¸²ç±»å‹çš„æ•°å€¼")
  - Xxx.valueOf("å­—ç¬¦ä¸²ç±»å‹çš„æ•°å€¼")ï¼šæ¨èä½¿ç”¨

### 8.10 æ­£åˆ™è¡¨è¾¾å¼

æ­£åˆ™è¡¨è¾¾å¼çš„ä½œç”¨ï¼šæ˜¯ä¸€äº›ç‰¹æ®Šå­—ç¬¦ç»„æˆçš„æ ¡éªŒè§„åˆ™ï¼Œå¯ä»¥éªŒè¯ä¿¡æ¯çš„æ­£ç¡®æ€§ï¼Œæ ¡éªŒé‚®ç®±ã€ç”µè¯å·ç ã€é‡‘é¢ç­‰æ˜¯å¦åˆæ³•ã€‚

éœ€æ±‚ï¼šæ¼”ç¤ºä¸ç”¨æ­£åˆ™è¡¨è¾¾å¼å’Œç”¨æ­£åˆ™è¡¨è¾¾å¼æ ¡éªŒQQå·ç ã€‚

```Java
public class RegexDemo {
    public static void main(String[] args) {
        System.out.println(checkQQ("42422332"));
        System.out.println(checkQQRegex("42422332"));
    }

    public static boolean checkQQRegex(String qq) {
        return qq != null && qq.matches("\\d{4,}");
    }

    public static boolean checkQQ(String qq) {
        if (qq == null) {
            return false;
        } else {
            if (qq.length() >= 4) {
                boolean rs = true;
                for (int i = 0; i < qq.length(); i++) {
                    char ch = qq.charAt(i);
                    if (ch < '0' || ch > '9') {
                        rs = false;
                    }
                }
                return rs;
            } else {
                return false;
            }
        }
    }
}
```

æ·±å…¥å­¦ä¹ æ­£åˆ™è¡¨è¾¾å¼çš„å†™æ³•

å­—ç¬¦ç±»

- [abc] aã€bæˆ–c (ç®€å•ç±»)
- [^abc] ä»»ä½•å­—ç¬¦ï¼Œé™¤äº†aã€bæˆ–c (å¦å®š)
- [a-zA-Z] aåˆ°zæˆ–Aåˆ°Zï¼Œä¸¤å¤´çš„å­—æ¯åŒ…æ‹¬åœ¨å†… (èŒƒå›´)
- [a-d[m-p]] aåˆ°dæˆ–måˆ°pï¼š[a-dm-p] (å¹¶é›†)
- [a-z&&[def23]] dã€eæˆ–f (äº¤é›†)
- [a-z&&\[^bc]] aåˆ°zï¼Œé™¤äº†bå’Œcï¼š[ad-z] (å‡å»)
- [a-z&&\[^m-p]] aåˆ°zï¼Œè€Œémåˆ°pï¼š[a-lq-z] (å‡å»)

Greedyæ•°é‡è¯

- X? Xï¼Œä¸€æ¬¡æˆ–ä¸€æ¬¡ä¹Ÿæ²¡æœ‰
- X* Xï¼Œé›¶æ¬¡æˆ–å¤šæ¬¡
- X+ Xï¼Œä¸€æ¬¡æˆ–å¤šæ¬¡
- X{n} Xï¼Œæ°å¥½næ¬¡
- X{n,} Xï¼Œè‡³å°‘næ¬¡
- X{n,m} Xï¼Œè‡³å°‘næ¬¡ï¼Œä½†æ˜¯ä¸è¶…è¿‡mæ¬¡ 

è¡¨ç¤ºè§„åˆ™å¤ªå¤šï¼Œå…·ä½“æŸ¥çœ‹Javaæ–‡æ¡£ã€‚

```Java
public class RegexDemo01 {
    public static void main(String[] args) {
        checkEmail();
        checkTell();
    }

    // æ ¡éªŒæ‰‹æœºå·ç 
    private static void checkTell() {
        Scanner sc = new Scanner(System.in);
        System.out.println("è¯·æ‚¨è¾“å…¥æ‰‹æœºå·ç ï¼š");
        String email = sc.nextLine();
        if (email.matches("1[3-9]\\d{9}")) {
            System.out.println("æ‰‹æœºå·ç åˆæ³•äº†ï¼");
        } else {
            System.err.println("æ‰‹æœºå·ç æ ¼å¼ä¸æ­£ç¡®ï¼");
        }
    }

    // æ ¡éªŒé‚®ç®±
    public static void checkEmail() {
        Scanner sc = new Scanner(System.in);
        System.out.println("è¯·æ‚¨è¾“å…¥é‚®ç®±ï¼š");
        String email = sc.nextLine();
        if (email.matches("\\w{1,}@\\w{2,10}(\\.\\w{2,10}){1,2}")) {
            System.out.println("é‚®ç®±åˆæ³•äº†ï¼");
        } else {
            System.err.println("é‚®ç®±æ ¼å¼ä¸æ­£ç¡®ï¼");
        }
    }
}
```

æ­£åˆ™è¡¨è¾¾å¼åœ¨æ–¹æ³•ä¸­çš„åº”ç”¨

- public String[] split(String regex)ï¼šæŒ‰ç…§æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„å†…å®¹è¿›è¡Œåˆ†å‰²å­—ç¬¦ä¸²ï¼Œè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ã€‚
- public String replaceAll(String regex, String newStr)ï¼šæŒ‰ç…§æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„å†…å®¹è¿›è¡Œæ›¿æ¢ã€‚

æ­£åˆ™è¡¨è¾¾å¼çˆ¬å–ä¿¡æ¯

```Java
import java.util.regex.Matcher;
import java.util.regex.Pattern;

public class RegexDemo03 {
    public static void main(String[] args) {
        String rs = "æ¥çš„è¿›å£ä»¶Javaï¼Œç”µè¯020-15645646ï¼Œå¤§å§å¤«IEå’Œ" +
                "djfh@ustc.cnï¼Œç”µè¯13544659457ï¼Œ0203232323" +
                "é‚®ç®±bozai@itahu.cnï¼Œ400-100-3233ï¼Œ4001003232";
        String regex = "(\\w{1,}@\\w{2,10}(\\.\\w{2,10}){1,2})|(1[3-9]\\d{9})|(0\\d{2,5}-?\\d{5,15})|(400-?\\d{3,8}-?\\d{3,8})";
        Pattern pattern = Pattern.compile(regex);
        Matcher matcher = pattern.matcher(rs);
        while (matcher.find()) {
            System.out.println(matcher.group());
        }
    }
}
```

## 9. æ³›å‹

### 9.1 æ³›å‹çš„æ¦‚è¿°

æ³›å‹å°±æ˜¯ä¸€ä¸ªæ ‡ç­¾ï¼š<æ•°æ®ç±»å‹>

æ³›å‹å¯ä»¥åœ¨ç¼–è¯‘é˜¶æ®µçº¦æŸåªèƒ½æ“ä½œæŸç§æ•°æ®ç±»å‹ã€‚

æ³¨æ„ï¼šJDK1.7å¼€å§‹ä¹‹åï¼Œæ³›å‹åé¢çš„ç”³æ˜å¯ä»¥çœç•¥ä¸å†™ã€‚æ³›å‹å’Œé›†åˆéƒ½åªèƒ½æ”¯æŒå¼•ç”¨æ•°æ®ç±»å‹ï¼Œä¸æ”¯æŒåŸºæœ¬æ•°æ®ç±»å‹ã€‚

æ³›å‹å¥½å¤„ï¼šæ³›å‹åœ¨ç¼–è¯‘é˜¶æ®µçº¦æŸäº†æ“ä½œçš„æ•°æ®ç±»å‹ï¼Œä»è€Œä¸ä¼šå‡ºç°ç±»å‹è½¬æ¢å¼‚å¸¸ã€‚

### 9.2 è‡ªå®šä¹‰æ³›å‹

ä½¿ç”¨æ³›å‹å®šä¹‰çš„ç±»å°±æ˜¯æ³›å‹ç±»ã€‚

æ³›å‹ç±»çš„æ ¼å¼

```Java
ä¿®é¥°ç¬¦ class ç±»å<æ³›å‹å˜é‡>{
    
}
```

æ³›å‹å˜é‡å»ºè®®ä½¿ç”¨Eï¼ŒTï¼ŒKï¼ŒV

æ³›å‹çš„æ ¸å¿ƒæ€æƒ³ï¼šæ˜¯æŠŠå‡ºç°æ³›å‹å˜é‡çš„åœ°æ–¹å…¨éƒ¨æ›¿æ¢æˆä¼ è¾“çš„çœŸå®æ•°æ®ç±»å‹ã€‚

æ³›å‹æ–¹æ³•ï¼šå®šä¹‰äº†æ³›å‹çš„æ–¹æ³•å°±æ˜¯æ³›å‹æ–¹æ³•ã€‚

æ³›å‹æ–¹æ³•çš„å®šä¹‰æ ¼å¼

```Java
ä¿®é¥°ç¬¦ <æ³›å‹å˜é‡> è¿”å›å€¼ç±»å‹ æ–¹æ³•åç§°(å½¢å‚åˆ—è¡¨){
    
}
```

æ³¨æ„ï¼šæ–¹æ³•å®šä¹‰äº†æ˜¯ä»€ä¹ˆæ³›å‹å˜é‡ï¼Œåé¢å°±åªèƒ½ç”¨ä»€ä¹ˆæ³›å‹å˜é‡ã€‚

```Java
import java.util.ArrayList;

public class GenericityDemo {
    public static void main(String[] args) {
        MyArrayList<String> lists1 = new MyArrayList<>();
        lists1.add("Hello");
        lists1.add("World");
        lists1.add("Java");
        System.out.println(lists1);

        lists1.remove("World");
        System.out.println(lists1);
        System.out.println("--------------------");

        Integer[] arr = {10,20,30,40};
        String[] arr1 = {"Hello","World","Java"};
        String s = arrToString(arr);
        String s1 = arrToString(arr1);
        System.out.println(s);
        System.out.println(s1);
    }

    public static <T> String arrToString(T[] nums) {
        StringBuilder sb = new StringBuilder();
        sb.append("[");
        if (nums != null && nums.length > 0) {
            for (int i = 0; i < nums.length; i++) {
                T ele = nums[i];
                sb.append(i==nums.length-1?ele:ele+",");
            }
        }
        sb.append("]");
        return sb.toString();
    }
}

class MyArrayList<E> {
    private ArrayList lists = new ArrayList();

    public void add(E e) {
        lists.add(e);
    }

    public void remove(E e) {
        lists.remove(e);
    }

    @Override
    public String toString() {
        return lists.toString();
    }
}
```

æ³›å‹æ¥å£å½¢å¼

```Java
ä¿®é¥°ç¬¦ interface æ¥å£åç§°<æ³›å‹å˜é‡>{
    
}
```

æ³›å‹æ¥å£çš„æ ¸å¿ƒæ€æƒ³ï¼šåœ¨å®ç°æ¥å£çš„æ—¶å€™ä¼ å…¥çœŸå®çš„æ•°æ®ç±»å‹ï¼Œè¿™æ ·é‡å†™çš„æ–¹æ³•å°±æ˜¯å¯¹è¯¥æ•°æ®ç±»å‹è¿›è¡Œæ“ä½œã€‚

æ³›å‹é€šé…ç¬¦ï¼šï¼Ÿï¼Œï¼Ÿå¯ä»¥ç”¨åœ¨ä½¿ç”¨æ³›å‹çš„æ—¶å€™ä»£è¡¨ä¸€åˆ‡ç±»å‹ã€‚

æ³›å‹çš„ä¸Šä¸‹é™

- ? extends Carï¼šé‚£ä¹ˆï¼Ÿå¿…é¡»æ˜¯Caræˆ–è€…å…¶å­ç±»ã€‚(æ³›å‹çš„ä¸Šé™)
- ? super Carï¼šé‚£ä¹ˆï¼Ÿå¿…é¡»æ˜¯Caræˆ–è€…å…¶çˆ¶ç±»ã€‚(æ³›å‹çš„ä¸‹é™ï¼Œä¸æ˜¯å¾ˆå¸¸è§)

## 10. é›†åˆ

é›†åˆç‰¹ç‚¹

- Setç³»åˆ—é›†åˆï¼šæ·»åŠ çš„å…ƒç´ æ˜¯æ— åºï¼Œä¸é‡å¤ï¼Œæ— ç´¢å¼•çš„ã€‚
  - HashSetï¼šæ·»åŠ çš„å…ƒç´ æ˜¯æ— åºï¼Œä¸é‡å¤ï¼Œæ— ç´¢å¼•çš„ã€‚
  - LinkedHashSetï¼šæ·»åŠ çš„å…ƒç´ æ˜¯æœ‰åºï¼Œä¸é‡å¤ï¼Œæ— ç´¢å¼•çš„ã€‚
  - TreeSetï¼šä¸é‡å¤ï¼Œæ— ç´¢å¼•ï¼ŒæŒ‰ç…§å¤§å°é»˜è®¤å‡åºæ’åºã€‚
- Listç³»åˆ—é›†åˆï¼šæ·»åŠ çš„å…ƒç´ æ˜¯æœ‰åºï¼Œå¯é‡å¤ï¼Œæœ‰ç´¢å¼•çš„ã€‚
  - ArrayListï¼šæ·»åŠ çš„å…ƒç´ æ˜¯æœ‰åºï¼Œå¯é‡å¤ï¼Œæœ‰ç´¢å¼•çš„ã€‚
  - LinkedListï¼šæ·»åŠ çš„å…ƒç´ æ˜¯æœ‰åºï¼Œå¯é‡å¤ï¼Œæœ‰ç´¢å¼•çš„ã€‚

Collectionæ˜¯é›†åˆçš„ç¥–å®—ç±»ï¼ŒCollectioné›†åˆçš„åŠŸèƒ½æ˜¯ä¸€åˆ‡é›†åˆéƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨çš„ã€‚

Collectioné›†åˆçš„éå†æ–¹å¼æœ‰ä¸‰ç§

- è¿­ä»£å™¨
- foreach(å¢å¼ºforå¾ªç¯)
- JDK1.8å¼€å§‹ä¹‹åçš„æ–°æŠ€æœ¯Lambdaè¡¨è¾¾å¼

è¿­ä»£å™¨æ–¹æ³•

- public Iterator iterator()ï¼šè·å–é›†åˆå¯¹åº”çš„è¿­ä»£å™¨ï¼Œç”¨æ¥éå†é›†åˆä¸­çš„å…ƒç´ 
- E next()ï¼šè·å–ä¸‹ä¸€ä¸ªå…ƒç´ å€¼
- boolean hasNext()ï¼šåˆ¤æ–­æ˜¯å¦æœ‰ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œæœ‰è¿”å›trueï¼Œåä¹‹è¿”å›false

foreachéå†é›†åˆæˆ–è€…æ•°ç»„å¾ˆæ–¹ä¾¿ã€‚

ç¼ºç‚¹ï¼šforeachéå†æ— æ³•çŸ¥é“éå†åˆ°äº†å“ªä¸ªå…ƒç´ äº†ï¼Œå› ä¸ºæ²¡æœ‰ç´¢å¼•ã€‚

Lambdaè¡¨è¾¾å¼

- lists.forEach(s -> System.out.println(s));
- lists.forEach(System.out::println);

**çº¢é»‘æ ‘**

çº¢é»‘æ ‘å°±æ˜¯å¹³è¡¡çš„äºŒå‰æŸ¥æ‰¾æ ‘ã€‚

çº¢é»‘æ ‘æ˜¯ä¸€ç§è‡ªå¹³è¡¡çš„äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œæ˜¯è®¡ç®—æœºç§‘å­¦ä¸­ç”¨åˆ°çš„ä¸€ç§æ•°æ®ç»“æ„ï¼Œå®ƒæ˜¯åœ¨1972å¹´ç”±Rudolf Bayerå‘æ˜çš„ï¼Œå½“æ—¶è¢«ç§°ä¸ºå¹³è¡¡äºŒå‰Bæ ‘ï¼Œåæ¥ï¼Œåœ¨1978å¹´è¢«Leoj.Guibaså’ŒRobert Sedgewickä¿®æ”¹ä¸ºå¦‚ä»Šçš„â€çº¢é»‘æ ‘â€œã€‚å®ƒæ˜¯ä¸€ç§ç‰¹æ®Šçš„äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œçº¢é»‘æ ‘çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹ä¸Šéƒ½æœ‰å­˜å‚¨ä½è¡¨ç¤ºèŠ‚ç‚¹çš„é¢œè‰²ï¼Œå¯ä»¥æ˜¯çº¢æˆ–è€…é»‘ã€‚

çº¢é»‘æ ‘ä¸æ˜¯é«˜åº¦å¹³è¡¡çš„ï¼Œå®ƒçš„å¹³è¡¡æ˜¯é€šè¿‡â€çº¢é»‘æ ‘çš„ç‰¹æ€§â€œè¿›è¡Œå®ç°çš„ã€‚

çº¢é»‘æ ‘çš„ç‰¹æ€§ï¼š

- æ¯ä¸€ä¸ªèŠ‚ç‚¹æˆ–æ˜¯çº¢è‰²çš„ï¼Œæˆ–è€…æ˜¯é»‘è‰²çš„ã€‚
- æ ¹èŠ‚ç‚¹å¿…é¡»æ˜¯é»‘è‰²ã€‚
- æ¯ä¸ªå¶èŠ‚ç‚¹(Nil)æ˜¯é»‘è‰²çš„ï¼›(å¦‚æœä¸€ä¸ªèŠ‚ç‚¹æ²¡æœ‰å­èŠ‚ç‚¹æˆ–è€…çˆ¶èŠ‚ç‚¹ï¼Œåˆ™è¯¥èŠ‚ç‚¹ç›¸åº”çš„æŒ‡é’ˆå±æ€§å€¼ä¸ºNilï¼Œè¿™äº›Nilè§†ä¸ºå¶èŠ‚ç‚¹)ã€‚
- å¦‚æœæŸä¸€ä¸ªèŠ‚ç‚¹æ˜¯çº¢è‰²ï¼Œé‚£ä¹ˆå®ƒçš„å­èŠ‚ç‚¹å¿…é¡»æ˜¯é»‘è‰²(ä¸èƒ½å‡ºç°ä¸¤ä¸ªçº¢è‰²èŠ‚ç‚¹ç›¸è¿çš„æƒ…å†µ)ã€‚
- å¯¹æ¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä»è¯¥èŠ‚ç‚¹åˆ°å…¶æ‰€æœ‰åä»£å¶èŠ‚ç‚¹çš„ç®€å•è·¯å¾„ä¸Šï¼Œå‡åŒ…å«ç›¸åŒæ•°ç›®çš„é»‘è‰²èŠ‚ç‚¹ã€‚

åœ¨è¿›è¡Œå…ƒç´ æ’å…¥çš„æ—¶å€™ï¼Œå’Œä¹‹å‰ä¸€æ ·ï¼›æ¯ä¸€æ¬¡æ’å…¥å®Œæ¯•ä»¥åï¼Œä½¿ç”¨é»‘è‰²è§„åˆ™è¿›è¡Œæ ¡éªŒï¼Œå¦‚æœä¸æ»¡è¶³çº¢é»‘è§„åˆ™ï¼Œå°±éœ€è¦é€šè¿‡å˜è‰²ï¼Œå·¦æ—‹å’Œå³æ—‹æ¥è°ƒæ•´æ ‘çœ‹ï¼Œä½¿å…¶æ»¡è¶³çº¢é»‘è§„åˆ™ã€‚

çº¢é»‘æ ‘çš„å¢åˆ æ”¹æŸ¥æ€§èƒ½éƒ½å¥½ï¼

Listéå†æ–¹å¼

- forå¾ªç¯
- è¿­ä»£å™¨
- foreach
- JDK 1.8æ–°æŠ€æœ¯

LinkedListä¹Ÿæ˜¯Listçš„å®ç°ç±»ï¼šåº•å±‚æ˜¯åŸºäºé“¾è¡¨çš„ï¼Œå¢åˆ æ¯”è¾ƒå¿«ï¼ŒæŸ¥è¯¢æ…¢ã€‚

LinkedListæ˜¯æ”¯æŒåŒé“¾è¡¨ï¼Œå®šä½å‰åçš„å…ƒç´ éƒ½æ˜¯éå¸¸å¿«çš„ï¼Œå¢åˆ é¦–å°¾çš„å…ƒç´ ä¹Ÿæ˜¯æœ€å¿«çš„ã€‚

æ‰€ä»¥LinkedListé™¤äº†æ‹¥æœ‰Listé›†åˆçš„å…¨éƒ¨åŠŸèƒ½è¿˜å¤šäº†å¾ˆå¤šæ“ä½œé¦–å°¾å…ƒç´ çš„ç‰¹æ®ŠåŠŸèƒ½ã€‚

å¦‚æœæŸ¥è¯¢å¤šè€Œå¢åˆ å°‘ç”¨ArrayListé›†åˆï¼›å¦‚æœæŸ¥è¯¢å°‘è€Œå¢åˆ é¦–å°¾è¾ƒå¤šç”¨LinkedListé›†åˆã€‚

Seté›†åˆ

- å¯¹äºæœ‰å€¼ç‰¹æ€§çš„ï¼ŒSeté›†åˆå¯ä»¥ç›´æ¥åˆ¤æ–­è¿›è¡Œå»é‡å¤ã€‚
- å¯¹äºå¼•ç”¨æ•°æ®ç±»å‹çš„ç±»å¯¹è±¡ï¼ŒSeté›†åˆæ˜¯æŒ‰ç…§å¦‚ä¸‹æµç¨‹è¿›è¡Œæ˜¯å¦é‡å¤çš„åˆ¤æ–­ã€‚
  - Seté›†åˆä¼šè®©ä¸¤ä¸¤å¯¹è±¡ï¼Œå…ˆè°ƒç”¨è‡ªå·±çš„hashCode()æ–¹æ³•å¾—åˆ°å½¼æ­¤çš„å“ˆå¸Œå€¼(æ‰€è°“çš„å†…å­˜åœ°å€)
  - ç„¶åæ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡çš„å“ˆå¸Œå€¼æ˜¯å¦ç›¸åŒï¼Œå¦‚æœä¸ç›¸åŒåˆ™ç›´æ¥è®¤ä¸ºä¸¤ä¸ªå¯¹è±¡ä¸é‡å¤
  - å¦‚æœå“ˆå¸Œå€¼ç›¸åŒï¼Œä¼šç»§ç»­è®©ä¸¤ä¸ªå¯¹è±¡è¿›è¡Œequalsæ¯”è¾ƒå†…å®¹æ˜¯å¦ç›¸åŒï¼Œå¦‚æœç›¸åŒè®¤ä¸ºçœŸçš„é‡å¤äº†ï¼Œå¦‚æœä¸ç›¸åŒè®¤ä¸ºä¸é‡å¤
- åªè¦å¯¹è±¡å†…å®¹ä¸€æ ·ï¼Œå°±å¸Œæœ›é›†åˆè®¤ä¸ºå®ƒä»¬é‡å¤äº†ï¼Œéœ€è¦é‡å†™hashCodeå’Œequalsæ–¹æ³•ã€‚
- Setç³»åˆ—é›†åˆæ·»åŠ å…ƒç´ æ— åºçš„æ ¹æœ¬åŸå› æ˜¯å› ä¸ºåº•å±‚é‡‡ç”¨äº†å“ˆå¸Œè¡¨å­˜å‚¨å…ƒç´ ã€‚
  - JDK 1.8ä¹‹å‰ï¼šå“ˆå¸Œè¡¨ = æ•°ç»„ + é“¾è¡¨ + (å“ˆå¸Œç®—æ³•)
  - JDK 1.8ä¹‹åï¼šå“ˆå¸Œè¡¨ = æ•°ç»„ + é“¾è¡¨ + çº¢é»‘æ ‘ + (å“ˆå¸Œç®—æ³•)
  - å½“é“¾è¡¨çš„é•¿åº¦è¶…è¿‡é˜ˆå€¼(8)æ—¶ï¼Œå°†é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼Œè¿™æ ·å¤§å¤§å‡å°‘äº†æŸ¥æ‰¾æ—¶é—´

å“ˆå¸Œè¡¨çš„å¢åˆ æ”¹æŸ¥æ€§èƒ½éƒ½å¾ˆå¥½ã€‚

LinkedHashSetåº•å±‚ä¾ç„¶æ˜¯ä½¿ç”¨å“ˆå¸Œè¡¨å­˜å‚¨å…ƒç´ çš„ï¼Œä½†æ˜¯æ¯ä¸ªå…ƒç´ éƒ½é¢å¤–å¸¦ä¸€ä¸ªé“¾æ¥ç»´æŠ¤æ·»åŠ é¡ºåºã€‚

ä¸å…‰å¢åˆ æŸ¥å¿«ï¼Œè¿˜æœ‰åºã€‚ç¼ºç‚¹æ˜¯å¤šäº†ä¸€ä¸ªå­˜å‚¨é¡ºåºçš„é“¾ä¼šå å†…å­˜ç©ºé—´ã€‚è€Œä¸”ä¸å…è®¸é‡å¤ï¼Œæ— ç´¢å¼•ã€‚

æ€»ç»“

- å¦‚æœå¸Œæœ›å…ƒç´ å¯ä»¥é‡å¤ï¼Œåˆæœ‰ç´¢å¼•ï¼ŒæŸ¥è¯¢è¦å¿«ç”¨ArrayListé›†åˆã€‚
- å¦‚æœå¸Œæœ›å…ƒç´ å¯ä»¥é‡å¤ï¼Œåˆæœ‰ç´¢å¼•ï¼Œå¢åˆ è¦å¿«è¦ç”¨LinkedListé›†åˆã€‚
- å¦‚æœå¸Œæœ›å¢åˆ æ”¹æŸ¥éƒ½å¾ˆå¿«ï¼Œä½†æ˜¯å…ƒç´ ä¸é‡å¤ä»¥åŠæ— ç´¢å¼•ï¼Œé‚£ä¹ˆç”¨HashSeté›†åˆã€‚
- å¦‚æœå¸Œæœ›å¢åˆ æ”¹æŸ¥éƒ½å¾ˆå¿«ä¸”æœ‰åºï¼Œä½†æ˜¯å…ƒç´ ä¸é‡å¤ä»¥åŠæ— ç´¢å¼•ï¼Œé‚£ä¹ˆç”¨LinkedHashSeté›†åˆã€‚
- è¿™é‡Œçš„æœ‰åºæŒ‡çš„éƒ½æ˜¯æ’å…¥çš„é¡ºåºå’Œéå†ç»“æœé¡ºåºä¸€è‡´ã€‚

TreeSeté›†åˆç§°ä¸ºæ’åºä¸é‡å¤é›†åˆï¼Œå¯ä»¥å¯¹å…ƒç´ åŠé€†è¡Œé»˜è®¤çš„å‡åºæ’åºã€‚

TreeSeté›†åˆè‡ªæ’åºçš„æ–¹å¼

- æœ‰å€¼ç‰¹æ€§çš„å…ƒç´ ç›´æ¥å¯ä»¥å‡åºæ’åºã€‚
- å­—ç¬¦ä¸²ç±»å‹çš„å…ƒç´ ä¼šæŒ‰ç…§é¦–å­—æ¯çš„ç¼–å·æ’åºã€‚
- å¯¹äºè‡ªå®šä¹‰çš„å¼•ç”¨æ•°æ®ç±»å‹ï¼ŒTreeSeté»˜è®¤æ— æ³•æ’åºï¼Œæ‰§è¡Œçš„æ—¶å€™ç›´æ¥æŠ¥é”™ï¼Œå› ä¸ºäººå®¶ä¸çŸ¥é“æ’åºè§„åˆ™ã€‚

è‡ªå®šä¹‰çš„å¼•ç”¨æ•°æ®ç±»å‹çš„æ’åºå®ç°

- å¯¹äºè‡ªå®šä¹‰çš„å¼•ç”¨æ•°æ®ç±»å‹ï¼ŒTreeSeté»˜è®¤æ— æ³•æ’åºï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å®šåˆ¶æ’åºçš„å¤§å°è§„åˆ™ã€‚
- ç¨‹åºå‘˜å®šä¹‰å¤§å°è§„åˆ™çš„æ–¹æ¡ˆæœ‰2ç§
  - ç›´æ¥ä¸ºå¯¹è±¡çš„ç±»å®ç°æ¯”è¾ƒå™¨è§„åˆ™æ¥å£Comparableï¼Œé‡å†™æ¯”è¾ƒæ–¹æ³•ã€‚
    - å¦‚æœç¨‹åºå‘˜è®¤ä¸ºæ¯”è¾ƒè€…å¤§äºè¢«æ¯”è¾ƒè€…ï¼Œè¿”å›æ­£æ•°ã€‚
    - å¦‚æœç¨‹åºå‘˜è®¤ä¸ºæ¯”è¾ƒè€…å°äºè¢«æ¯”è¾ƒè€…ï¼Œè¿”å›è´Ÿæ•°ã€‚
    - å¦‚æœç¨‹åºå‘˜è®¤ä¸ºæ¯”è¾ƒè€…ç­‰äºè¢«æ¯”è¾ƒè€…ï¼Œè¿”å›0ã€‚
  - ç›´æ¥ä¸ºé›†åˆè®¾ç½®æ¯”è¾ƒå™¨Comparatorå¯¹è±¡ï¼Œé‡å†™æ¯”è¾ƒæ–¹æ³•ã€‚
    - å¦‚æœç¨‹åºå‘˜è®¤ä¸ºæ¯”è¾ƒè€…å¤§äºè¢«æ¯”è¾ƒè€…ï¼Œè¿”å›æ­£æ•°ã€‚
    - å¦‚æœç¨‹åºå‘˜è®¤ä¸ºæ¯”è¾ƒè€…å°äºè¢«æ¯”è¾ƒè€…ï¼Œè¿”å›è´Ÿæ•°ã€‚
    - å¦‚æœç¨‹åºå‘˜è®¤ä¸ºæ¯”è¾ƒè€…ç­‰äºè¢«æ¯”è¾ƒè€…ï¼Œè¿”å›0ã€‚
  - å¦‚æœç±»å’Œé›†åˆéƒ½å¸¦æœ‰æ¯”è¾ƒè§„åˆ™ï¼Œä¼˜å…ˆä½¿ç”¨é›†åˆè‡ªå¸¦çš„æ¯”è¾ƒè§„åˆ™ã€‚

Collectionså¹¶ä¸å±äºé›†åˆï¼Œæ˜¯ç”¨æ¥æ“ä½œé›†åˆçš„å·¥å…·ç±»ã€‚

å¯å˜å‚æ•°

- å¯å˜å‚æ•°ç”¨åœ¨å½¢å‚ä¸­å¯ä»¥æ¥æ”¶å¤šä¸ªæ•°æ®ã€‚
- å¯å˜å‚æ•°çš„å½¢å¼ï¼šæ•°æ®ç±»å‹...å‚æ•°åç§°

å¯å˜å‚æ•°çš„ä½œç”¨

- ä¼ è¾“å‚æ•°éå¸¸çµæ´»ï¼Œæ–¹ä¾¿
- å¯ä»¥ä¸ä¼ è¾“å‚æ•°
- å¯ä»¥ä¼ è¾“ä¸€ä¸ªå‚æ•°
- å¯ä»¥ä¼ è¾“å¤šä¸ªå‚æ•°
- å¯ä»¥ä¼ è¾“ä¸€ä¸ªæ•°ç»„

å¯å˜å‚æ•°åœ¨æ–¹æ³•å†…éƒ¨æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªæ•°ç»„ã€‚

å¯å˜å‚æ•°çš„æ³¨æ„äº‹é¡¹

- ä¸€ä¸ªå½¢å‚åˆ—è¡¨ä¸­å¯å˜å‚æ•°åªèƒ½æœ‰ä¸€ä¸ª
- å¯å˜å‚æ•°å¿…é¡»æ”¾åœ¨å½¢å‚åˆ—è¡¨çš„æœ€åé¢

```Java
import java.util.Arrays;

public class SetDemo {
    public static void main(String[] args) {
        sum();
        sum(10);
        sum(10,20,30);
        sum(new int[]{10,30,50,70,90});
    }

    public static void sum(int... nums) {
        System.out.println(nums.length);
        System.out.println(Arrays.toString(nums));
        System.out.println("---------------------------");
    }
}
```

ç»ƒä¹ ï¼šæ–—åœ°ä¸»æ¸¸æˆã€‚

æ‰‘å…‹ç‰Œç±»

```Java
public class Card {
    private String number;
    private String color;
    private int index;

    public Card() {
    }

    public Card(String number, String color, int index) {
        this.number = number;
        this.color = color;
        this.index = index;
    }

    public String getNumber() {
        return number;
    }

    public void setNumber(String number) {
        this.number = number;
    }

    public String getColor() {
        return color;
    }

    public void setColor(String color) {
        this.color = color;
    }

    public int getIndex() {
        return index;
    }

    public void setIndex(int index) {
        this.index = index;
    }

    @Override
    public String toString() {
        return number + color;
    }
}
```

æ–—åœ°ä¸»æ¸¸æˆç±»

```Java
import java.util.*;

public class GameDemo {
    public static final List<Card> ALL_CARDS = new LinkedList<>();

    static {
        String[] numbers = {"3", "4", "5", "6", "7", "8", "9", "10", "J", "Q", "K", "A", "2"};
        String[] colors = {"â™ ","â™¥","â™£","â™¦"};

        int index = 0;
        for (String number : numbers) {
            for (String color : colors) {
                Card card = new Card(number,color,index++);
                ALL_CARDS.add(card);
            }
        }

        Collections.addAll(ALL_CARDS,new Card("","ğŸƒ",index++),new Card("","ğŸ‘²",index++));
        System.out.println("è¾“å‡ºæ–°ç‰Œï¼š" + ALL_CARDS);
    }

    public static void main(String[] args) {
        Collections.shuffle(ALL_CARDS);
        System.out.println("æ´—ç‰Œåï¼š" + ALL_CARDS);

        List<Card> lingHuChong = new ArrayList<>();
        List<Card> jiuMoZhi = new ArrayList<>();
        List<Card> dongfangbubai = new ArrayList<>();

        for (int i = 0; i < ALL_CARDS.size() - 3; i++) {
            Card c = ALL_CARDS.get(i);
            if (i % 3 == 0) {
                lingHuChong.add(c);
            } else if (i % 3 == 1) {
                jiuMoZhi.add(c);
            } else if (i % 3 == 2) {
                dongfangbubai.add(c);
            }
        }

        sortCards(lingHuChong);
        sortCards(jiuMoZhi);
        sortCards(dongfangbubai);

        System.out.println("ä»¤ç‹å†²ï¼š" + lingHuChong);
        System.out.println("é¸ æ‘©æ™ºï¼š" + jiuMoZhi);
        System.out.println("ä¸œæ–¹ä¸è´¥ï¼š" + dongfangbubai);

        List<Card> lastThreeCards = ALL_CARDS.subList(ALL_CARDS.size() - 3, ALL_CARDS.size());
        System.out.println("åº•ç‰Œï¼š" + lastThreeCards);

    }

    private static void sortCards(List<Card> cards) {
        Collections.sort(cards, new Comparator<Card>() {
            @Override
            public int compare(Card o1, Card o2) {
                return o2.getIndex() - o1.getIndex();
            }
        });
    }
}
```

## 11. Mapé›†åˆ

### 11.1 Mapé›†åˆæ¦‚è¿°

Mapé›†åˆæ˜¯å¦ä¸€ä¸ªé›†åˆä½“ç³»ï¼ŒCollectionæ˜¯å•å€¼é›†åˆä½“ç³»ã€‚

Mapé›†åˆæ˜¯ä¸€ç§åŒåˆ—é›†åˆï¼Œæ¯ä¸ªå…ƒç´ åŒ…å«ä¸¤ä¸ªå€¼ã€‚

Mapé›†åˆçš„æ¯ä¸ªå…ƒç´ çš„æ ¼å¼ï¼škey=value(é”®å€¼å¯¹é›†åˆ)

Mapé›†åˆä¹Ÿè¢«ç§°ä¸ºâ€œé”®å€¼å¯¹é›†åˆâ€ã€‚

æ³¨æ„ï¼šé›†åˆå’Œæ³›å‹éƒ½åªèƒ½æ”¯æŒå¼•ç”¨æ•°æ®ç±»å‹ï¼Œé›†åˆå®Œå…¨å¯ä»¥ç§°ä¸ºæ˜¯å¯¹è±¡å®¹å™¨ï¼Œå­˜å‚¨éƒ½æ˜¯å¯¹è±¡ã€‚

Mapé›†åˆçš„ç‰¹ç‚¹

- Mapé›†åˆçš„ç‰¹ç‚¹éƒ½æ˜¯ç”±é”®å†³å®šçš„ã€‚
- Mapé›†åˆçš„é”®æ˜¯æ— åºï¼Œä¸é‡å¤ï¼Œæ— ç´¢å¼•çš„ã€‚
  - Mapé›†åˆåé¢é‡å¤çš„é”®å¯¹åº”çš„å…ƒç´ ä¼šè¦†ç›–å‰é¢çš„æ•´ä¸ªå…ƒç´ ã€‚
- Mapé›†åˆçš„å€¼æ— è¦æ±‚ã€‚
- Mapé›†åˆçš„é”®å€¼å¯¹éƒ½å¯ä»¥ä¸ºnullã€‚

HashMapï¼šå…ƒç´ æŒ‰ç…§é”®æ˜¯æ— åºï¼Œä¸é‡å¤ï¼Œæ— ç´¢å¼•ï¼Œå€¼ä¸åšè¦æ±‚ã€‚

LinkedHashMapï¼šå…ƒç´ æŒ‰ç…§é”®æ˜¯æœ‰åºï¼Œä¸é‡å¤ï¼Œæ— ç´¢å¼•ï¼Œå€¼ä¸åšè¦æ±‚ã€‚

Mapé›†åˆçš„éå†æ–¹å¼

- â€œé”®å€¼å¯¹â€çš„æ–¹å¼éå†ï¼šå…ˆè·å–Mapé›†åˆå…¨éƒ¨çš„é”®ï¼Œå†æ ¹æ®é”®æ‰¾å€¼ã€‚
- â€œé”®å€¼å¯¹â€çš„æ–¹å¼éå†ï¼šéš¾åº¦è¾ƒå¤§ã€‚
- JDK 1.8 å¼€å§‹ä¹‹åçš„æ–°æŠ€æœ¯ï¼šLambdaè¡¨è¾¾å¼ã€‚

```Java
import java.util.HashMap;
import java.util.Map;
import java.util.Set;

public class MapDemo01 {
    public static void main(String[] args) {
        Map<String,Integer> maps = new HashMap<>();
        maps.put("å¨ƒå¨ƒ",30);
        maps.put("iphoneX",100);
        maps.put("huawei",1000);
        maps.put("ç”Ÿæ´»ç”¨å“",10);
        maps.put("æ‰‹è¡¨",10);
        System.out.println(maps);

        Set<String> keys = maps.keySet();
        for (String key : keys) {
            Integer value = maps.get(key);
            System.out.println(key + "=" + value);
        }
        System.out.println("------------------------");

        Set<Map.Entry<String, Integer>> entries = maps.entrySet();
        for (Map.Entry<String, Integer> entry : entries) {
            String key = entry.getKey();
            Integer value = entry.getValue();
            System.out.println(key + "=" + value);
        }
        System.out.println("------------------------");

        maps.forEach((k, v) -> System.out.println(k + "=" + v));
    }
}
```

Mapé›†åˆçš„é”®å’Œå€¼éƒ½å¯ä»¥å­˜å‚¨è‡ªå®šä¹‰ç±»å‹ã€‚

å¦‚æœå¸Œæœ›Mapé›†åˆè®¤ä¸ºè‡ªå®šä¹‰ç±»å‹çš„é”®å¯¹è±¡é‡å¤äº†ï¼Œå¿…é¡»é‡å†™å¯¹è±¡çš„hashCode()å’Œequals()æ–¹æ³•ã€‚

LinkedHashMapé›†åˆ

- LinkedHashMapæ˜¯HashMapçš„å­ç±»ï¼Œæ·»åŠ çš„å…ƒç´ æŒ‰ç…§é”®æœ‰åºï¼Œä¸é‡å¤çš„ã€‚
- HashSeté›†åˆç›¸å½“äºæ˜¯HashMapé›†åˆçš„é”®éƒ½ä¸å¸¦å€¼ã€‚
- LinkedHashSeté›†åˆç›¸å½“äºæ˜¯LinkedHashMapé›†åˆçš„é”®éƒ½ä¸å¸¦å€¼ã€‚
- åº•å±‚åŸç†å®Œå…¨ä¸€æ ·ï¼Œéƒ½æ˜¯åŸºäºå“ˆå¸Œè¡¨æŒ‰ç…§é”®å­˜å‚¨æ•°æ®çš„ï¼Œåªæ˜¯HashMapæˆ–è€…LinkedHashMapçš„é”®éƒ½å¤šä¸€ä¸ªé™„å±å€¼ã€‚

TreeMapé›†åˆ

- TreeMapé›†åˆå’ŒTreeSeté›†åˆéƒ½æ˜¯æ’åºä¸é‡å¤é›†åˆã€‚
- TreeSeté›†åˆçš„åº•å±‚æ˜¯åŸºäºTreeMapï¼Œåªæ˜¯é”®æ²¡æœ‰é™„å±å€¼è€Œå·²ã€‚
- TreeMapé›†åˆæŒ‡å®šå¤§å°è§„åˆ™æœ‰2ä¸­æ–¹å¼
  - ç›´æ¥ä¸ºå¯¹è±¡çš„ç±»å®ç°æ¯”è¾ƒå™¨è§„åˆ™æ¥å£Comparableï¼Œé‡å†™æ¯”è¾ƒæ–¹æ³•
  - ç›´æ¥ä¸ºé›†åˆè®¾ç½®æ¯”è¾ƒå™¨Comparatorå¯¹è±¡ï¼Œé‡å†™æ¯”è¾ƒæ–¹æ³•

ç»ƒä¹ ï¼šè®¡ç®—å­—ç¬¦ä¸²ä¸­å„å­—ç¬¦å‡ºç°çš„æ¬¡æ•°ã€‚

```Java
public class MapDemo01 {
    public static void main(String[] args) {
        Scanner sc = new Scanner(System.in);
        System.out.println("è¯·æ‚¨è¾“å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ï¼š");
        String datas = sc.nextLine();

        Map<Character,Integer> infos = new HashMap<>();
        for (int i = 0; i < datas.length(); i++) {
            char ch = datas.charAt(i);
            if (infos.containsKey(ch)) {
                infos.put(ch,infos.get(ch) + 1);
            } else {
                infos.put(ch,1);
            }
        }
        System.out.println("ç»“æœï¼š" + infos);
    }
}
```

ç»ƒä¹ ï¼šä½¿ç”¨Mapé›†åˆå®ç°æ–—åœ°ä¸»å°æ¡ˆä¾‹ã€‚

```Java
import java.util.*;

public class GameDemo {
    public static final Map<Card,Integer> ALL_CARDS_SIZE = new HashMap<>();
    public static final List<Card> ALL_CARDS = new ArrayList<>();
    static {
        String[] numbers = {"3", "4", "5", "6", "7", "8", "9", "10", "J", "Q", "K", "A", "2"};
        String[] colors = {"â™ ","â™¥","â™£","â™¦"};

        int index = 0;
        for (String number : numbers) {
            for (String color : colors) {
                Card card = new Card(number,color);
                ALL_CARDS.add(card);
                ALL_CARDS_SIZE.put(card,index++);
            }
        }
        Card c1 = new Card("","ğŸƒ");
        Card c2 = new Card("","ğŸ‘²");
        ALL_CARDS.add(c1);
        ALL_CARDS.add(c2);
        ALL_CARDS_SIZE.put(c1,index++);
        ALL_CARDS_SIZE.put(c2,index++);
        System.out.println("è¾“å‡ºæ–°ç‰Œï¼š" + ALL_CARDS);
    }

    public static void main(String[] args) {
        Collections.shuffle(ALL_CARDS);
        System.out.println("æ´—ç‰Œåï¼š" + ALL_CARDS);

        List<Card> lingHuChong = new ArrayList<>();
        List<Card> jiuMoZhi = new ArrayList<>();
        List<Card> dongfangbubai = new ArrayList<>();

        for (int i = 0; i < ALL_CARDS.size() - 3; i++) {
            Card c = ALL_CARDS.get(i);
            if (i % 3 == 0) {
                lingHuChong.add(c);
            } else if (i % 3 == 1) {
                jiuMoZhi.add(c);
            } else if (i % 3 == 2) {
                dongfangbubai.add(c);
            }
        }

        sortCards(lingHuChong);
        sortCards(jiuMoZhi);
        sortCards(dongfangbubai);

        System.out.println("ä»¤ç‹å†²ï¼š" + lingHuChong);
        System.out.println("é¸ æ‘©æ™ºï¼š" + jiuMoZhi);
        System.out.println("ä¸œæ–¹ä¸è´¥ï¼š" + dongfangbubai);

        List<Card> lastThreeCards = ALL_CARDS.subList(ALL_CARDS.size() - 3, ALL_CARDS.size());
        System.out.println("åº•ç‰Œï¼š" + lastThreeCards);

    }

    private static void sortCards(List<Card> cards) {
        Collections.sort(cards, new Comparator<Card>() {
            @Override
            public int compare(Card o1, Card o2) {
                return ALL_CARDS_SIZE.get(o1) - ALL_CARDS_SIZE.get(o2);
            }
        });
    }
}
```

ç»ƒä¹ ï¼šç®€å•å›¾ä¹¦ç®¡ç†ç³»ç»Ÿçš„å¼€å‘ã€‚

ä¹¦ç±Bookç±»

```Java
public class Book {
    private String name;
    private double price;
    private String author;

    public Book() {
    }

    public Book(String name, double price, String author) {
        this.name = name;
        this.price = price;
        this.author = author;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public double getPrice() {
        return price;
    }

    public void setPrice(double price) {
        this.price = price;
    }

    public String getAuthor() {
        return author;
    }

    public void setAuthor(String author) {
        this.author = author;
    }
}
```

å›¾ä¹¦ç®¡ç†BookSystemç±»

```Java
import java.util.*;

public class BookSystem {
    public static final Map<String, List<Book>> BOOK_STORE = new HashMap<>();
    public static final Scanner SYS_SCANNER = new Scanner(System.in);

    public static void main(String[] args) {
        showCommand();
    }

    private static void showCommand() {
        System.out.println("====================æ¬¢è¿æ‚¨è¿›å…¥ç³»ç»Ÿ====================");
        System.out.println("(1) æŸ¥çœ‹å…¨éƒ¨ä¹¦ç±ã€‚query");
        System.out.println("(2) æ·»åŠ ä¹¦æœ¬ä¿¡æ¯ã€‚add");
        System.out.println("(3) åˆ é™¤ä¹¦æœ¬ä¿¡æ¯ã€‚delete");
        System.out.println("(4) ä¿®æ”¹ä¹¦æœ¬ä¿¡æ¯ã€‚update");
        System.out.println("(5) é€€å‡ºç³»ç»Ÿã€‚exit");
        System.out.print("è¯·æ‚¨è¾“å…¥æ‚¨çš„æ“ä½œå‘½ä»¤ï¼š");
        String command = SYS_SCANNER.nextLine();

        switch (command) {
            case "query":
                queryBooks();
                break;
            case "add":
                addBook();
                break;
            case "delete":
                deleteBook();
                break;
            case "update":
                updateBook();
                break;
            case "exit":
                System.out.println("é€€å‡ºæˆåŠŸï¼ŒæœŸå¾…æ‚¨ä¸‹æ¬¡å…‰ä¸´ï¼");
                System.exit(0);
                break;
            default:
                System.err.println("æ‚¨çš„è¾“å…¥æœ‰è¯¯ï¼Œè¯·é‡æ–°ç¡®è®¤ï¼");
        }
        showCommand();
    }

    private static void deleteBook() {
        queryBooks();
        System.out.println("====================æ¬¢è¿æ‚¨è¿›å…¥åˆ é™¤ä¹¦æœ¬ä¸šåŠ¡====================");
        while (true) {
            System.out.println("è¯·æ‚¨è¾“å…¥åˆ é™¤ä¹¦æœ¬çš„æ ç›®ï¼š");
            String type = SYS_SCANNER.nextLine();
            if (BOOK_STORE.containsKey(type)) {
                while (true) {
                    System.out.println("è¯·é—®æ‚¨è¦åˆ é™¤çš„ä¹¦æœ¬åç§°æ˜¯ï¼š");
                    String name = SYS_SCANNER.nextLine();
                    Book book = getBookByTypeAndName(type, name);
                    if (book == null) {
                        System.out.println("ä¸å­˜åœ¨è¿™æœ¬ä¹¦ï¼");
                    } else {
                        List<Book> books = BOOK_STORE.get(type);
                        books.remove(book);
                        System.out.println("åˆ é™¤æˆåŠŸï¼");
                        queryBooks();
                        return;
                    }
                }
            } else {
                System.err.println("æ‚¨çš„æ ç›®è¾“å…¥æœ‰è¯¯ï¼Œè¯·ç¡®è®¤ï¼");
            }
        }
    }

    private static void updateBook() {
        if (BOOK_STORE.size() == 0) {
            System.out.println("æ‚¨ç°åœ¨æ ¹æœ¬æ²¡æœ‰ä»»ä½•æ ç›®å¯ä»¥ä¿®æ”¹ï¼");
        } else {
            queryBooks();
            System.out.println("====================æ¬¢è¿æ‚¨è¿›å…¥ä¿®æ”¹ä¹¦æœ¬ä¸šåŠ¡====================");
            while (true) {
                System.out.println("è¯·æ‚¨è¾“å…¥ä¿®æ”¹ä¹¦æœ¬çš„æ ç›®ï¼š");
                String type = SYS_SCANNER.nextLine();
                if (BOOK_STORE.containsKey(type)) {
                    while (true) {
                        System.out.println("è¯·æ‚¨è¾“å…¥ä¿®æ”¹ä¹¦æœ¬çš„åç§°ï¼š");
                        String name = SYS_SCANNER.nextLine();
                        Book book = getBookByTypeAndName(type, name);
                        if (book == null) {
                            System.err.println("æ‚¨è¾“å…¥çš„ä¹¦åæ˜¯ä¸å­˜åœ¨çš„ï¼Œè¯·é‡æ–°ç¡®è®¤ï¼");
                        } else {
                            System.out.println("è¯·æ‚¨è¾“å…¥ä¿®æ”¹ä¹¦æœ¬çš„æ–°åç§°ï¼š");
                            String newName = SYS_SCANNER.nextLine();
                            System.out.println("è¯·æ‚¨è¾“å…¥ä¿®æ”¹ä¹¦æœ¬çš„æ–°ä»·æ ¼ï¼š");
                            String newPrice = SYS_SCANNER.nextLine();
                            System.out.println("è¯·æ‚¨è¾“å…¥ä¿®æ”¹ä¹¦æœ¬çš„æ–°ä½œè€…ï¼š");
                            String newAuthor = SYS_SCANNER.nextLine();
                            book.setName(newName);
                            book.setPrice(Double.valueOf(newPrice));
                            book.setAuthor(newAuthor);
                            queryBooks();
                            System.out.println("æ‚¨ä¿®æ”¹çš„ä¹¦æœ¬æˆåŠŸï¼Œè¯·çœ‹å¦‚ä¸Šä¿¡æ¯ç¡®è®¤ï¼");
                            return;
                        }
                    }
                } else {
                    System.out.println("æ‚¨è¾“å…¥çš„æ ç›®ä¸å­˜åœ¨ï¼Œè¯·é‡æ–°ç¡®è®¤ï¼");
                }
            }
        }
    }

    public static Book getBookByTypeAndName(String type,String name) {
        List<Book> books = BOOK_STORE.get(type);
        for (Book book : books) {
            if (book.getName().equals(name)) {
                return book;
            }
        }
        return null;
    }

    private static void queryBooks() {
        System.out.println("====================æ¬¢è¿æ‚¨è¿›å…¥æŸ¥è¯¢ä¹¦æœ¬ä¸šåŠ¡====================");
        if (BOOK_STORE.size() == 0) {
            System.out.println("æ‚¨çš„å›¾ä¹¦é¦†ä¸€æœ¬ä¹¦éƒ½æ²¡æœ‰ï¼Œè¯·èµ¶ç´§ä¹°ä¹¦å»ï¼");
        } else {
            System.out.println("ç±»å‹\t\t\t\tä¹¦å\t\t\t\t\tä»·æ ¼\t\t\tä½œè€…");
            BOOK_STORE.forEach((type,books) -> {
                System.out.println(type);
                for (Book book : books) {
                    System.out.println("\t\t\t\t" + book.getName() + "\t\t\t\t" + book.getPrice() + "\t\t\t" + book.getAuthor());
                }
            });
        }
    }

    private static void addBook() {
        System.out.println("====================æ¬¢è¿æ‚¨è¿›å…¥æ·»åŠ ä¹¦æœ¬ä¸šåŠ¡====================");
        System.out.println("è¯·æ‚¨è¾“å…¥æ·»åŠ ä¹¦æœ¬çš„æ ç›®ï¼š");
        String type = SYS_SCANNER.nextLine();
        List<Book> books = null;
        if (BOOK_STORE.containsKey(type)) {
            books = BOOK_STORE.get(type);
        } else {
            books = new ArrayList<>();
            BOOK_STORE.put(type,books);
        }

        System.out.println("è¯·æ‚¨è¾“å…¥æ·»åŠ ä¹¦æœ¬çš„åç§°ï¼š");
        String name = SYS_SCANNER.nextLine();
        System.out.println("è¯·æ‚¨è¾“å…¥æ·»åŠ ä¹¦æœ¬çš„ä»·æ ¼ï¼š");
        String price = SYS_SCANNER.nextLine();
        System.out.println("è¯·æ‚¨è¾“å…¥æ·»åŠ ä¹¦æœ¬çš„ä½œè€…ï¼š");
        String author = SYS_SCANNER.nextLine();
        Book book = new Book(name,Double.valueOf(price),author);
        books.add(book);
        System.out.println("æ‚¨æ·»åŠ åœ¨" + type + "ä¸‹çš„ä¹¦æœ¬" + book.getName() + "æˆåŠŸï¼");

    }
}
```

## 12. åŸºç¡€ç®—æ³•

**å†’æ³¡æ’åº**

ä½œç”¨ï¼šå¯ä»¥ç”¨äºå¯¹æ•°ç»„æˆ–è€…å¯¹é›†åˆçš„å…ƒç´ è¿›è¡Œå¤§å°æ’åºã€‚

æ ¸å¿ƒç®—æ³•æ€æƒ³ï¼šæ¯æ¬¡ä»æ•°ç»„çš„ç¬¬ä¸€ä¸ªä½ç½®å¼€å§‹ä¸¤ä¸¤æ¯”è¾ƒã€‚æŠŠè¾ƒå¤§çš„å…ƒç´ ä¸è¾ƒå°çš„å…ƒç´ è¿›è¡Œå±‚å±‚äº¤æ¢ã€‚æœ€ç»ˆæŠŠå½“å‰æœ€å¤§çš„ä¸€ä¸ªå…ƒç´ å­˜å…¥åˆ°æ•°ç»„å½“å‰çš„æœ«å°¾ã€‚è¿™å°±æ˜¯å†’æ³¡æ€æƒ³ã€‚

```Java
import java.util.Arrays;

public class BubbleSort {
    public static void main(String[] args) {
        int[] arr = new int[]{55, 22, 99, 88};
        for (int i = 0; i < arr.length - 1; i++) {
            for (int j = 0; j < arr.length - i - 1; j++) {
                if (arr[j] > arr[j + 1]) {
                    int temp = arr[j];
                    arr[j] = arr[j + 1];
                    arr[j + 1] = temp;
                }
            }
        }
        System.out.println(Arrays.toString(arr));
    }
}
```

**é€‰æ‹©æ’åº**

é€‰æ‹©æ’åºçš„æ€æƒ³ï¼šä»å½“å‰ä½ç½®å¼€å§‹æ‰¾å‡ºåé¢çš„è¾ƒå°å€¼ä¸è¯¥ä½ç½®äº¤æ¢ã€‚

æ€è·¯

- æ§åˆ¶é€‰æ‹©å‡ è½®ï¼šæ•°ç»„çš„é•¿åº¦-1
- æ§åˆ¶æ¯è½®ä»å½“å‰ä½ç½®å¼€å§‹æ¯”è¾ƒå‡ æ¬¡

```Java
import java.util.Arrays;

public class SelectSort {
    public static void main(String[] args) {
        int[] arr = new int[]{5, 1, 3, 2};
        for (int i = 0; i < arr.length - 1; i++) {
            for (int j = i + 1; j < arr.length; j++) {
                if (arr[i] > arr[j]) {
                    int temp = arr[i];
                    arr[i] = arr[j];
                    arr[j] = temp;
                }
            }
        }
        System.out.println(Arrays.toString(arr));
    }
}
```

**äºŒåˆ†æŸ¥æ‰¾**

äºŒåˆ†æŸ¥æ‰¾çš„å‰æï¼šå¯¹æ•°ç»„æ˜¯æœ‰è¦æ±‚çš„ï¼Œæ•°ç»„å¿…é¡»å·²ç»æ’å¥½åºã€‚

æ€è·¯ï¼šæ¯æ¬¡å…ˆä¸ä¸­é—´çš„å…ƒç´ è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœå¤§äºå¾€å³è¾¹æ‰¾ï¼Œå¦‚æœå°äºå¾€å·¦è¾¹æ‰¾ï¼Œå¦‚æœç­‰äºå°±è¿”å›è¯¥å…ƒç´ ç´¢å¼•ä½ç½®ã€‚å¦‚æœæ²¡æœ‰è¯¥å…ƒç´ ï¼Œè¿”å›-1ã€‚ç»¼åˆæ€§èƒ½æ¯”è¾ƒå¥½ã€‚

```Java
public class BinarySearch {
    public static void main(String[] args) {
        int[] arr = {10, 14, 21, 38, 45, 47, 53, 81, 87, 99};
        int index = binarySearch(arr, 53);
        System.out.println(index);
    }

    public static int binarySearch(int[] arr, int number) {
        int start = 0;
        int end = arr.length - 1;
        while (start <= end) {
            int middleIndex = (start + end) / 2;
            if (number > arr[middleIndex]) {
                start = middleIndex + 1;
            } else if (number < arr[middleIndex]) {
                end = middleIndex - 1;
            } else if (number == arr[middleIndex]) {
                return middleIndex;
            }
        }
        return -1;
    }
}
```

## 13. å¼‚å¸¸

### 13.1 å¼‚å¸¸çš„æ¦‚å¿µå’Œä½“ç³»

ä»€ä¹ˆæ˜¯å¼‚å¸¸

- å¼‚å¸¸æ˜¯ç¨‹åºåœ¨â€œç¼–è¯‘â€æˆ–è€…â€œæ‰§è¡Œâ€çš„è¿‡ç¨‹ä¸­å¯èƒ½å‡ºç°çš„é—®é¢˜ã€‚
- å¼‚å¸¸æ˜¯åº”è¯¥å°½é‡æå‰é¿å…çš„ã€‚
- å¼‚å¸¸å¯èƒ½ä¹Ÿæ˜¯æ— æ³•åšåˆ°ç»å¯¹é¿å…çš„ï¼Œå¼‚å¸¸å¯èƒ½æœ‰å¤ªå¤šæƒ…å†µäº†ï¼Œå¼€å‘ä¸­åªèƒ½æå‰å¹²é¢„ã€‚
- å¼‚å¸¸ä¸€æ—¦å‡ºç°äº†ï¼Œè‹¥æœæ²¡æœ‰æå‰å¤„ç†ï¼Œç¨‹åºå°±ä¼šé€€å‡ºJVMè™šæ‹Ÿæœºè€Œç»ˆæ­¢ï¼Œå¼€å‘ä¸­å¼‚å¸¸æ˜¯éœ€è¦æå‰å¤„ç†çš„ã€‚

ç ”ç©¶å¼‚å¸¸å¹¶ä¸”é¿å…å¼‚å¸¸ï¼Œç„¶åæå‰å¤„ç†å¼‚å¸¸ï¼Œä½“ç°çš„æ˜¯ç¨‹åºçš„å®‰å…¨ï¼Œå¥å£®æ€§ã€‚

Javaä¼šä¸ºå¸¸è§çš„ä»£ç å¼‚å¸¸éƒ½è®¾è®¡ä¸€ä¸ªç±»æ¥ä»£è¡¨ã€‚

Errorï¼šé”™è¯¯çš„æ„æ€ï¼Œä¸¥é‡é”™è¯¯Errorï¼Œæ— æ³•é€šè¿‡å¤„ç†çš„é”™è¯¯ï¼Œä¸€æ—¦å‡ºç°ï¼Œç¨‹åºå‘˜æ— èƒ½ä¸ºåŠ›äº†ã€‚åªèƒ½é‡å¯ç³»ç»Ÿï¼Œä¼˜åŒ–é¡¹ç›®ã€‚æ¯”å¦‚å†…å­˜å´©æºƒï¼ŒJVMæœ¬èº«çš„å´©æºƒã€‚è¿™ä¸ªç¨‹åºå‘˜æ— éœ€ç†ä¼šã€‚

Exceptionï¼šå¼‚å¸¸ç±»ï¼Œå®ƒæ‰æ˜¯å¼€å‘ä¸­ä»£ç åœ¨ç¼–è¯‘æˆ–è€…æ‰§è¡Œçš„è¿‡ç¨‹ä¸­å¯èƒ½å‡ºç°çš„é”™è¯¯ï¼Œå®ƒæ˜¯éœ€è¦æå‰å¤„ç†çš„ã€‚ä»¥ä¾¿ç¨‹åºæ›´å¥å£®ã€‚

Exceptionå¼‚å¸¸çš„åˆ†ç±»

- ç¼–è¯‘æ—¶å¼‚å¸¸ï¼šç»§æ‰¿è‡ªExceptionçš„å¼‚å¸¸æˆ–è€…å…¶å­ç±»ï¼Œç¼–è¯‘é˜¶æ®µå°±ä¼šæŠ¥é”™ï¼Œå¿…é¡»ç¨‹åºå‘˜å¤„ç†çš„ã€‚å¦åˆ™ä»£ç ç¼–è¯‘å°±ä¸èƒ½é€šè¿‡ã€‚
- è¿è¡Œæ—¶å¼‚å¸¸ï¼šç»§æ‰¿è‡ªRuntimeExceptionçš„å¼‚å¸¸æˆ–è€…å…¶å­ç±»ï¼Œç¼–è¯‘é˜¶æ®µæ˜¯ä¸ä¼šæŠ¥é”™çš„ï¼Œå®ƒæ˜¯åœ¨è¿è¡Œæ—¶é˜¶æ®µå¯èƒ½å‡ºç°ï¼Œè¿è¡Œæ—¶å¼‚å¸¸å¯ä»¥å¤„ç†ä¹Ÿå¯ä»¥ä¸å¤„ç†ï¼Œç¼–è¯‘é˜¶æ®µæ˜¯ä¸ä¼šå‡ºé”™çš„ï¼Œä½†æ˜¯è¿è¡Œé˜¶æ®µå¯èƒ½å‡ºç°ï¼Œè¿˜æ˜¯å»ºè®®æå‰å¤„ç†ã€‚

**è¿è¡Œæ—¶å¼‚å¸¸**

è¿è¡Œæ—¶å¼‚å¸¸æ¦‚å¿µ

- ç»§æ‰¿è‡ªRuntimeExceptionçš„å¼‚å¸¸æˆ–è€…å…¶å­ç±»
- ç¼–è¯‘é˜¶æ®µæ˜¯ä¸ä¼šå‡ºé”™çš„ï¼Œå®ƒæ˜¯åœ¨è¿è¡Œæ—¶é˜¶æ®µå¯èƒ½å‡ºç°çš„é”™è¯¯
- è¿è¡Œæ—¶å¼‚å¸¸ç¼–è¯‘é˜¶æ®µå¯ä»¥å¤„ç†ä¹Ÿå¯ä»¥ä¸å¤„ç†ï¼Œä»£ç ç¼–è¯‘éƒ½èƒ½é€šè¿‡

å¸¸è§è¿è¡Œæ—¶å¼‚å¸¸

- æ•°ç»„ç´¢å¼•è¶Šç•Œå¼‚å¸¸ï¼šArrayIndexOutOfBoundsExceptionã€‚
- ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼šNullPointerExceptionã€‚ç›´æ¥è¾“å‡ºæ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯è°ƒç”¨ç©ºæŒ‡é’ˆçš„å˜é‡çš„åŠŸèƒ½å°±ä¼šæŠ¥é”™ã€‚
- ç±»å‹è½¬æ¢å¼‚å¸¸ï¼šClassCastExceptionã€‚
- è¿­ä»£å™¨éå†æ²¡æœ‰æ­¤å…ƒç´ å¼‚å¸¸ï¼šNoSuchElementExceptionã€‚
- æ•°å­¦æ“ä½œå¼‚å¸¸ï¼šArithmeticExceptionã€‚
- æ•°å­—è½¬æ¢å¼‚å¸¸ï¼šNumberFormatExceptionã€‚

**ç¼–è¯‘æ—¶å¼‚å¸¸**

ç¼–è¯‘æ—¶å¼‚å¸¸ç»§æ‰¿è‡ªExceptionçš„å¼‚å¸¸æˆ–è€…å…¶å­ç±»ï¼Œæ²¡æœ‰ç»§æ‰¿RuntimeExceptionã€‚â€œç¼–è¯‘æ—¶å¼‚å¸¸æ˜¯ç¼–è¯‘é˜¶æ®µå°±ä¼šæŠ¥é”™â€ã€‚å¿…é¡»ç¨‹åºå‘˜ç¼–è¯‘é˜¶æ®µå°±å¤„ç†çš„ï¼Œå¦åˆ™ä»£ç ç¼–è¯‘å°±æŠ¥é”™ã€‚

ç¼–è¯‘æ—¶å¼‚å¸¸çš„ä½œç”¨ï¼šæ˜¯æ‹…å¿ƒç¨‹åºå‘˜çš„æŠ€æœ¯ä¸è¡Œï¼Œåœ¨ç¼–è¯‘é˜¶æ®µå°±æŠ¥å‡ºä¸€ä¸ªé”™è¯¯ï¼Œç›®çš„åœ¨äºæé†’ã€‚æé†’ç¨‹åºå‘˜è¿™é‡Œå¾ˆå¯èƒ½å‡ºé”™ï¼Œè¯·æ£€æŸ¥å¹¶æ³¨æ„ä¸è¦å‡ºbugã€‚

### 13.2 å¼‚å¸¸å¤„ç†

å¼‚å¸¸äº§ç”Ÿé»˜è®¤çš„å¤„ç†è¿‡ç¨‹è§£æ

- é»˜è®¤ä¼šåœ¨å‡ºç°å¼‚å¸¸çš„ä»£ç å“ªé‡Œè‡ªåŠ¨çš„åˆ›å»ºä¸€ä¸ªå¼‚å¸¸å¯¹è±¡ï¼šArithmeticExceptionã€‚
- å¼‚å¸¸ä¼šä»æ–¹æ³•ä¸­å‡ºç°çš„ç‚¹è¿™é‡ŒæŠ›å‡ºç»™è°ƒç”¨è€…ï¼Œè°ƒç”¨è€…æœ€ç»ˆæŠ›å‡ºç»™JVMè™šæ‹Ÿæœºã€‚
- è™šæ‹Ÿæœºæ¥æ”¶åˆ°å¼‚å¸¸å¯¹è±¡åï¼Œå…ˆåœ¨æ§åˆ¶å°ç›´æ¥è¾“å‡ºå¼‚å¸¸æ ˆä¿¡æ¯æ•°æ®ã€‚
- ç›´æ¥ä»å½“å‰æ‰§è¡Œçš„å¼‚å¸¸ç‚¹å¹²æ‰å½“å‰ç¨‹åºã€‚
- åç»­ä»£ç æ²¡æœ‰æœºä¼šæ‰§è¡Œäº†ï¼Œå› ä¸ºç¨‹åºå·²ç»æ­»äº¡ã€‚

**ç¼–è¯‘æ—¶å¼‚å¸¸çš„å¤„ç†**

æ–¹å¼ä¸€ï¼šå‡ºç°å¼‚å¸¸çš„åœ°æ–¹å±‚å±‚æŠ›å‡ºï¼Œè°éƒ½ä¸å¤„ç†ï¼Œæœ€ç»ˆæŠ›ç»™è™šæ‹Ÿæœºã€‚è¿™ç§æ–¹å¼è™½ç„¶å¯ä»¥è§£å†³ç¼–è¯‘æ—¶å¼‚å¸¸ï¼Œä½†æ˜¯å¦‚æœå¼‚å¸¸çœŸçš„å‡ºç°äº†ï¼Œç¨‹åºä¼šç›´æ¥æ­»äº¡ï¼Œæ‰€ä»¥è¿™ç§æ–¹å¼å¹¶ä¸å¥½ã€‚

æ–¹å¼äºŒï¼šä½¿ç”¨try...catchæ•è·å¼‚å¸¸ï¼Œå¯ä»¥å¤„ç†å¼‚å¸¸ï¼Œå¹¶ä¸”å‡ºç°å¼‚å¸¸åä»£ç ä¹Ÿä¸ä¼šæ­»äº¡ã€‚è¿™ç§æ–¹æ¡ˆè¿˜æ˜¯å¯ä»¥çš„ã€‚ä½†ä»ç†è®ºä¸Šæ¥è¯´ï¼Œè¿™ç§æ–¹å¼ä¸æ˜¯æœ€å¥½çš„ï¼Œä¸Šå±‚è°ƒç”¨è€…ä¸èƒ½ç›´æ¥çŸ¥é“åº•å±‚çš„æ‰§è¡Œæƒ…å†µã€‚

æ–¹å¼ä¸‰ï¼šåœ¨å‡ºç°å¼‚å¸¸çš„åœ°æ–¹æŠŠå¼‚å¸¸ä¸€å±‚ä¸€å±‚åœ°æŠ›å‡ºç»™æœ€å¤–å±‚è°ƒç”¨è€…ï¼Œæœ€å¤–å±‚è°ƒç”¨è€…é›†ä¸­æ•è·å¤„ç†ã€‚è¿™ç§æ–¹æ¡ˆæœ€å¤–å±‚è°ƒç”¨è€…å¯ä»¥çŸ¥é“åº•å±‚æ‰§è¡Œçš„æƒ…å†µï¼ŒåŒæ—¶ç¨‹åºåœ¨å‡ºç°å¼‚å¸¸åä¹Ÿä¸ä¼šç«‹å³æ­»äº¡ï¼Œè¿™æ˜¯ç†è®ºä¸Šæœ€å¥½çš„æ–¹æ¡ˆã€‚

è™½ç„¶å¼‚å¸¸æœ‰ä¸‰ç§å¤„ç†æ–¹å¼ï¼Œä½†æ˜¯å¼€å‘ä¸­åªè¦èƒ½è§£å†³ä½ çš„é—®é¢˜ï¼Œæ¯ç§æ–¹å¼éƒ½æœ‰å¯èƒ½ç”¨åˆ°ã€‚

**è¿è¡Œæ—¶å¼‚å¸¸çš„å¤„ç†**

è¿è¡Œæ—¶å¼‚å¸¸å¯ä»¥è‡ªåŠ¨æŠ›å‡ºï¼Œä¸éœ€è¦æˆ‘ä»¬æ‰‹å·¥æŠ›å‡ºã€‚

è¿è¡Œæ—¶å¼‚å¸¸çš„å¤„ç†è§„èŒƒï¼šç›´æ¥åœ¨æœ€å¤–å±‚æ•è·å¤„ç†å³å¯ï¼Œåº•å±‚ä¼šè‡ªåŠ¨æŠ›å‡ºã€‚

finallyçš„ä½œç”¨ï¼šå¯ä»¥åœ¨ä»£ç æ‰§è¡Œå®Œæ¯•ä»¥åè¿›è¡Œèµ„æºçš„é‡Šæ”¾æ“ä½œã€‚

ä»€ä¹ˆæ˜¯èµ„æºï¼šèµ„æºéƒ½æ˜¯å®ç°äº†Closeableæ¥å£çš„ï¼Œéƒ½è‡ªå¸¦close()å…³é—­æ–¹æ³•ã€‚

å¼‚å¸¸çš„è¯­æ³•æ³¨æ„

- è¿è¡Œæ—¶å¼‚å¸¸è¢«æŠ›å‡ºå¯ä»¥ä¸å¤„ç†ã€‚å¯ä»¥è‡ªåŠ¨æŠ›å‡ºï¼Œç¼–è¯‘æ—¶å¼‚å¸¸å¿…é¡»å¤„ç†ï¼ŒæŒ‰ç…§è§„èŒƒéƒ½åº”è¯¥å¤„ç†ã€‚
- é‡å†™æ–¹æ³•ç”³æ˜æŠ›å‡ºçš„å¼‚å¸¸ï¼Œåº”è¯¥ä¸çˆ¶ç±»è¢«é‡å†™æ–¹æ³•ç”³æ˜æŠ›å‡ºçš„å¼‚å¸¸ä¸€æ ·æˆ–è€…æ›´å°ã€‚
- æ–¹æ³•é»˜è®¤éƒ½å¯ä»¥è‡ªåŠ¨æŠ›å‡ºè¿è¡Œæ—¶å¼‚å¸¸ï¼Œthrows RuntimeExceptionå¯ä»¥çœç•¥ä¸å†™ã€‚
- åœ¨å¤šå¼‚å¸¸å¤„ç†æ—¶ï¼Œæ•è·å¤„ç†ï¼Œå‰è¾¹çš„å¼‚å¸¸ç±»ä¸èƒ½æ˜¯åè¾¹å¼‚å¸¸ç±»çš„çˆ¶ç±»ã€‚
- åœ¨try/catchåå¯ä»¥è¿½åŠ finallyä»£ç å—ï¼Œå…¶ä¸­çš„ä»£ç ä¸€å®šä¼šè¢«æ‰§è¡Œï¼Œé€šå¸¸ç”¨äºèµ„æºå›æ”¶æ“ä½œã€‚

### 13.3 è‡ªå®šä¹‰å¼‚å¸¸

è‡ªå®šä¹‰ç¼–è¯‘æ—¶å¼‚å¸¸

- å®šä¹‰ä¸€ä¸ªå¼‚å¸¸ç±»ç»§æ‰¿Exception
- é‡å†™æ„é€ å™¨
- åœ¨å‡ºç°å¼‚å¸¸çš„åœ°æ–¹ç”¨throw new è‡ªå®šä¹‰å¯¹è±¡æŠ›å‡º
- ç¼–è¯‘æ—¶å¼‚å¸¸æ˜¯ç¼–è¯‘é˜¶æ®µå°±æŠ¥é”™ï¼Œæé†’æ›´åŠ å¼ºçƒˆï¼Œä¸€å®šéœ€è¦å¤„ç†

è‡ªå®šä¹‰è¿è¡Œæ—¶å¼‚å¸¸

- å®šä¹‰ä¸€ä¸ªå¼‚å¸¸ç±»ç»§æ‰¿RuntimeException
- é‡å†™æ„é€ å™¨
- åœ¨å‡ºç°å¼‚å¸¸çš„åœ°æ–¹ç”¨throw new è‡ªå®šä¹‰å¯¹è±¡æŠ›å‡º
- æé†’ä¸å¼ºçƒˆï¼Œç¼–è¯‘é˜¶æ®µä¸æŠ¥é”™

å¼‚å¸¸çš„ä½œç”¨

- å¯ä»¥å¤„ç†ä»£ç é—®é¢˜ï¼Œé˜²æ­¢ç¨‹åºå‡ºç°å¼‚å¸¸åçš„æ­»äº¡
- æé«˜äº†ç¨‹åºçš„å¥å£®æ€§å’Œå®‰å…¨æ€§

## 14. å¤šçº¿ç¨‹

### 14.1 å¤šçº¿ç¨‹æ¦‚è¿°

è¿›ç¨‹ï¼šç¨‹åºæ˜¯é™æ­¢çš„ï¼Œè¿è¡Œä¸­çš„ç¨‹åºå°±æ˜¯è¿›ç¨‹ã€‚

è¿›è¡Œçš„ä¸‰ä¸ªç‰¹å¾

- åŠ¨æ€æ€§ï¼šè¿›ç¨‹æ˜¯è¿è¡Œä¸­çš„ç¨‹åºï¼Œè¦åŠ¨æ€çš„å ç”¨å†…å­˜ï¼ŒCPUå’Œç½‘ç»œèµ„æºã€‚
- ç‹¬ç«‹æ€§ï¼šè¿›ç¨‹ä¸è¿›ç¨‹ä¹‹é—´æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œå½¼æ­¤æœ‰è‡ªå·±çš„ç‹¬ç«‹å†…å­˜åŒºåŸŸã€‚
- å¹¶å‘æ€§ï¼šå‡å¦‚CPUæ˜¯å•æ ¸ï¼ŒåŒä¸€ä¸ªæ—¶åˆ»å…¶å®å†…å­˜ä¸­åªæœ‰ä¸€ä¸ªè¿›ç¨‹åœ¨è¢«æ‰§è¡Œã€‚CPUä¼šåˆ†æ—¶è½®è¯¢åˆ‡æ¢ä¾æ¬¡ä¸ºæ¯ä¸ªè¿›ç¨‹æœåŠ¡ï¼Œå› ä¸ºåˆ‡æ¢çš„é€Ÿåº¦éå¸¸å¿«ï¼Œç»™æˆ‘ä»¬çš„æ„Ÿè§‰è¿™äº›è¿›ç¨‹åœ¨åŒæ—¶æ‰§è¡Œï¼Œè¿™å°±æ˜¯å¹¶å‘æ€§ã€‚

å¹¶è¡Œï¼šåŒä¸€ä¸ªæ—¶åˆ»åŒæ—¶æœ‰å¤šä¸ªåœ¨æ‰§è¡Œã€‚

çº¿ç¨‹

- çº¿ç¨‹æ˜¯å±äºè¿›ç¨‹çš„ã€‚ä¸€ä¸ªè¿›ç¨‹å¯ä»¥åŒ…å«å¤šä¸ªçº¿ç¨‹ï¼Œè¿™å°±æ˜¯å¤šçº¿ç¨‹ã€‚
- çº¿ç¨‹åˆ›å»ºå¼€é”€ç›¸å¯¹äºè¿›ç¨‹æ¥è¯´æ¯”è¾ƒå°ã€‚
- çº¿ç¨‹ä¹Ÿæ”¯æŒå¹¶å‘æ€§ã€‚

çº¿ç¨‹çš„ä½œç”¨

- å¯ä»¥æé«˜ç¨‹åºçš„æ•ˆç‡ï¼Œçº¿ç¨‹ä¹Ÿæ”¯æŒå¹¶å‘æ€§ï¼Œå¯ä»¥æœ‰æ›´å¤šæœºä¼šå¾—åˆ°CPUã€‚
- å¤šçº¿ç¨‹å¯ä»¥è§£å†³å¾ˆå¤šä¸šåŠ¡æ¨¡å‹ã€‚
- å¤§å‹é«˜å¹¶å‘æŠ€æœ¯çš„æ ¸å¿ƒæŠ€æœ¯ã€‚
- æ¶‰åŠåˆ°å¤šçº¿ç¨‹çš„å¼€å‘å¯èƒ½éƒ½æ¯”è¾ƒéš¾ç†è§£ã€‚

### 14.2 çº¿ç¨‹çš„åˆ›å»º

åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼æœ‰ä¸‰ç§

1. ç›´æ¥å®šä¹‰ä¸€ä¸ªç±»ç»§æ‰¿çº¿ç¨‹ç±»Threadï¼Œé‡å†™runæ–¹æ³•ï¼Œåˆ›å»ºçº¿ç¨‹å¯¹è±¡ï¼Œè°ƒç”¨çº¿ç¨‹å¯¹è±¡çš„start()æ–¹æ³•å¯åŠ¨çº¿ç¨‹ã€‚
2. å®šä¹‰ä¸€ä¸ªçº¿ç¨‹ä»»åŠ¡ç±»å®ç°Runnableæ¥å£ï¼Œé‡å†™run()æ–¹æ³•ï¼Œåˆ›å»ºçº¿ç¨‹ä»»åŠ¡å¯¹è±¡ï¼ŒæŠŠçº¿ç¨‹ä»»åŠ¡å¯¹è±¡åŒ…è£…æˆçº¿ç¨‹å¯¹è±¡ï¼Œè°ƒç”¨çº¿ç¨‹å¯¹è±¡çš„start()æ–¹æ³•å¯åŠ¨çº¿ç¨‹ã€‚
3. å®ç°Callableæ¥å£(æ‹“å±•)ã€‚

ç»§æ‰¿Threadç±»çš„æ–¹å¼

- å®šä¹‰ä¸€ä¸ªçº¿ç¨‹ç±»ç»§æ‰¿Threadç±»
- é‡å†™run()æ–¹æ³•
- åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹å¯¹è±¡
- è°ƒç”¨çº¿ç¨‹å¯¹è±¡çš„start()æ–¹æ³•å¯åŠ¨çº¿ç¨‹

ç»§æ‰¿Threadç±»çš„ä¼˜ç¼ºç‚¹

- ä¼˜ç‚¹ï¼šç¼–ç ç®€å•
- ç¼ºç‚¹ï¼šçº¿ç¨‹ç±»å·²ç»ç»§æ‰¿äº†Threadç±»æ— æ³•ç»§æ‰¿å…¶ä»–ç±»äº†ï¼ŒåŠŸèƒ½ä¸èƒ½é€šè¿‡ç»§æ‰¿æ‹“å±•

çº¿ç¨‹çš„æ³¨æ„äº‹é¡¹

- çº¿ç¨‹å¯åŠ¨å¿…é¡»è°ƒç”¨start()æ–¹æ³•ã€‚å¦åˆ™å½“æˆæ™®é€šç±»å¤„ç†ã€‚
  - å¦‚æœçº¿ç¨‹ç›´æ¥è°ƒç”¨run()æ–¹æ³•ï¼Œç›¸å½“äºå˜æˆäº†æ™®é€šç±»çš„æ‰§è¡Œï¼Œæ­¤æ—¶å°†åªæœ‰ä¸»çº¿ç¨‹åœ¨æ‰§è¡Œä»–ä»¬
  - start()æ–¹æ³•åº•å±‚å…¶å®æ˜¯ç»™CPUæ³¨å†Œå½“å‰çš„çº¿ç¨‹ï¼Œå¹¶ä¸”è§¦å‘run()æ–¹æ³•æ‰§è¡Œ
- å»ºè®®çº¿ç¨‹å…ˆåˆ›å»ºå­çº¿ç¨‹ï¼Œä¸»çº¿ç¨‹çš„ä»»åŠ¡æ”¾åœ¨ä¹‹åã€‚å¦åˆ™ä¸»çº¿ç¨‹æ˜¯å…ˆæ‰§è¡Œå®Œã€‚

Threadç±»çš„API

- public void setName(String name)ï¼šç»™å½“å‰çº¿ç¨‹å–åå­—ã€‚
- public void getName()ï¼šè·å–å½“å‰çº¿ç¨‹çš„åå­—ã€‚
  - çº¿ç¨‹å­˜åœ¨é»˜è®¤åç§°ï¼Œå­çº¿ç¨‹çš„é»˜è®¤åç§°æ˜¯ï¼šThread-ç´¢å¼•ã€‚
  - ä¸»çº¿ç¨‹çš„é»˜è®¤åç§°å°±æ˜¯ï¼šmainã€‚
- public static Thread currentThread()ï¼šè·å–å½“å‰çº¿ç¨‹å¯¹è±¡ï¼Œè¿™ä¸ªä»£ç åœ¨å“ªä¸ªçº¿ç¨‹ä¸­ï¼Œå°±å¾—åˆ°å“ªä¸ªçº¿ç¨‹å¯¹è±¡ã€‚
- public static void sleep(long time)ï¼šè®©å½“å‰çº¿ç¨‹ä¼‘çœ å¤šå°‘æ¯«ç§’å†ç»§ç»­æ‰§è¡Œã€‚

å®ç°Runnableæ¥å£çš„æ–¹å¼

- åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ä»»åŠ¡ç±»å®ç°Runnableæ¥å£
- é‡å†™run()æ–¹æ³•
- åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ä»»åŠ¡å¯¹è±¡
- æŠŠçº¿ç¨‹ä»»åŠ¡å¯¹è±¡åŒ…è£…æˆçº¿ç¨‹å¯¹è±¡
- è°ƒç”¨çº¿ç¨‹å¯¹è±¡çš„start()æ–¹æ³•å¯åŠ¨çº¿ç¨‹

å®ç°Runnableæ¥å£çš„ä¼˜ç¼ºç‚¹

- ä¼˜ç‚¹
  - çº¿ç¨‹ä»»åŠ¡ç±»åªæ˜¯å®ç°äº†Runnableæ¥å£ï¼Œå¯ä»¥ç»§ç»­ç»§æ‰¿å…¶ä»–ç±»ï¼ŒåŒæ—¶å¯ä»¥ç»§ç»­å®ç°å…¶ä»–æ¥å£
  - ä¸€ä¸ªçº¿ç¨‹ä»»åŠ¡å¯¹è±¡å¯ä»¥è¢«å…±äº«æˆå¤šä¸ªçº¿ç¨‹å¯¹è±¡ï¼Œé€‚åˆåšå¤šçº¿ç¨‹çš„èµ„æºå…±äº«æ“ä½œ
  - å®ç°è§£è€¦æ“ä½œï¼Œçº¿ç¨‹ä»»åŠ¡ä»£ç å¯ä»¥è¢«å¤šä¸ªçº¿ç¨‹å…±äº«ï¼Œä»»åŠ¡ä»£ç å’Œçº¿ç¨‹ç‹¬ç«‹
  - çº¿ç¨‹æ± å¯ä»¥æ”¾å…¥å®ç°Runnableæˆ–Callableçº¿ç¨‹ä»»åŠ¡å¯¹è±¡
  - å¾ˆé€‚åˆåšçº¿ç¨‹æ± çš„æ‰§è¡Œä»»åŠ¡
- ç¼ºç‚¹
  - ç¼–ç ç›¸å¯¹å¤æ‚
  - æ— æ³•ç›´æ¥å¾—åˆ°çº¿ç¨‹æ‰§è¡Œçš„ç»“æœ

å®ç°Callableæ¥å£

- å®šä¹‰ä¸€ä¸ªçº¿ç¨‹ä»»åŠ¡ç±»å®ç°Callableæ¥å£ï¼Œç”³æ˜çº¿ç¨‹æ‰§è¡Œçš„ç»“æœç±»å‹
- é‡å†™çº¿ç¨‹ä»»åŠ¡ç±»çš„callæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å¯ä»¥ç›´æ¥è¿”å›æ‰§è¡Œçš„ç»“æœ
- åˆ›å»ºä¸€ä¸ªCallableçš„çº¿ç¨‹ä»»åŠ¡å¯¹è±¡
- æŠŠCallableçš„çº¿ç¨‹ä»»åŠ¡å¯¹è±¡åŒ…è£…æˆä¸€ä¸ªæœªæ¥ä»»åŠ¡å¯¹è±¡
- æŠŠæœªæ¥ä»»åŠ¡å¯¹è±¡åŒ…è£…æˆçº¿ç¨‹å¯¹è±¡
- è°ƒç”¨çº¿ç¨‹çš„start()æ–¹æ³•å¯åŠ¨çº¿ç¨‹

ä¼˜ç¼ºç‚¹

- ä¼˜ç‚¹ï¼šå…¨æ˜¯ä¼˜ç‚¹ã€‚
  - çº¿ç¨‹ä»»åŠ¡ç±»åªæ˜¯å®ç°äº†Callableæ¥å£ï¼Œå¯ä»¥ç»§ç»­ç»§æ‰¿å…¶ä»–ç±»ï¼ŒåŒæ—¶å¯ä»¥ç»§ç»­å®ç°å…¶ä»–æ¥å£
  - ä¸€ä¸ªçº¿ç¨‹ä»»åŠ¡å¯¹è±¡å¯ä»¥è¢«å…±äº«æˆå¤šä¸ªçº¿ç¨‹ä»»åŠ¡å¯¹è±¡ï¼Œé€‚åˆåšå¤šçº¿ç¨‹çš„èµ„æºå…±äº«æ“ä½œ
  - å¾ˆé€‚åˆåšçº¿ç¨‹æ± çš„æ‰§è¡Œæ“ä½œ
  - å¯ä»¥ç›´æ¥è·å–çº¿ç¨‹æ‰§è¡Œçš„ç»“æœ
- ç¼ºç‚¹ï¼šç¼–ç å¤æ‚ã€‚

æ¡ˆä¾‹

```Java
import java.util.concurrent.Callable;
import java.util.concurrent.FutureTask;

public class ThreadDemo02 {
    public static void main(String[] args) {
        Callable<String> call = new MyCallable();
        // æŠŠCallableä»»åŠ¡å¯¹è±¡åŒ…è£…æˆä¸€ä¸ªæœªæ¥ä»»åŠ¡å¯¹è±¡
        FutureTask<String> task = new FutureTask<>(call);
        Thread t = new Thread(task);
        t.start();

        for (int i = 1; i <= 10; i++) {
            System.out.println(Thread.currentThread().getName() + ":" + i);
        }

        try {
            String rs = task.get(); // è·å–callæ–¹æ³•è¿”å›çš„ç»“æœ
            System.out.println(rs);
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}

class MyCallable implements Callable<String> {
    @Override
    public String call() throws Exception {
        int sum = 0;
        for (int i = 1; i <= 10; i++) {
            System.out.println(Thread.currentThread().getName() + ":" + i);
            sum += i;
        }
        return Thread.currentThread().getName() + "æ‰§è¡Œçš„ç»“æœæ˜¯ï¼š" + sum;
    }
}
```

### 14.3 çº¿ç¨‹å®‰å…¨

çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼šå¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œåŒä¸€ä¸ªå…±äº«èµ„æºçš„æ—¶å€™å¯èƒ½ä¼šå‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚

é—®é¢˜æ¡ˆä¾‹ï¼šä¸¤äººåŒæ—¶ä»é“¶è¡Œè´¦æˆ·å–é’±ã€‚

é“¶è¡Œè´¦æˆ·ç±»Account

```Java
public class Account {
    private String cardID;
    private double money;

    public Account() {
    }

    public Account(String cardID, double money) {
        this.cardID = cardID;
        this.money = money;
    }

    public String getCardID() {
        return cardID;
    }

    public void setCardID(String cardID) {
        this.cardID = cardID;
    }

    public double getMoney() {
        return money;
    }

    public void setMoney(double money) {
        this.money = money;
    }

    public void drawMoney(double money) {
        String name = Thread.currentThread().getName();
        if (this.money >= money) {
            System.out.println(name + "æ¥å–é’±ï¼Œä½™é¢è¶³å¤Ÿï¼Œåå‡º" + money);
            this.money -= money;
            System.out.println(name + "æ¥å–é’±åï¼Œä½™é¢å‰©ä½™" + this.money);
        } else {
            System.out.println(name + "æ¥å–é’±ï¼Œä½™é¢ä¸è¶³ï¼");
        }
    }
}
```

å–é’±çº¿ç¨‹ç±»DrawThread

```Java
public class DrawThread extends Thread {
    private Account acc;
    public DrawThread(Account acc,String name) {
        super(name);
        this.acc = acc;
    }
    @Override
    public void run() {
        acc.drawMoney(100000);
    }
}
```

å–é’±ç±»ThreadSafe

```Java
public class ThreadSafe {
    public static void main(String[] args) {
        Account acc = new Account("ICBC-110",100000);

        Thread littleMing = new DrawThread(acc,"å°æ˜");
        littleMing.start();

        Thread littleRed = new DrawThread(acc,"å°çº¢");
        littleRed.start();
    }
}
```

çº¿ç¨‹åŒæ­¥çš„ä½œç”¨ï¼šå°±æ˜¯ä¸ºäº†è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜çš„æ–¹æ¡ˆã€‚

çº¿ç¨‹åŒæ­¥è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜çš„æ ¸å¿ƒæ€æƒ³ï¼šè®©å¤šä¸ªçº¿ç¨‹å®ç°å…ˆåä¾æ¬¡è®¿é—®å…±äº«èµ„æºï¼Œè¿™æ ·å°±è§£å†³äº†å®‰å…¨é—®é¢˜ã€‚

çº¿ç¨‹åŒæ­¥çš„åšæ³•ï¼šæ˜¯æŠŠå…±äº«èµ„æºè¿›è¡Œä¸Šé”ï¼Œæ¯æ¬¡åªèƒ½ä¸€ä¸ªçº¿ç¨‹è¿›å…¥ï¼Œè®¿é—®å®Œæ¯•ä»¥åï¼Œå…¶ä»–çº¿ç¨‹æ‰èƒ½è¿›æ¥ã€‚

çº¿ç¨‹åŒæ­¥çš„æ–¹å¼æœ‰ä¸‰ç§

- åŒæ­¥ä»£ç å—
- åŒæ­¥æ–¹æ³•
- lockæ˜¾ç¤ºé”

**åŒæ­¥ä»£ç å—**

ä½œç”¨ï¼šæŠŠå‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜çš„æ ¸å¿ƒä»£ç ç»™ä¸Šé”ï¼Œæ¯æ¬¡åªèƒ½ä¸€ä¸ªçº¿ç¨‹è¿›å…¥ï¼Œæ‰§è¡Œå®Œæ¯•ä»¥åè‡ªåŠ¨è§£é”ï¼Œå…¶ä»–çº¿ç¨‹æ‰å¯ä»¥è¿›æ¥æ‰§è¡Œã€‚

æ ¼å¼

```Java
synchronized(é”å¯¹è±¡){
    // è®¿é—®å…±äº«èµ„æºçš„æ ¸å¿ƒä»£ç 
}
```

é”å¯¹è±¡ï¼šç†è®ºä¸Šå¯ä»¥æ˜¯ä»»æ„çš„â€œå”¯ä¸€â€å¯¹è±¡å³å¯ã€‚

åŸåˆ™ä¸Šï¼šé”å¯¹è±¡å»ºè®®ä½¿ç”¨å…±äº«èµ„æºã€‚

- åœ¨å®ä¾‹æ–¹æ³•ä¸­å»ºè®®ç”¨thisä½œä¸ºé”å¯¹è±¡ã€‚æ­¤æ—¶thisæ­£å¥½æ˜¯å…±äº«èµ„æºã€‚
- åœ¨é™æ€æ–¹æ³•ä¸­å»ºè®®ç”¨ç±»å.classå­—èŠ‚ç ä½œä¸ºé”å¯¹è±¡ã€‚

ä¿®æ”¹ä»£ç å¦‚ä¸‹

```Java
public void drawMoney(double money) {
    String name = Thread.currentThread().getName();
    synchronized (this) {
        if (this.money >= money) {
            System.out.println(name + "æ¥å–é’±ï¼Œä½™é¢è¶³å¤Ÿï¼Œåå‡º" + money);
            this.money -= money;
            System.out.println(name + "æ¥å–é’±åï¼Œä½™é¢å‰©ä½™" + this.money);
        } else {
            System.out.println(name + "æ¥å–é’±ï¼Œä½™é¢ä¸è¶³ï¼");
        }
    }
}
```

**åŒæ­¥æ–¹æ³•**

ä½œç”¨ï¼šæŠŠå‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜çš„æ ¸å¿ƒæ–¹æ³•ç»™é”èµ·æ¥ï¼Œæ¯æ¬¡åªèƒ½ä¸€ä¸ªçº¿ç¨‹è¿›å…¥è®¿é—®ï¼Œå…¶ä»–çº¿ç¨‹å¿…é¡»åœ¨æ–¹æ³•å¤–é¢ç­‰å¾…ã€‚

ç”¨æ³•ï¼šç›´æ¥ç»™æ–¹æ³•åŠ ä¸Šä¸€ä¸ªä¿®é¥°ç¬¦synchronizedã€‚

åŸç†ï¼šåŒæ­¥æ–¹æ³•çš„åŸç†å’ŒåŒæ­¥ä»£ç å—çš„åº•å±‚åŸç†å…¶å®æ˜¯å®Œå…¨ä¸€æ ·çš„ï¼Œåªæ˜¯åŒæ­¥æ–¹æ³•æ˜¯æŠŠæ•´ä¸ªæ–¹æ³•çš„ä»£ç éƒ½é”èµ·æ¥ã€‚

åŒæ­¥æ–¹æ³•å…¶å®åº•å±‚ä¹Ÿæ˜¯æœ‰é”å¯¹è±¡çš„

- å¦‚æœæ–¹æ³•æ˜¯å®ä¾‹æ–¹æ³•ï¼šåŒæ­¥æ–¹æ³•é»˜è®¤ç”¨thisä½œä¸ºé”å¯¹è±¡ã€‚
- å¦‚æœæ–¹æ³•æ˜¯é™æ€æ–¹æ³•ï¼šåŒæ­¥æ–¹æ³•é»˜è®¤ç”¨ç±»å.classä½œä¸ºçš„é”å¯¹è±¡ã€‚

ä¿®æ”¹ä»£ç 

```Java
public synchronized void drawMoney(double money) {
    String name = Thread.currentThread().getName();
    if (this.money >= money) {
        System.out.println(name + "æ¥å–é’±ï¼Œä½™é¢è¶³å¤Ÿï¼Œåå‡º" + money);
        this.money -= money;
        System.out.println(name + "æ¥å–é’±åï¼Œä½™é¢å‰©ä½™" + this.money);
    } else {
        System.out.println(name + "æ¥å–é’±ï¼Œä½™é¢ä¸è¶³ï¼");
    }
}
```

**lockæ˜¾ç¤ºé”**

java.util.concurrent.locks.Lockæœºåˆ¶æä¾›äº†æ¯”synchronizedä»£ç å—å’Œsynchronizedæ–¹æ³•æ›´å¹¿æ³›çš„é”å®šæ“ä½œï¼ŒåŒæ­¥ä»£ç å—/åŒæ­¥æ–¹æ³•å…·æœ‰çš„åŠŸèƒ½Lockéƒ½æœ‰ï¼Œé™¤æ­¤ä¹‹å¤–æ›´å¼ºå¤§ã€‚

Locké”ä¹Ÿç§°åŒæ­¥é”ï¼ŒåŠ é”ä¸é‡Šæ”¾é”æ–¹æ³•åŒ–äº†ï¼Œå¦‚ä¸‹ï¼š

- public void lock()ï¼šåŠ åŒæ­¥é”
- public void unlock()ï¼šé‡Šæ”¾åŒæ­¥é”

ä¿®æ”¹ä»£ç 

```Java
import java.util.concurrent.locks.Lock;
import java.util.concurrent.locks.ReentrantLock;

public class Account {
    private String cardID;
    private double money;
    private final Lock lock = new ReentrantLock();

    public Account() {
    }

    public Account(String cardID, double money) {
        this.cardID = cardID;
        this.money = money;
    }

    public String getCardID() {
        return cardID;
    }

    public void setCardID(String cardID) {
        this.cardID = cardID;
    }

    public double getMoney() {
        return money;
    }

    public void setMoney(double money) {
        this.money = money;
    }

    public void drawMoney(double money) {
        String name = Thread.currentThread().getName();
        lock.lock();
        try {
            if (this.money >= money) {
                System.out.println(name + "æ¥å–é’±ï¼Œä½™é¢è¶³å¤Ÿï¼Œåå‡º" + money);
                this.money -= money;
                System.out.println(name + "æ¥å–é’±åï¼Œä½™é¢å‰©ä½™" + this.money);
            } else {
                System.out.println(name + "æ¥å–é’±ï¼Œä½™é¢ä¸è¶³ï¼");
            }
        } catch (Exception e) {
            e.printStackTrace();
        } finally {
            lock.unlock();
        }
    }
}
```

### 14.4 çº¿ç¨‹é€šä¿¡

çº¿ç¨‹é€šä¿¡ï¼šå¤šä¸ªçº¿ç¨‹å› ä¸ºåœ¨åŒä¸€ä¸ªè¿›ç¨‹ä¸­ï¼Œæ‰€ä»¥äº’ç›¸é€šä¿¡æ˜¯æ¯”è¾ƒå®¹æ˜“çš„ã€‚

çº¿ç¨‹é€šä¿¡çš„ç»å…¸æ¨¡å‹ï¼šç”Ÿäº§è€…ä¸æ¶ˆè´¹è€…é—®é¢˜ã€‚

- ç”Ÿäº§è€…è´Ÿè´£ç”Ÿæˆå•†å“ï¼Œæ¶ˆè´¹è€…è´Ÿè´£æ¶ˆè´¹å•†å“
- ç”Ÿäº§ä¸èƒ½è¿‡å‰©ï¼Œæ¶ˆè´¹ä¸èƒ½æ²¡æœ‰

æ³¨æ„ï¼šçº¿ç¨‹é€šä¿¡ä¸€å®šæ˜¯å¤šä¸ªçº¿ç¨‹åœ¨æ“ä½œåŒä¸€ä¸ªèµ„æºæ‰éœ€è¦è¿›è¡Œé€šä¿¡ã€‚çº¿ç¨‹é€šä¿¡å¿…é¡»å…ˆä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œå¦åˆ™æ¯«æ— æ„ä¹‰ï¼Œä»£ç ä¹Ÿä¼šæŠ¥é”™ã€‚

çº¿ç¨‹é€šä¿¡çš„æ ¸å¿ƒæ–¹æ³•

- public void wait()ï¼šè®©å½“å‰çº¿ç¨‹è¿›å…¥åˆ°ç­‰å¾…çŠ¶æ€ï¼Œæ­¤æ–¹æ³•å¿…é¡»é”å¯¹è±¡è°ƒç”¨ã€‚
- public void notify()ï¼šå”¤é†’å½“å‰é”å¯¹è±¡ä¸Šç­‰å¾…çŠ¶æ€çš„æŸä¸ªçº¿ç¨‹ï¼Œæ­¤æ–¹æ³•å¿…é¡»é”å¯¹è±¡è°ƒç”¨ã€‚
- public void notifyAll()ï¼šå”¤é†’å½“å‰é”å¯¹è±¡ä¸Šç­‰å¾…çŠ¶æ€çš„å…¨éƒ¨çº¿ç¨‹ï¼Œæ­¤æ–¹æ³•å¿…é¡»é”å¯¹è±¡è°ƒç”¨ã€‚

å°ç»“ï¼šæ˜¯ä¸€ç§ç­‰å¾…å”¤é†’æœºåˆ¶ã€‚å¿…é¡»æ˜¯åœ¨åŒä¸€ä¸ªå…±äº«èµ„æºæ‰éœ€è¦é€šä¿¡ï¼Œè€Œä¸”å¿…é¡»ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚

ç»ƒä¹ ï¼šé“¶è¡Œå­˜å–é’±æ¡ˆä¾‹ã€‚

é“¶è¡Œè´¦æˆ·ç±»Account

```Java
public class Account {
    private String cardId;
    private double money;

    public Account() {
    }

    public Account(String cardId, double money) {
        this.cardId = cardId;
        this.money = money;
    }

    public String getCardId() {
        return cardId;
    }

    public void setCardId(String cardId) {
        this.cardId = cardId;
    }

    public double getMoney() {
        return money;
    }

    public void setMoney(double money) {
        this.money = money;
    }

    public synchronized void drawMoney(double money) {
        try {
            String name = Thread.currentThread().getName();
            if (this.money >= money) {
                this.money -= money;
                System.out.println(name + "æ¥å–é’±ï¼Œå–é’±ï¼š" + money + "å‰©ä½™ï¼š" + this.money);
                this.notifyAll();
                this.wait();
            } else {
                this.notifyAll();
                this.wait();
            }
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    public synchronized void saveMoney(double money) {
        try {
            String name = Thread.currentThread().getName();
            if (this.money > 0) {
                this.notifyAll();
                this.wait();
            } else {
                this.money += money;
                System.out.println(name + "æ¥å­˜é’±ï¼š" + money);
                this.notifyAll();
                this.wait();
            }
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
```

å­˜é’±çº¿ç¨‹ç±»SaveThread

```Java
public class SaveThread extends Thread {
    private Account acc;
    public SaveThread(Account acc, String name) {
        super(name);
        this.acc = acc;
    }
    @Override
    public void run() {
        while (true) {
            try {
                Thread.sleep(3000);
            } catch (Exception e) {
                e.printStackTrace();
            }
            acc.saveMoney(10000);
        }
    }
}
```

å–é’±çº¿ç¨‹ç±»DrawThread

```Java
public class DrawThread extends Thread {
    private Account acc;
    public DrawThread(Account acc, String name) {
        super(name);
        this.acc = acc;
    }
    @Override
    public void run() {
        while (true) {
            try {
                Thread.sleep(3000);
            } catch (Exception e) {
                e.printStackTrace();
            }
            acc.drawMoney(10000);
        }
    }
}
```

çº¿ç¨‹é€šä¿¡ç±»ThreadCommunication

```Java
public class ThreadCommunication {
    public static void main(String[] args) {
        Account acc = new Account("ICBC-111",0);

        new DrawThread(acc,"å°æ˜").start();
        new DrawThread(acc,"å°çº¢").start();

        new SaveThread(acc,"äº²çˆ¹").start();
        new SaveThread(acc,"å¹²çˆ¹").start();
        new SaveThread(acc,"å²³çˆ¶").start();
    }
}
```

### 14.5 çº¿ç¨‹æ± 

çº¿ç¨‹æ± ï¼šå…¶å®å°±æ˜¯ä¸€ä¸ªå®¹çº³å¤šä¸ªçº¿ç¨‹çš„å®¹å™¨ï¼Œå…¶ä¸­çš„çº¿ç¨‹å¯ä»¥åå¤åœ°ä½¿ç”¨ï¼Œçœå»äº†é¢‘ç¹åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹å¯¹è±¡çš„æ“ä½œï¼Œæ— éœ€åå¤åˆ›å»ºçº¿ç¨‹è€Œæ¶ˆè€—è¿‡å¤šèµ„æºã€‚

åˆç†åˆ©ç”¨çº¿ç¨‹æ± èƒ½å¤Ÿå¸¦æ¥ä¸‰ä¸ªå¥½å¤„

1. é™ä½èµ„æºæ¶ˆè€—ã€‚
   - å‡å°‘äº†åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹çš„æ¬¡æ•°ï¼Œæ¯ä¸ªå·¥ä½œçº¿ç¨‹éƒ½å¯ä»¥è¢«é‡å¤åˆ©ç”¨ï¼Œå¯æ‰§è¡Œå¤šä¸ªä»»åŠ¡ã€‚
2. æé«˜å“åº”é€Ÿåº¦ã€‚
   - ä¸éœ€è¦é¢‘ç¹åœ°åˆ›å»ºçº¿ç¨‹ï¼Œå¦‚æœæœ‰çº¿ç¨‹å¯ä»¥ç›´æ¥ç”¨ï¼Œä¸ä¼šå‡ºç°ç³»ç»Ÿåƒµæ­»ã€‚
3. æé«˜çº¿ç¨‹çš„å¯ç®¡ç†æ€§(çº¿ç¨‹æ± å¯ä»¥çº¦æŸç³»ç»Ÿæœ€å¤šåªèƒ½æœ‰å¤šå°‘ä¸ªçº¿ç¨‹ï¼Œä¸ä¼šå› ä¸ºçº¿ç¨‹è¿‡å¤šè€Œæ­»æœº)

çº¿ç¨‹æ± çš„æ ¸å¿ƒæ€æƒ³ï¼šçº¿ç¨‹å¤ç”¨ï¼ŒåŒä¸€ä¸ªçº¿ç¨‹å¯ä»¥è¢«é‡å¤ä½¿ç”¨ï¼Œæ¥å¤„ç†å¤šä¸ªä»»åŠ¡ã€‚

çº¿ç¨‹æ± åœ¨Javaä¸­çš„ä»£è¡¨ç±»ï¼šExecutorService(æ¥å£)ã€‚

Javaåœ¨Executorsç±»ä¸‹æä¾›äº†ä¸€ä¸ªé™æ€æ–¹æ³•å¾—åˆ°ä¸€ä¸ªçº¿ç¨‹æ± çš„å¯¹è±¡

- public static ExecutorService newFixedThreadPool(int nThreads)ï¼šåˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± è¿”å›ã€‚

ExecutorServiceæäº¤çº¿ç¨‹ä»»åŠ¡å¯¹è±¡æ‰§è¡Œçš„æ–¹æ³•

- Future<?> submit(Runnable task)ï¼šæäº¤ä¸€ä¸ªRunnableçš„ä»»åŠ¡å¯¹è±¡ç»™çº¿ç¨‹æ± æ‰§è¡Œã€‚
- Future<?> submit(Callable task)ï¼šæäº¤ä¸€ä¸ªCallableçš„ä»»åŠ¡å¯¹è±¡ç»™çº¿ç¨‹æ± æ‰§è¡Œã€‚

å°ç»“

- pools.shutdown()ï¼šç­‰å¾…ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ä»¥åæ‰ä¼šå…³é—­çº¿ç¨‹æ± ã€‚
- pools.shutdownNow()ï¼šç«‹å³å…³é—­çº¿ç¨‹æ± çš„ä»£ç ï¼Œæ— è®ºä»»åŠ¡æ˜¯å¦æ‰§è¡Œå®Œæ¯•ã€‚
- çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å¯ä»¥è¢«å¤ç”¨ï¼Œçº¿ç¨‹ç”¨å®Œä»¥åå¯ä»¥ç»§ç»­å»æ‰§è¡Œå…¶ä»–ä»»åŠ¡ã€‚
- Callableåšçº¿ç¨‹æ± çš„ä»»åŠ¡å¯ä»¥å¾—åˆ°çº¿ç¨‹æ‰§è¡Œçš„ç»“æœã€‚

```Java
public class ThreadPoolsDemo01 {
    public static void main(String[] args) {
        ExecutorService pools = Executors.newFixedThreadPool(3);
        Future<String> t1 = pools.submit(new MyCallable(100));
        Future<String> t2 = pools.submit(new MyCallable(200));
        Future<String> t3 = pools.submit(new MyCallable(300));
        Future<String> t4 = pools.submit(new MyCallable(400));

        try {
            String rs1 = t1.get();
            String rs2 = t2.get();
            String rs3 = t3.get();
            String rs4 = t4.get();
            System.out.println(rs1);
            System.out.println(rs2);
            System.out.println(rs3);
            System.out.println(rs4);
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}

class MyCallable implements Callable<String> {
    private int n;
    public MyCallable(int n) {
        this.n = n;
    }
    @Override
    public String call() throws Exception {
        int sum = 0;
        for (int i = 1; i <= n; i++) {
            sum += i;
        }
        return Thread.currentThread().getName() + "æ‰§è¡Œçš„ç»“æœæ˜¯ï¼š" + sum;
    }
}
```

### 14.6 æ­»é”

æ­»é”æ˜¯è¿™æ ·ä¸€ç§æƒ…å½¢ï¼šå¤šä¸ªçº¿ç¨‹åŒæ—¶è¢«é˜»å¡ï¼Œå®ƒä»¬ä¸­çš„ä¸€ä¸ªæˆ–è€…å…¨éƒ¨éƒ½åœ¨ç­‰å¾…æŸä¸ªèµ„æºè¢«é‡Šæ”¾ã€‚ç”±äºçº¿ç¨‹è¢«æ— é™æœŸåœ°é˜»å¡ï¼Œå› æ­¤ç¨‹åºä¸å¯èƒ½æ­£å¸¸ç»ˆæ­¢ã€‚

Javaæ­»é”äº§ç”Ÿçš„å››ä¸ªå¿…è¦æ¡ä»¶

- äº’æ–¥ä½¿ç”¨ï¼šå³å½“èµ„æºè¢«ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨(å ç”¨)æ—¶ï¼Œåˆ«çš„çº¿ç¨‹ä¸èƒ½ä½¿ç”¨ã€‚
- ä¸å¯æŠ¢å ï¼šèµ„æºè¯·æ±‚è€…ä¸èƒ½å¼ºåˆ¶ä»èµ„æºå æœ‰è€…æ‰‹ä¸­å¤ºå–èµ„æºï¼Œèµ„æºåªèƒ½ç”±èµ„æºå æœ‰è€…ä¸»åŠ¨é‡Šæ”¾ã€‚
- è¯·æ±‚å’Œä¿æŒï¼šå³å½“èµ„æºè¯·æ±‚è€…åœ¨è¯·æ±‚å…¶ä»–çš„èµ„æºçš„åŒæ—¶ä¿æŒå¯¹åŸæœ‰èµ„æºçš„å æœ‰ã€‚
- å¾ªç¯ç­‰å¾…ï¼šå³å­˜åœ¨ä¸€ä¸ªç­‰å¾…å¾ªç¯é˜Ÿåˆ—ï¼Œp1è¦p2çš„èµ„æºï¼Œp2è¦p1çš„èµ„æºã€‚è¿™æ ·å°±å½¢æˆäº†ä¸€ä¸ªç­‰å¾…ç¯è·¯ã€‚

å½“ä¸Šè¿°å››ä¸ªæ¡ä»¶éƒ½æˆç«‹çš„æ—¶å€™ï¼Œä¾¿å½¢æˆæ­»é”ã€‚å½“ç„¶ï¼Œæ­»é”çš„æƒ…å†µä¸‹å¦‚æœæ‰“ç ´ä¸Šè¿°ä»»ä½•ä¸€ä¸ªæ¡ä»¶ï¼Œä¾¿å¯è®©æ­»é”æ¶ˆå¤±ã€‚

å®ç°æ­»é”æ¡ˆä¾‹ä»£ç 

```Java
public class ThreadDead {
    public static Object resources01 = new Object();
    public static Object resources02 = new Object();

    public static void main(String[] args) {
        new Thread(new Runnable() {
            @Override
            public void run() {
                synchronized (resources01) {
                    System.out.println("çº¿ç¨‹1å ç”¨èµ„æº1è¯·æ±‚èµ„æº2");
                    try {
                        Thread.sleep(1000);
                    } catch (Exception e) {
                        e.printStackTrace();
                    }
                    synchronized (resources02) {
                        System.out.println("çº¿ç¨‹1æˆåŠŸå ç”¨èµ„æº2");
                    }
                }
            }
        }).start();

        new Thread(new Runnable() {
            @Override
            public void run() {
                synchronized (resources02) {
                    System.out.println("çº¿ç¨‹2å ç”¨èµ„æº2è¯·æ±‚èµ„æº1");
                    try {
                        Thread.sleep(1000);
                    } catch (Exception e) {
                        e.printStackTrace();
                    }
                    synchronized (resources01) {
                        System.out.println("çº¿ç¨‹2æˆåŠŸå ç”¨èµ„æº1");
                    }
                }
            }
        }).start();
    }
}
```

## 15. Volatileå…³é”®å­—

### 15.1 å˜é‡ä¸å¯è§æ€§

å¤šä¸ªçº¿ç¨‹è®¿é—®å…±äº«å˜é‡ï¼Œä¼šå‡ºç°ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹å˜é‡çš„å€¼åï¼Œå…¶ä»–çº¿ç¨‹çœ‹ä¸åˆ°æœ€æ–°å€¼çš„æƒ…å†µã€‚

å¹¶å‘å˜é‡ä¸‹å˜é‡ä¸å¯è§æ€§æ¡ˆä¾‹

```Java
public class VolatileDemo extends Thread {
    private boolean flag = false;

    @Override
    public void run() {
        try {
            Thread.sleep(1000);
        } catch (Exception e) {
            e.printStackTrace();
        }
        flag = true;
        System.out.println("flag = " + flag);
    }

    public boolean isFlag() {
        return flag;
    }

    public void setFlag(boolean flag) {
        this.flag = flag;
    }
}

class VisibilityDemo {
    public static void main(String[] args) {
        VolatileDemo t = new VolatileDemo();
        t.start();

        while (true) {
            if (t.isFlag()) {
                System.out.println("ä¸»çº¿ç¨‹è¿›å…¥æ‰§è¡Œ~~~~");
            }
        }
    }
}
```

ä¸å¯è§æ€§çš„åŸå› ï¼šæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼Œçº¿ç¨‹éƒ½æ˜¯ä»ä¸»å†…å­˜æ‹·è´å…±äº«å˜é‡çš„å‰¯æœ¬å€¼ã€‚æ¯ä¸ªçº¿ç¨‹æ˜¯åœ¨è‡ªå·±çš„å·¥ä½œå†…å­˜ä¸­æ“ä½œå…±äº«å˜é‡çš„ã€‚

è§£å†³æ–¹æ¡ˆæœ‰ä¸¤ç§å¸¸è§æ–¹å¼

1. åŠ é”
   - æ¯æ¬¡åŠ é”ä¼šæ¸…ç©ºçº¿ç¨‹è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼Œé‡æ–°è¯»å–ä¸»å†…å­˜æœ€æ–°å€¼ã€‚
2. å¯¹å…±äº«çš„å˜é‡è¿›è¡Œvolatileå…³é”®å­—ä¿®é¥°
   - volatileä¿®é¥°çš„å˜é‡å¯ä»¥åœ¨å¤šçº¿ç¨‹å¹¶å‘ä¿®æ”¹ä¸‹ï¼Œå®ç°çº¿ç¨‹é—´å˜é‡çš„å¯è§æ€§ã€‚
   - ä¸€æ—¦ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†volatileä¿®é¥°çš„å˜é‡ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å¯ä»¥ç«‹å³å–åˆ°æœ€æ–°å€¼ã€‚

åŠ é”æ–¹å¼

ä¿®æ”¹åçš„ä»£ç 

```Java
while (true) {
    synchronized (VisibilityDemo01.class) {
        if (t.isFlag()) {
            System.out.println("ä¸»çº¿ç¨‹è¿›å…¥æ‰§è¡Œ~~~~");
        }
    }
}
```

æŸä¸€ä¸ªçº¿ç¨‹è¿›å…¥synchronizedä»£ç å—å‰åï¼Œæ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹

- çº¿ç¨‹è·å¾—é”
- æ¸…ç©ºå·¥ä½œå†…å­˜
- ä»ä¸»å†…å­˜æ‹·è´å…±äº«å˜é‡æœ€æ–°çš„å€¼åˆ°å·¥ä½œå†…å­˜æˆä¸ºå‰¯æœ¬
- æ‰§è¡Œä»£ç 
- å°†ä¿®æ”¹åçš„å‰¯æœ¬çš„å€¼åˆ·æ–°å›ä¸»å†…å­˜ä¸­
- çº¿ç¨‹é‡Šæ”¾é”

volatileå…³é”®å­—ä¿®é¥°

ä¿®æ”¹ä»£ç 

```Java
private volatile boolean flag = false;
```

å·¥ä½œæµç¨‹

- å­çº¿ç¨‹ä»ä¸»å†…å­˜è¯»å–åˆ°æ•°æ®æ”¾å…¥å…¶å¯¹åº”çš„å·¥ä½œå†…å­˜
- å°†flagçš„å€¼æ›´æ”¹ä¸ºtrueï¼Œä½†æ˜¯è¿™ä¸ªæ—¶å€™flagçš„å€¼è¿˜æ²¡æœ‰å†™å›ä¸»å†…å­˜
- æ­¤æ—¶mainæ–¹æ³•è¯»å–åˆ°äº†flagçš„å€¼ä¸ºfalse
- å½“å­çº¿ç¨‹å°†flagçš„å€¼å†™å›å»åï¼Œå¤±æ•ˆå…¶ä»–çº¿ç¨‹å¯¹æ­¤å˜é‡çš„å‰¯æœ¬
- å†æ¬¡å¯¹flagè¿›è¡Œæ“ä½œçš„æ—¶å€™çº¿ç¨‹ä¼šä»ä¸»å†…å­˜è¯»å–æœ€æ–°çš„å€¼ï¼Œæ”¾å…¥åˆ°å·¥ä½œå†…å­˜ä¸­

**volatileä¸synchronized**

- volatileåªèƒ½ä¿®é¥°å®ä¾‹å˜é‡å’Œç±»å˜é‡ï¼Œè€Œsynchronizedå¯ä»¥ä¿®é¥°æ–¹æ³•ï¼Œä»¥åŠä»£ç å—ã€‚
- volatileä¿è¯æ•°æ®çš„å¯è§æ€§ï¼Œä½†æ˜¯ä¸ä¿è¯åŸå­æ€§(å¤šçº¿ç¨‹è¿›è¡Œå†™æ“ä½œï¼Œä¸ä¿è¯çº¿ç¨‹å®‰å…¨)ï¼›è€Œsynchronizedæ˜¯ä¸€ç§æ’ä»–(äº’æ–¥)çš„æœºåˆ¶ã€‚

### 15.2 åŸå­æ€§

æ¦‚è¿°ï¼šæ‰€è°“çš„åŸå­æ€§æ˜¯æŒ‡åœ¨ä¸€æ¬¡æ“ä½œæˆ–è€…å¤šæ¬¡æ“ä½œä¸­ï¼Œè¦ä¹ˆæ‰€æœ‰çš„æ“ä½œå…¨éƒ¨éƒ½å¾—åˆ°äº†æ‰§è¡Œå¹¶ä¸”ä¸ä¼šå—åˆ°ä»»ä½•å› ç´ çš„å¹²æ‰°è€Œä¸­æ–­ï¼Œè¦ä¹ˆæ‰€æœ‰çš„æ“ä½œéƒ½ä¸æ‰§è¡Œã€‚

volatileåªèƒ½ä¿è¯çº¿ç¨‹é—´å˜é‡çš„å¯è§æ€§ï¼Œä½†æ˜¯ä¸èƒ½ä¿è¯å˜é‡æ“ä½œçš„åŸå­æ€§ã€‚

åŠ é”ä¿è¯åŸå­æ€§ä»£ç 

```Java
public class VolatileAtomicDemo {
    public static void main(String[] args) {
        Runnable target = new MyRunnable();
        for (int i = 1; i <= 100; i++) {
            new Thread(target).start();
        }
    }
}

class MyRunnable implements Runnable {
    private int count;

    @Override
    public void run() {
        synchronized ("DiLei") {
            for (int i = 1; i <= 100; i++) {
                count++;
                System.out.println("count=====>>>" + count);
            }
        }
    }
}
```

åŠ é”æœºåˆ¶æ€§èƒ½è¾ƒå·®ã€‚

**åŸå­ç±»**

æ¦‚è¿°ï¼šJavaä»JDK1.5å¼€å§‹æä¾›äº†java.util.concurrent.atomicåŒ…(ç®€ç§°AtomicåŒ…)ï¼Œè¿™ä¸ªåŒ…ä¸­çš„åŸå­æ“ä½œç±»æä¾›äº†ä¸€ç§ç”¨æ³•ç®€å•ï¼Œæ€§èƒ½é«˜æ•ˆï¼Œçº¿ç¨‹å®‰å…¨çš„æ›´æ–°ä¸€ä¸ªå˜é‡çš„æ–¹å¼ã€‚

ä½¿ç”¨åŸå­ç±»å®ç°åŸå­æ€§æ“ä½œ

```Java
import java.util.concurrent.atomic.AtomicInteger;

public class VolatileAtomicDemo {
    public static void main(String[] args) {
        Runnable target = new MyRunnable();
        for (int i = 1; i <= 100; i++) {
            new Thread(target).start();
        }
    }
}

class MyRunnable implements Runnable {
    private AtomicInteger atomicInteger = new AtomicInteger();

    @Override
    public void run() {
        for (int i = 1; i <= 100; i++) {
            System.out.println("count=====>>>" + atomicInteger.incrementAndGet());
        }
    }
}
```

**åŸå­ç±»CASæœºåˆ¶**

CASçš„å…¨ç§°æ˜¯ï¼šCompare And Swap(æ¯”è¾ƒå†äº¤æ¢)ï¼›æ˜¯ç°ä»£CPUå¹¿æ³›æ”¯æŒçš„ä¸€ç§å¯¹å†…å­˜ä¸­çš„å…±äº«æ•°æ®è¿›è¡Œæ“ä½œçš„ä¸€ç§ç‰¹æ®ŠæŒ‡ä»¤ã€‚CASå¯ä»¥å°†read-modify-check-writeè½¬æ¢ä¸ºåŸå­æ“ä½œï¼Œè¿™ä¸ªåŸå­æ“ä½œç›´æ¥ç”±å¤„ç†å™¨ä¿è¯ã€‚

CASæœºåˆ¶å½“ä¸­ä½¿ç”¨äº†3ä¸ªåŸºæœ¬æ“ä½œæ•°ï¼šå†…å­˜åœ°å€Vï¼Œæ—§çš„é¢„æœŸå€¼Aï¼Œè¦ä¿®æ”¹çš„æ–°å€¼Bã€‚

**CASä¸Synchronizedï¼šä¹è§‚é”ï¼Œæ‚²è§‚é”**

CASå’ŒSynchronizedéƒ½å¯ä»¥ä¿è¯å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å…±äº«æ•°æ®çš„å®‰å…¨æ€§ã€‚é‚£ä¹ˆä»–ä»¬ä¸¤è€…æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

Synchronizedæ˜¯ä»æ‚²è§‚çš„è§’åº¦å‡ºå‘

æ€»æ˜¯å‡è®¾æœ€åçš„æƒ…å†µï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Šé”ï¼Œè¿™æ ·åˆ«äººæƒ³æ‹¿è¿™ä¸ªæ•°æ®å°±ä¼šé˜»å¡ç›´åˆ°å®ƒæ‹¿åˆ°é”ã€‚

å…±äº«èµ„æºæ¯æ¬¡åªç»™ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ï¼Œå…¶ä»–çº¿ç¨‹é˜»å¡ï¼Œç”¨å®Œåå†æŠŠèµ„æºè½¬è®©ç»™å…¶å®ƒçº¿ç¨‹ã€‚å› æ­¤Synchronizedæˆ‘ä»¬ä¹Ÿå°†å…¶ç§°ä¹‹ä¸ºæ‚²è§‚é”ã€‚JDKä¸­çš„ReentrantLockä¹Ÿæ˜¯ä¸€ç§æ‚²è§‚é”ï¼Œæ€§èƒ½è¾ƒå·®ã€‚

CASæ˜¯ä»ä¹è§‚çš„è§’åº¦å‡ºå‘

æ€»æ˜¯å‡è®¾æœ€å¥½çš„æƒ…å†µï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¸ä¼šä¿®æ”¹ï¼Œæ‰€ä»¥ä¸ä¼šä¸Šé”ï¼Œä½†æ˜¯åœ¨æ›´æ–°çš„æ—¶å€™ä¼šåˆ¤æ–­ä¸€ä¸‹åœ¨æ­¤æœŸé—´åˆ«äººæœ‰æ²¡æœ‰å»æ›´æ–°è¿™ä¸ªæ•°æ®ã€‚

CASè¿™ç§æœºåˆ¶æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†å…¶ç§°ä¹‹ä¸ºä¹è§‚é”ï¼Œç»¼åˆæ€§èƒ½è¾ƒå¥½ã€‚

## 16. å¹¶å‘åŒ…

å¹¶å‘åŒ…çš„æ¥å†ï¼šåœ¨å®é™…å¼€å‘ä¸­å¦‚æœä¸éœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå¤§å®¶ä¸éœ€è¦åšçº¿ç¨‹å®‰å…¨ï¼Œå› ä¸ºå¦‚æœåšäº†åè€Œæ€§èƒ½ä¸å¥½ã€‚ä½†æ˜¯å¼€å‘ä¸­æœ‰å¾ˆå¤šä¸šåŠ¡æ˜¯éœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨é—®é¢˜çš„ï¼Œæ­¤æ—¶å°±å¿…é¡»è€ƒè™‘äº†ã€‚å¦åˆ™ä¸šåŠ¡å‡ºç°é—®é¢˜ã€‚Javaä¸ºå¾ˆå¤šä¸šåŠ¡åœºæ™¯æä¾›äº†æ€§èƒ½ä¼˜å¼‚ï¼Œä¸”çº¿ç¨‹å®‰å…¨çš„å¹¶å‘åŒ…ï¼Œç¨‹åºå‘˜å¯ä»¥é€‰æ‹©ä½¿ç”¨ã€‚

### 16.1 ConcurrentHashMap

Mapé›†åˆä¸­çš„ç»å…¸é›†åˆï¼šHashMapå®ƒæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œæ€§èƒ½å¥½ã€‚

- å¦‚æœåœ¨è¦æ±‚çº¿ç¨‹å®‰å…¨çš„ä¸šåŠ¡æƒ…å†µä¸‹å°±ä¸èƒ½ç”¨è¿™ä¸ªé›†åˆåšMapé›†åˆï¼Œå¦åˆ™ä¸šåŠ¡ä¼šå´©æºƒ

ä¸ºäº†ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œå¯ä»¥ä½¿ç”¨Hashtableã€‚æ³¨æ„ï¼šçº¿ç¨‹ä¸­åŠ å…¥äº†è®¡æ—¶ã€‚

- Hashtableæ˜¯çº¿ç¨‹å®‰å…¨çš„Mapé›†åˆï¼Œä½†æ˜¯æ€§èƒ½è¾ƒå·®ã€‚(å·²ç»è¢«æ·˜æ±°ï¼Œè™½ç„¶å®‰å…¨ï¼Œä½†æ˜¯æ€§èƒ½å·®)

ä¸ºäº†ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œå†çœ‹ConcurrentHashMap(ä¸åªçº¿ç¨‹å®‰å…¨ï¼Œè€Œä¸”æ•ˆç‡é«˜ï¼Œæ€§èƒ½å¥½ï¼Œæœ€æ–°æœ€å¥½ç”¨çš„çº¿ç¨‹å®‰å…¨çš„ç±»)ã€‚

- ConcurrentHashMapä¿è¯äº†çº¿ç¨‹å®‰å…¨ï¼Œç»¼åˆæ€§èƒ½è¾ƒå¥½

HashMapã€Hashtableä¸ConcurrentHashMapçš„æ¡ˆä¾‹

```Java
import java.util.HashMap;
import java.util.Hashtable;
import java.util.Map;
import java.util.concurrent.ConcurrentHashMap;

public class ConcurrentHashMapDemo {
    public static Map<String,String> maps = new ConcurrentHashMap<>();

    public static void main(String[] args) {
        Runnable target = new MyRunnable();
        Thread t1 = new Thread(target,"çº¿ç¨‹1");
        Thread t2 = new Thread(target,"çº¿ç¨‹2");
        t1.start();
        t2.start();

        try {
            t1.join();  // è®©t1è·‘å®Œï¼Œè®©å½“å‰ä¸»çº¿ç¨‹ä¸èƒ½ç«äº‰t1çš„CPUã€‚
            t2.join();  // è®©t2è·‘å®Œï¼Œè®©å½“å‰ä¸»çº¿ç¨‹ä¸èƒ½ç«äº‰t2çš„CPUã€‚
        } catch (Exception e) {
            e.printStackTrace();
        }

        System.out.println("å…ƒç´ ä¸ªæ•°ï¼š" + maps.size());
    }
}

class MyRunnable implements Runnable {
    @Override
    public void run() {
        long start = System.currentTimeMillis();
        for (int i = 1; i <= 500000; i++) {
            ConcurrentHashMapDemo.maps.put(Thread.currentThread().getName() + i, Thread.currentThread().getName() + i);
        }
        long end = System.currentTimeMillis();
        System.out.println(Thread.currentThread().getName() + "è€—æ—¶ï¼š" + (end - start) / 1000.0 + "s");
    }
}
```

### 16.2 CountDownLatch

CountDownLatchå…è®¸ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ç­‰å¾…å…¶ä»–çº¿ç¨‹å®Œæˆæ“ä½œï¼Œå†æ‰§è¡Œè‡ªå·±ã€‚

ä¾‹å¦‚ï¼šçº¿ç¨‹1è¦æ‰§è¡Œæ‰“å°ï¼šAå’ŒCï¼Œçº¿ç¨‹2è¦æ‰§è¡Œæ‰“å°ï¼šBï¼Œä½†çº¿ç¨‹1åœ¨æ‰“å°Aåï¼Œè¦çº¿ç¨‹2æ‰“å°Bä¹‹åæ‰èƒ½æ‰“å°Cï¼Œæ‰€ä»¥ï¼šçº¿ç¨‹1åœ¨æ‰“å°Aåï¼Œå¿…é¡»ç­‰å¾…çº¿ç¨‹2æ‰“å°å®ŒBä¹‹åæ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚

æ„é€ å™¨

- public CountDownLatch(int count) ï¼šåˆå§‹åŒ–å”¤é†’éœ€è¦çš„downå‡ æ­¥ã€‚

æ–¹æ³•

- public void await() throws InterruptedExceptionï¼šè®©å½“å‰çº¿ç¨‹ç­‰å¾…ï¼Œå¿…é¡»down
- public void countDown()ï¼šè®¡æ•°å™¨è¿›è¡Œå‡1 ï¼ˆdown 1ï¼‰

æ‰“å°æœºæ¡ˆä¾‹

```Java
import java.util.concurrent.CountDownLatch;

public class CountDownLatchDemo {
    public static void main(String[] args) {
        CountDownLatch c = new CountDownLatch(1);
        new ThreadA(c).start();
        new ThreadB(c).start();
    }
}

class ThreadA extends Thread {
    private CountDownLatch c;
    public ThreadA(CountDownLatch c) {
        this.c = c;
    }

    @Override
    public void run() {
        System.out.println("A");
        try {
            c.await();
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
        System.out.println("C");
    }
}

class ThreadB extends Thread {
    private CountDownLatch c;
    public ThreadB(CountDownLatch c) {
        this.c = c;
    }

    @Override
    public void run() {
        System.out.println("B");
        c.countDown(); // è®©ç›‘ç£è€…ä¸­çš„è®¡æ•°å™¨å‡1ï¼Œè¢«ç­‰å¾…çš„çº¿ç¨‹å°±å”¤é†’äº†
    }
}
```

### 16.3 CyclicBarrier

CyclicBarrierä½œç”¨ï¼šæŸä¸ªçº¿ç¨‹ä»»åŠ¡å¿…é¡»ç­‰å¾…å…¶ä»–çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ä»¥åæ‰èƒ½æœ€ç»ˆè§¦å‘è‡ªå·±æ‰§è¡Œã€‚

æ„é€ å™¨

- public CyclicBarrier(int parties, Runnable barrierAction)ï¼šç”¨äºåœ¨çº¿ç¨‹åˆ°è¾¾å±éšœ5æ—¶ï¼Œä¼˜å…ˆæ‰§è¡ŒbarrierActionï¼Œæ–¹ä¾¿å¤„ç†æ›´å¤æ‚çš„ä¸šåŠ¡åœºæ™¯

æ–¹æ³•

- public int await()ï¼šæ¯ä¸ªçº¿ç¨‹è°ƒç”¨awaitæ–¹æ³•å‘Šè¯‰CyclicBarrieræˆ‘å·²ç»åˆ°è¾¾äº†å±éšœï¼Œç„¶åå½“å‰çº¿ç¨‹è¢«é˜»å¡

å¯ä»¥å®ç°å¤šçº¿ç¨‹ä¸­ï¼ŒæŸä¸ªä»»åŠ¡åœ¨ç­‰å¾…å…¶ä»–çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ä»¥åè§¦å‘ã€‚å¾ªç¯å±éšœå¯ä»¥å®ç°è¾¾åˆ°ä¸€ç»„å±éšœå°±è§¦å‘ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œã€‚

å‘˜å·¥è¿›å…¥ä¼šè®®å®¤å¼€ä¼šæ¡ˆä¾‹

```Java
import java.util.concurrent.CyclicBarrier;

public class CyclicBarrierDemo {
    public static void main(String[] args) {
        CyclicBarrier c = new CyclicBarrier(5, new Meeting());
        for (int i = 1; i <= 5; i++) {
            new EmployeeThread("å‘˜å·¥" + i,c).start();
        }
    }
}

class Meeting implements Runnable {
    @Override
    public void run() {
        System.out.println(Thread.currentThread().getName() + "å¼€å§‹ç»„ç»‡ä¼šè®®ï¼");
    }
}

class EmployeeThread extends Thread {
    private CyclicBarrier c;
    public EmployeeThread(String name,CyclicBarrier c) {
        super(name);
        this.c = c;
    }

    @Override
    public void run() {
        try {
            Thread.sleep(3000);
            System.out.println(Thread.currentThread().getName() + "æ­£åœ¨è¿›å…¥ä¼šè®®å®¤");
            c.await();
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
```

### 16.4 Semaphore

Semaphore(å‘ä¿¡å·)çš„ä¸»è¦ä½œç”¨æ˜¯æ§åˆ¶çº¿ç¨‹çš„å¹¶å‘æ•°é‡ã€‚

synchronizedå¯ä»¥èµ·åˆ°â€œé”â€çš„ä½œç”¨ï¼Œä½†æŸä¸ªæ—¶é—´æ®µå†…ï¼Œåªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹å…è®¸æ‰§è¡Œã€‚

Semaphoreå¯ä»¥è®¾ç½®åŒæ—¶å…è®¸å‡ ä¸ªçº¿ç¨‹æ‰§è¡Œã€‚

Semaphoreå­—é¢æ„æ€æ˜¯ä¿¡å·é‡çš„æ„æ€ï¼Œå®ƒçš„ä½œç”¨æ˜¯æ§åˆ¶è®¿é—®ç‰¹å®šèµ„æºçš„çº¿ç¨‹æ•°ç›®

Semaphoreæ„é€ æ–¹æ³•

- public Semaphore(int permits)ï¼špermitsè¡¨ç¤ºè®¸å¯çº¿ç¨‹çš„æ•°é‡
- public Semaphore(int permits, boolean fair)ï¼šfairè¡¨ç¤ºå…¬å¹³æ€§ï¼Œå¦‚æœè¿™ä¸ªè®¾ä¸ºtrueçš„è¯ï¼Œä¸‹æ¬¡æ‰§è¡Œçš„çº¿ç¨‹ä¼šæ˜¯ç­‰å¾…æœ€ä¹…çš„çº¿ç¨‹

Semaphoreé‡è¦æ–¹æ³•

- public void acquire() throws InterruptExceptionï¼šè¡¨ç¤ºè·å–è®¸å¯
- public void release()ï¼šrelease()è¡¨ç¤ºé‡Šæ”¾è®¸å¯

Semaphoreå¯ä»¥æ§åˆ¶çº¿ç¨‹å¹¶å‘å é”çš„æ•°é‡ã€‚

ç»ƒä¹ æ¡ˆä¾‹

```Java
import java.util.concurrent.Semaphore;

public class SemaphoreDemo {
    public static void main(String[] args) {
        Service service = new Service();
        for (int i = 1; i <= 5; i++) {
            MyThread a = new MyThread(service);
            a.start();
        }
    }
}

class MyThread extends Thread {
    private Service service;
    public MyThread(Service service) {
        this.service = service;
    }

    @Override
    public void run() {
        service.login();
    }
}

class Service {
    private Semaphore semaphore = new Semaphore(1);

    public void login() {
        try {
            semaphore.acquire();
            System.out.println(Thread.currentThread().getName() + "è¿›å…¥ æ—¶é—´=" + System.currentTimeMillis());
            try {
                Thread.sleep(1000);
                System.out.println(Thread.currentThread().getName() + "ç™»å½•æˆåŠŸï¼");
            } catch (Exception e) {
                e.printStackTrace();
            }
            System.out.println(Thread.currentThread().getName() + "ç¦»å¼€ æ—¶é—´=" + System.currentTimeMillis());
            semaphore.release();
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
```

### 16.5 Exchanger

ä½œç”¨ï¼šExchanger(äº¤æ¢è€…)æ˜¯ä¸€ä¸ªç”¨äºçº¿ç¨‹é—´åä½œçš„å·¥å…·ç±»ã€‚Exchangerç”¨äºè¿›è¡Œçº¿ç¨‹é—´çš„æ•°æ®äº¤æ¢ã€‚è¿™ä¸¤ä¸ªçº¿ç¨‹é€šè¿‡exchangeæ–¹æ³•äº¤æ¢æ•°æ®ï¼Œå¦‚æœç¬¬ä¸€ä¸ªçº¿ç¨‹å…ˆæ‰§è¡Œexchange()æ–¹æ³•ï¼Œå®ƒä¼šä¸€ç›´ç­‰å¾…ç¬¬äºŒä¸ªçº¿ç¨‹ä¹Ÿæ‰§è¡Œexchangeæ–¹æ³•ã€‚å½“ä¸¤ä¸ªçº¿ç¨‹éƒ½è¾¾åˆ°åŒæ­¥ç‚¹æ—¶ï¼Œè¿™ä¸¤ä¸ªçº¿ç¨‹å°±å¯ä»¥äº¤æ¢æ•°æ®ï¼Œå°†æœ¬çº¿ç¨‹ç”Ÿäº§å‡ºæ¥çš„æ•°æ®ä¼ é€’ç»™å¯¹æ–¹ã€‚

Exchangeræ„é€ æ–¹æ³•

- public Exchanger()

Exchangeré‡è¦æ–¹æ³•

- public V exchange(V x)

åˆ†æ

- éœ€è¦2ä¸ªçº¿ç¨‹
- éœ€è¦ä¸€ä¸ªäº¤æ¢å¯¹è±¡è´Ÿè´£äº¤æ¢ä¸¤ä¸ªçº¿ç¨‹æ‰§è¡Œçš„ç»“æœ

å°ç»“ï¼šExchangerå¯ä»¥å®ç°çº¿ç¨‹é—´çš„æ•°æ®äº¤æ¢ã€‚ä¸€ä¸ªçº¿ç¨‹å¦‚æœç­‰ä¸åˆ°å¯¹æ–¹çš„æ•°æ®äº¤æ¢å°±ä¼šä¸€ç›´ç­‰å¾…ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥æ§åˆ¶ä¸€ä¸ªçº¿ç¨‹ç­‰å¾…çš„æ—¶é—´ï¼Œå¿…é¡»åŒæ–¹éƒ½è¿›è¡Œäº¤æ¢æ‰å¯ä»¥æ­£å¸¸è¿›è¡Œæ•°æ®çš„äº¤æ¢ã€‚

ç»ƒä¹ æ¡ˆä¾‹å¦‚ä¸‹

```Java
import java.util.concurrent.Exchanger;
import java.util.concurrent.TimeUnit;

public class ExchangerDemo {
    public static void main(String[] args) {
        Exchanger<String> exchanger = new Exchanger();
        new Boy(exchanger).start();
        new Girl(exchanger).start();
    }
}

class Boy extends Thread {
    private Exchanger<String> exchanger;
    public Boy(Exchanger<String> exchanger) {
        this.exchanger = exchanger;
    }

    @Override
    public void run() {
        System.out.println("ç”·å­©å¼€å§‹åšå¥½è‡ªå·±çš„å®šæƒ…ä¿¡ç‰©ï¼šåŒå¿ƒğŸ”’ï¼");
        try {
            String rs = exchanger.exchange("åŒå¿ƒğŸ”’",5, TimeUnit.SECONDS);
            System.out.println("ç”·å­©æ”¶åˆ°ç¤¼ç‰©ï¼š" + rs);
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}

class Girl extends Thread {
    private Exchanger<String> exchanger;
    public Girl(Exchanger<String> exchanger) {
        this.exchanger = exchanger;
    }

    @Override
    public void run() {
        System.out.println("å¥³å­©å¼€å§‹åšå¥½è‡ªå·±çš„å®šæƒ…ä¿¡ç‰©ï¼šé’¥åŒ™ğŸ”‘ï¼");
        try {
            Thread.sleep(6000);
            String rs = exchanger.exchange("é’¥åŒ™ğŸ”‘");
            System.out.println("å¥³å­©æ”¶åˆ°ç¤¼ç‰©ï¼š" + rs);
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
```

## 17. Lambdaè¡¨è¾¾å¼

æ¦‚è¿°ï¼šLambdaè¡¨è¾¾å¼æ˜¯JDK1.8å¼€å§‹ä¹‹åçš„æ–°æŠ€æœ¯ï¼Œæ˜¯ä¸€ç§ä»£ç çš„æ–°è¯­æ³•ã€‚æ˜¯ä¸€ç§ç‰¹æ®Šå†™æ³•ã€‚

ä½œç”¨ï¼šâ€œæ ¸å¿ƒç›®çš„æ˜¯ä¸ºäº†ç®€åŒ–åŒ¿åå†…éƒ¨ç±»çš„ä»£ç å†™æ³•â€ã€‚

Lambdaè¡¨è¾¾å¼çš„æ ¼å¼

```Java
(åŒ¿åå†…éƒ¨ç±»è¢«é‡å†™æ–¹æ³•çš„å½¢å‚åˆ—è¡¨) -> {
    è¢«é‡å†™æ–¹æ³•çš„æ–¹æ³•ä½“ä»£ç ã€‚
}
```

Lambdaè¡¨è¾¾å¼çš„ä½¿ç”¨å‰æ

- Lambdaè¡¨è¾¾å¼å¹¶ä¸èƒ½ç®€åŒ–æ‰€æœ‰åŒ¿åå†…éƒ¨ç±»çš„å†™æ³•
- Lambdaè¡¨è¾¾å¼åªèƒ½ç®€åŒ–æ¥å£ä¸­åªæœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•çš„åŒ¿åå†…éƒ¨ç±»å½¢å¼

Lambdaè¡¨è¾¾å¼åªèƒ½ç®€åŒ–å‡½æ•°å¼æ¥å£çš„åŒ¿åå†…éƒ¨ç±»å†™æ³•

- é¦–å…ˆå¿…é¡»æ˜¯æ¥å£
- æ¥å£ä¸­åªèƒ½æœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•

**Lambdaè¡¨è¾¾å¼ç®€åŒ–Runnableæ¥å£çš„åŒ¿åå†…éƒ¨ç±»å†™æ³•**

**@FunctionalInterfaceå‡½æ•°å¼æ¥å£æ³¨è§£ï¼š**ä¸€æ—¦æŸä¸ªæ¥å£åŠ ä¸Šäº†è¿™ä¸ªæ³¨è§£ï¼Œè¿™ä¸ªæ¥å£åªèƒ½æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ã€‚è¿™ä¸ªæ¥å£å°±å¯ä»¥è¢«Lambdaè¡¨è¾¾å¼ç®€åŒ–ã€‚

```Java
public class LambdaDemo {
    public static void main(String[] args) {
        Thread t = new Thread(new Runnable() {
            @Override
            public void run() {
                System.out.println(Thread.currentThread().getName() + "ï¼šæ‰§è¡Œ~~~");
            }
        });
        t.start();

        Thread t1 = new Thread(() -> System.out.println(Thread.currentThread().getName() + "ï¼šæ‰§è¡Œ~~~"));
        t1.start();
    }
}
```

**Lambdaç®€åŒ–Comparatoræ¥å£åŒ¿åå†…éƒ¨ç±»å†™æ³•**

```Java
public class LambdaDemo01 {
    public static void main(String[] args) {
        List<Student> lists = new ArrayList<>();
        Student s1 = new Student("æé“­",18,'ç”·');
        Student s2 = new Student("å†¯é¾™",23,'ç”·');
        Student s3 = new Student("ç‹ä¹ä¹",21,'ç”·');
        Collections.addAll(lists,s1,s2,s3);

        Collections.sort(lists, new Comparator<Student>() {
            @Override
            public int compare(Student o1, Student o2) {
                return o1.getAge() - o2.getAge();
            }
        });

        Collections.sort(lists,(Student o1, Student o2) -> {
            return o1.getAge() - o2.getAge();
        });
        System.out.println(lists);
    }
}
```

## 18. æ–¹æ³•å¼•ç”¨

æ–¹æ³•å¼•ç”¨ï¼šæ–¹æ³•å¼•ç”¨æ˜¯ä¸ºäº†è¿›ä¸€æ­¥ç®€åŒ–Lambdaè¡¨è¾¾å¼çš„å†™æ³•ã€‚

æ–¹æ³•å¼•ç”¨çš„æ ¼å¼ï¼šç±»å‹æˆ–è€…å¯¹è±¡::å¼•ç”¨çš„æ–¹æ³•ã€‚

å…³é”®è¯­æ³•æ˜¯ï¼š"::"ã€‚

```Java
import java.util.ArrayList;
import java.util.List;

public class MethodDemo {
    public static void main(String[] args) {
        List<String> lists = new ArrayList<>();
        lists.add("Java1");
        lists.add("Java2");
        lists.add("Java3");

        lists.forEach(s -> System.out.println(s));
        System.out.println("-------------------------");
        lists.forEach(System.out::println);
    }
}
```

æ–¹æ³•å¼•ç”¨æœ‰å››ç§å½¢å¼

- é™æ€æ–¹æ³•çš„å¼•ç”¨
- å®ä¾‹æ–¹æ³•çš„å¼•ç”¨
- ç‰¹å®šç±»å‹æ–¹æ³•çš„å¼•ç”¨
- æ„é€ å™¨çš„å¼•ç”¨

é™æ€æ–¹æ³•çš„å¼•ç”¨

å¼•ç”¨æ ¼å¼ï¼šç±»å::é™æ€æ–¹æ³•ã€‚

æ³¨æ„ï¼šè¢«å¼•ç”¨çš„æ–¹æ³•çš„å‚æ•°åˆ—è¡¨è¦å’Œå‡½æ•°å¼æ¥å£ä¸­çš„æŠ½è±¡æ–¹æ³•çš„å‚æ•°åˆ—è¡¨ä¸€è‡´ã€‚

å®ä¾‹æ–¹æ³•çš„å¼•ç”¨

å¼•ç”¨æ ¼å¼ï¼šå¯¹è±¡::å®ä¾‹æ–¹æ³•ã€‚

ç‰¹å®šç±»å‹æ–¹æ³•çš„å¼•ç”¨

ç‰¹å®šç±»å‹ï¼šStringï¼Œä»»ä½•ç±»å‹ã€‚

å¼•ç”¨æ ¼å¼ï¼šç‰¹å®šç±»å‹::æ–¹æ³•ã€‚

æ³¨æ„ï¼šå¦‚æœç¬¬ä¸€ä¸ªå‚æ•°åˆ—è¡¨ä¸­çš„å½¢å‚ä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºäº†åé¢çš„æ–¹æ³•çš„è°ƒç”¨è€…ï¼Œå¹¶ä¸”å…¶ä½™å‚æ•°ä½œä¸ºåé¢æ–¹æ³•çš„å½¢å‚ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç”¨ç‰¹å®šç±»å‹æ–¹æ³•å¼•ç”¨äº†ã€‚

```Java
import java.util.Arrays;
import java.util.Comparator;

public class MethodDemo {
    public static void main(String[] args) {
        String[] strs = new String[]{"James","AA","John","Patricia","Dlei","Robert","Boom","Cao","black","Michael","Linda","cao","after","sBBB"};

        Arrays.sort(strs);
        System.out.println(Arrays.toString(strs));

        Arrays.sort(strs, new Comparator<String>() {
            @Override
            public int compare(String o1, String o2) {
                return o1.compareToIgnoreCase(o2);
            }
        });

        Arrays.sort(strs,(o1, o2) -> o1.compareToIgnoreCase(o2));
        Arrays.sort(strs,String::compareToIgnoreCase);
        System.out.println(Arrays.toString(strs));
    }
```

æ„é€ å™¨å¼•ç”¨

å¼•ç”¨æ ¼å¼ï¼šç±»å::new

æ³¨æ„ï¼šå‰åå‚æ•°ä¸€è‡´çš„æƒ…å†µä¸‹ï¼Œåˆåœ¨åˆ›å»ºå¯¹è±¡å°±å¯ä»¥ä½¿ç”¨æ„é€ å™¨å¼•ç”¨ã€‚

## 19. Streamæµ

### 19.1 æ¦‚è¿°

Streamæµï¼šåœ¨Java 8ä¸­ï¼Œå¾—ç›ŠäºLambdaæ‰€å¸¦æ¥çš„å‡½æ•°å¼ç¼–ç¨‹ï¼Œå¼•å…¥äº†ä¸€ä¸ªå…¨æ–°çš„Streamæµæ¦‚å¿µï¼Œç”¨äºè§£å†³å·²æœ‰é›†åˆ/æ•°ç»„ç±»åº“æ—¢æœ‰çš„å¼Šç«¯ã€‚

Streamæµè§£å†³é—®é¢˜ï¼šå¯ä»¥è§£å†³å·²æœ‰é›†åˆç±»åº“æˆ–è€…æ•°ç»„APIçš„å¼Šç«¯ã€‚Streamè®¤ä¸ºé›†åˆå’Œæ•°ç»„æ“ä½œçš„APIå¾ˆä¸å¥½ç”¨ï¼Œæ‰€ä»¥é‡‡ç”¨äº†Streamæµç®€åŒ–é›†åˆå’Œæ•°ç»„çš„æ“ä½œã€‚

å°ç»“ï¼šStreamæµçš„æ ¸å¿ƒæ€æƒ³æ˜¯æŠŠé›†åˆæˆ–è€…æ•°ç»„è½¬æˆä¸€ä¸ªStreamæµ(ä¼ é€å¸¦)ï¼Œç„¶åä½¿ç”¨Streamæµçš„å¼ºå¤§åŠŸèƒ½è¿›è¡Œå…ƒç´ çš„å¤„ç†ã€‚

```Java
import java.util.ArrayList;
import java.util.List;

public class StreamDemo {
    public static void main(String[] args) {
        List<String> list = new ArrayList<>();
        list.add("å¼ æ— å¿Œ");
        list.add("å‘¨èŠ·è‹¥");
        list.add("èµµæ•");
        list.add("å¼ å¼º");
        list.add("å¼ ä¸‰ä¸°");

        list.stream().filter(s -> s.startsWith("å¼ ")).filter(s -> s.length() == 3).forEach(System.out::println);
    }
```

### 19.2 Streamæµæ“ä½œ

é›†åˆè·å–æµçš„API

- default Stream\<E> stream()

å°ç»“

- é›†åˆè·å–streamæµç”¨ stream();
- æ•°ç»„ï¼šArrays.stream(æ•°ç»„) / Stream.of(æ•°ç»„)

Streamæµçš„å¸¸ç”¨API

- forEachï¼šé€ä¸€å¤„ç†(éå†)
- countï¼šç»Ÿè®¡ä¸ªæ•°
  - long count();
- filterï¼šè¿‡æ»¤å…ƒç´ 
  - Stream\<T> filter(Predicate<? super T> predicate)
- limitï¼šå–å‰å‡ ä¸ªå…ƒç´ 
- skipï¼šè·³è¿‡å‰å‡ ä¸ª
- mapï¼šåŠ å·¥æ–¹æ³•(æŠŠåŸæ¥çš„å…ƒç´ åŠ å·¥ä»¥åï¼Œé‡æ–°æ”¾ä¸Šå»)
- concatï¼šåˆå¹¶æµ

```Java
import java.util.ArrayList;
import java.util.List;
import java.util.stream.Stream;

public class StreamDemo {
    public static void main(String[] args) {
        List<String> list = new ArrayList<>();
        list.add("å¼ æ— å¿Œ");
        list.add("å‘¨èŠ·è‹¥");
        list.add("èµµæ•");
        list.add("å¼ å¼º");
        list.add("å¼ ä¸‰ä¸°");

        Stream<Integer> s1 = Stream.of(10,20,30,40);
        Stream<String> s2 = list.stream();
        Stream<Object> allStream = Stream.concat(s1, s2);
        allStream.forEach(System.out::println);
        System.out.println("--------------------------");

        list.stream().filter(s -> s.length() == 3).filter(s -> s.startsWith("å¼ ")).forEach(System.out::println);
        System.out.println("--------------------------");

        long count = list.stream().count();
        System.out.println(count);
        System.out.println("--------------------------");

        list.stream().filter(s -> s.length() == 3).limit(1).forEach(System.out::println);
        System.out.println("--------------------------");

        list.stream().map(s -> "æ­¦å½“çš„ï¼š" + s).forEach(System.out::println);
    }
}
```

Streamç»ˆç»“ä¸éç»ˆç»“æ–¹æ³•

ç»ˆç»“æ–¹æ³•ï¼šä¸€æ—¦Streamè°ƒç”¨äº†ç»ˆç»“æ–¹æ³•ï¼Œæµçš„æ“ä½œå°±å…¨éƒ¨ç»ˆç»“äº†ï¼Œä¸èƒ½ç»§ç»­ä½¿ç”¨ï¼Œåªèƒ½åˆ›æ–°çš„Streamæ“ä½œ

ç»ˆç»“æ–¹æ³•ï¼šforEachï¼Œcount

éç»ˆç»“æ–¹æ³•ï¼šæ¯æ¬¡è°ƒç”¨å®Œæˆä»¥åè¿”å›ä¸€ä¸ªæ–°çš„æµå¯¹è±¡ï¼Œå¯ä»¥ç»§ç»­ä½¿ç”¨ï¼Œæ”¯æŒé“¾å¼ç¼–ç¨‹ã€‚

æ”¶é›†Streamæµï¼šæŠŠStreamæµçš„æ•°æ®è½¬å›æˆé›†åˆã€‚

Streamçš„ä½œç”¨ï¼šæŠŠé›†åˆè½¬æ¢æˆä¸€æ ¹ä¼ é€å¸¦ï¼Œå€Ÿç”¨Streamæµçš„å¼ºå¤§åŠŸèƒ½è¿›è¡Œçš„æ“ä½œã€‚ä½†æ˜¯å®é™…å¼€å‘ä¸­æ•°æ®æœ€ç»ˆçš„å½¢å¼è¿˜æ˜¯åº”è¯¥æ˜¯é›†åˆï¼Œæœ€ç»ˆStreamæµæ“ä½œå®Œæ¯•ä»¥åè¿˜æ˜¯è¦è½¬æ¢æˆé›†åˆã€‚è¿™å°±æ˜¯æ”¶é›†Streamæµã€‚

Streamæµï¼šæ‰‹æ®µã€‚

é›†åˆï¼šæ‰æ˜¯ç›®çš„ã€‚

æµï¼šåªèƒ½æ“ä½œä¸€æ¬¡ã€‚

```Java
import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;
import java.util.Set;
import java.util.stream.Collectors;
import java.util.stream.Stream;

public class StreamDemo {
    public static void main(String[] args) {
        List<String> list = new ArrayList<>();
        list.add("å¼ æ— å¿Œ");
        list.add("å‘¨èŠ·è‹¥");
        list.add("èµµæ•");
        list.add("å¼ å¼º");
        list.add("å¼ ä¸‰ä¸°");
        list.add("å¼ ä¸‰ä¸°");

        Stream<String> zhangLists = list.stream().filter(s -> s.startsWith("å¼ "));
        Set<String> sets = zhangLists.collect(Collectors.toSet());
        System.out.println(sets);

        Stream<String> zhangLists1 = list.stream().filter(s -> s.startsWith("å¼ "));
        List<String> lists = zhangLists1.collect(Collectors.toList());
        System.out.println(lists);

        Stream<String> zhangLists2 = list.stream().filter(s -> s.startsWith("å¼ "));
        Object[] arrs = zhangLists2.toArray();
        Stream<String> zhangLists3 = list.stream().filter(s -> s.startsWith("å¼ "));
        String[] arrs1 = zhangLists3.toArray(String[]::new);
        System.out.println(Arrays.toString(arrs1));

    }
}
```

## 20. Fileç±»

Fileç±»ï¼šä»£è¡¨æ“ä½œç³»ç»Ÿçš„æ–‡ä»¶å¯¹è±¡ã€‚æ˜¯ç”¨æ¥æ“ä½œæ“ä½œç³»ç»Ÿçš„æ–‡ä»¶å¯¹è±¡çš„ï¼Œåˆ é™¤æ–‡ä»¶ï¼Œè·å–æ–‡ä»¶ä¿¡æ¯ï¼Œåˆ›å»ºæ–‡ä»¶(æ–‡ä»¶å¤¹)ã€‚

å¹¿ä¹‰æ¥è¯´ï¼šæ“ä½œç³»ç»Ÿè®¤ä¸ºæ–‡ä»¶åŒ…å«æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ã€‚

Fileç±»åˆ›å»ºæ–‡ä»¶å¯¹è±¡çš„æ ¼å¼

- File f = new File("ç»å¯¹è·¯å¾„/ç›¸å¯¹è·¯å¾„");
- ç»å¯¹è·¯å¾„ï¼šä»ç£ç›˜çš„ç›˜ç¬¦ä¸€è·¯èµ°åˆ°ç›®çš„ä½ç½®çš„è·¯å¾„ã€‚
  - ç»å¯¹è·¯å¾„ä¾èµ–å…·ä½“çš„ç¯å¢ƒï¼Œä¸€æ—¦è„±ç¦»ç¯å¢ƒï¼Œä»£ç å¯èƒ½å‡ºé”™
  - ä¸€èˆ¬æ˜¯å®šä½æŸä¸ªæ“ä½œç³»ç»Ÿä¸­çš„æŸä¸ªæ–‡ä»¶å¯¹è±¡
- ç›¸å¯¹è·¯å¾„ï¼šä¸å¸¦ç›˜ç¬¦çš„ã€‚
  - é»˜è®¤æ˜¯ç›´æ¥ç›¸å¯¹åˆ°å·¥ç¨‹ç›®å½•ä¸‹å¯»æ‰¾æ–‡ä»¶çš„
  - ç›¸å¯¹è·¯å¾„åªèƒ½ç”¨äºå¯»æ‰¾å·¥ç¨‹ä¸‹çš„æ–‡ä»¶
  - èƒ½ç”¨ç›¸å¯¹è·¯å¾„å°±åº”è¯¥å°½é‡ä½¿ç”¨ï¼Œå¯ä»¥è·¨å¹³å°
- File f = new File("æ–‡ä»¶å¯¹è±¡/æ–‡ä»¶å¤¹å¯¹è±¡");

Fileç±»çš„è·å–åŠŸèƒ½çš„API

- public String getAbsolutePath()ï¼šè¿”å›æ­¤Fileçš„ç»å¯¹è·¯å¾„åå­—ç¬¦ä¸²ã€‚
- public String getPath()ï¼šè·å–åˆ›å»ºæ–‡ä»¶å¯¹è±¡çš„æ—¶å€™ç”¨çš„è·¯å¾„ã€‚
- public String getName()ï¼šè¿”å›ç”±æ­¤Fileè¡¨ç¤ºçš„æ–‡ä»¶æˆ–ç›®å½•çš„åç§°ã€‚
- public long length()ï¼šè¿”å›ç”±æ­¤Fileè¡¨ç¤ºçš„æ–‡ä»¶çš„é•¿åº¦ã€‚

```Java
import java.io.File;

public class FileDemo {
    public static void main(String[] args) {
        File f1 = new File("D:\\Photo\\MyImages2.jpg");
        System.out.println(f1.getAbsolutePath());
        System.out.println(f1.getPath());
        System.out.println(f1.getName());
        System.out.println(f1.length());
        System.out.println("-------------------------------------");

        File f2 = new File("Day05Demo\\src\\dlei01.txt");
        System.out.println(f2.getAbsolutePath());
        System.out.println(f2.getPath());
        System.out.println(f2.length());
    }
}
```

Fileç±»çš„åˆ¤æ–­åŠŸèƒ½çš„æ–¹æ³•

- public boolean exists()ï¼šæ­¤Fileè¡¨ç¤ºçš„æ–‡ä»¶æˆ–ç›®å½•æ˜¯å¦å®é™…å­˜åœ¨ã€‚
- public boolean isDirectory()ï¼šæ­¤Fileè¡¨ç¤ºçš„æ˜¯å¦ä¸ºç›®å½•ã€‚
- public boolean isFile()ï¼šæ­¤Fileè¡¨ç¤ºçš„æ˜¯å¦ä¸ºæ–‡ä»¶ã€‚

Fileç±»çš„åˆ›å»ºå’Œåˆ é™¤çš„æ–¹æ³•

- public boolean createNewFile()ï¼šå½“ä¸”ä»…å½“å…·æœ‰è¯¥åç§°çš„æ–‡ä»¶å°šä¸å­˜åœ¨æ—¶ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç©ºæ–‡ä»¶ã€‚(å‡ ä¹ä¸ç”¨çš„ï¼Œå› ä¸ºä»¥åæ–‡ä»¶éƒ½æ˜¯è‡ªåŠ¨åˆ›å»ºçš„)
- public boolean delete()ï¼šåˆ é™¤ç”±æ­¤Fileè¡¨ç¤ºçš„æ–‡ä»¶æˆ–ç›®å½•ã€‚(åªèƒ½åˆ é™¤ç©ºç›®å½•)
- public boolean mkdir()ï¼šåˆ›å»ºç”±æ­¤Fileè¡¨ç¤ºçš„ç›®å½•ã€‚(åªèƒ½åˆ›å»ºä¸€çº§ç›®å½•)
- public boolean mkdirs()ï¼šå¯ä»¥åˆ›å»ºå¤šçº§ç›®å½•ã€‚(å»ºè®®ä½¿ç”¨çš„)

Fileé’ˆå¯¹ç›®å½•çš„éå†

- public String[] list()ï¼šè·å–å½“å‰ç›®å½•ä¸‹æ‰€æœ‰çš„â€œä¸€çº§æ–‡ä»¶åç§°â€åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ä¸­å»è¿”å›ã€‚
- public File[] listFiles()ï¼šå¸¸ç”¨ï¼Œè·å–å½“å‰ç›®å½•ä¸‹æ‰€æœ‰çš„â€œä¸€çº§æ–‡ä»¶å¯¹è±¡â€åˆ°ä¸€ä¸ªæ–‡ä»¶å¯¹è±¡æ•°ç»„ä¸­å»è¿”å›ã€‚

```Java
import java.io.File;
import java.text.SimpleDateFormat;

public class FileDemo01 {
    public static void main(String[] args) {
        File dir = new File("F:\\Git");
        String[] names = dir.list();
        for (String name : names) {
            System.out.println(name);
        }
        System.out.println("----------------------");

        File[] files = dir.listFiles();
        for (File file : files) {
            System.out.println(file.getAbsolutePath());
        }

        File f1 = new File("D:\\Photo\\MyImages2.jpg");
        long time = f1.lastModified();
        SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
        System.out.println(sdf.format(time));
    }
}
```

## 21. é€’å½’

é€’å½’ï¼šæ–¹æ³•åœ¨æ–¹æ³•ä¸­åˆè°ƒç”¨äº†è‡ªå·±ã€‚

ç›´æ¥é€’å½’ï¼šè‡ªå·±çš„æ–¹æ³•è°ƒç”¨è‡ªå·±ã€‚

é—´æ¥é€’å½’ï¼šè‡ªå·±çš„æ–¹æ³•è°ƒç”¨åˆ«çš„æ–¹æ³•ï¼Œåˆ«çš„æ–¹æ³•åˆè°ƒç”¨è‡ªå·±ã€‚

æ³¨æ„ï¼šé€’å½’å¦‚æœæ§åˆ¶çš„ä¸æ°å½“ï¼Œä¼šå½¢æˆé€’å½’çš„æ­»å¾ªç¯ï¼Œä»è€Œå¯¼è‡´æ ˆå†…å­˜æº¢å‡ºé”™è¯¯ã€‚

é€’å½’çš„ä¸‰è¦ç´ 

- é€’å½’çš„å…¬å¼
- é€’å½’çš„ç»ˆç»“ç‚¹
- é€’å½’çš„æ–¹æ³•å¿…é¡»èµ°å‘ç»ˆç»“ç‚¹

ç»ƒä¹ æ¡ˆä¾‹ï¼šçŒ´å­åƒæ¡ƒï¼ŒçŒ´å­ç¬¬ä¸€å¤©æ‘˜äº†è‹¥å¹²ä¸ªæ¡ƒå­ï¼Œå½“å³åƒäº†ä¸€åŠï¼Œè§‰å¾—å¥½ä¸è¿‡ç˜¾ï¼Œç„¶ååˆå¤šåƒäº†ä¸€ä¸ªã€‚ç¬¬äºŒå¤©åˆåƒäº†å‰ä¸€å¤©å‰©ä¸‹çš„ä¸€åŠï¼Œè§‰å¾—å¥½ä¸è¿‡ç˜¾ï¼Œç„¶ååˆå¤šåƒäº†ä¸€ä¸ªã€‚ä»¥åæ¯å¤©éƒ½æ˜¯å¦‚æ­¤ï¼Œç­‰åˆ°ç¬¬åå¤©å†åƒçš„æ—¶å€™å‘ç°åªæœ‰1ä¸ªæ¡ƒå­ï¼Œè¯·é—®çŒ´å­ç¬¬ä¸€å¤©æ€»å…±æ‘˜äº†å¤šå°‘ä¸ªæ¡ƒå­ã€‚

éè§„å¾‹åŒ–é€’å½’åº”è¯¥æŒ‰ç…§ä¸šåŠ¡æµç¨‹å¼€å‘ã€‚

```Java
public class RecursionDemo {
    public static void main(String[] args) {
        System.out.println(f(1));
    }

    public static int f(int x) {
        if (x == 10) {
            return 1;
        } else {
            return  2 * f(x + 1) + 2;
        }
    }
}
```

é€’å½’å®ç°æ–‡ä»¶æœç´¢ï¼šå»F:/Gitç›®å½•å¯»æ‰¾å‡º8859-1.txtæ–‡ä»¶ã€‚

```Java
import java.io.File;

public class RecursionDemo {
    public static void main(String[] args) {
        searchFiles(new File("F:/Git"), "8859-1.txt");
    }

    public static void searchFiles(File dir, String fileName) {
        if (dir.exists() && dir.isDirectory()) {
            File[] files = dir.listFiles();
            if (files != null && files.length > 0) {
                for (File file : files) {
                    if (file.isFile()) {
                        if (file.getName().contains(fileName)) {
                            System.out.println(file.getAbsolutePath());
                        }
                    } else {
                        searchFiles(file,fileName);
                    }
                }
            }
        }
    }
}
```

## 22. IOæµ

### 22.1 IOæµæ¦‚è¿°

å­—ç¬¦é›†ï¼šå„ä¸ªå›½å®¶ä¸ºè‡ªå·±å›½å®¶çš„å­—ç¬¦å–çš„ä¸€å¥—ç¼–å·è§„åˆ™ã€‚

å°ç»“

- è‹±æ–‡å’Œæ•°å­—åœ¨ä»»ä½•ç¼–ç é›†ä¸­éƒ½æ˜¯ä¸€æ ·çš„ï¼Œéƒ½å 1ä¸ªå­—èŠ‚
- GBKç¼–ç ä¸­ï¼Œ1ä¸ªä¸­æ–‡å­—ç¬¦ä¸€èˆ¬å 2ä¸ªå­—èŠ‚
- UTF-8ç¼–ç ä¸­ï¼Œ1ä¸ªä¸­æ–‡å­—ç¬¦ä¸€èˆ¬å 3ä¸ªå­—èŠ‚
- æŠ€æœ¯äººå‘˜éƒ½åº”è¯¥ä½¿ç”¨UTF-8ç¼–ç 

IOè¾“å…¥è¾“å‡ºæµï¼šè¾“å…¥/è¾“å‡ºæµã€‚

- Inputï¼šè¾“å…¥
- Outputï¼šè¾“å‡º

å¼•å…¥ï¼šFileç±»åªèƒ½æ“ä½œæ–‡ä»¶å¯¹è±¡æœ¬èº«ï¼Œä¸èƒ½è¯»å†™æ–‡ä»¶å¯¹è±¡çš„å†…å®¹ã€‚è¯»å†™æ•°æ®å†…å®¹ï¼Œåº”è¯¥ä½¿ç”¨IOæµã€‚

IOæµæ˜¯ä¸€ä¸ªæ°´æµæ¨¡å‹ï¼šIOç†è§£æˆæ°´ç®¡ï¼ŒæŠŠæ•°æ®ç†è§£æˆæ°´æµã€‚

IOæµçš„åˆ†ç±»

- æŒ‰ç…§æµçš„æ–¹å‘åˆ†ä¸ºï¼šè¾“å…¥æµ(è¯»)ï¼Œè¾“å‡ºæµ(å†™)
- æŒ‰ç…§æµçš„å†…å®¹åˆ†ä¸ºï¼šå­—èŠ‚æµï¼Œå­—ç¬¦æµ

### 22.2 å­—èŠ‚è¾“å…¥è¾“å‡ºæµ

|     å­—èŠ‚è¾“å…¥æµ      |      å­—èŠ‚è¾“å‡ºæµ      |   å­—ç¬¦è¾“å…¥æµ   |   å­—ç¬¦è¾“å‡ºæµ   |            |
| :-----------------: | :------------------: | :------------: | :------------: | :--------: |
|     InputStream     |     OutputStream     |     Reader     |     Writer     |   æŠ½è±¡ç±»   |
|   FileInputStream   |   FileOutputStream   |   FileReader   |   FileWriter   | å­ç±»å®ç°ç±» |
| BufferedInputStream | BufferedOutputStream | BufferedReader | BufferedWriter |   å®ç°ç±»   |

```Java
import java.io.File;
import java.io.FileInputStream;
import java.io.InputStream;

public class FileInputStreamDemo {
    public static void main(String[] args) throws Exception {
        File file = new File("Day05Demo\\src\\dlei01.txt");
        InputStream is = new FileInputStream(file);

        int ch = 0;
        while ((ch = is.read()) != -1) {
            System.out.print((char) ch);
        }
    }
}
```

å°ç»“

- ä¸€ä¸ªä¸€ä¸ªå­—èŠ‚è¯»å–è‹±æ–‡å’Œæ•°å­—æ²¡æœ‰é—®é¢˜
- ä½†æ˜¯ä¸€æ—¦è¯»å–ä¸­æ–‡è¾“å‡ºæ— æ³•é¿å…ä¹±ç ï¼Œå› ä¸ºä¼šæˆªæ–­ä¸­æ–‡çš„å­—èŠ‚
- ä¸€ä¸ªä¸€ä¸ªå­—èŠ‚çš„è¯»å–æ•°æ®ï¼Œæ€§èƒ½ä¹Ÿè¾ƒå·®ï¼Œæ‰€ä»¥ä¸æ¨èä½¿ç”¨æ­¤æ–¹æ¡ˆ

å­—èŠ‚æ•°ç»„è¯»å–

- ä½¿ç”¨å­—èŠ‚æ•°ç»„è¯»å–å†…å®¹ï¼Œæ•ˆç‡å¯ä»¥
- ä½†æ˜¯ä½¿ç”¨å­—èŠ‚æ•°ç»„è¯»å–æ–‡æœ¬å†…å®¹è¾“å‡ºï¼Œä¹Ÿæ— æ³•é¿å…ä¸­æ–‡è¯»å–è¾“å‡ºä¹±ç çš„é—®é¢˜

å­—èŠ‚æµè¯»å–è§£å†³ä¸­æ–‡ä¹±ç é—®é¢˜

- å®šä¹‰ä¸€ä¸ªå­—èŠ‚æ•°ç»„ä¸æ–‡ä»¶çš„å¤§å°åˆšå¥½ä¸€æ ·å¤§ï¼Œç„¶åä¸€æ¡¶æ°´è¯»å–å…¨éƒ¨å­—èŠ‚æ•°æ®å†è¾“å‡º
- å¯ä»¥é¿å…ä¸­æ–‡è¯»å–è¾“å‡ºä¹±ç ï¼Œä½†æ˜¯å¦‚æœè¯»å–çš„æ–‡ä»¶è¿‡å¤§ï¼Œä¼šå‡ºç°å†…å­˜æº¢å‡º
- å­—èŠ‚æµå¹¶ä¸é€‚åˆè¯»å–æ–‡æœ¬æ–‡ä»¶å†…å®¹è¾“å‡ºï¼Œè¯»å†™æ–‡ä»¶å†…å®¹å»ºè®®ä½¿ç”¨å­—ç¬¦æµ

FileOutputStreamæ–‡ä»¶å­—èŠ‚è¾“å‡ºæµ

ä½œç”¨ï¼šä»¥å†…å­˜ä¸ºåŸºå‡†ï¼ŒæŠŠå†…å­˜ä¸­çš„æ•°æ®ï¼ŒæŒ‰ç…§å­—èŠ‚çš„å½¢å¼å†™å‡ºåˆ°ç£ç›˜æ–‡ä»¶ä¸­å»ã€‚

```Java
import java.io.FileOutputStream;
import java.io.OutputStream;

public class FileOutputStreamDemo {
    public static void main(String[] args) throws Exception {
        OutputStream os = new FileOutputStream("Day05Demo\\src\\dlei02.txt",true);
        os.write(97);
        os.write('b');
        os.write("\r\n".getBytes());

        byte[] bytes = new byte[]{98,99,100,111,104};
        os.write(bytes);
        os.write("\r\n".getBytes());
        byte[] bytes1 = "Javaæ˜¯æœ€ä¼˜ç¾çš„è¯­è¨€ï¼Œæˆ‘çˆ±Javaï¼".getBytes();
        System.out.println(bytes1.length);
        os.write(bytes1);

        os.flush();
        os.close();
    }
}
```

å°ç»“

- å­—èŠ‚è¾“å‡ºæµå¯ä»¥å†™å­—èŠ‚æ•°æ®åˆ°æ–‡ä»¶ä¸­å»
- å¯ä»¥å†™ä¸€ä¸ªå­—èŠ‚ï¼Œå†™ä¸€ä¸ªå­—èŠ‚æ•°ç»„ï¼Œå†™ä¸€ä¸ªå­—èŠ‚æ•°ç»„çš„ä¸€éƒ¨åˆ†å‡ºå»
- ç®¡é“ç”¨å®Œéœ€è¦å…³é—­ï¼Œæ•°æ®è¦ç”Ÿæ•ˆéœ€è¦åˆ·æ–°ï¼Œå…³é—­åŒ…å«åˆ·æ–°ï¼Œåˆ·æ–°åæµå¯ä»¥ç»§ç»­ä½¿ç”¨ï¼Œå…³é—­åæµæ— æ³•ç»§ç»­ä½¿ç”¨äº†
- å­—èŠ‚è¾“å‡ºæµç®¡é“é»˜è®¤æ˜¯è¦†ç›–ç®¡é“ï¼Œå¯åŠ¨ç®¡é“å†™æ•°æ®å‰ä¼šæ¸…ç©ºæ•°æ®

å­—èŠ‚æµåšæ–‡ä»¶å¤åˆ¶

å­—èŠ‚æµå¤åˆ¶æ€æƒ³

- å­—èŠ‚æ˜¯è®¡ç®—æœºä¸­ä¸€åˆ‡æ–‡ä»¶çš„ç»„æˆï¼Œæ‰€ä»¥å­—èŠ‚æµé€‚åˆåšä¸€åˆ‡æ–‡ä»¶çš„å¤åˆ¶ã€‚
- å¤åˆ¶æ˜¯æŠŠæºæ–‡ä»¶çš„å…¨éƒ¨å­—èŠ‚ä¸€å­—ä¸æ¼çš„è½¬ç§»åˆ°ç›®æ ‡æ–‡ä»¶ï¼Œåªè¦æ–‡ä»¶å‰åçš„æ ¼å¼ä¸€æ ·ï¼Œç»å¯¹ä¸ä¼šæœ‰é—®é¢˜ã€‚

```Java
import java.io.*;

public class FileCopyDemo {
    public static void main(String[] args) {
        InputStream is = null;
        OutputStream os = null;
        try {
            is = new FileInputStream("D:\\Photo\\MyImages2.jpg");
            os = new FileOutputStream("Day05Demo\\src\\photo.jpg");

            byte[] buffer = new byte[1024];
            int len;
            while ((len = is.read(buffer)) != -1) {
                os.write(buffer,0,len);
            }
            System.out.println("å¤åˆ¶å®Œæˆï¼");
        } catch (Exception e) {
            e.printStackTrace();
        } finally {
            if (is != null) {
                try {
                    is.close();
                } catch (Exception e) {
                    e.printStackTrace();
                }
            }
            if (os != null) {
                try {
                    os.close();
                } catch (Exception e) {
                    e.printStackTrace();
                }
            }
        }
    }
}
```

JDK 1.7å¼€å§‹ä¹‹åé‡Šæ”¾èµ„æºçš„æ–°æ–¹å¼

try-with-resources

```Java
try (
    // è¿™é‡Œåªèƒ½æ”¾ç½®èµ„æºå¯¹è±¡ï¼Œç”¨å®Œä¼šè‡ªåŠ¨è°ƒç”¨close()å…³é—­
) {
    
} catch(Exception e) {
    e.printStackTrace();
}
```

ä»€ä¹ˆæ˜¯èµ„æºï¼šèµ„æºç±»ä¸€å®šæ˜¯å®ç°äº†Closeableæ¥å£ï¼Œå®ç°è¿™ä¸ªæ¥å£çš„ç±»å°±æ˜¯èµ„æºã€‚

```Java
import java.io.*;

public class FileCopyDemo {
    public static void main(String[] args) {
        try (
                InputStream is  = new FileInputStream("D:\\Photo\\MyImages2.jpg");
                OutputStream os = new FileOutputStream("Day05Demo\\src\\photo.jpg");
                ) {
            byte[] buffer = new byte[1024];
            int len;
            while ((len = is.read(buffer)) != -1) {
                os.write(buffer,0,len);
            }
            System.out.println("å¤åˆ¶å®Œæˆï¼");
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
```

### 22.3 å­—ç¬¦è¾“å…¥è¾“å‡ºæµ

FileReaderï¼šæ–‡ä»¶å­—ç¬¦è¾“å…¥æµã€‚

ä½œç”¨ï¼šä»¥å†…å­˜ä¸ºåŸºå‡†ï¼ŒæŠŠç£ç›˜æ–‡ä»¶çš„æ•°æ®ä»¥å­—ç¬¦çš„å½¢å¼è¯»å…¥åˆ°å†…å­˜ã€‚ç®€å•æ¥è¯´ï¼Œè¯»å–æ–‡æœ¬æ–‡ä»¶å†…å®¹åˆ°å†…å­˜ä¸­å»ã€‚

```Java
import java.io.FileReader;
import java.io.Reader;

public class FileReaderDemo {
    public static void main(String[] args) throws Exception {
        Reader fr = new FileReader("Day05Demo\\src\\dlei02.txt");
        int ch;
        while ((ch = fr.read()) != -1) {
            System.out.print((char) ch);
        }
    }
}
```

å°ç»“

- å­—ç¬¦æµä¸€ä¸ªä¸€ä¸ªå­—ç¬¦çš„è¯»å–æ–‡æœ¬å†…å®¹è¾“å‡ºï¼Œå¯ä»¥è§£å†³ä¸­æ–‡è¯»å–è¾“å‡ºä¹±ç çš„é—®é¢˜
- å­—ç¬¦æµå¾ˆé€‚åˆæ“ä½œæ–‡æœ¬æ–‡ä»¶å†…å®¹
- ä½†æ˜¯ä¸€ä¸ªä¸€ä¸ªå­—ç¬¦åœ°è¯»å–æ–‡æœ¬å†…å®¹æ€§èƒ½è¾ƒå·®

```Java
import java.io.FileReader;
import java.io.Reader;

public class FileReaderDemo {
    public static void main(String[] args) throws Exception {
        Reader fr = new FileReader("Day05Demo\\src\\dlei02.txt");
        char[] buffer = new char[1024];
        int len;
        while ((len = fr.read(buffer)) != -1) {
            String rs = new String(buffer,0,len);
            System.out.print(rs);
        }
    }
}
```

å­—ç¬¦æµæŒ‰ç…§å­—ç¬¦æ•°ç»„å¾ªç¯è¯»å–æ•°æ®ï¼Œå¯ä»¥è§£å†³ä¸­æ–‡è¯»å–è¾“å‡ºä¹±ç çš„é—®é¢˜ï¼Œè€Œä¸”æ€§èƒ½ä¹Ÿè¾ƒå¥½ã€‚

FileWriteræ–‡ä»¶å­—ç¬¦è¾“å‡ºæµçš„ä½¿ç”¨

ä½œç”¨ï¼šä»¥å†…å­˜ä¸ºåŸºå‡†ï¼ŒæŠŠå†…å­˜ä¸­çš„æ•°æ®æŒ‰ç…§å­—ç¬¦çš„å½¢å¼å†™å‡ºåˆ°ç£ç›˜æ–‡ä»¶ä¸­å»ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯æŠŠå†…å­˜çš„æ•°æ®ä»¥å­—ç¬¦å†™å‡ºåˆ°æ–‡ä»¶ä¸­å»ã€‚

```Java
import java.io.FileWriter;
import java.io.Writer;

public class FileWriterDemo {
    public static void main(String[] args) throws Exception {
        Writer fw = new FileWriter("Day05Demo\\src\\dlei01.txt",true);
        fw.write(97);
        fw.write('b');
        fw.write("\r\n");
        fw.write('ä¸­');
        fw.write("\r\n");
        fw.write("Javaæ˜¯æœ€ä¼˜ç¾çš„è¯­è¨€");
        fw.write("\r\n");
        fw.write("æˆ‘çˆ±ä¸­å›½".toCharArray());
        fw.write("\r\n");
        fw.write("Javaæ˜¯æœ€ä¼˜ç¾çš„è¯­è¨€",0,9);
        fw.write("\r\n");
        fw.write("æˆ‘çˆ±ä¸­å›½".toCharArray(),0,2);
        fw.close();
    }
}
```

å°ç»“ï¼šå­—ç¬¦è¾“å‡ºæµå¯ä»¥å†™å­—ç¬¦æ•°æ®å‡ºå»ï¼Œæ€»å…±æœ‰5ä¸ªæ–¹æ³•å†™å­—ç¬¦ã€‚

### 22.4 ç¼“å†²æµ

ç¼“å†²æµï¼šç¼“å†²æµå¯ä»¥æé«˜å­—èŠ‚æµå’Œå­—ç¬¦æµçš„è¯»å†™æ•°æ®çš„æ€§èƒ½ã€‚

ç¼“å†²æµåˆ†ä¸ºå››ç±»

- BufferedInputStreamï¼šå­—èŠ‚ç¼“å†²è¾“å…¥æµï¼Œå¯ä»¥æé«˜å­—èŠ‚è¾“å…¥æµè¯»æ•°æ®çš„æ€§èƒ½ã€‚
- BufferedOutputStreamï¼šå­—èŠ‚ç¼“å†²è¾“å‡ºæµï¼Œå¯ä»¥æé«˜å­—èŠ‚è¾“å‡ºæµå†™æ•°æ®çš„æ€§èƒ½ã€‚
- BufferedReaderï¼šå­—ç¬¦ç¼“å†²è¾“å‡ºæµï¼Œå¯ä»¥æé«˜å­—ç¬¦è¾“å…¥æµè¯»æ•°æ®çš„æ€§èƒ½ã€‚
- BufferedWriterï¼šå­—ç¬¦ç¼“å†²è¾“å‡ºæµï¼Œå¯ä»¥æé«˜å­—ç¬¦è¾“å‡ºæµå†™æ•°æ®çš„æ€§èƒ½ã€‚

å­—èŠ‚ç¼“å†²è¾“å…¥æµï¼šBufferedInputStream

ä½œç”¨ï¼šå¯ä»¥æŠŠä½çº§çš„å­—èŠ‚è¾“å…¥æµåŒ…è£…æˆä¸€ä¸ªé«˜çº§çš„ç¼“å†²å­—èŠ‚è¾“å…¥æµç®¡é“ï¼Œä»è€Œæé«˜å­—èŠ‚è¾“å…¥æµè¯»æ•°æ®çš„æ€§èƒ½ã€‚

æ„é€ å™¨ï¼špublic BufferedInputStream(InputStream in)

```Java
import java.io.BufferedInputStream;
import java.io.FileInputStream;

public class BufferedInputStreamDemo {
    public static void main(String[] args) throws Exception {
        BufferedInputStream bis = new BufferedInputStream(new FileInputStream("Day05Demo\\src\\dlei02.txt"));
        byte[] buffer = new byte[1024];
        int len;
        while ((len = bis.read(buffer)) != -1) {
            String rs = new String(buffer,0,len);
            System.out.print(rs);
        }
    }
}
```

å­—èŠ‚ç¼“å†²è¾“å‡ºæµï¼šBufferedOutputStream

ä½œç”¨ï¼šå¯ä»¥æŠŠä½çº§çš„å­—èŠ‚è¾“å‡ºæµåŒ…è£…æˆä¸€ä¸ªé«˜çº§çš„ç¼“å†²å­—èŠ‚è¾“å‡ºæµï¼Œä»è€Œæé«˜å†™æ•°æ®çš„æ€§èƒ½ã€‚

æ„é€ å™¨ï¼špublic BufferedOutputStream(OutputStream os)

åŸç†ï¼šç¼“å†²å­—èŠ‚è¾“å‡ºæµè‡ªå¸¦äº†8KBç¼“å†²æ± ï¼Œæ•°æ®å°±ç›´æ¥å†™å…¥åˆ°ç¼“å†²æ± ä¸­å»ï¼Œæ€§èƒ½æé«˜äº†ã€‚

å­—ç¬¦ç¼“å†²è¾“å…¥æµï¼šBufferedReader

ä½œç”¨ï¼šå­—ç¬¦ç¼“å†²è¾“å…¥æµå¯ä»¥æŠŠå­—ç¬¦è¾“å…¥æµåŒ…è£…æˆä¸€ä¸ªé«˜çº§çš„ç¼“å†²å­—ç¬¦è¾“å…¥æµï¼Œå¯ä»¥æé«˜å­—ç¬¦è¾“å…¥æµè¯»æ•°æ®çš„æ€§èƒ½ã€‚

æ„é€ å™¨ï¼špublic BufferedReader(Reader reader)

åŸç†ï¼šç¼“å†²å­—ç¬¦è¾“å…¥æµé»˜è®¤ä¼šæœ‰ä¸€ä¸ª8KBçš„å­—ç¬¦ç¼“å†²æµï¼Œå¯ä»¥æé«˜è¯»å­—ç¬¦çš„æ€§èƒ½ã€‚

```Java
import java.io.BufferedReader;
import java.io.FileReader;

public class BufferedReaderDemo {
    public static void main(String[] args) throws Exception {
        BufferedReader br = new BufferedReader(new FileReader("Day05Demo\\src\\dlei02.txt"));

        String line;
        while ((line = br.readLine()) != null) {
            System.out.println(line);
        }
        br.close();
    }
}
```

å­—ç¬¦ç¼“å†²è¾“å‡ºæµï¼šBufferedWriter

ä½œç”¨ï¼šæŠŠå­—ç¬¦è¾“å‡ºæµåŒ…è£…æˆä¸€ä¸ªé«˜çº§çš„ç¼“å†²å­—ç¬¦è¾“å‡ºæµï¼Œæé«˜å†™å­—ç¬¦æ•°æ®çš„æ€§èƒ½ã€‚

æ„é€ å™¨ï¼špublic BufferedWriter(Writer writer)

åŸç†ï¼šé«˜çº§çš„å­—ç¬¦ç¼“å†²è¾“å‡ºæµå¤šäº†ä¸€ä¸ª8KBçš„å­—ç¬¦ç¼“å†²æ± ï¼Œå†™æ•°æ®æ€§èƒ½æå¤§æé«˜äº†ã€‚

```Java
import java.io.BufferedWriter;
import java.io.FileWriter;

public class BufferedWriterDemo {
    public static void main(String[] args) throws Exception {
        BufferedWriter bw = new BufferedWriter(new FileWriter("Day05Demo\\src\\dlei01.txt",true));

        bw.write("æˆ‘åœ¨å­¦Javaä¸­çš„IOæµ~~~");
        bw.newLine();
        bw.write("Javaæ˜¯æœ€ä¼˜ç¾çš„è¯­è¨€~~~");
        bw.newLine();
        bw.close();
    }
}
```

ç»ƒä¹ ï¼šå°†æ–‡æ¡£ä¸­å¸¦æœ‰ä¸­æ–‡åºå·çš„å†…å®¹è¯»å‡ºã€æ’åºå¹¶å†™å…¥æ–°çš„æ–‡æ¡£ã€‚

```Java
import java.io.BufferedReader;
import java.io.BufferedWriter;
import java.io.FileReader;
import java.io.FileWriter;
import java.util.ArrayList;
import java.util.Collections;
import java.util.List;

public class ExecDemo {
    public static void main(String[] args) {
        try (
                BufferedReader br = new BufferedReader(new FileReader("Day05Demo\\src\\dlei01.txt"));
                BufferedWriter bw = new BufferedWriter(new FileWriter("Day05Demo\\src\\dlei02.txt"));
                ) {
            List<String> datas = new ArrayList<>();
            String line;
            while ((line = br.readLine()) != null) {
                datas.add(line);
            }

            List<Character> sizes = new ArrayList<>();
            Collections.addAll(sizes,'é›¶','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­','ä¸ƒ','å…«','ä¹','å');

            Collections.sort(datas, (o1, o2) -> sizes.indexOf(o1.charAt(0)) - sizes.indexOf(o2.charAt(0)));
            System.out.println(datas);

            for (String data : datas) {
                bw.write(data);
                bw.newLine();
            }
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
```

æ³¨æ„ï¼šå¦‚æœä»£ç ç¼–ç å’Œè¯»å–çš„æ–‡ä»¶ç¼–ç ä¸€è‡´ï¼Œå­—ç¬¦æµè¯»å–çš„æ—¶å€™ä¸ä¼šä¹±ç ï¼Œåä¹‹åˆ™ä¼šä¹±ç ã€‚

### 22.5 å­—ç¬¦è¾“å…¥è¾“å‡ºè½¬æ¢æµ

å­—ç¬¦è¾“å…¥è½¬æ¢æµï¼šInputStreamReader

ä½œç”¨ï¼šå¯ä»¥æŠŠåŸå§‹çš„å­—èŠ‚æµæŒ‰ç…§å½“å‰é»˜è®¤çš„ä»£ç ç¼–ç è½¬æ¢æˆå­—ç¬¦è¾“å…¥æµã€‚ä¹Ÿå¯ä»¥æŠŠåŸå§‹çš„å­—èŠ‚æµæŒ‰ç…§æŒ‡å®šç¼–ç è½¬æ¢æˆå­—ç¬¦è¾“å…¥æµã€‚

æ„é€ å™¨

- public InputStreamReader(InputStream is)ï¼šå¯ä»¥ä½¿ç”¨å½“å‰ä»£ç é»˜è®¤ç¼–ç è½¬æ¢æˆå­—ç¬¦æµï¼Œå‡ ä¹ä¸ç”¨
- public InputStreamReader(InputStream is, String charset)ï¼šå¯ä»¥æŒ‡å®šç¼–ç æŠŠå­—èŠ‚æµè½¬æ¢æˆå­—ç¬¦æµ

å­—ç¬¦è¾“å‡ºè½¬æ¢æµï¼šOutputStreamWriter

ä½œç”¨ï¼šå¯ä»¥æŒ‡å®šç¼–ç æŠŠå­—èŠ‚è¾“å‡ºæµè½¬æ¢æˆå­—ç¬¦è¾“å‡ºæµï¼Œå¯ä»¥æŒ‡å®šå†™å‡ºå»çš„å­—ç¬¦ç¼–ç ã€‚

æ„é€ å™¨

- public OutputStreamWriter(OutputStream os)ï¼šç”¨å½“å‰é»˜è®¤ç¼–ç UTF-8æŠŠå­—èŠ‚è¾“å‡ºæµè½¬æ¢æˆå­—ç¬¦è¾“å‡ºæµ
- public OutputStreamWriter(OutputStream os, String charset)ï¼šæŒ‡å®šç¼–ç æŠŠå­—èŠ‚è¾“å‡ºæµè½¬æ¢æˆå­—ç¬¦è¾“å‡ºæµ

### 22.6 å¯¹è±¡åºåˆ—åŒ–æŠ€æœ¯

å¯¹è±¡åºåˆ—åŒ–ï¼šå°±æ˜¯æŠŠJavaå¯¹è±¡æ•°æ®ç›´æ¥å­˜å‚¨åˆ°æ–‡ä»¶ä¸­å»ã€‚

å¯¹è±¡ååºåˆ—åŒ–ï¼šå°±æ˜¯æŠŠJavaå¯¹è±¡çš„æ–‡ä»¶æ•°æ®æ¢å¤åˆ°Javaå¯¹è±¡ä¸­å»ã€‚

å¯¹è±¡åºåˆ—åŒ–æµ(å¯¹è±¡å­—èŠ‚è¾“å‡ºæµ)ï¼šObjectOutputStream

ä½œç”¨ï¼šæŠŠå†…å­˜ä¸­çš„Javaå¯¹è±¡æ•°æ®ä¿å­˜åˆ°æ–‡ä»¶ä¸­å»ã€‚

æ„é€ å™¨ï¼špublic ObjectOutputStream(OutputStream out)

åºåˆ—åŒ–æ–¹æ³•ï¼špublic final void writeObject(Object obj)

æ³¨æ„ï¼šå¦‚æœè¦åºåˆ—åŒ–å¯¹è±¡ï¼Œé‚£ä¹ˆå¯¹è±¡å¿…é¡»å®ç°åºåˆ—åŒ–æ¥å£ï¼šimplements Serializableã€‚

```Java
import java.io.FileOutputStream;
import java.io.ObjectOutputStream;
import java.io.OutputStream;

public class SerializeDemo {
    public static void main(String[] args) throws Exception {
        User user = new User("é“æ‰‡å…¬ä¸»","003197","é“æ‰‡å…¬ä¸»");
        OutputStream os = new FileOutputStream("Day05Demo\\src\\obj.dat");
        ObjectOutputStream oos = new ObjectOutputStream(os);
        oos.writeObject(user);
        oos.close();
        System.out.println("åºåˆ—åŒ–æˆåŠŸ~~~");
    }
}
```

å¯¹è±¡ååºåˆ—åŒ–(å¯¹è±¡å­—èŠ‚è¾“å…¥æµ)ï¼šObjectInputStream

ä½œç”¨ï¼šè¯»å–åºåˆ—åŒ–çš„å¯¹è±¡æ–‡ä»¶æ¢å¤åˆ°Javaå¯¹è±¡ä¸­ã€‚

æ„é€ å™¨ï¼špublic ObjectInputStream(InputStream is)

æ–¹æ³•ï¼špublic final Object readObject()

æ³¨æ„ï¼štransientä¿®é¥°çš„æˆå‘˜å˜é‡å°†ä¸å‚ä¸åºåˆ—åŒ–ã€‚

å¯¹è±¡å‡å¦‚åºåˆ—ç‰ˆæœ¬å·ï¼šprivate static final long serialVersionUID = 2L;

ååºåˆ—åŒ–ä½¿ç”¨çš„å¯¹è±¡ç‰ˆæœ¬å·å¿…é¡»ä¸åºåˆ—åŒ–ä½¿ç”¨çš„ç‰ˆæœ¬å·ä¸€è‡´æ‰ä¸ä¼šæŠ¥é”™ã€‚

```Java
import java.io.FileInputStream;
import java.io.InputStream;
import java.io.ObjectInputStream;

public class SerializeDemo01 {
    public static void main(String[] args) throws Exception {
        InputStream is = new FileInputStream("Day05Demo\\src\\obj.dat");
        ObjectInputStream ois = new ObjectInputStream(is);
        User user = (User) ois.readObject();
        System.out.println(user);
        System.out.println("ååºåˆ—åŒ–å®Œæˆ~~~");
    }
}
```

### 22.7 æ‰“å°æµ

æ‰“å°æµï¼šPrintStream/PrintWriterã€‚

æ‰“å°æµçš„ä½œç”¨

- å¯ä»¥æ–¹ä¾¿ï¼Œå¿«é€Ÿçš„å†™æ•°æ®å‡ºå»
- å¯ä»¥å®ç°æ‰“å°å•¥å‡ºå»ï¼Œå°±æ˜¯å•¥å‡ºå»

æ‰“å°æµçš„æ„é€ å™¨

- public PrintStream(OutputStream os)
- public PrintStream(String filepath)

å°ç»“

- PrintStreamå¯ä»¥æ–¹ä¾¿å¿«é€Ÿæ‰“å°æ•°æ®å‡ºå»ï¼ŒåŒæ—¶å¯ä»¥å†™å­—èŠ‚è¾“å‡º
- PrintWriterå¯ä»¥æ–¹ä¾¿å¿«é€Ÿæ‰“å°æ•°æ®å‡ºå»ï¼ŒåŒæ—¶å¯ä»¥å†™å­—ç¬¦è¾“å‡º

```Java
import java.io.FileOutputStream;
import java.io.OutputStream;
import java.io.PrintStream;

public class PrintStreamDemo {
    public static void main(String[] args) throws Exception {
        OutputStream os = new FileOutputStream("Day05Demo\\src\\dlei02.txt");
        PrintStream ps = new PrintStream(os);

        ps.println(97);
        ps.println(110);
        ps.println("Javaæ˜¯æœ€ä¼˜ç¾çš„è¯­è¨€");
        ps.println(99.8);
        ps.println(false);
        ps.println('ä¸­');
        ps.close();
    }
}
```

æ‰“å°æµæ”¹å˜è¾“å‡ºçš„æµå‘ï¼Œé‡å®šå‘ã€‚

```Java
import java.io.PrintStream;

public class PrintStreamDemo {
    public static void main(String[] args) throws Exception {
        PrintStream ps = new PrintStream("Day05Demo\\src\\log.txt");
        System.setOut(ps);

        System.out.println("==Hello==");
        System.out.println("==World==");
        System.out.println("==Java==");
        System.out.println("==JavaSE==");
    }
}
```

### 22.8 Properties

Propertiesï¼šå±æ€§é›†å¯¹è±¡ã€‚

å…¶å®å°±æ˜¯ä¸€ä¸ªMapé›†åˆã€‚ä¹Ÿå°±æ˜¯ä¸€ä¸ªé”®å€¼å¯¹é›†åˆã€‚ä½†æ˜¯æˆ‘ä»¬ä¸€èˆ¬ä¸ä¼šå½“é›†åˆä½¿ç”¨ï¼Œå› ä¸ºæœ‰HashMapã€‚

Propertiesæ ¸å¿ƒä½œç”¨

- Propertiesä»£è¡¨çš„æ˜¯ä¸€ä¸ªå±æ€§æ–‡ä»¶ï¼Œå¯ä»¥æŠŠé”®å€¼å¯¹çš„æ•°æ®å­˜å…¥åˆ°ä¸€ä¸ªå±æ€§æ–‡ä»¶ä¸­å»ã€‚
- å±æ€§æ–‡ä»¶ï¼šåç¼€æ˜¯.propertiesç»“å°¾çš„æ–‡ä»¶ï¼Œé‡Œé¢çš„å†…å®¹éƒ½æ˜¯key=valueã€‚

å±æ€§é›†å¯¹è±¡Propertieså®é™…ä¸Šæ˜¯ä¸€ä¸ªMapé›†åˆï¼Œå¯ä»¥å®ç°æŠŠé”®å€¼å¯¹æ•°æ®ä¿å­˜åˆ°å±æ€§æ–‡ä»¶ä¸­å»ã€‚

```Java
import java.io.FileOutputStream;
import java.io.OutputStream;
import java.util.Properties;

public class PropertiesDemo {
    public static void main(String[] args) throws Exception {
        Properties properties = new Properties();
        properties.setProperty("admin","123456");
        properties.setProperty("dlei","101333");
        System.out.println(properties);

        OutputStream os = new FileOutputStream("Day05Demo\\src\\user.properties");
        properties.store(os,"ä¿å­˜ç”¨æˆ·æ•°æ®");
    }
}
```

Propertiesè¯»å–å±æ€§æ–‡ä»¶ä¸­çš„é”®å€¼å¯¹ä¿¡æ¯

```Java
import java.io.FileInputStream;
import java.util.Properties;

public class PropertiesDemo {
    public static void main(String[] args) throws Exception {
        Properties properties = new Properties();
        System.out.println(properties);

        properties.load(new FileInputStream("Day05Demo\\src\\user.properties"));
        System.out.println(properties);

        System.out.println(properties.getProperty("dlei"));
    }
}
```

## 23. ç¼–ç¨‹æ€ç»´æ‹“å±•

å•¤é…’é—®é¢˜ï¼šå•¤é…’2å…ƒä¸€ç“¶ï¼Œ4ä¸ªç›–å­å¯ä»¥æ¢ä¸€ç“¶ï¼Œ2ä¸ªç©ºç“¶å¯ä»¥æ¢ä¸€ç“¶ã€‚

```Java
public class BeerDemo {
    public static int totalNum;
    public static int lastPingZiNum;
    public static int lastGaiZiNum;

    public static void main(String[] args) {
        buyBeer(10);
        System.out.println("æ€»æ•°ï¼š" + totalNum);
        System.out.println("å‰©ä½™ç›–å­ï¼š" + lastGaiZiNum);
        System.out.println("å‰©ä½™ç“¶å­ï¼š" + lastPingZiNum);
    }

    public static void buyBeer(int money) {
        int number = money / 2;
        totalNum += number;

        int currentPingZiNum = lastPingZiNum + number;
        int currentGaiZiNum = lastGaiZiNum + number;

        int totalMoney = 0;
        totalMoney += (currentPingZiNum / 2) * 2;
        lastPingZiNum = currentPingZiNum % 2;

        totalMoney += (currentGaiZiNum / 4) * 2;
        lastGaiZiNum = currentGaiZiNum % 4;

        if (totalMoney >= 2) {
            buyBeer(totalMoney);
        }
    }
}
```

å¤åˆ¶æ–‡ä»¶å¤¹

```Java
import java.io.*;

public class CopyDirDemo {
    public static void main(String[] args) {
        CopyDir(new File("D:\\letsvpn"), new File("F:\\copylets"));
    }

    public static void CopyDir(File srcDir, File destDir) {
        if (srcDir.exists() && srcDir.isDirectory()) {
            destDir.mkdirs();
            File[] files = srcDir.listFiles();
            if (files != null && files.length > 0) {
                for (File file : files) {
                    if (file.isFile()) {
                        copyFile(file,new File(destDir,file.getName()));
                    } else {
                        CopyDir(file,new File(destDir,file.getName()));
                    }
                }
            }
        }
    }

    private static void copyFile(File srcFile, File destFile) {
        try (
                BufferedInputStream bis = new BufferedInputStream(new FileInputStream(srcFile));
                BufferedOutputStream bos = new BufferedOutputStream(new FileOutputStream(destFile))
        ) {
            byte[] buffer = new byte[1024];
            int len;
            while ((len = bis.read(buffer)) != -1) {
                bos.write(buffer,0,len);
            }
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
```

## 24. ç½‘ç»œé€šä¿¡

### 24.1 æ¦‚è¿°

é€šä¿¡ä¸€å®šæ˜¯åŸºäºè½¯ä»¶ç»“æ„å®ç°çš„

- C/Sç»“æ„ï¼šå…¨ç§°ä¸ºClient/Serverç»“æ„ï¼Œæ˜¯æŒ‡å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯ç»“æ„ã€‚
  - å¸¸è§ç¨‹åºæœ‰QQã€è¿…é›·ã€IDEAç­‰
- B/Sç»“æ„ï¼šå…¨ç§°ä¸ºBrowser/Serverç»“æ„ï¼Œæ˜¯æŒ‡æµè§ˆå™¨å’ŒæœåŠ¡å™¨ç»“æ„ã€‚
  - å¸¸è§æµè§ˆå™¨æœ‰è°·æ­Œã€ç«ç‹ç­‰ã€ç½‘ç«™æœ‰äº¬ä¸œã€æ·˜å®ç­‰
  - å¼€å‘ä¸­çš„é‡ç‚¹ï¼ŒåŸºäºç½‘é¡µè®¾è®¡é¡µé¢ï¼Œç•Œé¢æ•ˆæœå¯ä»¥æ›´ä¸°å¯Œï¼šJava Webå¼€å‘

ä¸¤ç§æ¶æ„å„æœ‰ä¼˜åŠ¿ï¼Œä½†æ˜¯æ— è®ºå“ªç§æ¶æ„ï¼Œéƒ½ç¦»ä¸å¼€ç½‘ç»œçš„æ”¯æŒã€‚ç½‘ç»œç¼–ç¨‹ï¼Œå°±æ˜¯åœ¨ä¸€å®šçš„åè®®ä¸‹ï¼Œå®ç°ä¸¤å°è®¡ç®—æœºçš„é€šä¿¡æŠ€æœ¯ã€‚

ç½‘ç»œé€šä¿¡çš„ä¸‰è¦ç´ 

1. åè®®ï¼šè®¡ç®—æœºç½‘ç»œå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯é€šä¿¡å¿…é¡»äº‹å…ˆçº¦å®šå’Œå½¼æ­¤éµå®ˆçš„é€šä¿¡è§„åˆ™ã€‚HTTPï¼ŒFTPï¼ŒTCPï¼ŒUDPï¼ŒSSHï¼ŒSMTPã€‚
2. IPåœ°å€ï¼šæŒ‡äº’è”ç½‘åè®®åœ°å€(Internet Protocol Address)ï¼Œä¿—ç§°IPã€‚IPåœ°å€ç”¨æ¥ç»™ä¸€ä¸ªç½‘ç»œä¸­çš„è®¡ç®—æœºè®¾å¤‡åšå”¯ä¸€çš„ç¼–å·ã€‚
   - IPv4ï¼š4ä¸ªå­—èŠ‚ï¼Œ32ä½ç»„æˆã€‚
   - IPv6ï¼šå¯ä»¥å®ç°ä¸ºæ‰€æœ‰è®¾å¤‡åˆ†é…IPï¼Œ128ä½ã€‚
   - æ³¨æ„ï¼šç‰¹æ®Šçš„IPåœ°å€ï¼šæœ¬æœºIPåœ°å€ã€‚(ä¸å—ç¯å¢ƒçš„å½±å“ï¼Œä»»ä½•æ—¶å€™éƒ½å­˜åœ¨è¿™ä¸¤ä¸ªIPï¼Œå¯ä»¥ç›´æ¥æ‰¾æœ¬æœºã€‚)127.0.0.1 == localhostã€‚
3. ç«¯å£ï¼šç«¯å£å·å°±å¯ä»¥å”¯ä¸€æ ‡è¯†è®¾å¤‡ä¸­çš„è¿›ç¨‹(åº”ç”¨ç¨‹åº)ã€‚
   - ç«¯å£å·ï¼šç”¨ä¸¤ä¸ªå­—èŠ‚è¡¨ç¤ºçš„æ•´æ•°ï¼Œå®ƒçš„å–å€¼èŒƒå›´æ˜¯0~65535ã€‚
   - 0~1023ä¹‹é—´çš„ç«¯å£å·ç”¨äºä¸€äº›çŸ¥åçš„ç½‘ç»œæœåŠ¡å’Œåº”ç”¨ã€‚
   - å¦‚æœç«¯å£å·è¢«å¦å¤–ä¸€ä¸ªæœåŠ¡æˆ–åº”ç”¨æ‰€å ç”¨ï¼Œä¼šå¯¼è‡´å½“å‰ç¨‹åºå¯åŠ¨å¤±è´¥ã€‚æŠ¥å‡ºç«¯å£è¢«å ç”¨å¼‚å¸¸ã€‚

TCP/IPåè®®ï¼šä¼ è¾“æ§åˆ¶åè®®(Transmission Control Protocol)ã€‚

- TCPåè®®æ˜¯é¢å‘è¿æ¥çš„å®‰å…¨çš„å¯é çš„ä¼ è¾“é€šä¿¡åè®®
- åœ¨é€šä¿¡ä¹‹å‰å¿…é¡»ç¡®å®šå¯¹æ–¹åœ¨çº¿å¹¶ä¸”è¿æ¥æˆåŠŸæ‰å¯ä»¥é€šä¿¡
- ä¾‹å¦‚ä¸‹è½½æ–‡ä»¶ã€æµè§ˆç½‘é¡µç­‰(è¦æ±‚å¯é ä¼ è¾“)

UDPï¼šç”¨æˆ·æ•°æ®æŠ¥åè®®(User Datagram Protocol)ã€‚

- UDPåè®®æ˜¯ä¸€ä¸ªé¢å‘æ— è¿æ¥çš„ä¸å¯é ä¼ è¾“çš„åè®®
- ç›´æ¥å‘æ¶ˆæ¯ç»™å¯¹æ–¹ï¼Œä¸ç®¡å¯¹æ–¹æ˜¯å¦åœ¨çº¿ï¼Œå‘æ¶ˆæ¯åä¹Ÿä¸éœ€è¦ç¡®è®¤
- æ— çº¿(è§†é¢‘ä¼šè®®ï¼Œé€šè¯)ï¼Œæ€§èƒ½å¥½ï¼Œå¯èƒ½ä¸¢å¤±ä¸€äº›æ•°æ®

### 24.2 é€šä¿¡ç¼–ç¨‹åŸºç¡€

InetAddressç±»ï¼šä¸€ä¸ªè¯¥ç±»çš„å¯¹è±¡å°±ä»£è¡¨ä¸€ä¸ªIPåœ°å€å¯¹è±¡ã€‚

InetAddressç±»æˆå‘˜æ–¹æ³•

- static InetAddress getLocalHost()ï¼šè·å¾—æœ¬åœ°ä¸»æœºIPåœ°å€å¯¹è±¡ã€‚
- static InetAddress getByName(String host)ï¼šæ ¹æ®IPåœ°å€å­—ç¬¦ä¸²æˆ–ä¸»æœºåè·å¾—å¯¹åº”çš„IPåœ°å€å¯¹è±¡ã€‚
- String getHostName()ï¼šè·å¾—ä¸»æœºåã€‚
- String getHostAddress()ï¼šè·å¾—IPåœ°å€å­—ç¬¦ä¸²ã€‚

```Java
import java.net.InetAddress;

public class InetAddressDemo {
    public static void main(String[] args) throws Exception {
        InetAddress ip = InetAddress.getLocalHost();
        System.out.println(ip.getHostName());
        System.out.println(ip.getHostAddress());

        InetAddress ip1 = InetAddress.getByName("www.baidu.com");
        System.out.println(ip1.getHostName());
        System.out.println(ip1.getHostAddress());

        System.out.println(ip1.isReachable(5000));
    }
}
```

UDPé€šä¿¡

å®¢æˆ·ç«¯ç¨‹åº

```Java
import java.net.DatagramPacket;
import java.net.DatagramSocket;
import java.net.InetAddress;

public class UDPClientDemo {
    public static void main(String[] args) throws Exception {
        System.out.println("==å¯åŠ¨å®¢æˆ·ç«¯ç¨‹åº==");
        byte[] buffer = "ä»Šæ™šæœˆè‰²çœŸç¾ï¼".getBytes();
        DatagramPacket packet = new DatagramPacket(buffer,buffer.length, InetAddress.getLocalHost(),6666);
        DatagramSocket socket = new DatagramSocket(8888);
        socket.send(packet);
        socket.close();
    }
}
```

æœåŠ¡ç«¯ç¨‹åº

```Java
import java.net.DatagramPacket;
import java.net.DatagramSocket;

public class UDPServerDemo {
    public static void main(String[] args) throws Exception {
        System.out.println("==å¯åŠ¨æœåŠ¡ç«¯ç¨‹åº==");
        byte[] buffer = new byte[1024*64];
        DatagramPacket packet = new DatagramPacket(buffer,buffer.length);
        DatagramSocket socket = new DatagramSocket(6666);
        socket.receive(packet);
        int len = packet.getLength();
        String rs = new String(buffer,0,len);
        System.out.println(rs);

        String ip = packet.getAddress().getHostAddress();
        int port = packet.getPort();
        System.out.println("å¯¹æ–¹ï¼š" + ip + "ï¼š" + port);
        socket.close();
    }
}
```

TCPåè®®ç›¸å…³çš„ç±»

- Socketï¼šä¸€ä¸ªè¯¥ç±»çš„å¯¹è±¡å°±ä»£è¡¨ä¸€ä¸ªå®¢æˆ·ç«¯ç¨‹åºã€‚
- ServerSocketï¼šä¸€ä¸ªè¯¥ç±»çš„å¯¹è±¡å°±ä»£è¡¨ä¸€ä¸ªæœåŠ¡å™¨ç«¯ç¨‹åºã€‚

TCPé€šä¿¡ä¹Ÿå«Socketç½‘ç»œç¼–ç¨‹ï¼Œåªè¦ä»£ç åŸºäºSocketå¼€å‘ï¼Œåº•å±‚å°±æ˜¯åŸºäºäº†å¯é ä¼ è¾“çš„TCPé€šä¿¡ã€‚

å®¢æˆ·ç«¯å¼€å‘æµç¨‹

- å®¢æˆ·ç«¯è¦æ±‚è¯·æ±‚äºæœåŠ¡ç«¯çš„socketç®¡é“è¿æ¥ã€‚
- ä»socketé€šä¿¡ç®¡é“ä¸­å¾—åˆ°ä¸€ä¸ªå­—èŠ‚è¾“å…¥æµã€‚
- é€šè¿‡å­—èŠ‚è¾“å…¥æµç»™æœåŠ¡ç«¯å†™å‡ºæ•°æ®ã€‚

æœåŠ¡ç«¯çš„å¼€å‘æµç¨‹

- æ³¨å†Œç«¯å£ã€‚
- æ¥æ”¶å®¢æˆ·ç«¯çš„socketç®¡é“è¿æ¥ã€‚
- ä»socketé€šä¿¡ç®¡é“ä¸­å¾—åˆ°ä¸€ä¸ªå­—èŠ‚è¾“å…¥æµã€‚
- ä»å­—èŠ‚è¾“å…¥æµä¸­è¯»å–å®¢æˆ·ç«¯å‘æ¥çš„æ•°æ®ã€‚

ç»ƒä¹ æ¡ˆä¾‹ï¼šå®¢æˆ·ç«¯å‘é€ä¸€è¡Œæ•°æ®ï¼ŒæœåŠ¡ç«¯æ¥æ”¶ä¸€è¡Œæ•°æ®ã€‚

å®¢æˆ·ç«¯ç¨‹åº

```Java
import java.io.OutputStream;
import java.io.PrintStream;
import java.net.Socket;

public class ClientDemo {
    public static void main(String[] args) throws Exception {
        Socket socket = new Socket("10.100.159.153",8888);
        OutputStream os = socket.getOutputStream();
        PrintStream ps = new PrintStream(os);
        ps.println("æˆ‘æ˜¯å®¢æˆ·ç«¯ï¼Œç¬¬ä¸€æ¬¡ç»™ä½ å‘æ¶ˆæ¯ï¼Œåªæƒ³è¯´ï¼šåˆæ¬¡è§é¢ï¼Œè¯·å¤šå…³ç…§ï¼");
        ps.flush();
        System.out.println("å®¢æˆ·ç«¯å‘é€å®Œæ¯•~~~");
    }
}
```

æœåŠ¡ç«¯ç¨‹åº

```Java
import java.io.BufferedReader;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.io.Reader;
import java.net.ServerSocket;
import java.net.Socket;

public class ServerDemo {
    public static void main(String[] args) throws Exception {
        System.out.println("---æœåŠ¡ç«¯å¯åŠ¨---");
        ServerSocket ss = new ServerSocket(8888);
        Socket socket = ss.accept();
        InputStream is = socket.getInputStream();
        Reader isr = new InputStreamReader(is);
        BufferedReader br = new BufferedReader(isr);
        String msg;
        if ((msg = br.readLine()) != null) {
            System.out.println("æ”¶åˆ°ï¼š" + msg);
        }
    }
}
```

å®ç°åå¤å‘é€å’Œæ¥æ”¶æ¶ˆæ¯

æœåŠ¡ç«¯ä¿®æ”¹éƒ¨åˆ†ä»£ç 

```Java
while ((msg = br.readLine()) != null) {
    System.out.println("æ”¶åˆ°ï¼š" + msg);
}
```

å®¢æˆ·ç«¯ä»£ç 

```Java
import java.io.OutputStream;
import java.io.PrintStream;
import java.net.Socket;
import java.util.Scanner;

public class ClientDemo01 {
    public static void main(String[] args) throws Exception {
        Socket socket = new Socket("10.100.159.153",8888);
        OutputStream os = socket.getOutputStream();
        PrintStream ps = new PrintStream(os);
        while (true) {
            Scanner sc = new Scanner(System.in);
            System.out.println("è¯·è¯´ï¼š");
            ps.println(sc.nextLine());
            ps.flush();
        }
    }
}
```

å®ç°ä¸€ä¸ªæœåŠ¡ç«¯å¯ä»¥æ¥æ”¶å¤šä¸ªå®¢æˆ·ç«¯æ¶ˆæ¯

å®¢æˆ·ç«¯ç¨‹åºä»£ç å¦‚ä¸Šï¼Œæ— éœ€ä¿®æ”¹

æœåŠ¡å™¨ç«¯ç¨‹åºä»£ç 

```Java
import java.io.BufferedReader;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.io.Reader;
import java.net.ServerSocket;
import java.net.Socket;

public class ServerDemo01 {
    public static void main(String[] args) throws Exception {
        System.out.println("---æœåŠ¡ç«¯å¯åŠ¨---");
        ServerSocket ss = new ServerSocket(8888);
        while (true) {
            Socket socket = ss.accept();
            new ServerReaderThread(socket).start();
        }
    }
}

class ServerReaderThread extends Thread {
    private Socket socket;
    public ServerReaderThread(Socket socket) {
        this.socket = socket;
    }

    @Override
    public void run() {
        try {
            InputStream is = socket.getInputStream();
            Reader isr = new InputStreamReader(is);
            BufferedReader br = new BufferedReader(isr);
            String msg;
            while ((msg = br.readLine()) != null) {
                System.out.println(socket.getRemoteSocketAddress() + "è¯´ï¼š" + msg);
            }
        } catch (Exception e) {
            System.out.println(socket.getRemoteSocketAddress() + "ä¸‹çº¿äº†~~~");
        }
    }
}
```

å¼•å…¥ï¼šæˆ‘ä»¬ä¹‹å‰å¼•å…¥çš„çº¿ç¨‹è§£å†³ä¸€ä¸ªæœåŠ¡ç«¯å¯ä»¥æ¥æ”¶å¤šä¸ªå®¢æˆ·ç«¯æ¶ˆæ¯ï¼Œå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯çš„çº¿ç¨‹æ¨¡å‹æ˜¯ï¼šN-Nçš„å…³ç³»ã€‚ä¸€ä¸ªå®¢æˆ·ç«¯è¦ä¸€ä¸ªçº¿ç¨‹ã€‚è¿™ç§æ¨¡å‹æ˜¯ä¸è¡Œçš„ï¼Œå¹¶å‘è¶Šé«˜ï¼Œç³»ç»Ÿç˜«ç—ªè¶Šå¿«ã€‚

è§£å†³ï¼šæˆ‘ä»¬å¯ä»¥åœ¨æœåŠ¡ç«¯å¼•å…¥çº¿ç¨‹æ± ï¼Œä½¿ç”¨çº¿ç¨‹æ± æ¥å¤„ç†ä¸å®¢æˆ·ç«¯çš„æ¶ˆæ¯é€šä¿¡ã€‚çº¿ç¨‹æ± ä¸ä¼šå¼•èµ·å‡ºç°è¿‡å¤šçš„çº¿ç¨‹è€Œå¯¼è‡´ç³»ç»Ÿæ­»æœºã€‚

ä¼˜åŠ£åŠ¿

- ä¼˜åŠ¿ï¼šä¸ä¼šå¼•èµ·ç³»ç»Ÿçš„æ­»æœºï¼Œå¯ä»¥æ§åˆ¶å¹¶å‘çº¿ç¨‹çš„æ•°é‡ã€‚
- åŠ£åŠ¿ï¼šåŒæ—¶å¯ä»¥å¹¶å‘çš„çº¿ç¨‹å°†å—åˆ°é™åˆ¶ã€‚

ä½¿ç”¨çº¿ç¨‹æ± å®ç°å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯äº¤äº’

å®¢æˆ·ç«¯ç¨‹åº

```Java
import java.io.OutputStream;
import java.io.PrintStream;
import java.net.Socket;
import java.util.Scanner;

public class ClientDemo {
    public static void main(String[] args) throws Exception {
        Socket socket = new Socket("10.100.159.153",8888);
        OutputStream os = socket.getOutputStream();
        PrintStream ps = new PrintStream(os);
        while (true) {
            Scanner sc = new Scanner(System.in);
            System.out.println("è¯·è¯´ï¼š");
            ps.println(sc.nextLine());
            ps.flush();
        }
    }
}
```

æœåŠ¡å™¨ç«¯ç¨‹åº

```Java
import java.net.ServerSocket;
import java.net.Socket;

public class ServerDemo {
    public static void main(String[] args) {
        try {
            System.out.println("---æœåŠ¡ç«¯å¯åŠ¨---");
            ServerSocket ss = new ServerSocket(8888);
            HandlerSocketThreadPool handlerSocketThreadPool = new HandlerSocketThreadPool(3,100);
            while (true) {
                Socket socket = ss.accept();
                System.out.println("æœ‰äººä¸Šçº¿äº†ï¼ï¼");
                handlerSocketThreadPool.execute(new ReaderClientRunnable(socket));
            }
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
```

çº¿ç¨‹ä»»åŠ¡ç±»

```Java
import java.io.BufferedReader;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.io.Reader;
import java.net.Socket;

public class ReaderClientRunnable implements Runnable {
    private Socket socket;
    public ReaderClientRunnable(Socket socket) {
        this.socket = socket;
    }

    @Override
    public void run() {
        try {
            InputStream is = socket.getInputStream();
            Reader isr = new InputStreamReader(is);
            BufferedReader br = new BufferedReader(isr);
            String msg;
            while ((msg = br.readLine()) != null) {
                System.out.println(socket.getRemoteSocketAddress() + "è¯´ï¼š" + msg);
            }
        } catch (Exception e) {
            System.out.println(socket.getRemoteSocketAddress() + "ä¸‹çº¿äº†~~~");
        }
    }
}
```

çº¿ç¨‹æ± ç±»

```Java
import java.util.concurrent.ArrayBlockingQueue;
import java.util.concurrent.ExecutorService;
import java.util.concurrent.ThreadPoolExecutor;
import java.util.concurrent.TimeUnit;

public class HandlerSocketThreadPool {
    private ExecutorService executor;
    public HandlerSocketThreadPool(int maxPoolSize, int queueSize) {
        this.executor = new ThreadPoolExecutor(
                maxPoolSize,
                maxPoolSize,
                120L,
                TimeUnit.SECONDS,
                new ArrayBlockingQueue<Runnable>(queueSize)
        );
    }

    public void execute(Runnable task) {
        this.executor.execute(task);
    }
}
```

ç»ƒä¹ æ¡ˆä¾‹ï¼šå›¾ç‰‡ä¸Šä¼ ã€‚

å®¢æˆ·ç«¯ç¨‹åº

```Java
import java.io.*;
import java.net.Socket;

public class ClientDemo {
    public static final String SRC_IMAGE = "D:\\Photo\\MyImages2.jpg";

    public static void main(String[] args) throws Exception {
        Socket socket = new Socket("10.100.159.153",7777);
        OutputStream os = socket.getOutputStream();
        BufferedOutputStream bos = new BufferedOutputStream(os);
        BufferedInputStream bis = new BufferedInputStream(new FileInputStream(SRC_IMAGE));

        byte[] buffer = new byte[1024];
        int len;
        while ((len = bis.read(buffer)) != -1) {
            bos.write(buffer,0,len);
        }
        bos.flush();
        bis.close();
        socket.shutdownOutput();
        System.out.println("ä¼ è¾“å›¾ç‰‡æ•°æ®æˆåŠŸäº†ï¼ï¼ï¼");

        BufferedReader br = new BufferedReader(new InputStreamReader(socket.getInputStream()));
        System.out.println(br.readLine());
    }
}
```

æœåŠ¡å™¨ç«¯ç¨‹åº

```Java
import java.io.*;
import java.net.ServerSocket;
import java.net.Socket;
import java.util.UUID;

public class ServerDemo {
    public static final String DEST_FILE = "F:\\TestUP\\";
    public static void main(String[] args) throws Exception {
        System.out.println("---æœåŠ¡ç«¯å¯åŠ¨---");
        ServerSocket ss = new ServerSocket(7777);
        while (true) {
            Socket socket = ss.accept();
            System.out.println(socket.getRemoteSocketAddress() + "æ¥äº†ï¼Œè€å¼Ÿï¼");
            new ServerReaderThread(socket).start();
        }
    }
}

class ServerReaderThread extends Thread {
    private Socket socket;
    public ServerReaderThread(Socket socket) {
        this.socket = socket;
    }

    @Override
    public void run() {
        try {
            InputStream is = socket.getInputStream();
            BufferedInputStream bis = new BufferedInputStream(is);
            BufferedOutputStream bos = new BufferedOutputStream(new FileOutputStream(ServerDemo.DEST_FILE + UUID.randomUUID().toString() + ".jpg"));
            byte[] buffer = new byte[1024];
            int len;
            while ((len = bis.read(buffer)) != -1) {
                bos.write(buffer,0,len);
            }
            bos.flush();
            bos.close();

            PrintStream ps = new PrintStream(socket.getOutputStream());
            ps.println("äº²çˆ±çš„å®¢æˆ·ç«¯ï¼Œæˆ‘å·²ç»æ”¶åˆ°ä½ çš„å›¾ç‰‡ï¼Œè°¢è°¢");
            ps.flush();

            Thread.sleep(10000);
        } catch (Exception e) {
            System.out.println(socket.getRemoteSocketAddress() + "ä¸‹çº¿äº†~~~");
        }
    }
}
```

### 24.3 BSæ¶æ„æ¨¡æ‹Ÿ

å®¢æˆ·ç«¯ï¼šæµè§ˆå™¨

æœåŠ¡ç«¯ï¼šè‡ªå·±å¼€å‘

éœ€æ±‚ï¼šåœ¨æµè§ˆå™¨ä¸­è¯·æ±‚æœ¬ç¨‹åºï¼Œå“åº”ä¸€ä¸ªç½‘é¡µæ–‡å­—ç»™æµè§ˆå™¨æ˜¾ç¤ºã€‚

æœåŠ¡å™¨ç«¯ç¨‹åºä»£ç å¦‚ä¸‹

```Java
import java.io.PrintStream;
import java.net.ServerSocket;
import java.net.Socket;

public class BSserverDemo {
    public static void main(String[] args) {
        try {
            ServerSocket ss = new ServerSocket(8080);
            while (true) {
                Socket socket = ss.accept();
                new ServerReaderThread(socket).start();
            }
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}

class ServerReaderThread extends Thread {
    private Socket socket;
    public ServerReaderThread(Socket socket) {
        this.socket = socket;
    }

    @Override
    public void run() {
        try {
            PrintStream ps = new PrintStream(socket.getOutputStream());
            ps.println("HTTP/1.1 200 OK");
            ps.println("Content-Type:text/html;charset=UTF-8");
            ps.println();

            ps.println("<span style='color:green;font-size:60px;'>ä¼˜ç§€çš„Javaè¯­è¨€æ˜¯ä¸–ç•Œä¸Šæœ€å¥½çš„è¯­è¨€!!</span>");
            Thread.sleep(3000);
            ps.close();
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
```

### 24.4 é€šä¿¡æ¨¡å‹

1.BIOé€šä¿¡æ¨¡å¼ï¼šåŒæ­¥é˜»å¡å¼é€šä¿¡ã€‚(Socketç½‘ç»œç¼–ç¨‹ä¹Ÿå°±æ˜¯ä¸Šé¢çš„é€šä¿¡æ¶æ„)

- åŒæ­¥ã€å¼‚æ­¥ã€é˜»å¡ã€éé˜»å¡

2.ä¼ªå¼‚æ­¥é€šä¿¡ï¼šå¼•å…¥äº†çº¿ç¨‹æ± ã€‚

3.NIOè¡¨ç¤ºåŒæ­¥éé˜»å¡IOï¼ŒæœåŠ¡å™¨å®ç°æ¨¡å¼ä¸ºè¯·æ±‚å¯¹åº”ä¸€ä¸ªçº¿ç¨‹ï¼Œå³å®¢æˆ·ç«¯å‘é€çš„è¿æ¥è¯·æ±‚éƒ½ä¼šæ³¨å†Œåˆ°å¤šè·¯å¤ç”¨å™¨ä¸Šï¼Œå¤šè·¯å¤ç”¨å™¨è½®è¯¢åˆ°è¿æ¥æœ‰I/Oè¯·æ±‚æ—¶æ‰å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œå¤„ç†ã€‚

4.AIOè¡¨ç¤ºå¼‚æ­¥éé˜»å¡IOï¼ŒæœåŠ¡å™¨å®ç°æ¨¡å¼ä¸ºä¸€ä¸ªæœ‰æ•ˆè¯·æ±‚ä¸€ä¸ªçº¿ç¨‹ï¼Œå®¢æˆ·ç«¯çš„I/Oè¯·æ±‚éƒ½æ˜¯ç”±æ“ä½œç³»ç»Ÿå…ˆå®ŒæˆIOæ“ä½œåå†é€šçŸ¥æœåŠ¡å™¨åº”ç”¨æ¥å¯åŠ¨çº¿ç¨‹è¿›è¡Œå¤„ç†ã€‚

åº”ç”¨åœºæ™¯

- BIOé€‚ç”¨äºè¿æ¥æ•°ç›®æ¯”è¾ƒå°ä¸”å›ºå®šçš„æ¶æ„ï¼Œè¯¥æ–¹å¼å¯¹æœåŠ¡å™¨èµ„æºè¦æ±‚æ¯”è¾ƒé«˜ï¼ŒJDK 1.4ä»¥å‰çš„å”¯ä¸€é€‰æ‹©ã€‚
- NIOé€‚ç”¨äºè¿æ¥æ•°ç›®å¤šä¸”è¿æ¥æ¯”è¾ƒçŸ­(è½»æ“ä½œ)çš„æ¶æ„ï¼Œå¦‚èŠå¤©æœåŠ¡å™¨ï¼Œç¼–ç¨‹å¤æ‚ï¼ŒJDK 1.4å¼€å§‹æ”¯æŒã€‚
- AIOé€‚ç”¨äºè¿æ¥æ•°ç›®å¤šä¸”è¿æ¥æ¯”è¾ƒé•¿(é‡æ“ä½œ)çš„æ¶æ„ï¼Œå¦‚ç›¸å†ŒæœåŠ¡å™¨ï¼Œå……åˆ†è°ƒç”¨æ“ä½œç³»ç»Ÿå‚ä¸å¹¶å‘æ“ä½œï¼Œç¼–ç¨‹å¤æ‚ï¼ŒJDK 1.7å¼€å§‹æ”¯æŒã€‚

## 25. å•å…ƒæµ‹è¯•

å•å…ƒæµ‹è¯•æ˜¯æŒ‡ç¨‹åºå‘˜å†™çš„æµ‹è¯•ä»£ç ç»™è‡ªå·±çš„ç±»ä¸­çš„æ–¹æ³•è¿›è¡Œé¢„æœŸæ­£ç¡®æ€§çš„éªŒè¯ã€‚

å•å…ƒæµ‹è¯•ä¸€æ—¦å†™å¥½äº†è¿™äº›æµ‹è¯•ä»£ç ï¼Œå°±å¯ä»¥ä¸€ç›´ä½¿ç”¨ï¼Œå¯ä»¥å®ç°ä¸€å®šç¨‹åº¦ä¸Šçš„è‡ªåŠ¨åŒ–æµ‹è¯•ã€‚

å•å…ƒæµ‹è¯•ä¸€èˆ¬è¦ä½¿ç”¨æ¡†æ¶è¿›è¡Œ

- æ¡†æ¶æ˜¯å‰äººæˆ–è€…ä¸€äº›å¼ºå¤§çš„æŠ€æœ¯å…¬å¸åœ¨å®æˆ˜æˆ–è€…ç ”å‘ä¸­è®¾è®¡çš„ä¸€äº›ä¼˜è‰¯çš„è®¾è®¡æ–¹æ¡ˆæˆ–è€…æˆå‹çš„ä»£ç åŠŸèƒ½ï¼Œä½œä¸ºä¸€ä¸ªå®Œæ•´çš„æŠ€æœ¯ä½“ç³»å‘è¡Œå‡ºæ¥ç§°ä¸ºæ¡†æ¶ã€‚
- æ¡†æ¶å¯ä»¥è®©ç¨‹åºå‘˜å¿«é€Ÿæ‹¥æœ‰ä¸€ä¸ªå¼ºå¤§çš„è§£å†³æ–¹æ¡ˆï¼Œå¯ä»¥å¿«é€Ÿçš„å¼€å‘åŠŸèƒ½ï¼Œæé«˜æ•ˆç‡å¹¶ä¸”ç›´æ¥å°±æœ‰äº†å¾ˆå¥½çš„æ€§èƒ½ã€‚

å•å…ƒæµ‹è¯•çš„ç»å…¸æ¡†æ¶ï¼šJunitã€‚

å•å…ƒæµ‹è¯•æ¦‚å¿µ

- å•å…ƒï¼šåœ¨Javaä¸­ï¼Œä¸€ä¸ªç±»å°±æ˜¯ä¸€ä¸ªå•å…ƒ
- å•å…ƒæµ‹è¯•ï¼šç¨‹åºå‘˜ç”¨Junitç¼–å†™çš„ä¸€å°æ®µä»£ç ï¼Œç”¨æ¥å¯¹æŸä¸ªç±»ä¸­çš„æŸä¸ªæ–¹æ³•è¿›è¡ŒåŠŸèƒ½æµ‹è¯•æˆ–ä¸šåŠ¡é€»è¾‘æµ‹è¯•

Junitå•å…ƒæµ‹è¯•æ¡†æ¶çš„ä½œç”¨

- ç”¨æ¥å¯¹ç±»ä¸­çš„æ–¹æ³•åŠŸèƒ½è¿›è¡Œæœ‰ç›®çš„çš„æµ‹è¯•ï¼Œä»¥ä¿è¯ç¨‹åºçš„æ­£ç¡®æ€§å’Œç¨³å®šæ€§
- èƒ½å¤Ÿç‹¬ç«‹çš„æµ‹è¯•æŸä¸ªæ–¹æ³•æˆ–è€…æ‰€æœ‰æ–¹æ³•çš„é¢„æœŸæ­£ç¡®æ€§

ä¸šåŠ¡ä»£ç ç¤ºä¾‹

```Java
public class UserService {
    public String login(String loginName, String passWord) {
        if ("admin".equals(loginName) && "123456".equals(passWord)) {
            return "success";
        }
        return "ç”¨æˆ·åæˆ–è€…å¯†ç é”™è¯¯";
    }

    public void chu(int a, int b) {
        int c = a / b;
        System.out.println(c);
    }
}
```

æµ‹è¯•ç±»ä»£ç ç¤ºä¾‹

```Java
import org.junit.Assert;
import org.junit.Test;

public class UserServiceTest {
    @Test
    public void testLogin() {
        UserService userService = new UserService();
        String rs = userService.login("admin", "123456");
        Assert.assertEquals("ç™»å½•ä¸šåŠ¡æ–¹æ³•æœ‰é”™è¯¯ï¼Œè¯·æ£€æŸ¥","success",rs);
    }

    @Test
    public void testChu() {
        UserService userService = new UserService();
        userService.chu(10,2);
    }
}
```

## 26. åå°„

### 26.1 åå°„æ¦‚è¿°

åå°„ï¼Œæ³¨è§£ï¼Œä»£ç†ï¼Œæ³›å‹æ˜¯Javaçš„é«˜çº§æŠ€æœ¯ï¼Œæ˜¯ä»¥åæ¡†æ¶çš„åº•å±‚åŸç†å¿…é¡»ä½¿ç”¨åˆ°çš„æŠ€æœ¯ã€‚

åå°„ï¼šæ˜¯Javaç‹¬æœ‰çš„æŠ€æœ¯ï¼Œæ˜¯JavaæŠ€æœ¯æ˜¾è‘—çš„ç‰¹ç‚¹ã€‚

åå°„æ˜¯æŒ‡å¯¹äºä»»ä½•ä¸€ä¸ªç±»ï¼Œåœ¨â€œè¿è¡Œçš„æ—¶å€™â€éƒ½å¯ä»¥ç›´æ¥å¾—åˆ°è¿™ä¸ªç±»å…¨éƒ¨æˆåˆ†ã€‚

- åœ¨è¿è¡Œæ—¶ï¼Œå¯ä»¥ç›´æ¥å¾—åˆ°è¿™ä¸ªç±»çš„æ„é€ å™¨å¯¹è±¡ã€‚(Constructor)
- åœ¨è¿è¡Œæ—¶ï¼Œå¯ä»¥ç›´æ¥å¾—åˆ°è¿™ä¸ªç±»çš„æˆå‘˜å˜é‡å¯¹è±¡ã€‚(Field)
- åœ¨è¿è¡Œæ—¶ï¼Œå¯ä»¥ç›´æ¥å¾—åˆ°è¿™ä¸ªç±»çš„æˆå‘˜æ–¹æ³•å¯¹è±¡ã€‚(Method)

åå°„çš„æ ¸å¿ƒæ€æƒ³å’Œå…³é”®å°±æ˜¯å¾—åˆ°ï¼šç¼–è¯‘ä»¥åçš„classæ–‡ä»¶å¯¹è±¡ã€‚

åå°„æä¾›äº†ä¸€ä¸ªClassç±»å‹ï¼Œå°±æ˜¯å¯ä»¥å¾—åˆ°ç¼–è¯‘ä»¥åçš„classæ–‡ä»¶å¯¹è±¡ã€‚

- HelloWorld.java -> javac -> HelloWorld.class
- Class c = HelloWorld.class

æ³¨æ„ï¼šåå°„æ˜¯å·¥ä½œåœ¨è¿è¡Œæ—¶çš„æŠ€æœ¯ï¼Œå› ä¸ºåªæœ‰è¿è¡Œä¹‹åæ‰ä¼šæœ‰classç±»å¯¹è±¡ã€‚

åå°„è·å–Classç±»å¯¹è±¡çš„ä¸‰ç§æ–¹å¼

- ç±»å.class
- é€šè¿‡ç±»çš„å¯¹è±¡.getClass()æ–¹æ³•
- Class.forName("ç±»çš„å…¨é™å")
  - public static Class<?> forName(String className)

Classç±»ä¸‹çš„æ–¹æ³•

- String getSimpleName()ï¼šè·å¾—ç±»åå­—ç¬¦ä¸²ï¼šç±»å
- String getName()ï¼šè·å¾—ç±»å…¨åï¼šåŒ…å+ç±»å
- T newInstance()ï¼šåˆ›å»ºClasså¯¹è±¡å…³è”ç±»çš„å¯¹è±¡ï¼Œå…¶å®åº•å±‚ä¹Ÿæ˜¯è°ƒç”¨æ— å‚æ•°æ„é€ å™¨ï¼Œå·²ç»è¢«æ·˜æ±°

æ¡ˆä¾‹ä»£ç 

```Java
public class ReflectDemo {
    public static void main(String[] args) throws Exception {
        Class c1 = Student.class;
        System.out.println(c1);

        Student swk = new Student();
        Class c2 = swk.getClass();
        System.out.println(c2);

        Class c3 = Class.forName("com.itahu.Code07.Student");
        System.out.println(c3);

        System.out.println(c1.getSimpleName());
        System.out.println(c1.getName());
        Student s1 = (Student) c1.newInstance();
    }
}
```

### 26.2 Classç±»çš„å„ç§å¯¹è±¡è·å–

åå°„ä¸­Classç±»è·å–æ„é€ å™¨å¯¹è±¡

- Constructor getConstructor(Class... parameterTypes)ï¼šæ ¹æ®å‚æ•°åŒ¹é…è·å–æŸä¸ªæ„é€ å™¨ï¼Œåªèƒ½æ‹¿publicä¿®é¥°çš„æ„é€ å™¨ï¼Œå‡ ä¹ä¸ç”¨ã€‚
- Constructor getDeclaredConstructor(Class... parameterTypes)ï¼šæ ¹æ®å‚æ•°åŒ¹é…è·å–æŸä¸ªæ„é€ å™¨ï¼Œåªè¦ç”³æ˜å°±å¯ä»¥å®šä½ï¼Œä¸å…³å¿ƒæƒé™ä¿®é¥°ç¬¦ï¼Œå»ºè®®ä½¿ç”¨ã€‚
- Constructor[] getConstructors()ï¼šè·å–æ‰€æœ‰çš„æ„é€ å™¨ï¼Œåªèƒ½æ‹¿publicä¿®é¥°çš„æ„é€ å™¨ï¼Œå‡ ä¹ä¸ç”¨ã€‚
- Constructor[] getDeclaredConstructors()ï¼šè·å–æ‰€æœ‰ç”³æ˜çš„æ„é€ å™¨ï¼Œåªè¦ä½ å†™æˆ‘å°±èƒ½æ‹¿åˆ°ï¼Œæ— æ‰€è°“æƒé™ï¼Œå»ºè®®ä½¿ç”¨ã€‚

```Java
import org.junit.Test;
import java.lang.reflect.Constructor;

public class ReflectDemo01 {
    @Test
    public void getConstructors() {
        Class c = Student.class;
        Constructor[] cons = c.getConstructors();
        for (Constructor con : cons) {
            System.out.println(con.getName() + "==>" + con.getParameterCount());
        }
    }

    @Test
    public void getDeclaredConstructors() {
        Class c = Student.class;
        Constructor[] cons = c.getDeclaredConstructors();
        for (Constructor con : cons) {
            System.out.println(con.getName() + "==>" + con.getParameterCount());
        }
    }

    @Test
    public void getConstructor() throws Exception {
        Class c = Student.class;
        Constructor con = c.getConstructor(String.class, int.class);
        System.out.println(con.getName() + "==>" + con.getParameterCount());
    }

    @Test
    public void getDeclaredConstructor() throws Exception {
        Class c = Student.class;
        Constructor con = c.getDeclaredConstructor();
        System.out.println(con.getName() + "==>" + con.getParameterCount());
    }
}
```

åå°„è·å–Classä¸­çš„æ„é€ å™¨å¯¹è±¡Constructorä½œç”¨ï¼šä¹Ÿæ˜¯åˆå§‹åŒ–å¹¶å¾—åˆ°ç±»çš„ä¸€ä¸ªå¯¹è±¡è¿”å›ã€‚

Constructorçš„API

- T newInstance(Object... initargs)ï¼šåˆ›å»ºå¯¹è±¡ï¼Œæ³¨å…¥æ„é€ å™¨éœ€è¦çš„æ•°æ®ã€‚
- void setAccessible(true)ï¼šä¿®æ”¹è®¿é—®æƒé™ï¼Œtrueä»£è¡¨æš´åŠ›æ”»ç ´æƒé™ï¼Œfalseè¡¨ç¤ºä¿ç•™ä¸å¯è®¿é—®æƒé™ã€‚(æš´åŠ›åå°„)

```Java
import org.junit.Test;
import java.lang.reflect.Constructor;

public class ReflectDemo02 {
    @Test
    public void createObj01() throws Exception {
        Class c = Student.class;
        Constructor constructor = c.getDeclaredConstructor();
        constructor.setAccessible(true);
        Student swk = (Student) constructor.newInstance();
        System.out.println(swk);
    }

    @Test
    public void createObj02() throws Exception {
        Class c = Student.class;
        Constructor constructor = c.getDeclaredConstructor(String.class, int.class);
        Student swk = (Student) constructor.newInstance("å­™æ‚Ÿç©º", 1000);
        System.out.println(swk);
    }
}
```

åå°„è·å–æˆå‘˜å˜é‡

- Field getField(String name)ï¼šæ ¹æ®æˆå‘˜å˜é‡åç§°è·å¾—å¯¹åº”Fieldå¯¹è±¡ï¼Œåªèƒ½è·å¾—publicä¿®é¥°ã€‚
- Field getDeclaredField(String name)ï¼šæ ¹æ®æˆå‘˜å˜é‡åè·å¾—å¯¹åº”Fieldå¯¹è±¡ï¼Œåªè¦ç”³æ˜äº†å°±å¯ä»¥å¾—åˆ°ã€‚
- Field[] getFields()ï¼šè·å¾—æ‰€æœ‰çš„æˆå‘˜å˜é‡å¯¹åº”çš„Fieldå¯¹è±¡ï¼Œåªèƒ½è·å¾—publicçš„ã€‚
- Field[] getDeclaredFields()ï¼šè·å¾—æ‰€æœ‰çš„æˆå‘˜å˜é‡å¯¹åº”çš„Fieldå¯¹è±¡ï¼Œåªè¦ç”³æ˜äº†å°±å¯ä»¥å¾—åˆ°ã€‚

åå°„è·å–æˆå‘˜å˜é‡ï¼šå–å€¼å’Œèµ‹å€¼

Fieldæ–¹æ³•ï¼šç»™æˆå‘˜å˜é‡èµ‹å€¼å’Œå–å€¼

- void set(Object obj, Object value)ï¼šç»™å¯¹è±¡æ³¨å…¥æŸä¸ªæˆå‘˜å˜é‡æ•°æ®ã€‚
- Object get(Object obj)ï¼šè·å–å¯¹è±¡çš„æˆå‘˜å˜é‡çš„å€¼ã€‚
- void setAccessible(true)ï¼šæš´åŠ›åå°„ï¼Œè®¾ç½®ä¸ºå¯ä»¥ç›´æ¥è®¿é—®ç§æœ‰ç±»å‹çš„å±æ€§ã€‚
- Class getType()ï¼šè·å–å±æ€§çš„ç±»å‹ï¼Œè¿”å›Classå¯¹è±¡ã€‚
- String getName()ï¼šè·å–å±æ€§çš„åç§°ã€‚

```Java
import org.junit.Test;
import java.lang.reflect.Field;

public class FieldDemo01 {
    @Test
    public void setField() throws Exception {
        Class c = Dog.class;
        Field nameF = c.getDeclaredField("name");
        Dog taidi = new Dog();
        nameF.setAccessible(true);
        nameF.set(taidi, "å‹‡æ•¢çš„æ³°è¿ª");
        System.out.println(taidi);

        String value = nameF.get(taidi) + "";
        System.out.println(value);
    }
}
```

åå°„è·å–ç±»çš„Methodæ–¹æ³•å¯¹è±¡

- Method getMethod(String name, Class... args)ï¼šæ ¹æ®æ–¹æ³•åå’Œå‚æ•°ç±»å‹è·å¾—å¯¹åº”çš„æ–¹æ³•å¯¹è±¡ï¼Œåªèƒ½è·å¾—publicçš„ã€‚
- Method getDeclaredMethod(String name, Class... args)ï¼šæ ¹æ®æ–¹æ³•åå’Œå‚æ•°ç±»å‹è·å¾—å¯¹åº”çš„æ–¹æ³•å¯¹è±¡ï¼ŒåŒ…æ‹¬privateçš„ã€‚
- Method[] getMethods()ï¼šè·å¾—ç±»ä¸­æ‰€æœ‰æˆå‘˜æ–¹æ³•çš„å¯¹è±¡ï¼Œè¿”å›æ•°ç»„ï¼Œåªèƒ½è·å¾—publicä¿®é¥°çš„ä¸”åŒ…å«çˆ¶ç±»çš„ã€‚
- Method[] getDeclaredMethods()ï¼šè·å¾—ç±»ä¸­çš„æ‰€æœ‰æˆå‘˜æ–¹æ³•å¯¹è±¡ï¼Œè¿”å›æ•°ç»„ï¼Œåªè·å¾—æœ¬ç±»ç”³æ˜çš„æ–¹æ³•ã€‚

Methodçš„æ–¹æ³•

- Object invoke(Object obj, Object... args)
  - å‚æ•°ä¸€ï¼šè§¦å‘çš„æ˜¯å“ªä¸ªå¯¹è±¡çš„æ–¹æ³•æ‰§è¡Œã€‚
  - å‚æ•°äºŒï¼šargsæ˜¯è°ƒç”¨æ–¹æ³•æ—¶ä¼ é€’çš„å®é™…å‚æ•°ã€‚

```Java
import org.junit.Test;
import java.lang.reflect.Method;

public class MethodDemo {
    @Test
    public void getDeclaredMethod() throws Exception {
        Class c = Dog.class;
        Method run = c.getDeclaredMethod("run");
        Dog jinMao = new Dog();
        run.invoke(jinMao);

        Method eat = c.getDeclaredMethod("eat", String.class);
        eat.setAccessible(true);
        Object rs = eat.invoke(jinMao, "éª¨å¤´");
        System.out.println(rs);
    }
}
```

åå°„æ‹“å±•

- åå°„å¯ä»¥ç ´åé¢å‘å¯¹è±¡çš„å°è£…æ€§
- åŒæ—¶å¯ä»¥ç ´åæ³›å‹çš„çº¦æŸæ€§

```Java
import java.lang.reflect.Method;
import java.util.ArrayList;
import java.util.List;

public class ReflectDemo03 {
    public static void main(String[] args) throws Exception {
        List<Double> scores = new ArrayList<>();
        scores.add(99.3);
        scores.add(199.3);
        scores.add(89.5);

        Class c = scores.getClass();
        Method add = c.getDeclaredMethod("add", Object.class);
        add.invoke(scores,"æ³¢ä»”");
        System.out.println(scores);
    }
}
```

åå°„é€‚åˆåšé€šç”¨æŠ€æœ¯æ¡†æ¶çš„åº•å±‚å®ç°ï¼Œåœ¨æ¡†æ¶çš„åº•å±‚æºç ä¸­æˆ‘ä»¬ç»å¸¸çœ‹åˆ°åå°„çš„å½±å­ã€‚

å¦‚åå°„å¯ä»¥å®ç°ï¼šä»»ä½•å¯¹è±¡åªè¦ç»™æˆ‘ï¼Œæˆ‘å°±å¯ä»¥æŠŠä¿¡æ¯å’Œå­—æ®µéƒ½è§£æå¹¶å­˜å‚¨èµ·æ¥ã€‚

## 27. æ³¨è§£

### 27.1 æ³¨è§£æ¦‚è¿°

æ³¨è§£

- ç”¨åœ¨ç±»ä¸Šï¼Œæ–¹æ³•ä¸Šï¼Œæˆå‘˜å˜é‡ï¼Œæ„é€ å™¨ï¼Œ...ä¸Šå¯¹æˆåˆ†è¿›è¡Œç¼–è¯‘çº¦æŸï¼Œæ ‡è®°ç­‰æ“ä½œçš„ã€‚
- æ³¨è§£æ˜¯JDK 1.5çš„æ–°ç‰¹æ€§ã€‚
- æ³¨è§£ç›¸å½“ä¸€ç§æ ‡è®°ï¼Œæ˜¯ç±»çš„ç»„æˆéƒ¨åˆ†ï¼Œå¯ä»¥ç»™ç±»æºå¸¦ä¸€äº›é¢å¤–ä¿¡æ¯ã€‚
- æ³¨è§£æ˜¯ç»™ç¼–è¯‘å™¨æˆ–JVMçœ‹çš„ï¼Œç¼–è¯‘å™¨æˆ–JVMå¯ä»¥æ ¹æ®æ³¨è§£æ¥å®Œæˆå¯¹åº”çš„åŠŸèƒ½ã€‚

æ³¨è§£ä½œç”¨

- æ ‡è®°
- æ–¹æ³•é‡å†™çº¦æŸã€‚@Override
- å‡½æ•°å¼æ¥å£çº¦æŸã€‚@FunctionInterface
- ç°ä»Šæœ‰åçš„æ¡†æ¶æŠ€æœ¯å¤šåŠéƒ½æ˜¯åœ¨ä½¿ç”¨æ³¨è§£å’Œåå°„ï¼Œéƒ½æ˜¯å±äºæ¡†æ¶çš„åŸºç¡€æŠ€æœ¯ã€‚

### 27.2 æ³¨è§£çš„ä½¿ç”¨

è‡ªå®šä¹‰æ³¨è§£çš„æ ¼å¼

```Java
ä¿®é¥°ç¬¦ @interface æ³¨è§£å {
    // æ³¨è§£å±æ€§
}
```

æ³¨æ„ï¼šè‡ªå®šä¹‰æ³¨è§£ç”¨@interfaceå…³é”®å­—ï¼Œæ³¨è§£é»˜è®¤å¯ä»¥æ ‡è®°å¾ˆå¤šåœ°æ–¹ã€‚

æ³¨è§£çš„å±æ€§

å±æ€§æ ¼å¼

- æ ¼å¼1ï¼šæ•°æ®ç±»å‹ å±æ€§å();
- æ ¼å¼2ï¼šæ•°æ®ç±»å‹ å±æ€§å() default é»˜è®¤å€¼;

å±æ€§é€‚ç”¨çš„æ•°æ®ç±»å‹ï¼šå…«ç§æ•°æ®ç±»å‹(intï¼Œshortï¼Œlongï¼Œdoubleï¼Œbyteï¼Œcharï¼Œbooleanï¼Œfloat)ï¼ŒStringï¼ŒClassã€‚ä»¥ä¸Šç±»å‹çš„æ•°ç»„å½¢å¼éƒ½æ”¯æŒã€‚

```Java
@Book(name = "ã€Šç²¾é€šJavaåŸºç¡€ã€‹",authors = {"æ³¢ä»”","Dlei","æ³¢å¦"},price = 99.9)
public class MyBook {
    @Book(name = "ã€Šç²¾é€šMySQLæ•°æ®åº“å…¥é—¨åˆ°åˆ åº“è·‘è·¯ã€‹",authors = {"å°ç™½","å°é»‘"},price = 19.9,address = "åŒ—äº¬")
    public static void main(String[] args) {

    }
}

@interface Book{
    String name();
    String[] authors();
    double price();
    String address() default "å¹¿å·";
}
```

æ³¨æ„ï¼šåœ¨ç”¨æ³¨è§£çš„æ—¶å€™ï¼Œå±æ€§å¿…é¡»èµ‹å€¼ï¼Œé™¤éè¿™ä¸ªå±æ€§æœ‰é»˜è®¤å€¼ã€‚

æ³¨è§£çš„ç‰¹æ®Šå±æ€§åç§°ï¼švalue

- valueå±æ€§ï¼Œå¦‚æœåªæœ‰ä¸€ä¸ªvalueå±æ€§çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨valueå±æ€§çš„æ—¶å€™å¯ä»¥çœç•¥valueåç§°ä¸å†™ã€‚
- ä½†æ˜¯å¦‚æœæœ‰å¤šä¸ªå±æ€§ï¼Œä¸”å¤šä¸ªå±æ€§æ²¡æœ‰é»˜è®¤å€¼ï¼Œé‚£ä¹ˆvalueæ˜¯ä¸èƒ½çœç•¥çš„ã€‚

```Java
@Books("/deleteBook.action")
//@Books(value = "/deleteBook.action")
public class AnnotationDemo {
}

@interface Books {
    String value();
}
```

å…ƒæ³¨è§£

- å…ƒæ³¨è§£æ˜¯sunå…¬å¸æä¾›çš„ã€‚
- å…ƒæ³¨è§£æ˜¯ç”¨åœ¨è‡ªå®šä¹‰æ³¨è§£ä¸Šçš„æ³¨è§£ã€‚
- å…ƒæ³¨è§£æ˜¯ç”¨æ¥æ³¨è§£è‡ªå®šä¹‰æ³¨è§£çš„ã€‚

å…ƒæ³¨è§£æœ‰ä¸¤ä¸ª

- @Targetï¼šçº¦æŸè‡ªå®šä¹‰æ³¨è§£åªèƒ½åœ¨å“ªäº›åœ°æ–¹ä½¿ç”¨
  - ä½†æ˜¯é»˜è®¤çš„æ³¨è§£å¯ä»¥åœ¨ç±»ï¼Œæ–¹æ³•ï¼Œæ„é€ å™¨ï¼Œæˆå‘˜å˜é‡ï¼Œ...ä½¿ç”¨ã€‚
- @Retentionï¼šç”³æ˜æ³¨è§£çš„ç”Ÿå‘½å‘¨æœŸ
  - ç”³æ˜æ³¨è§£çš„ä½œç”¨èŒƒå›´ï¼šç¼–è¯‘æ—¶ï¼Œè¿è¡Œæ—¶ã€‚

@Targetå¯ä½¿ç”¨çš„å€¼å®šä¹‰åœ¨ElementTypeæšä¸¾ç±»ä¸­ï¼Œå¸¸ç”¨å€¼æœ‰

- TYPEï¼Œç±»ã€æ¥å£
- FIELDï¼Œæˆå‘˜å˜é‡
- METHODï¼Œæˆå‘˜æ–¹æ³•
- PARAMETERï¼Œæ–¹æ³•å‚æ•°
- CONSTRUCTORï¼Œæ„é€ å™¨
- LOCAL_VARIABLEï¼Œå±€éƒ¨å˜é‡

@Retentionå¯ä½¿ç”¨çš„å€¼å®šä¹‰åœ¨RetentionPolicyæšä¸¾ç±»ä¸­ï¼Œå¸¸ç”¨å€¼æœ‰

- SOURCEï¼šæ³¨è§£åªä½œç”¨åœ¨æºç é˜¶æ®µï¼Œç”Ÿæˆçš„å­—èŠ‚ç æ–‡ä»¶ä¸­ä¸å­˜åœ¨ã€‚
- CLASSï¼šæ³¨è§£ä½œç”¨åœ¨æºç é˜¶æ®µï¼Œå­—èŠ‚ç æ–‡ä»¶é˜¶æ®µï¼Œè¿è¡Œé˜¶æ®µä¸å­˜åœ¨ï¼Œé»˜è®¤å€¼ã€‚
- RUNTIMEï¼šæ³¨è§£ä½œç”¨åœ¨æºç é˜¶æ®µï¼Œå­—èŠ‚ç æ–‡ä»¶é˜¶æ®µï¼Œè¿è¡Œé˜¶æ®µã€‚(å¼€å‘å¸¸ç”¨)

```Java
import java.lang.annotation.ElementType;
import java.lang.annotation.Retention;
import java.lang.annotation.RetentionPolicy;
import java.lang.annotation.Target;

public class AnnotationDemo {
    @MyTest
    public static void main(String[] args) {
    }
}

@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
@interface MyTest {
}
```

æ³¨è§£çš„è§£æï¼šæˆ‘ä»¬ä¼šä½¿ç”¨æ³¨è§£æ³¨é‡Šä¸€ä¸ªç±»çš„æˆåˆ†ï¼Œé‚£ä¹ˆå°±æ¶‰åŠåˆ°è¦è§£æå‡ºè¿™äº›æ³¨è§£çš„æ•°æ®ã€‚å¼€å‘ä¸­ç»å¸¸è¦çŸ¥é“ä¸€ä¸ªç±»çš„æˆåˆ†ä¸Šé¢åˆ°åº•æœ‰å“ªäº›æ³¨è§£ï¼Œæ³¨è§£æœ‰å“ªäº›å±æ€§æ•°æ®ï¼Œè¿™éƒ½éœ€è¦è¿›è¡Œæ³¨è§£çš„è§£æã€‚

ä¸æ³¨è§£è§£æç›¸å…³çš„æ¥å£

- Annotationï¼šæ³¨è§£ç±»å‹ï¼Œè¯¥ç±»æ˜¯æ‰€æœ‰æ³¨è§£çš„çˆ¶ç±»ã€‚æ³¨è§£éƒ½æ˜¯ä¸€ä¸ªAnnotationçš„å¯¹è±¡ã€‚
- AnnotatedElementï¼šè¯¥æ¥å£å®šä¹‰äº†ä¸æ³¨è§£è§£æç›¸å…³çš„æ–¹æ³•ã€‚æ‰€æœ‰çš„ç±»æˆåˆ†Classï¼ŒMethodï¼ŒFieldï¼ŒConstructorï¼šéƒ½å®ç°äº†AnnotatedElementæ¥å£ï¼Œä»–ä»¬éƒ½æ‹¥æœ‰è§£ææ³¨è§£çš„èƒ½åŠ›ã€‚
  - Annotation[] getDeclaredAnnotations()ï¼šè·å¾—å½“å‰å¯¹è±¡ä¸Šä½¿ç”¨çš„æ‰€æœ‰æ³¨è§£ï¼Œè¿”å›æ³¨è§£æ•°ç»„ã€‚
  - T getDeclaredAnnotation(Class\<T> annotationClass)ï¼šæ ¹æ®æ³¨è§£ç±»å‹è·å¾—å¯¹åº”æ³¨è§£å¯¹è±¡ã€‚
  - boolean isAnnotationPresent(Class\<Annotation> annotationClass)ï¼šåˆ¤æ–­å½“å‰å¯¹è±¡æ˜¯å¦ä½¿ç”¨äº†æŒ‡å®šçš„æ³¨è§£ï¼Œå¦‚æœä½¿ç”¨äº†åˆ™è¿”å›trueï¼Œå¦åˆ™falseã€‚

è§£ææ³¨è§£æ•°æ®çš„åŸç†ï¼šæ³¨è§£åœ¨å“ªä¸ªæˆåˆ†ä¸Šï¼Œæˆ‘ä»¬å°±å…ˆæ‹¿å“ªä¸ªæˆåˆ†å¯¹è±¡ï¼Œå†æ‹¿è¯¥å¯¹è±¡ä¸Šé¢çš„æ³¨è§£ã€‚

```Java
import org.junit.Test;
import java.lang.annotation.*;
import java.lang.reflect.Method;
import java.util.Arrays;

public class AnnotationDemo {
    @Test
    public void parseClass() {
        Class c = BookStore.class;
        if (c.isAnnotationPresent(Books.class)) {
            Books book = (Books) c.getDeclaredAnnotation(Books.class);
            System.out.println(book.value());
            System.out.println(book.price());
            System.out.println(Arrays.toString(book.authors()));
        }
    }

    @Test
    public void parseMethod() throws Exception {
        Class c = BookStore.class;
        Method run = c.getDeclaredMethod("run");
        if (run.isAnnotationPresent(Books.class)) {
            Books book = (Books) run.getDeclaredAnnotation(Books.class);
            System.out.println(book.value());
            System.out.println(book.price());
            System.out.println(Arrays.toString(book.authors()));
        }
    }
}

@Books(value = "ã€ŠJavaåŸºç¡€åˆ°ç²¾é€šã€‹",price = 99.5,authors = {"Mark","æ³¢ä»”"})
class BookStore {
    @Books(value = "ã€ŠMyBatisæŒä¹…å±‚æ¡†æ¶ã€‹",price = 199.5,authors = {"Dlei","å°é»‘"})
    public void run() {
    }
}

@Target({ElementType.TYPE,ElementType.METHOD})
@Retention(RetentionPolicy.RUNTIME)
@interface Books {
    String value();
    double price() default 100;
    String[] authors();
}
```

è‡ªå®šä¹‰æ³¨è§£æ¨¡æ‹Ÿå†™ä¸€ä¸ªJunitæ¡†æ¶çš„åŸºæœ¬ä½¿ç”¨

éœ€æ±‚ï¼šå®šä¹‰è‹¥å¹²ä¸ªæ–¹æ³•ï¼Œåªè¦åŠ äº†MyTestæ³¨è§£ï¼Œå°±å¯ä»¥è¢«è‡ªåŠ¨è§¦å‘æ‰§è¡Œã€‚

åˆ†æ

- å®šä¹‰ä¸€ä¸ªè‡ªå®šä¹‰æ³¨è§£MyTest
  - åªèƒ½æ³¨è§£æ–¹æ³•
  - å­˜æ´»èŒƒå›´ä¸€ç›´éƒ½åœ¨
- å®šä¹‰è‹¥å¹²ä¸ªæ–¹æ³•ï¼Œåªè¦æœ‰@MyTestæ³¨è§£çš„æ–¹æ³•å°±èƒ½è¢«è§¦å‘æ‰§è¡Œï¼Œæ²¡æœ‰è¿™ä¸ªæ³¨è§£çš„æ–¹æ³•ä¸èƒ½æ‰§è¡Œ

```Java
import java.lang.annotation.ElementType;
import java.lang.annotation.Retention;
import java.lang.annotation.RetentionPolicy;
import java.lang.annotation.Target;
import java.lang.reflect.Method;

public class TestDemo {
    @MyTest
    public void test01() {
        System.out.println("===test01===");
    }

    public void test02() {
        System.out.println("===test02===");
    }

    @MyTest
    public void test03() {
        System.out.println("===test03===");
    }

    @MyTest
    public void test04() {
        System.out.println("===test04===");
    }

    public static void main(String[] args) throws Exception {
        TestDemo t = new TestDemo();
        Class c = TestDemo.class;
        Method[] methods = c.getDeclaredMethods();
        for (Method method : methods) {
            if (method.isAnnotationPresent(MyTest.class)) {
                method.invoke(t);
            }
        }
    }
}

@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
@interface MyTest {
}
```

æ³¨æ„ï¼šæ³¨è§£å’Œåå°„å¯ä»¥é…åˆè§£å†³ä¸€äº›æ¡†æ¶æ€æƒ³ï¼Œæ³¨è§£å¯ä»¥å®ç°æ ‡è®°çš„æˆåˆ†åšç‰¹æ®Šå¤„ç†ã€‚

## 28. XML

### 28.1 XMLæ¦‚è¿°

XMLæ¦‚å¿µ

- è‹±æ–‡ï¼šExtensible Markup Languageå¯æ‰©å±•çš„æ ‡è®°è¯­è¨€ï¼Œç”±å„ç§æ ‡è®°(æ ‡ç­¾==å…ƒç´ )ç»„æˆã€‚
- å¯æ‰©å±•ï¼šæ‰€æœ‰çš„æ ‡ç­¾éƒ½æ˜¯è‡ªå®šä¹‰çš„ï¼Œå¯ä»¥éšæ„æ‰©å±•çš„ã€‚å¦‚ï¼š\<abc/>ï¼Œ\<bobby>ï¼Œ\<sex>ã€‚
- æ ‡è®°è¯­è¨€ï¼šæ•´ä¸ªæ–‡æ¡£ç”±å„ç§æ ‡ç­¾ç»„æˆã€‚æ¸…æ™°ï¼Œæ•°æ®ç»“æ„åŒ–ã€‚
- XMLæ˜¯é€šè¿‡æ ¼å¼æ ‡å‡†ï¼Œå…¨çƒæ‰€æœ‰çš„æŠ€æœ¯äººå‘˜éƒ½çŸ¥é“è¿™ä¸ªä¸œè¥¿ï¼Œéƒ½å¯èƒ½ä¼šæŒ‰ç…§XMLçš„è§„èŒƒå­˜å‚¨æ•°æ®ï¼Œäº¤äº’æ•°æ®ã€‚

XMLä½œç”¨

- æ•°æ®äº¤æ¢ï¼šä¸åŒçš„è®¡ç®—æœºè¯­è¨€ä¹‹é—´ï¼Œä¸åŒçš„æ“ä½œç³»ç»Ÿä¹‹é—´ï¼Œä¸åŒçš„æ•°æ®åº“ä¹‹é—´ï¼Œè¿›è¡Œæ•°æ®äº¤æ¢ã€‚
- é…ç½®æ–‡ä»¶ï¼šåœ¨åæœŸæˆ‘ä»¬ä¸»è¦ç”¨äºå„ç§æ¡†æ¶çš„é…ç½®æ–‡ä»¶ã€‚

XMLçš„ç‰¹ç‚¹

- ç”¨äºæ•°æ®äº¤äº’ï¼Œç”¨äºæ•°æ®çš„å­˜å‚¨ï¼Œç”¨äºåšç³»ç»Ÿçš„é…ç½®æ–‡ä»¶
- åŒºåˆ†å¤§å°å†™
- éå¸¸ä¸¥è°¨ï¼Œåªè¦æœ‰é”™è¯¯ï¼Œè§£æå™¨å°±ä¸èƒ½è§£æ
- å¯ä»¥æ‰©å±•çš„ï¼Œæ‰€æœ‰çš„æ ‡ç­¾éƒ½æ˜¯ç¨‹åºå‘˜è‡ªå·±åˆ›å»ºå‡ºæ¥
- XMLæ–‡ä»¶çš„åç¼€ä¸º.xml

### 28.2 XMLçš„ä½¿ç”¨

åˆ›å»ºä¸€ä¸ªXMLæ–‡ä»¶

```XML
<?xml version="1.0" encoding="UTF-8" ?>
<person>
    <name>ç‹ç†™å‡¤</name>
    <age>29</age>
    <sex>å¥³</sex>
    <hobby>ç¬‘å¾—å¾ˆçŠ€åˆ©</hobby>
</person>
```

XMLç”±ä¸ƒç§ç»„æˆå…ƒç´ æ„æˆ

- å£°æ˜(æŠ¬å¤´)
- å…ƒç´ (æ ‡ç­¾)
- å±æ€§
- æ³¨é‡Š
- å®ä½“å­—ç¬¦
- CDATAå­—ç¬¦æ•°æ®åŒº
- å¤„ç†æŒ‡ä»¤

```XML
<?xml version="1.0" encoding="UTF-8" ?>
<?xml-stylesheet type="text/css" href="../css/xml.css" ?>
<!--å¤„ç†æŒ‡ä»¤ï¼šå¯¼å…¥å¤–éƒ¨çš„cssæ ·å¼æ§åˆ¶xmlçš„ç•Œé¢æ•ˆæœï¼Œæ²¡æœ‰å•¥ç”¨ï¼Œxmlä¸æ˜¯ä¸ºäº†å±•ç¤ºå¥½çœ‹çš„ï¼-->
<!--å£°æ˜ æŠ¬å¤´ å¿…é¡»åœ¨ç¬¬ä¸€è¡Œ-->
<!--æ³¨é‡Šï¼Œæœ¬å¤„å°±æ˜¯æ³¨é‡Šï¼Œå¿…é¡»ç”¨å‰åå°–æ‹¬å·å›´èµ·æ¥-->
<!--æ ‡ç­¾(å…ƒç´ )ï¼Œæ³¨æ„ä¸€ä¸ªXMLæ–‡ä»¶åªèƒ½æœ‰ä¸€ä¸ªæ ¹æ ‡ç­¾-->
<student>
    <!--å±æ€§ä¿¡æ¯ï¼šidï¼Œdesc-->
    <name id="1" desc="é«˜å¯Œå¸…">è¥¿é—¨åº†</name>
    <age>32</age>
    <!--å®ä½“å­—ç¬¦ï¼šåœ¨XMLæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬ä¸èƒ½ç›´æ¥å†™å°äºå·ç­‰ä¸€äº›ç‰¹æ®Šå­—ç¬¦ï¼Œä¼šä¸XMLæ–‡ä»¶æœ¬èº«çš„å†…å®¹å†²çªã€‚æ­¤æ—¶å¿…é¡»ç”¨è½¬ä¹‰çš„å®ä½“å­—ç¬¦ã€‚-->
    <sql>
        <!--select * from student where age < 18 && age > 10;-->
        select * from student where age &lt; 18 &amp;&amp; age &gt; 10;
    </sql>
    <!--å­—ç¬¦æ•°æ®åŒºï¼šåœ¨XMLæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬ä¸èƒ½ç›´æ¥å†™å°äºå·ç­‰ä¸€äº›ç‰¹æ®Šå­—ç¬¦ï¼Œä¼šä¸XMLæ–‡ä»¶æœ¬èº«çš„å†…å®¹å†²çªã€‚æ­¤æ—¶å¿…é¡»ç”¨è½¬ä¹‰çš„å®ä½“å­—ç¬¦ã€‚
    æˆ–è€…ä¹Ÿå¯ä»¥é€‰æ‹©ä½¿ç”¨å­—ç¬¦æ•°æ®åŒºï¼Œé‡Œé¢çš„å†…å®¹å¯ä»¥éšä¾¿äº†-->
    <sql2>
        <![CDATA[
            select * from student where age < 18 && age > 10;
        ]]>
    </sql2>
</student>
```

ä½¿ç”¨çš„CSSæ–‡ä»¶å¦‚ä¸‹

```CSS
name {
    font-size: 30px;
    color: green;
}

sql2 {
    font-size: 60px;
    color: red;
    font-family: æ¥·ä½“;
}
```

**XMLçš„ä¸¤ç§çº¦æŸ**

- DTDçº¦æŸ
- Schemaçº¦æŸ(æ˜¯æœ€ç‰›çš„çº¦æŸæŠ€æœ¯ï¼Œæœ€é‡è¦çš„)
- æˆ‘ä»¬åªè¦èƒ½æ‡‚å°±å¥½äº†ï¼Œä»¥åçº¦æŸæ–‡ä»¶éƒ½æ˜¯æ¡†æ¶å†™å¥½çš„ï¼Œæˆ‘ä»¬ä¼šç”¨å³å¯

DTDçº¦æŸçš„æ¦‚å¿µ

- DTDï¼šDocument Type Definiation æ–‡æ¡£ç±»å‹å®šä¹‰
- ä½œç”¨ï¼šçº¯æ–‡æœ¬æ–‡ä»¶ï¼ŒæŒ‡å®šäº†XMLçº¦æŸè§„åˆ™

åœ¨ä¼ä¸šå®é™…å¼€å‘ä¸­ï¼Œä¸ä¼šè‡ªå·±ç¼–å†™DTDçº¦æŸæ–‡æ¡£ï¼Œæˆ‘ä»¬åæœŸåªéœ€é€šè¿‡æ¡†æ¶æä¾›çš„DTDçº¦æŸæ–‡æ¡£ç¼–å†™å‡ºç›¸åº”çš„XMLé…ç½®æ–‡æ¡£ã€‚åªè¦å›å¯¼å…¥åˆ«äººçš„DTDçº¦æŸè‡ªå·±å³å¯ã€‚

Schemaçº¦æŸçš„å¼•å…¥

DTDçš„ä¸è¶³

- ä¸èƒ½éªŒè¯æ•°æ®ç±»å‹
- å› ä¸ºDTDæ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œæœ¬èº«ä¸èƒ½éªŒè¯æ˜¯å¦æ­£ç¡®

Schemaç‰¹ç‚¹

- çº¦æŸæ–‡ä»¶æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªXMLæ–‡ä»¶ï¼Œå®ƒæœ¬èº«ä¹Ÿä¼šè¢«å…¶å®ƒxsdæ–‡æ¡£çº¦æŸã€‚
- å†…ç½®å¤šç§æ•°æ®ç±»å‹ï¼Œå¯ä»¥æ£€æŸ¥æ•°æ®ç±»å‹æ˜¯å¦æ­£ç¡®ã€‚
- æ”¯æŒå‘½åç©ºé—´ï¼Œä¸€ä¸ªXMLæ–‡ä»¶å¯ä»¥åŒæ—¶å¼•å…¥å¤šä¸ªxsdçš„çº¦æŸæ–‡ä»¶ï¼Œè®©çº¦æŸè§„åˆ™é‡ç”¨ã€‚
- æ‰©å±•åä¸ºxsdï¼šXML Schema Definitionã€‚
- çº¦æŸæ–‡ä»¶æœ¬èº«ä¹Ÿæ˜¯XMLæ–‡ä»¶ï¼Œæ‰€ä»¥ä¹Ÿæœ‰æ ¹å…ƒç´ ï¼Œæ ¹å…ƒç´ çš„åå­—å«ï¼šschemaã€‚

æ¨¡å¼æ–‡æ¡£å’Œå®ä¾‹æ–‡æ¡£

æ¨¡å¼æ–‡æ¡£ï¼šåˆ¶å®šçº¦æŸçš„XMLæ–‡æ¡£(ç±»ä¼¼äºï¼šç±»)ã€‚Schema

å®ä¾‹æ–‡æ¡£ï¼šè¢«çº¦æŸçš„XMLæ–‡æ¡£(ç±»ä¼¼äºï¼šå¯¹è±¡)

**XMLçš„è§£æ**ï¼šä½¿ç”¨Javaè¯­è¨€å»è§£æXMLæ–‡ä»¶ï¼Œè¯»å–XMLä¸­çš„å…ƒç´ ï¼Œå±æ€§ï¼Œæ–‡æœ¬ç­‰æ•°æ®å°±æ˜¯XMLè§£æã€‚

XMLçš„ä¸¤ç§è§£ææ–¹å¼

- DOMè§£æï¼šDocument Object Modelæ–‡æ¡£å¯¹è±¡æ¨¡å‹(é¢å‘å¯¹è±¡çš„è§£ææ–¹å¼)
  - ä¼˜ç‚¹ï¼šå°†æ•´ä¸ªXMLæ–‡ä»¶åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œç”Ÿæˆä¸€æ£µDOMæ ‘ã€‚éšæ„è®¿é—®æ ‘ä¸Šä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¯ä»¥ä¿®æ”¹å’Œåˆ é™¤èŠ‚ç‚¹ï¼Œç¨‹åºå¼€å‘æ¯”è¾ƒæ–¹ä¾¿ã€‚çº¯é¢å‘å¯¹è±¡å¼€å‘ã€‚
  - ç¼ºç‚¹ï¼šå å†…å­˜ï¼Œå¦‚æœXMLæ–‡ä»¶å¾ˆå¤§ï¼Œå¯èƒ½å‡ºç°å†…å­˜æº¢å‡ºã€‚
- SAXè§£æ
  - ä¼˜ç‚¹ï¼šäº‹ä»¶é©±åŠ¨å‹è§£æï¼Œè¯»å–ä¸€è¡Œå°±è§£æä¸€è¡Œï¼Œé‡Šæ”¾å†…å­˜ã€‚ç†è®ºä¸Šå¯ä»¥è§£æä»»æ„å¤§å°çš„XMLæ–‡ä»¶ã€‚
  - ç¼ºç‚¹ï¼šä½¿ç”¨è¿‡çš„å…ƒç´ ä¸èƒ½å†è®¿é—®äº†ï¼Œä¸èƒ½ä¿®æ”¹å…ƒç´ ï¼Œåªèƒ½æŸ¥æ‰¾ã€‚

Javaä¸­DOMè§£æå¼€å‘åŒ…

- JAXP
- JDOM
- Dom4j
- Jsoup

**XMLæ–‡æ¡£ç”ŸæˆDOMæ ‘åŸç†**

XML DOMå’ŒHTML DOMä¸€æ ·ï¼ŒXML DOMå°†æ•´ä¸ªXMLæ–‡æ¡£åŠ è½½åˆ°å†…å­˜ï¼Œç”Ÿæˆä¸€ä¸ªDOMæ ‘ï¼Œå¹¶è·å¾—ä¸€ä¸ªDocumentå¯¹è±¡ï¼Œé€šè¿‡Documentå¯¹è±¡å°±å¯ä»¥å¯¹DOMè¿›è¡Œæ“ä½œã€‚

XMLæ–‡ä»¶==documentæ–‡æ¡£å¯¹è±¡æ ‘\==DOMæ ‘

### 28.3 Dom4J

Dom4Jï¼šè·å–Documentå¯¹è±¡å’Œæ ¹å…ƒç´ ã€‚

Dom4Jå®‰è£…æ­¥éª¤

- å»Dom4Jå®˜ç½‘ä¸‹è½½Dom4Jçš„æ¡†æ¶ï¼šéƒ½æ˜¯ä¸€äº›jaråŒ…ã€‚
- æŠŠDom4Jçš„æ ¸å¿ƒjaråŒ…å¯¼å…¥åˆ°å½“å‰é¡¹ç›®ä¸­å»ã€‚
- åœ¨é¡¹ç›®ä¸­åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼šlibã€‚
- å°†dom4j-2.1.1.jaræ–‡ä»¶å¤åˆ¶åˆ°libæ–‡ä»¶å¤¹ã€‚
- åœ¨jaræ–‡ä»¶ä¸Šç‚¹å³é”®ï¼Œé€‰æ‹©Add as Library -> ç‚¹å‡»OKã€‚
- åœ¨ç±»ä¸­å¯¼åŒ…ä½¿ç”¨ã€‚

Javaæä¾›äº†Classä¸‹çš„ä¸€ä¸ªæ–¹æ³•

- public InputStream getResourceAsStream(String path)ï¼šç”¨äºåŠ è½½æ–‡ä»¶æˆä¸ºä¸€ä¸ªå­—èŠ‚è¾“å…¥æµè¿”å›ã€‚

Documentæ–‡æ¡£

- Element getRootElement()ï¼šè·å–æ ¹å…ƒç´ ã€‚

books.xmlæ–‡æ¡£å†…å®¹å¦‚ä¸‹

```XML
<?xml version="1.0" encoding="UTF-8" ?>
<books>
    <book id="0001" desc="ç¬¬ä¸€æœ¬ä¹¦">
        <name>JavaWebå¼€å‘æ•™ç¨‹</name>
        <author>å¼ å­ç¥¥</author>
        <sale>100.00å…ƒ</sale>
    </book>
    <book id="0002">
        <name>ä¸‰å›½æ¼”ä¹‰</name>
        <author>ç½—è´¯ä¸­</author>
        <sale>100.00å…ƒ</sale>
    </book>
    <user>
    </user>
</books>
```

è·å–documentå¯¹è±¡å’Œæ ¹å…ƒç´ 

```Java
import org.dom4j.Document;
import org.dom4j.Element;
import org.dom4j.io.SAXReader;
import java.io.InputStream;

public class Dom4JDemo {
    public static void main(String[] args) throws Exception {
        SAXReader saxReader = new SAXReader();
        InputStream is = Dom4JDemo.class.getResourceAsStream("/books.xml");
        Document document = saxReader.read(is);
        System.out.println(document);
        Element root = document.getRootElement();
        System.out.println(root.getName());
    }
}
```

Dom4Jè§£æXMLçš„å­å…ƒç´ 

Elementå…ƒç´ çš„API

- String getName()ï¼šå–å…ƒç´ çš„åç§°ã€‚
- List\<Element> elements()ï¼šå–å½“å‰å…ƒç´ ä¸‹çš„å…¨éƒ¨å­å…ƒç´ (ä¸€çº§)ã€‚
- List\<Element> elements(String name)ï¼šè·å–å½“å‰å…ƒç´ ä¸‹çš„æŒ‡å®šåç§°çš„å…¨éƒ¨å­å…ƒç´ (ä¸€çº§)ã€‚
- Element element(String name)ï¼šè·å–å½“å‰å…ƒç´ ä¸‹çš„æŒ‡å®šåç§°çš„æŸä¸ªå­å…ƒç´ ï¼Œé»˜è®¤å–ç¬¬ä¸€ä¸ª(ä¸€çº§)ã€‚

```Java
import org.dom4j.Document;
import org.dom4j.Element;
import org.dom4j.io.SAXReader;

import java.io.File;
import java.util.List;

public class Dom4JDemo01 {
    public static void main(String[] args) throws Exception {
        SAXReader saxReader = new SAXReader();
        Document document = saxReader.read(new File("Day07Demo/src/books.xml"));
        Element root = document.getRootElement();
        System.out.println(root.getName());

        List<Element> sonElement = root.elements();
        for (Element element : sonElement) {
            System.out.println(element.getName());
        }
        System.out.println("-------------------------");

        List<Element> sonElement1 = root.elements("book");
        for (Element element : sonElement1) {
            System.out.println(element.getName());
        }
        System.out.println("-------------------------");

        Element son = root.element("book");
        System.out.println(son.getName());
        System.out.println(son.attributeValue("id"));
    }
}
```

Dom4Jè§£æXMLçš„å±æ€§

Elementå…ƒç´ çš„API

- List\<Attribute> attributes()ï¼šè·å–å…ƒç´ çš„å…¨éƒ¨å±æ€§å¯¹è±¡ã€‚
- Attribute attribute(String name)ï¼šæ ¹æ®åç§°è·å–æŸä¸ªå…ƒç´ çš„å±æ€§å¯¹è±¡ã€‚
- String attributeValue(String var1)ï¼šç›´æ¥è·å–æŸä¸ªå…ƒç´ çš„æŸä¸ªå±æ€§åç§°çš„å€¼ã€‚

Attributeå¯¹è±¡çš„API

- String getName()ï¼šè·å–å±æ€§åç§°ã€‚
- String getValue()ï¼šè·å–å±æ€§å€¼ã€‚

```Java
import org.dom4j.Attribute;
import org.dom4j.Document;
import org.dom4j.Element;
import org.dom4j.io.SAXReader;

import java.io.File;
import java.util.List;

public class Dom4JDemo02 {
    public static void main(String[] args) throws Exception {
        SAXReader saxReader = new SAXReader();
        Document document = saxReader.read(new File("Day07Demo/src/books.xml"));
        Element root = document.getRootElement();
        Element bookEle = root.element("book");
        List<Attribute> attributes = bookEle.attributes();
        for (Attribute attribute : attributes) {
            System.out.println(attribute.getName() + "=>" + attribute.getValue());
        }

        Attribute descAttr = bookEle.attribute("desc");
        System.out.println(descAttr.getName() + "=>" + descAttr.getValue());

        System.out.println(bookEle.attributeValue("id"));
        System.out.println(bookEle.attributeValue("desc"));
    }
}
```

Dom4Jè§£æXMLçš„æ–‡æœ¬

Element

- String elementText(String name)ï¼šå¯ä»¥ç›´æ¥è·å–å½“å‰å…ƒç´ çš„å­å…ƒç´ çš„æ–‡æœ¬å†…å®¹ã€‚
- String elementTextTrim(String name)ï¼šå»å‰åç©ºæ ¼ï¼Œç›´æ¥è·å–å½“å‰å…ƒç´ çš„å­å…ƒç´ çš„æ–‡æœ¬å†…å®¹ã€‚
- String getText()ï¼šç›´æ¥è·å–å½“å‰å…ƒç´ çš„æ–‡æœ¬å†…å®¹ã€‚
- String getTextTrim()ï¼šå»å‰åç©ºæ ¼ï¼Œç›´æ¥è·å–å½“å‰å…ƒç´ çš„æ–‡æœ¬å†…å®¹ã€‚

```Java
import org.dom4j.Document;
import org.dom4j.Element;
import org.dom4j.io.SAXReader;

import java.io.File;

public class Dom4JDemo03 {
    public static void main(String[] args) throws Exception {
        SAXReader saxReader = new SAXReader();
        Document document = saxReader.read(new File("Day07Demo/src/books.xml"));
        Element root = document.getRootElement();

        Element bookEle = root.element("book");
        System.out.println(bookEle.elementText("name"));
        System.out.println(bookEle.elementTextTrim("name"));
        System.out.println(bookEle.elementText("author"));
        System.out.println(bookEle.elementTextTrim("author"));
        System.out.println(bookEle.elementText("sale"));
        System.out.println(bookEle.elementTextTrim("sale"));

        Element bookNameEle = bookEle.element("name");
        System.out.println(bookNameEle.getText());
        System.out.println(bookNameEle.getTextTrim());
    }
}
```

Dom4Jè§£æXMLæ–‡ä»¶ï¼šContacts.xmlæˆä¸ºä¸€ä¸ªJavaçš„å¯¹è±¡(é›†åˆå¯¹è±¡)ã€‚

Contacts.xmlè§£ææˆ===>List\<Contact>

Contacts.xmlæ–‡ä»¶

```XML
<?xml version="1.0" encoding="UTF-8" ?>
<contactList>
    <contact id="1" vip="true">
        <name>æ½˜é‡‘è²</name>
        <gender>å¥³</gender>
        <email>panpan@ithei.cn</email>
    </contact>
    <contact id="2" vip="false">
        <name>æ­¦æ¾</name>
        <gender>ç”·</gender>
        <email>wusong@ithei.cn</email>
    </contact>
    <contact id="3" vip="false">
        <name>æ­¦å¤§éƒ</name>
        <gender>ç”·</gender>
        <email>wuda@ithei.cn</email>
    </contact>
</contactList>
```

Contact.javaç±»

```Java
public class Contact {
    private int id;
    private boolean vip;
    private String name;
    private char sex;
    private String email;

    public Contact() {
    }

    public Contact(int id, boolean vip, String name, char sex, String email) {
        this.id = id;
        this.vip = vip;
        this.name = name;
        this.sex = sex;
        this.email = email;
    }

    public int getId() {
        return id;
    }

    public void setId(int id) {
        this.id = id;
    }

    public boolean isVip() {
        return vip;
    }

    public void setVip(boolean vip) {
        this.vip = vip;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public char getSex() {
        return sex;
    }

    public void setSex(char sex) {
        this.sex = sex;
    }

    public String getEmail() {
        return email;
    }

    public void setEmail(String email) {
        this.email = email;
    }

    @Override
    public String toString() {
        return "Contact{" +
                "id=" + id +
                ", vip=" + vip +
                ", name='" + name + '\'' +
                ", sex=" + sex +
                ", email='" + email + '\'' +
                '}';
    }
}
```

Dom4Jè§£æç±»

```Java
import org.dom4j.Document;
import org.dom4j.Element;
import org.dom4j.io.SAXReader;

import java.io.File;
import java.util.ArrayList;
import java.util.List;

public class Dom4JDemo04 {
    public static void main(String[] args) throws Exception {
        SAXReader saxReader = new SAXReader();
        Document document = saxReader.read(new File("Day07Demo/src/Contacts.xml"));
        Element root = document.getRootElement();

        List<Element> sonElements = root.elements();
        List<Contact> contactList = new ArrayList<>();
        if (sonElements != null && sonElements.size() > 0) {
            for (Element sonElement : sonElements) {
                Contact contact = new Contact();
                contact.setId(Integer.valueOf(sonElement.attributeValue("id")));
                contact.setVip(Boolean.valueOf(sonElement.attributeValue("vip")));
                contact.setName(sonElement.elementText("name"));
                contact.setSex(sonElement.elementText("gender").charAt(0));
                contact.setEmail(sonElement.elementText("email"));
                contactList.add(contact);
            }
        }
        System.out.println(contactList);
    }
}
```

### 28.4 XPathæŠ€æœ¯

XPathä½œç”¨ï¼šä¸€ç§ç”¨äºå¿«é€ŸæŸ¥æ‰¾XMLå…ƒç´ çš„è·¯å¾„è¡¨è¾¾å¼ï¼Œæ˜¯ç”¨äºæ–¹ä¾¿åœ°æ£€ç´¢XMLæ–‡ä»¶ä¸­çš„ä¿¡æ¯ã€‚

XPathè¡¨è¾¾å¼åˆ†ç±»

- ç»å¯¹è·¯å¾„
- ç›¸å¯¹è·¯å¾„
- å…¨æ–‡æœç´¢
- å±æ€§æŸ¥æ‰¾

XPathå¸¸ç”¨API

- List\<Node> selectNodes(String var1)ï¼šæ£€ç´¢å‡ºä¸€æ‰¹èŠ‚ç‚¹é›†åˆã€‚
- Node selectSingleNode(String var1)ï¼šæ£€ç´¢å‡ºä¸€ä¸ªèŠ‚ç‚¹è¿”å›ã€‚

```Java
import org.dom4j.Attribute;
import org.dom4j.Document;
import org.dom4j.Element;
import org.dom4j.Node;
import org.dom4j.io.SAXReader;
import org.junit.Test;

import java.io.InputStream;
import java.util.List;

public class XPathDemo {
    @Test
    public void path01() throws Exception {
        SAXReader saxReader = new SAXReader();
        InputStream is = Dom4JDemo04.class.getResourceAsStream("/Contacts.xml");
        Document document = saxReader.read(is);
        List<Node> nameNodes = document.selectNodes("/contactList/contact/name");
        for (Node nameNode : nameNodes) {
            System.out.println(nameNode.getText());
        }
    }

    @Test
    public void path02() throws Exception {
        SAXReader saxReader = new SAXReader();
        InputStream is = Dom4JDemo04.class.getResourceAsStream("/Contacts.xml");
        Document document = saxReader.read(is);
        Element root = document.getRootElement();
        List<Node> nameNodes = root.selectNodes("./contact/name");
        for (Node nameNode : nameNodes) {
            System.out.println(nameNode.getText());
        }
    }

    @Test
    public void path03() throws Exception {
        SAXReader saxReader = new SAXReader();
        InputStream is = Dom4JDemo04.class.getResourceAsStream("/Contacts.xml");
        Document document = saxReader.read(is);
        List<Node> nameNodes = document.selectNodes("//name");
        for (Node nameNode : nameNodes) {
            System.out.println(nameNode.getText());
        }
        System.out.println("-----------------------------------------------");
        List<Node> nameNodes1 = document.selectNodes("//contact/name");
        for (Node nameNode : nameNodes1) {
            System.out.println(nameNode.getText());
        }
        System.out.println("-----------------------------------------------");
        List<Node> nameNodes2 = document.selectNodes("//contact//name");
        for (Node nameNode : nameNodes2) {
            System.out.println(nameNode.getText());
        }
    }

    @Test
    public void path04() throws Exception {
        SAXReader saxReader = new SAXReader();
        InputStream is = Dom4JDemo04.class.getResourceAsStream("/Contacts.xml");
        Document document = saxReader.read(is);
        List<Node> attributes = document.selectNodes("//@id");
        for (Node attribute : attributes) {
            Attribute attr = (Attribute) attribute;
            System.out.println(attr.getName() + "--->" + attr.getValue());
        }
        System.out.println("-----------------------------------------------");
        List<Node> nodeEles = document.selectNodes("//contact[@id]");
        for (Node nodeEle : nodeEles) {
            System.out.println(nodeEle.getName());
        }
        System.out.println("-----------------------------------------------");
        Node nodeEle = document.selectSingleNode("//contact[@id=2]");
        Element ele = (Element) nodeEle;
        System.out.println(ele.elementTextTrim("name"));
    }
}
```

æ³¨æ„ï¼šXPathä¾èµ–Dom4JæŠ€æœ¯ ï¼Œå¿…é¡»å…ˆå¯¼å…¥Dom4Jï¼Œä¸”ä½¿ç”¨XPathéœ€è¦å¦å¤–å¯¼å…¥jaxen-1.1.2.jaråŒ…ã€‚

## 29. è®¾è®¡æ¨¡å¼ç­‰æ€æƒ³

å·¥å‚è®¾è®¡æ¨¡å¼ï¼šå·¥å‚æ¨¡å¼(Factory Pattern)æ˜¯Javaä¸­æœ€å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼ä¹‹ä¸€ã€‚è¿™ç§ç±»å‹çš„è®¾è®¡æ¨¡å¼å±äºåˆ›å»ºå‹æ¨¡å¼ï¼Œå®ƒæä¾›äº†ä¸€ç§åˆ›å»ºå¯¹è±¡çš„æ–¹å¼ã€‚ä¹‹å‰æˆ‘ä»¬åˆ›å»ºå¯¹è±¡æ—¶ï¼Œéƒ½æ˜¯ä½¿ç”¨new å¯¹è±¡çš„å½¢å¼åˆ›å»ºï¼Œé™¤new å¯¹è±¡æ–¹å¼ä»¥å¤–ï¼Œå·¥å‚æ¨¡å¼ä¹Ÿå¯ä»¥åˆ›å»ºå¯¹è±¡ã€‚

å·¥å‚è®¾è®¡æ¨¡å¼çš„ä½œç”¨

- å¯¹è±¡é€šè¿‡å·¥å‚çš„æ–¹æ³•åˆ›å»ºè¿”å›ï¼Œå·¥å‚çš„æ–¹æ³•å¯ä»¥ä¸ºè¯¥å¯¹è±¡è¿›è¡ŒåŠ å·¥å’Œæ•°æ®æ³¨å…¥ã€‚
- å¯ä»¥å®ç°ç±»ä¸ç±»ä¹‹é—´çš„è§£è€¦æ“ä½œã€‚

å°ç»“

- ä¼˜ç‚¹ï¼šå·¥å‚æ¨¡å¼çš„å­˜åœ¨å¯ä»¥æ”¹å˜åˆ›å»ºå¯¹è±¡çš„æ–¹å¼ï¼Œè§£å†³ç±»ä¸ç±»ä¹‹é—´çš„è€¦åˆã€‚
- ç¼ºç‚¹ï¼šå·¥å‚è®¾è®¡æ¨¡å¼å¤šäº†ä¸€ä¸ªå·¥å‚ç±»ã€‚

å·¥å‚ç±»

```Java
public class FactoryPattern {
    public static Animal creatAnimal() {
        return new Dog();
    }
}
```

æµ‹è¯•ç±»

```Java
public class FactoryDemo {
    public static void main(String[] args) {
        Animal a = FactoryPattern.creatAnimal();
        a.run();
    }
}
```

è£…é¥°æ¨¡å¼ï¼šè£…é¥°æ¨¡å¼æŒ‡çš„æ˜¯åœ¨ä¸æ”¹å˜åŸç±»ï¼Œä¸ä½¿ç”¨ç»§æ‰¿çš„åŸºç¡€ä¸Šï¼ŒåŠ¨æ€åœ°æ‰©å±•ä¸€ä¸ªç±»çš„åŠŸèƒ½ã€‚

æ€æƒ³ï¼šæ˜¯åˆ›å»ºä¸€ä¸ªæ–°ç±»ï¼ŒåŒ…è£…åŸå§‹ç±»ï¼Œä»è€Œåœ¨æ–°ç±»ä¸­æå‡åŸæ¥ç±»çš„åŠŸèƒ½ã€‚

å°ç»“

- è£…é¥°æ¨¡å¼å¯ä»¥åœ¨ä¸æ”¹å˜åŸç±»çš„åŸºç¡€ä¸Šå¯¹ç±»ä¸­çš„æ–¹æ³•è¿›è¡Œæ‰©å±•å¢å¼ºï¼Œå®ç°åŸåˆ™å¦‚ä¸‹
  - å®šä¹‰çˆ¶ç±»
  - å®šä¹‰åŸå§‹ç±»ï¼Œç»§æ‰¿çˆ¶ç±»ï¼Œå®šä¹‰åŠŸèƒ½
  - å®šä¹‰è£…é¥°ç±»ï¼Œç»§æ‰¿çˆ¶ç±»ï¼ŒåŒ…è£…åŸå§‹ç±»ï¼Œå¢å¼ºåŠŸèƒ½

çˆ¶ç±»

```Java
public abstract class InputStream {
    public abstract void read();
    public abstract void close();
}
```

åŸå§‹ç±»

```Java
public class FileInputStream extends InputStream {
    @Override
    public void read() {
        System.out.println("è¯»å–æ•°æ®~~~");
    }

    @Override
    public void close() {
        System.out.println("å…³é—­æµ~~~");
    }
}
```

è£…é¥°ç±»

```Java
public class BufferedInputStream extends InputStream {
    private InputStream is;
    public BufferedInputStream(InputStream is) {
        this.is = is;
    }
    @Override
    public void read() {
        System.out.println("å¼€å¯é«˜æ•ˆç¼“å†²è¯»å–~");
        is.read();
    }

    @Override
    public void close() {
        is.close();
    }
}
```

æµ‹è¯•ç”¨ä¾‹ç±»

```Java
public class Demo {
    public static void main(String[] args) {
        InputStream is = new BufferedInputStream(new FileInputStream());
        is.read();
        is.close();
    }
}
```

**Commons-ioåŒ…**

Commons-ioåŒ…ï¼šcommons-ioæ˜¯apacheå¼€æºåŸºé‡‘ç»„ç»‡æä¾›çš„ä¸€ç»„æœ‰å…³IOæ“ä½œçš„ç±»åº“ï¼Œå¯ä»¥æé«˜IOåŠŸèƒ½å¼€å‘çš„æ•ˆç‡ã€‚commons-ioå·¥å…·åŒ…æä¾›äº†å¾ˆå¤šæœ‰å…³ioæ“ä½œçš„ç±»ã€‚

å°ç»“ï¼šIOUtilså’ŒFileUtilså¯ä»¥æ–¹ä¾¿åœ°å¤åˆ¶æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ã€‚

```Java
import org.apache.commons.io.FileUtils;
import org.apache.commons.io.IOUtils;

import java.io.File;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.nio.file.Files;
import java.nio.file.Paths;

public class CommonsIODemo {
    public static void main(String[] args) throws Exception {
        IOUtils.copy(new FileInputStream("Day07Demo/src/books.xml"),new FileOutputStream("Day07Demo/new.xml"));
        FileUtils.copyFileToDirectory(new File("Day07Demo/src/books.xml"), new File("F:/test"));
        FileUtils.copyDirectoryToDirectory(new File("D:\\letsvpn"), new File("F:\\test"));
        Files.copy(Paths.get("Day07Demo/src/books.xml"), new FileOutputStream("Day07Demo/new1.xml"));
    }
}
```

**Base64**

Base64æ¦‚è¿°ï¼šBase64æ˜¯ç½‘ç»œä¸Šæœ€å¸¸è§çš„ç”¨äºä¼ è¾“8Bitå­—èŠ‚ç çš„ç¼–ç æ–¹å¼ä¹‹ä¸€ï¼ŒBase64å°±æ˜¯ä¸€ç§åŸºäº64ä¸ªå¯æ‰“å°å­—ç¬¦æ¥è¡¨ç¤ºäºŒè¿›åˆ¶æ•°æ®çš„æ–¹æ³•ã€‚

åœ¨Java 8ä¸­ï¼ŒBase64ç¼–ç å·²ç»æˆä¸ºJavaç±»åº“çš„æ ‡å‡†ã€‚

Java 8å†…ç½®äº†Base64ç¼–ç çš„ç¼–ç å™¨å’Œè§£ç å™¨ã€‚

Base64å·¥å…·ç±»æä¾›äº†ä¸€å¥—é™æ€æ–¹æ³•è·å–ä¸‹é¢ä¸‰ç§BASE64ç¼–è§£ç å™¨

- åŸºæœ¬ï¼šè¾“å‡ºè¢«æ˜ å°„åˆ°ä¸€ç»„å­—ç¬¦A-Za-z0-9+/ï¼Œç¼–ç ä¸æ·»åŠ ä»»ä½•è¡Œæ ‡ï¼Œè¾“å‡ºçš„è§£ç ä»…æ”¯æŒA-Za-z0-9+/ã€‚
- URLï¼šè¾“å‡ºæ˜ å°„åˆ°ä¸€ç»„å­—ç¬¦A-Za-z0-9+_ï¼Œè¾“å‡ºæ˜¯URLå’Œæ–‡ä»¶ã€‚
- MIMEï¼šè¾“å‡ºæ˜ å°„åˆ°MIMEå‹å¥½æ ¼å¼ã€‚è¾“å‡ºæ¯è¡Œä¸è¶…è¿‡76å­—ç¬¦ï¼Œå¹¶ä¸”ä½¿ç”¨â€˜\râ€™å¹¶è·Ÿéšâ€˜\nâ€™ä½œä¸ºåˆ†å‰²ã€‚ç¼–ç è¾“å‡ºæœ€åæ²¡æœ‰è¡Œåˆ†å‰²ã€‚

```Java
import java.util.Base64;
import java.util.UUID;

public class Base64Demo {
    public static void main(String[] args) {
        try {
            String rs1 = Base64.getEncoder().encodeToString("å…¨æ ˆç¨‹åºå‘˜".getBytes());
            System.out.println(rs1);
            byte[] buffer = Base64.getDecoder().decode(rs1);
            System.out.println(new String(buffer));

            String rs2 = Base64.getUrlEncoder().encodeToString("?loginName=å…¨æ ˆ&password=123456".getBytes());
            System.out.println(rs2);
            byte[] buffer1 = Base64.getUrlDecoder().decode(rs2);
            System.out.println(new String(buffer1));

            StringBuilder sb = new StringBuilder();
            for (int i = 0; i < 10; i++) {
                sb.append(UUID.randomUUID().toString());
            }
            String rs3 = Base64.getMimeEncoder().encodeToString(sb.toString().getBytes());
            System.out.println(rs3);
            byte[] buffer2 = Base64.getMimeDecoder().decode(rs3);
            System.out.println(new String(buffer2));

        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
```

## 30. JDK8æ—¥æœŸAPIè§£æ

### 30.1 å¼•å…¥

è€ç‰ˆæœ¬APIè®¡ç®—æ—¶é—´å›°éš¾ï¼Œåœ¨æ¯«ç§’è®¡ç®—æ—¶å®¹æ˜“å‡ºç°è¯¯å·®

```Java
import java.time.LocalDate;
import java.time.temporal.ChronoUnit;
import java.util.Calendar;
import java.util.Date;

public class JavaUtilTimeCalculateDemo {
    public static void main(String[] args) {
        Date d = new Date();
        long s1 = d.getTime();

        Calendar c = Calendar.getInstance();
        c.set(1995,11,16);
        Date d2 = c.getTime();
        long s2 = d2.getTime();

        long intervalDay = (s1 - s2) / 1000 / 60 / 60 / 24;
        System.out.println("1995å¹´12æœˆ16æ—¥è·ç¦»ç°åœ¨å·²ç»è¿‡äº†" + intervalDay + "å¤©");
        System.out.println("-------------------------------------------------");

        long day = ChronoUnit.DAYS.between(LocalDate.of(1995, 12, 16), LocalDate.now());
        System.out.println("1995å¹´12æœˆ16æ—¥è·ç¦»ç°åœ¨å·²ç»è¿‡äº†" + day + "å¤©");
    }
}
```

è€ç‰ˆæœ¬APIä¼šå‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜

- SimpleDateFormatç±»æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œåœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œå…¨å±€å…±äº«ä¸€ä¸ªSimpleDateFormatç±»ä¸­çš„Calendarå¯¹è±¡æœ‰å¯èƒ½ä¼šå‡ºç°å¼‚å¸¸ã€‚éœ€è¦è€ƒè™‘åŠ é”æ¥è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚

```Java
import java.text.SimpleDateFormat;
import java.util.Date;

public class SimpleDateFormatUnsafeDemo {
    final static SimpleDateFormat SIMPLE_DATE_FORMAT = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");

    public static void main(String[] args) {
        for (int i = 0; i < 10; i++) {
            new Thread(new Runnable() {
                @Override
                public void run() {
                    try {
                        synchronized (SIMPLE_DATE_FORMAT) {
                            Date date = SIMPLE_DATE_FORMAT.parse("2018-12-12 12:12:12");
                            System.out.println(date);
                        }
                    } catch (Exception e) {
                        e.printStackTrace();
                    }
                }
            }).start();
        }
    }
}
```

è€ç‰ˆæœ¬ä½¿ç”¨è§„èŒƒé—®é¢˜

```Java
import java.util.Calendar;

public class CalendarUnSafeDemo {
    public static void main(String[] args) {
        Calendar calendar = Calendar.getInstance();
        // å¼€å‘è§„èŒƒï¼šä¸å…è®¸ä½¿ç”¨æ²¡æœ‰å®šä¹‰çš„é­”æ³•æ•°å­—.
        calendar.set(2008,Calendar.AUGUST,8);
    }
}
```

### 30.2 å¸¸ç”¨ç±»çš„æ¦‚è¿°ä¸åŠŸèƒ½ä»‹ç»

**Instantç±»**

- Instantç±»å¯¹æ—¶é—´è½´ä¸Šçš„å•ä¸€ç¬æ—¶ç‚¹å»ºæ¨¡ï¼Œå¯ä»¥ç”¨äºè®°å½•åº”ç”¨ç¨‹åºä¸­çš„äº‹ä»¶æ—¶é—´æˆ³ï¼Œåœ¨ä¹‹åå­¦ä¹ çš„ç±»å‹è½¬æ¢ä¸­ï¼Œå‡å¯ä»¥ä½¿ç”¨Instantç±»ä½œä¸ºä¸­é—´ç±»å®Œæˆè½¬æ¢ã€‚

**Durationç±»**

- Durationç±»è¡¨ç¤ºç§’æˆ–çº³ç§’æ—¶é—´é—´éš”ï¼Œé€‚åˆå¤„ç†è¾ƒçŸ­çš„æ—¶é—´ï¼Œéœ€è¦æ›´é«˜çš„ç²¾ç¡®æ€§ã€‚

**Periodç±»**

- Periodç±»è¡¨ç¤ºä¸€æ®µæ—¶é—´çš„å¹´ã€æœˆã€æ—¥ã€‚

**LocalDateç±»**

- LocalDateæ˜¯ä¸€ä¸ªä¸å¯å˜çš„æ—¥æœŸæ—¶é—´å¯¹è±¡ï¼Œè¡¨ç¤ºæ—¥æœŸï¼Œé€šå¸¸è¢«è§†ä¸ºå¹´æœˆæ—¥ã€‚

**LocalTimeç±»**

- LocalTimeæ˜¯ä¸€ä¸ªä¸å¯å˜çš„æ—¥æœŸæ—¶é—´å¯¹è±¡ï¼Œé€šå¸¸è¢«çœ‹ä½œæ˜¯å°æ—¶-ç§’ï¼Œæ—¶é—´è¡¨ç¤ºä¸ºçº³ç§’ç²¾åº¦ã€‚

**LocalDateTimeç±»**

- LocalDateTimeæ˜¯ä¸€ä¸ªä¸å¯å˜çš„æ—¥æœŸæ—¶é—´å¯¹è±¡ï¼Œä»£è¡¨æ—¥æœŸæ—¶é—´ï¼Œé€šå¸¸è¢«è§†ä¸ºå¹´-æœˆ-æ—¥-æ—¶-åˆ†-ç§’ã€‚

**ZonedDateTimeç±»**

- ZonedDateTimeæ˜¯å…·æœ‰æ—¶åŒºçš„æ—¥æœŸæ—¶é—´çš„ä¸å¯å˜è¡¨ç¤ºï¼Œæ­¤ç±»å­˜å‚¨æ‰€æœ‰æ—¥æœŸå’Œæ—¶é—´å­—æ®µï¼Œç²¾åº¦ä¸ºçº³ç§’ï¼Œæ—¶åŒºä¸ºåŒºåŸŸåç§»é‡ï¼Œç”¨äºå¤„ç†æ¨¡ç³Šçš„æœ¬åœ°æ—¥æœŸæ—¶é—´ã€‚

Date-Time APIä¸­çš„æ‰€æœ‰ç±»å‡ç”Ÿæˆä¸å¯å˜å®ä¾‹ï¼Œå®ƒä»¬æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¹¶ä¸”è¿™äº›ç±»ä¸æä¾›å…¬å…±æ„é€ å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´æ²¡åŠæ³•é€šè¿‡newçš„æ–¹å¼ç›´æ¥åˆ›å»ºï¼Œéœ€è¦é‡‡ç”¨å·¥å‚æ–¹æ³•åŠ ä»¥å®ä¾‹åŒ–ã€‚

nowæ–¹æ³•åœ¨æ—¥æœŸ/æ—¶é—´ç±»çš„ä½¿ç”¨

- nowæ–¹æ³•å¯ä»¥æ ¹æ®å½“å‰æ—¥æœŸæˆ–æ—¶é—´åˆ›å»ºå®ä¾‹ã€‚

```Java
import java.time.*;

public class JavaTimeDemo {
    public static void main(String[] args) {
        Instant instantNow = Instant.now();
        LocalDate localDateNow = LocalDate.now();
        LocalTime localTimeNow = LocalTime.now();
        LocalDateTime localDateTimeNow = LocalDateTime.now();
        ZonedDateTime zonedDateTimeNow = ZonedDateTime.now();
        System.out.println(instantNow);
        System.out.println(localDateNow);
        System.out.println(localTimeNow);
        System.out.println(localDateTimeNow);
        System.out.println(zonedDateTimeNow);
    }
}
```

```Java
import java.time.*;

public class JavaTimeDemo {
    public static void main(String[] args) {
        Year year = Year.now();
        YearMonth yearMonth = YearMonth.now();
        MonthDay monthDay = MonthDay.now();
        System.out.println(year);
        System.out.println(yearMonth);
        System.out.println(monthDay);
    }
}
```

ofæ–¹æ³•åœ¨æ—¥æœŸ/æ—¶é—´ç±»çš„åº”ç”¨

- ofæ–¹æ³•å¯ä»¥æ ¹æ®ç»™å®šçš„å‚æ•°ç”Ÿæˆå¯¹åº”çš„æ—¥æœŸ/æ—¶é—´å¯¹è±¡ï¼ŒåŸºæœ¬ä¸Šæ¯ä¸ªåŸºæœ¬ç±»éƒ½æœ‰ofæ–¹æ³•ç”¨äºç”Ÿæˆçš„å¯¹åº”çš„å¯¹è±¡ï¼Œè€Œä¸”é‡è½½å½¢å¼å¤šå˜ï¼Œå¯ä»¥æ ¹æ®ä¸åŒçš„å‚æ•°ç”Ÿæˆå¯¹åº”çš„æ•°æ®ã€‚

```Java
import java.time.LocalDate;
import java.time.LocalDateTime;
import java.time.LocalTime;

public class JavaTimeDemo01 {
    public static void main(String[] args) {
        LocalDate localDate = LocalDate.of(2018, 8, 8);
        System.out.println(localDate);

        LocalTime localTime = LocalTime.of(20, 0,0,0);
        System.out.println(localTime);

        LocalDateTime localDateTime = LocalDateTime.of(2018, 8, 8, 20, 0);
        System.out.println(localDateTime);
        LocalDateTime localDateTime1 = LocalDateTime.of(localDate, localTime);
        System.out.println(localDateTime1);
    }
}
```

æ—¶åŒºä¿¡æ¯çš„è·å–

```Java
import java.time.ZoneId;
import java.util.Set;

public class JavaTimeDemo01 {
    public static void main(String[] args) {
        Set<String> availableZoneIds = ZoneId.getAvailableZoneIds();
        System.out.println(availableZoneIds.size());
        for (String availableZoneId : availableZoneIds) {
            System.out.println(availableZoneId);
        }
        System.out.println("---------------------------------------");
        ZoneId zoneId = ZoneId.systemDefault();
        System.out.println(zoneId);
    }
}
```

ä¸ºLocalDateTimeæ·»åŠ æ—¶åŒºä¿¡æ¯

- å°è£…æ—¶é—´LocalDateTimeå¹¶æ·»åŠ æ—¶åŒºä¿¡æ¯
- æ›´æ”¹æ—¶åŒºä¿¡æ¯æŸ¥çœ‹å¯¹åº”æ—¶é—´

```Java
import java.time.LocalDateTime;
import java.time.ZoneId;
import java.time.ZonedDateTime;

public class JavaTimeDemo01 {
    public static void main(String[] args) {
        LocalDateTime localDateTime = LocalDateTime.of(2018, 11, 11, 8, 54, 38);
        ZonedDateTime zonedDateTime = localDateTime.atZone(ZoneId.of("Asia/Shanghai"));
        System.out.println("ä¸Šæµ·å½“å‰çš„æ—¶é—´æ˜¯ï¼š" + zonedDateTime);

        ZonedDateTime zonedDateTime1 = zonedDateTime.withZoneSameInstant(ZoneId.of("Asia/Tokyo"));
        System.out.println("åŒä¸€æ—¶åˆ»ä¸œäº¬çš„æ—¶é—´æ˜¯ï¼š" + zonedDateTime1);
    }
}
```

Monthæšä¸¾ç±»çš„ä½¿ç”¨

java.timeåŒ…ä¸­å¼•å…¥äº†Monthçš„æšä¸¾ï¼ŒMonthä¸­åŒ…å«æ ‡å‡†æ—¥å†ä¸­çš„12ä¸ªæœˆä»½çš„å¸¸é‡(ä»JANURAYåˆ°DECEMBER)ä¹Ÿæä¾›äº†ä¸€äº›æ–¹ä¾¿çš„æ–¹æ³•ä¾›æˆ‘ä»¬ä½¿ç”¨ã€‚

æ¨èåœ¨åˆå§‹åŒ–LocalDateå’ŒLocalDateTimeå¯¹è±¡çš„æ—¶å€™ï¼Œæœˆä»½çš„å‚æ•°ä½¿ç”¨æšä¸¾çš„æ–¹å¼ä¼ å…¥ï¼Œè¿™æ ·æ›´ç®€å•æ˜“æ‡‚è€Œä¸”ä¸æ˜“å‡ºé”™ï¼Œå› ä¸ºå¦‚æœæ˜¯è€çš„æ€ç»´ï¼ŒCalendarä¼ å…¥0çš„è¯ï¼Œé‚£ä¹ˆä¼šå‡ºç°å¼‚å¸¸ã€‚

```Java
import java.time.LocalDateTime;
import java.time.Month;

public class JavaTimeDemo02 {
    public static void main(String[] args) {
        LocalDateTime.of(2011, Month.MAY, 15, 11, 11, 11);
        Month month = Month.of(12);
        System.out.println(month);
    }
}
```

### 30.2 pluså’Œwithç­‰å…¶ä»–æ–¹æ³•çš„ä½¿ç”¨

æƒ³è¦ä¿®æ”¹æŸä¸ªæ—¥æœŸ/æ—¶é—´å¯¹è±¡çš„ç°æœ‰å®ä¾‹æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨pluså’Œminusæ–¹æ³•æ¥å®Œæˆæ“ä½œã€‚

Java 8ä¸­æ—¥æœŸæ—¶é—´ç›¸å…³çš„APIä¸­çš„æ‰€æœ‰å®ä¾‹éƒ½æ˜¯ä¸å¯æ”¹å˜çš„ï¼Œä¸€æ—¦åˆ›å»ºLocalDateï¼ŒLocalTimeï¼ŒLocalDateTimeå°±æ— æ³•ä¿®æ”¹ä»–ä»¬(ç±»ä¼¼äºString)ï¼Œè¿™å¯¹äºçº¿ç¨‹å®‰å…¨éå¸¸æœ‰åˆ©ã€‚

```Java
import java.time.*;

public class JavaTimeDemo02 {
    public static void main(String[] args) {
        LocalDate localDate = LocalDate.of(2016, 2, 13);
        System.out.println("å½“å‰æ—¶é—´æ˜¯ï¼š" + localDate);
        LocalDate localDate1 = localDate.plusDays(4);
        System.out.println("4å¤©åæ—¶é—´æ˜¯ï¼š" + localDate1);
        System.out.println(localDate == localDate1);
        LocalDate localDate2 = localDate.plusWeeks(3);
        System.out.println("3å‘¨åæ—¶é—´æ˜¯ï¼š" + localDate2);
        LocalDate localDate3 = localDate.plusMonths(5);
        System.out.println("5æœˆåæ—¶é—´æ˜¯ï¼š" + localDate3);
        LocalDate localDate4 = localDate.plusYears(2);
        System.out.println("2å¹´åæ—¶é—´æ˜¯ï¼š" + localDate4);
    }
}
```

éœ€æ±‚æ¡ˆä¾‹ï¼šä»Šå¤©ç¨‹åºå‘˜å°å¼ æŸ¥çœ‹è‡ªå·±çš„è½¦è¾†ä¿é™©è®°å½•çš„æ—¶å€™çœ‹åˆ°è¿˜æœ‰2å¹´3æœˆ8å¤©å°±åˆ°æœŸäº†ï¼Œè®¡ç®—åˆ°æœŸçš„æ—¶é—´æ˜¯ä»€ä¹ˆæ—¶å€™ã€‚

```Java
import java.time.*;

public class JavaTimeDemo02 {
    public static void main(String[] args) {
        LocalDateTime now = LocalDateTime.now();
        LocalDateTime endTime = now.plusYears(2).plusMonths(3).plusDays(8);
        System.out.println("å½“å‰æ—¶é—´ï¼š" + now + "ï¼Œåˆ°æœŸæ—¶é—´ï¼š" + endTime);
        Period period = Period.of(2, 3, 8);
        LocalDateTime endT = now.plus(period);
        System.out.println("å½“å‰æ—¶é—´ï¼š" + now + "ï¼Œåˆ°æœŸæ—¶é—´ï¼š" + endT);
    }
}
```

éœ€æ±‚æ¡ˆä¾‹ï¼šç»“å©š10å¹´ç§°ä¸ºé”¡å©šï¼Œ2020å¹´2æœˆ2æ—¥11ç‚¹11åˆ†11ç§’ç§°ä¸ºå¯¹ç§°æ—¥ï¼Œå¾ˆå¤šæƒ…ä¾£å‡†å¤‡åœ¨é‚£å¤©ç»“å©šï¼Œå¦‚æœåœ¨é‚£å¤©ç»“å©šäº†ï¼Œé‚£ä¹ˆé”¡å©šä¼šå‘ç”Ÿåœ¨ä»€ä¹ˆæ—¶å€™ã€‚

```Java
import java.time.*;
import java.time.temporal.ChronoUnit;

public class JavaTimeDemo02 {
    public static void main(String[] args) {
        LocalDateTime marryTime = LocalDateTime.of(2020, Month.FEBRUARY, 2, 11, 11, 11);
        LocalDateTime time = marryTime.plus(1, ChronoUnit.DECADES);
        System.out.println("ç»“å©šæ—¶é—´ï¼š" + marryTime + "ï¼Œé”¡å©šæ—¶é—´ï¼š" + time);
        LocalDateTime eatTime = time.plus(1, ChronoUnit.HALF_DAYS);
        System.out.println("è¯·å®¢åƒé¥­æ—¶é—´ï¼š" + eatTime);
    }
}
```

withæ–¹æ³•çš„ä½¿ç”¨

- å¦‚æœä¸éœ€è¦å¯¹æ—¥æœŸè¿›è¡ŒåŠ å‡è€Œæ˜¯è¦ç›´æ¥ä¿®æ”¹æ—¥æœŸçš„è¯ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨withæ–¹æ³•ï¼Œwithæ–¹æ³•æä¾›äº†å¾ˆå¤šç§ä¿®æ”¹æ—¶é—´çš„æ–¹å¼ã€‚

```Java
import java.time.LocalDateTime;
import java.time.temporal.ChronoField;

public class JavaTimeDemo03 {
    public static void main(String[] args) {
        LocalDateTime time = getTime();
        LocalDateTime resultTime = time.withDayOfMonth(1);
        System.out.println("ä¿®æ”¹å‰ï¼š" + time + "ï¼Œä¿®æ”¹åï¼š" + resultTime);
        LocalDateTime result = time.with(ChronoField.DAY_OF_MONTH, 8);
        System.out.println("ä¿®æ”¹å‰ï¼š" + time + "ï¼Œä¿®æ”¹åï¼š" + result);
    }

    public static LocalDateTime getTime() {
        return LocalDateTime.of(1999,12,12,12,12,0);
    }
}
```

è°ƒèŠ‚å™¨TemporalAdjusterä¸æŸ¥è¯¢TemporalQuery

- TemporalAdjustersä¸»è¦ä¹Ÿæ˜¯ä¿®æ”¹æ—¥æœŸçš„ä½œç”¨

```Java
import java.time.LocalDate;
import java.time.temporal.TemporalAdjusters;

public class JavaTimeDemo03 {
    public static void main(String[] args) {
        LocalDate now = LocalDate.now();
        LocalDate localDate = now.with(TemporalAdjusters.firstDayOfMonth());
        System.out.println("æ—¶é—´ä¿®æ”¹ä¸ºå½“æœˆçš„ç¬¬ä¸€å¤©:" + localDate);
        LocalDate localDate1 = now.with(TemporalAdjusters.firstDayOfNextMonth());
        System.out.println(localDate1);
        LocalDate localDate2 = now.with(TemporalAdjusters.firstDayOfNextYear());
        System.out.println(localDate2);
        LocalDate localDate3 = now.with(TemporalAdjusters.lastDayOfMonth());
        System.out.println(localDate3);
        LocalDate localDate4 = now.with(TemporalAdjusters.lastDayOfYear());
        System.out.println(localDate4);
    }
}
```

DayOfWeekçš„ä½¿ç”¨

```Java
import java.time.DayOfWeek;
import java.time.LocalDate;
import java.time.temporal.TemporalAdjusters;

public class JavaTimeDemo03 {
    public static void main(String[] args) {
        LocalDate now = LocalDate.now();
        LocalDate localDate = now.with(DayOfWeek.SUNDAY);
        System.out.println("æ—¶é—´ä¿®æ”¹ä¸º:" + localDate);
        LocalDate w = now.with(TemporalAdjusters.previous(DayOfWeek.WEDNESDAY));
        System.out.println("æ—¶é—´ä¿®æ”¹ä¸º:" + w);
    }
}
```

è‡ªå®šä¹‰TemporalAdjusterè°ƒèŠ‚å™¨

è°ƒæ•´å‘è–ªæ—¥ç±»

```Java
import java.time.DayOfWeek;
import java.time.LocalDate;
import java.time.temporal.Temporal;
import java.time.temporal.TemporalAdjuster;
import java.time.temporal.TemporalAdjusters;

public class PayDayAdjuster implements TemporalAdjuster {
    @Override
    public Temporal adjustInto(Temporal temporal) {
        LocalDate payDay = LocalDate.from(temporal);
        int day;
        if (payDay.getDayOfMonth() != 15) {
            day = 15;
        } else {
            day = payDay.getDayOfMonth();
        }
        LocalDate realPayDay = payDay.withDayOfMonth(day);
        if (realPayDay.getDayOfWeek() == DayOfWeek.SUNDAY || realPayDay.getDayOfWeek() == DayOfWeek.SATURDAY) {
            realPayDay = realPayDay.with(TemporalAdjusters.previous(DayOfWeek.FRIDAY));
        }
        return realPayDay;
    }
}
```

æµ‹è¯•ç”¨ä¾‹ç±»

```Java
import java.time.LocalDate;

public class JavaTimeDemo {
    public static void main(String[] args) {
        LocalDate payDay = LocalDate.of(2018, 12, 15);
        LocalDate realDay = LocalDate.from(new PayDayAdjuster().adjustInto(payDay));
        System.out.println("é¢„è®¡å‘è–ªæ—¥ï¼š" + payDay + "ï¼ŒçœŸå®å‘è–ªæ—¥ï¼š" + realDay);
    }
}
```

TemporalQueryæ—¥æœŸæŸ¥è¯¢çš„åº”ç”¨

```Java
import java.time.LocalDate;
import java.time.Month;
import java.time.temporal.ChronoUnit;
import java.time.temporal.TemporalAccessor;
import java.time.temporal.TemporalQuery;

public class TestQueryImpl implements TemporalQuery<Long[]> {
    @Override
    public Long[] queryFrom(TemporalAccessor temporal) {
        LocalDate date = LocalDate.from(temporal);
        LocalDate d1 = LocalDate.of(date.getYear(), Month.DECEMBER, 25);
        LocalDate d2 = LocalDate.of(date.getYear(), Month.JUNE, 1);
        LocalDate d3 = LocalDate.of(date.getYear(), Month.MAY, 1);
        if (date.isAfter(d1)) {
            d1 = d1.plusYears(1);
        }
        if (date.isAfter(d2)) {
            d2 = d2.plusYears(1);
        }
        if (date.isAfter(d3)) {
            d3 = d3.plusYears(1);
        }
        Long[] lon = {ChronoUnit.DAYS.between(date,d1),ChronoUnit.DAYS.between(date,d2),ChronoUnit.DAYS.between(date,d3)};
        return lon;
    }
}
```

```Java
import java.time.LocalDate;

public class JavaTimeDemo01 {
    public static void main(String[] args) {
        LocalDate date = LocalDate.of(2020,5,30);
        Long[] longs = date.query(new TestQueryImpl());
        System.out.println("è·ç¦»ä¸‹ä¸€ä¸ªåœ£è¯èŠ‚è¿˜æœ‰" + longs[0] + "å¤©ï¼Œè·ç¦»ä¸‹ä¸€ä¸ªå„¿ç«¥èŠ‚è¿˜æœ‰" + longs[1] + "å¤©ï¼Œè·ç¦»ä¸‹ä¸€ä¸ªåŠ³åŠ¨èŠ‚è¿˜æœ‰" + longs[2] + "å¤©");
    }
}
```

**æ—¥æœŸç±»ä¹‹é—´çš„è½¬æ¢**

Java 8ä¸­çš„java.timeåŒ…ä¸­å¹¶æ²¡æœ‰æä¾›å¤ªå¤šçš„å†…ç½®æ–¹å¼æ¥è½¬æ¢java.utilåŒ…ä¸­ç”¨é¢„å¤„ç†æ ‡å‡†æ—¥æœŸå’Œæ—¶é—´çš„ç±»ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Instantç±»ä½œä¸ºä¸­ä»‹ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨java.sql.Dateå’Œjava.sql.Timestampç±»æä¾›çš„æ–¹æ³•è¿›è¡Œè½¬æ¢ã€‚

åˆ©ç”¨Instantç±»è¿›è¡Œè½¬æ¢

```Java
import java.time.Instant;
import java.time.LocalDate;
import java.time.ZoneId;
import java.time.ZonedDateTime;
import java.util.Date;

public class JavaTimeDemo02 {
    public static void main(String[] args) {
        Date d = new Date();
        Instant i = d.toInstant();
        ZonedDateTime zonedDateTime = i.atZone(ZoneId.systemDefault());
        LocalDate localDate = zonedDateTime.toLocalDate();
        System.out.println(d);
        System.out.println(localDate);
    }
}
```

åˆ©ç”¨java.sql.Dateå’Œjava.sql.Timestampç±»

```Java
import java.sql.Date;
import java.sql.Timestamp;
import java.time.LocalDate;
import java.time.LocalDateTime;

public class JavaTimeDemo02 {
    public static void main(String[] args) {
        Date d = new Date(System.currentTimeMillis());
        LocalDate localDate = d.toLocalDate();
        System.out.println(d);
        System.out.println(localDate);

        Timestamp t = new Timestamp(System.currentTimeMillis());
        LocalDateTime time = t.toLocalDateTime();
        System.out.println(t);
        System.out.println(time);
    }
}
```

```Java
import java.time.LocalDate;
import java.util.Date;

public class JavaTimeDemo03 {
    public static void main(String[] args) {
        Date d = new Date();
        java.sql.Date date = new java.sql.Date(d.getTime());
        LocalDate localDate = date.toLocalDate();
        System.out.println(d);
        System.out.println(date);
        System.out.println(localDate);
    }
}
```

Calendarè½¬æ¢ä¸ºZonedDateTime

```Java
import java.time.ZoneId;
import java.time.ZonedDateTime;
import java.util.Calendar;
import java.util.TimeZone;

public class JavaTimeDemo03 {
    public static void main(String[] args) {
        Calendar cal = Calendar.getInstance();
        TimeZone timeZone = cal.getTimeZone();
        ZoneId zoneId = timeZone.toZoneId();
        ZonedDateTime zonedDateTime = ZonedDateTime.ofInstant(cal.toInstant(), zoneId);
        System.out.println(cal);
        System.out.println(zonedDateTime);
    }
}
```

Calendarè½¬æ¢ä¸ºLocalDateTime

```Java
import java.time.LocalDateTime;
import java.util.Calendar;

public class JavaTimeDemo04 {
    public static void main(String[] args) {
        Calendar cal = Calendar.getInstance();
        int year = cal.get(Calendar.YEAR);
        int month = cal.get(Calendar.MONTH);
        int day = cal.get(Calendar.DAY_OF_MONTH);
        int hour = cal.get(Calendar.HOUR);
        int minute = cal.get(Calendar.MINUTE);
        int second = cal.get(Calendar.SECOND);
        LocalDateTime localDateTime = LocalDateTime.of(year, month + 1, day, hour, minute, second);
        System.out.println(localDateTime);
    }
}
```

### 30.3 æ—¥æœŸçš„è§£æä¸æ ¼å¼åŒ–DateTimeFormatter

DateTimeFormatterç±»æä¾›äº†å¤§é‡é¢„å®šä¹‰æ ¼å¼åŒ–å™¨ï¼ŒåŒ…æ‹¬å¸¸é‡(å¦‚ISO_LOCAL_DATE)ï¼Œæ¨¡å¼å­—æ¯(å¦‚yyyy-MM-dd)ä»¥åŠæœ¬åœ°åŒ–æ ·å¼ã€‚

ä¸SimpleDateFormatä¸åŒçš„æ˜¯ï¼Œæ–°ç‰ˆæœ¬çš„æ—¥æœŸ/æ—¶é—´APIçš„æ ¼å¼åŒ–ä¸ä¸éœ€è¦åœ¨åˆ›å»ºè½¬æ¢å™¨å¯¹è±¡å†è¿›è¡Œè½¬æ¢äº†ï¼Œé€šè¿‡æ—¶é—´æ—¥æœŸå¯¹è±¡çš„parse/formatæ–¹æ³•å¯ä»¥ç›´æ¥è¿›è¡Œè½¬æ¢ã€‚

```Java
import java.time.LocalDateTime;
import java.time.format.DateTimeFormatter;

public class JavaTimeDemo05 {
    public static void main(String[] args) {
        LocalDateTime now = LocalDateTime.now();
        String s1 = now.format(DateTimeFormatter.ISO_DATE_TIME);
        String s2 = now.format(DateTimeFormatter.ISO_DATE);
        System.out.println(now);
        System.out.println(s1);
        System.out.println(s2);

        LocalDateTime time = LocalDateTime.parse(s1);
        System.out.println(time);
    }
}
```

DateTimeFormatter.ofLocalizedDate()æ–¹æ³•çš„ä½¿ç”¨

```Java
import java.time.LocalDateTime;
import java.time.format.DateTimeFormatter;
import java.time.format.FormatStyle;

public class JavaTimeDemo05 {
    public static void main(String[] args) {
        LocalDateTime now = LocalDateTime.now();
        String s1 = now.format(DateTimeFormatter.ofLocalizedDate(FormatStyle.FULL));
        String s2 = now.format(DateTimeFormatter.ofLocalizedDate(FormatStyle.LONG));
        String s3 = now.format(DateTimeFormatter.ofLocalizedDate(FormatStyle.MEDIUM));
        String s4 = now.format(DateTimeFormatter.ofLocalizedDate(FormatStyle.SHORT));
        System.out.println(now);
        System.out.println(s1);
        System.out.println(s2);
        System.out.println(s3);
        System.out.println(s4);
    }
}
```

è‡ªå®šä¹‰æ ¼å¼åŒ–å™¨

```Java
import java.time.LocalDateTime;
import java.time.format.DateTimeFormatter;

public class JavaTimeDemo05 {
    public static void main(String[] args) {
        LocalDateTime now = LocalDateTime.now();
        String s = now.format(DateTimeFormatter.ofPattern("yyyy/MM/dd HH:mm:ss:SSS"));
        System.out.println(s);
    }
}
```

ç»ƒä¹ æ¡ˆä¾‹ï¼šå°†1998å¹´3æœˆ18æ—¥17æ—¶19åˆ†28ç§’æ ¼å¼åŒ–ä¸ºä»¥ä¸‹æ ¼å¼1998-03æœˆ-18---17:19åˆ†28ç§’ã€‚

```Java
import java.time.LocalDateTime;
import java.time.format.DateTimeFormatter;

public class JavaTimeDemo06 {
    public static void main(String[] args) {
        LocalDateTime time = LocalDateTime.of(1998, 3, 18, 17, 19, 28);
        String s = time.format(DateTimeFormatter.ofPattern("yyyy-MMæœˆ-dd---HH:mmåˆ†:ssç§’"));
        System.out.println(s);
    }
}
```

